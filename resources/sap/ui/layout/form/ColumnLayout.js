/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/ResizeHandler","sap/ui/layout/library","./FormLayout","./ColumnLayoutRenderer","sap/ui/thirdparty/jquery"],function(e,t,i,a,s,r){"use strict";var l=a.extend("sap.ui.layout.form.ColumnLayout",{metadata:{library:"sap.ui.layout",properties:{columnsXL:{type:"sap.ui.layout.form.ColumnsXL",group:"Appearance",defaultValue:2},columnsL:{type:"sap.ui.layout.form.ColumnsL",group:"Appearance",defaultValue:2},columnsM:{type:"sap.ui.layout.form.ColumnsM",group:"Appearance",defaultValue:1},labelCellsLarge:{type:"sap.ui.layout.form.ColumnCells",group:"Appearance",defaultValue:4},emptyCellsLarge:{type:"sap.ui.layout.form.EmptyCells",group:"Appearance",defaultValue:0}}}});l.prototype.init=function(){this._iBreakPointTablet=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=e.media._predefinedRangeSets[e.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];this._resizeProxy=r.proxy(n,this);if(typeof ResizeObserver==="function"){this._oResizeObserver=new ResizeObserver(this._resizeProxy)}};l.prototype.exit=function(){o.call(this);this._oResizeObserver=undefined};l.prototype.onBeforeRendering=function(e){if(this.getColumnsM()>this.getColumnsL()||this.getColumnsL()>this.getColumnsXL()){throw new Error("Column size not correct defined for "+this)}o.call(this)};l.prototype.onAfterRendering=function(e){if(this._oResizeObserver){var i=this.getDomRef();this._oResizeObserver.observe(i)}else{this._sResizeListener=t.register(this,this._resizeProxy)}f.call(this)};l.prototype.toggleContainerExpanded=function(e){e.$().toggleClass("sapUiFormCLContainerColl",!e.getExpanded())};l.prototype.onLayoutDataChange=function(e){this.invalidate()};l.prototype.onsapup=function(e){this.onsapleft(e)};l.prototype.onsapdown=function(e){this.onsapright(e)};l.prototype.getContainerRenderedDomRef=function(e){return e.getDomRef()};l.prototype.getElementRenderedDomRef=function(e){return e.getDomRef()};l.prototype._getContainerSize=function(e){var t=this.getParent();var i=this.getLayoutDataForElement(e,"sap.ui.layout.form.ColumnContainerData");var a=t.getVisibleFormContainers();var s=a.length;var r=this.getColumnsM();var l=this.getColumnsL();var o=this.getColumnsXL();var n={S:{Size:1,Break:false,FirstRow:false},M:{Size:1,Break:false,FirstRow:false},L:{Size:1,Break:false,FirstRow:false},XL:{Size:1,Break:false,FirstRow:false}};var f=function(e,t,i,a,s){if(i<e){t.Size=Math.floor(e/i);if(s&&t.Size*i<e){t.Size=t.Size+e-t.Size*i}}t.Break=e>1&&a>0&&a%e===0;t.FirstRow=i>1&&a<e};if(i){n.M.Size=i.getColumnsM();n.L.Size=i.getColumnsL();n.XL.Size=i.getColumnsXL();if(n.M.Size>r||n.L.Size>l||n.XL.Size>o){throw new Error("More cells defined for FormContainer "+e.getId()+" than columns on "+this)}}if(s===1){if(!i){n.M.Size=r;n.L.Size=l;n.XL.Size=o}n.S.FirstRow=true;n.M.FirstRow=true;n.L.FirstRow=true;n.XL.FirstRow=true}else{var u=0;var g=0;var p=0;var m;var C=false;var d=0;var L=r;var S=l;var h=o;var v=0;for(v=0;v<s;v++){if(e===a[v]){u=v;m=i}else{m=this.getLayoutDataForElement(a[v],"sap.ui.layout.form.ColumnContainerData")}if(!m){var y=a[v].getVisibleFormElements();if(g<y.length){g=y.length;p=v}d++}else{C=true;L=L-m.getColumnsM();S=S-m.getColumnsL();h=h-m.getColumnsXL()}}n.S.FirstRow=s>1&&u===0;n.S.Break=u>0;if(!C){f(r,n.M,s,u,u===p);f(l,n.L,s,u,u===p);f(o,n.XL,s,u,u===p)}else{if(!i){if(d<L){f(L,n.M,d,u,u===p)}if(d<S){f(S,n.L,d,u,u===p)}if(d<h){f(h,n.XL,d,u,u===p)}}var z={M:{rowColumns:0,lineBreak:false,first:true},L:{rowColumns:0,lineBreak:false,first:true},XL:{rowColumns:0,lineBreak:false,first:true}};var F=function(e,t,i){if(i){if(e.rowColumns+i<=t){e.rowColumns=e.rowColumns+i;e.lineBreak=false}else{e.rowColumns=i;if(t>1){e.lineBreak=true}e.first=false}}else{if(e.rowColumns<t){e.rowColumns++;e.lineBreak=false}else{e.rowColumns=1;if(t>1){e.lineBreak=true}e.first=false}}};for(v=0;v<s;v++){if(e===a[v]){m=i}else{m=this.getLayoutDataForElement(a[v],"sap.ui.layout.form.ColumnContainerData")}F(z.M,r,m?m.getColumnsM():0);F(z.L,l,m?m.getColumnsL():0);F(z.XL,o,m?m.getColumnsXL():0);if(e===a[v]){n.M.Break=z.M.lineBreak;n.L.Break=z.L.lineBreak;n.XL.Break=z.XL.lineBreak;n.M.FirstRow=z.M.first;n.L.FirstRow=z.L.first;n.XL.FirstRow=z.XL.first;break}}}}return n};l.prototype._getFieldSize=function(e){var t=12;var i=this.getLayoutDataForElement(e,"sap.ui.layout.form.ColumnElementData");var a={S:{Size:t,Break:false,Space:0},L:{Size:t,Break:false,Space:0}};var s=t;var l=this.getLabelCellsLarge();if(i){a.S.Size=i.getCellsSmall();a.L.Size=i.getCellsLarge()}var o=e.getParent();var n=o.getLabelControl();if(n===e){if(!i){a.S.Size=s;a.L.Size=l}}else{var f=o.getFieldsForRendering();var u=f.length;var g=t;var p=t-this.getEmptyCellsLarge();if(n){var m=this.getLayoutDataForElement(n,"sap.ui.layout.form.ColumnElementData");if(m){s=m.getCellsSmall();l=m.getCellsLarge()}if(s<t){g=g-s}if(l<t){p=p-l}}else{s=0;l=0}if(u===1){if(!i){a.S.Size=g;a.L.Size=p}else if(n){if(a.S.Size>g){a.S.Break=true}if(a.L.Size>p){a.L.Break=true}}}else{var C=0;var d=[];var L=[];var S={availableCells:g,first:0,last:999,firstDefault:-1,defaultFields:0};var h=0;var v=0;var y=0;var z;d.push(r.extend({},S));S.availableCells=p;L.push(r.extend({},S));var F=function(e,t,i,a){e[t].last=i-1;e.push(r.extend({},S));t++;e[t].first=i;e[t].availableCells=a;return t};var c=function(e,i,a,s,r){if(e[i].availableCells-e[i].defaultFields<a){if(a<=s){i=F(e,i,r,s)}else{i=F(e,i,r,t)}}e[i].availableCells=e[i].availableCells-a;return i};var D=function(e,t,i,a){if(e[t].availableCells===e[t].defaultFields){t=F(e,t,a,i)}if(e[t].firstDefault<0){e[t].firstDefault=a}e[t].defaultFields++;return t};for(C=0;C<u;C++){if(e!==f[C]){z=this.getLayoutDataForElement(f[C],"sap.ui.layout.form.ColumnElementData")}else{z=i;y=C}if(z){h=c(d,h,z.getCellsSmall(),g,C);v=c(L,v,z.getCellsLarge(),p,C)}else{h=D(d,h,g,C);v=D(L,v,p,C)}}var k=function(e,i,a,s,r){var l=0;var o;for(C=0;C<e.length;C++){if(i>=e[C].first&&i<=e[C].last){o=e[C];break}}if(!a){s.Size=Math.floor(o.availableCells/o.defaultFields)}if(i===o.first&&i>0){s.Break=true;if(r>0&&r<t&&s.Size<=t-r){s.Space=r}}if(i===o.firstDefault){l=o.availableCells-o.defaultFields*s.Size;if(l>0){s.Size=s.Size+l}}};k(d,y,i,a.S,s);k(L,y,i,a.L,l)}}return a};function o(){if(this._oResizeObserver){this._oResizeObserver.disconnect()}if(this._sResizeListener){t.deregister(this._sResizeListener);this._sResizeListener=undefined}}function n(e,t){window.requestAnimationFrame(function(){f.call(this,e,t)}.bind(this))}function f(e,i){var a=this.getDomRef();if(!a){o.call(this);return}var s=this.$();if(!s.is(":visible")){return}if(t.isSuspended(a,this._resizeProxy)){return}var r=a.clientWidth;var l=1;if(r<=this._iBreakPointTablet){s.toggleClass("sapUiFormCLMedia-Std-Phone",true);s.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false)}else if(r>this._iBreakPointTablet&&r<=this._iBreakPointDesktop){s.toggleClass("sapUiFormCLMedia-Std-Tablet",true);s.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsM()}else if(r>this._iBreakPointDesktop&&r<=this._iBreakPointLargeDesktop){s.toggleClass("sapUiFormCLMedia-Std-Desktop",true);s.toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false).toggleClass("sapUiFormCLMedia-Std-LargeDesktop",false);l=this.getColumnsL()}else{s.toggleClass("sapUiFormCLMedia-Std-LargeDesktop",true);s.toggleClass("sapUiFormCLMedia-Std-Desktop",false).toggleClass("sapUiFormCLMedia-Std-Phone",false).toggleClass("sapUiFormCLMedia-Std-Tablet",false);l=this.getColumnsXL()}var n=this.getLabelCellsLarge()<12&&r/l>this._iBreakPointTablet;s.toggleClass("sapUiFormCLWideColumns",n);s.toggleClass("sapUiFormCLSmallColumns",!n)}return l});