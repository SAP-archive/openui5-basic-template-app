/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/core/Control","./library","sap/ui/core/ResizeHandler","./AlignedFlowLayoutRenderer","sap/ui/dom/units/Rem"],function(e,t,i,s,n,o){"use strict";var r=t.extend("sap.ui.layout.AlignedFlowLayout",{metadata:{library:"sap.ui.layout",properties:{minItemWidth:{type:"sap.ui.core.AbsoluteCSSSize",defaultValue:"12rem"},maxItemWidth:{type:"sap.ui.core.AbsoluteCSSSize",defaultValue:"24rem"}},defaultAggregation:"content",aggregations:{content:{type:"sap.ui.core.Control",multiple:true},endContent:{type:"sap.ui.core.Control",multiple:true}}}});r.prototype.init=function(){if(typeof ResizeObserver==="function"){this.oResizeObserver=new ResizeObserver(this.onResize.bind(this));this.fLayoutWidth=0;this.fEndItemWidth=0}else{this._sResizeHandlerContainerListenerID=s.register(this,this.onResizeHandler.bind(this))}this.fnReflow=this.reflow.bind(this);this.bReflowSuspended=false};r.prototype.exit=function(){this.fnReflow=null;this.disconnectResizeObserver();this.oResizeObserver=null;this.fLayoutWidth=undefined;this.fEndItemWidth=undefined;this.disconnectResizeHandler();this._sResizeHandlerContainerListenerID="";this._sResizeHandlerEndItemListenerID=""};r.prototype.onAfterRenderingOrThemeChanged=function(){window.requestAnimationFrame(function(){var t=this.getDomRef(),i=this.getDomRef("endItem"),s=!!(this.hasContent()&&t&&i);if(s){var n=window.getComputedStyle(t,null),o=n.getPropertyValue("padding-top"),r=i.style;if(e.getConfiguration().getRTL()){r.left=n.getPropertyValue("padding-left")}else{r.right=n.getPropertyValue("padding-right")}r.bottom=o}var f={domRef:t,endItemDomRef:i};this.reflow(f)}.bind(this))};r.prototype.onBeforeRendering=function(){this.disconnectResizeObserver();this.disconnectResizeHandlerForEndItem()};r.prototype.onAfterRendering=function(){this.observeSizeChangesIfRequired();this.onAfterRenderingOrThemeChanged()};r.prototype.onThemeChanged=r.prototype.onAfterRenderingOrThemeChanged;r.prototype.onResizeHandler=function(e){if(e.size.width!==e.oldSize.width){this.reflow()}};r.prototype.onResize=function(e){var t=this.getDomRef();this.bReflowSuspended=this.bReflowSuspended||this.unobserveSizeChangesIfReflowSuspended(t);if(this.bReflowSuspended){return}var i,s=e[0],n=f(this.fLayoutWidth,s,t),o=s.contentRect.width,r=s.contentRect.height;if(n){this.fLayoutWidth=o;this.fLayoutHeight=r}else{i=this.getDomRef("endItem");n=f(this.fEndItemWidth,s,i);if(n){this.fEndItemWidth=o;this.fLayoutHeight=r}else if(this.fLayoutHeight!==r){this.fLayoutHeight=r}else{return}}window.requestAnimationFrame(function(){var e={domRef:t,endItemDomRef:i};this.reflow(e)}.bind(this))};r.prototype.reflow=function(t){if(this.bReflowSuspended){this.bReflowSuspended=false;if(this.oResizeObserver){this.observeSizeChangesIfRequired()}}var i=this.getContent();if(i.length===0||!i[0].isActive()){return}t=t||{};var s=t.domRef||this.getDomRef();if(!s){return}var n=t.endItemDomRef||this.getDomRef("endItem"),o=this.getLastItemDomRef();if(!n||!o){if(!s.offsetParent){return}this.toggleDisplayOfSpacers(s);return}var r=s.lastElementChild;h(s,r);if(!s.offsetParent){return}var f=r.style,a=n.offsetHeight,d=n.offsetWidth,u=o.offsetTop,l=o.offsetLeft,p,g;if(e.getConfiguration().getRTL()){g=l}else{var m=Number.parseFloat(window.getComputedStyle(o).marginRight);var R=l+o.offsetWidth+m;g=s.offsetWidth-R}var c=Number.parseFloat(window.getComputedStyle(n).marginRight);var v=g>=d+c;if(v){if(this.checkItemsWrapping(s)){if(n.offsetTop<u){f.height=Math.max(0,a-u)+"px";if(o.offsetTop>=n.offsetTop){p=n.offsetLeft;l=o.offsetLeft;if(p>=l&&p<=l+o.offsetWidth){f.height=a+"px"}}f.display="block"}else{f.height="0";f.display=""}}else{if(n.offsetTop<u){f.height=a+"px"}f.display="block"}}else{f.height=a+"px";f.display="block"}var y=d+"px";f.width=y;f.minWidth=y;this.toggleDisplayOfSpacers(s)};r.prototype.toggleDisplayOfSpacers=function(e){var t=this.getRenderer().CSS_CLASS+"OneLine",i=true;if(this.checkItemsWrapping(e,i)){e.classList.remove(t)}else{e.classList.add(t)}};function f(e,t,i){var s=.25,n=t.contentRect.width;return i===t.target&&Math.abs(n-e)>=s}function h(e,t){var i=t&&t.style;if(i){i.width="";i.height="";i.display=""}e.classList.remove(e.classList.item(0)+"OneLine")}r.prototype.checkItemsWrapping=function(e,t){e=e||this.getDomRef();if(!e){return false}var i=e.firstElementChild,s=this.getLastItemDomRef();if(!i||!s){return false}var n=i.offsetTop,o=s.offsetTop,r=i.offsetHeight;if(o>=n+r){return true}if(t){return false}var f=this.getDomRef("endItem");return!!f&&f.offsetTop>=n+r};r.prototype.getLastItemDomRef=function(){var e=this.getContent(),t=e.length;if(t){var i=e[t-1],s=i.getDomRef();if(s){return s.parentElement}}return null};r.prototype.getLastVisibleDomRef=function(){return this.getDomRef("endItem")||this.getLastItemDomRef()};r.prototype.computeNumberOfSpacers=function(){var e=this.getContent().length;if(e===0){return 0}var t=e,i=this.getMinItemWidth(),s;if(i.lastIndexOf("rem")!==-1){s=o.toPx(i)}else if(i.lastIndexOf("px")!==-1){s=parseFloat(i)}if(s){var n=Math.max(document.documentElement.clientWidth,window.screen.width);t=Math.abs(n/s)}t=Math.min(t,e-1);t=Math.max(1,t);t=Math.floor(t);return t};r.prototype.observeSizeChangesIfRequired=function(){if(this.hasContent()){this.observeSizeChanges()}};r.prototype.observeSizeChanges=function(){var e=this.getDomRef();if(!e){return}var t=this.getDomRef("endItem");if(this.oResizeObserver){this.oResizeObserver.observe(e);if(t){this.oResizeObserver.observe(t)}return}if(t){this._sResizeHandlerEndItemListenerID=s.register(t,this.onResizeHandler.bind(this))}};r.prototype.unobserveSizeChanges=function(e){if(this.oResizeObserver&&e){this.oResizeObserver.unobserve(e)}};r.prototype.unobserveSizeChangesIfReflowSuspended=function(e){var t=s.isSuspended(e,this.fnReflow);if(t){this.unobserveSizeChanges(e);this.unobserveSizeChanges(this.getDomRef("endItem"));return true}return false};r.prototype.disconnectResizeObserver=function(){if(this.oResizeObserver){this.oResizeObserver.disconnect()}};r.prototype.disconnectResizeHandler=function(){if(this._sResizeHandlerContainerListenerID){s.deregister(this._sResizeHandlerContainerListenerID)}this.disconnectResizeHandlerForEndItem()};r.prototype.disconnectResizeHandlerForEndItem=function(){if(this._sResizeHandlerEndItemListenerID){s.deregister(this._sResizeHandlerEndItemListenerID)}};r.prototype.hasContent=function(){return this.getContent().length>0};return r});