/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/layout/cssgrid/GridLayoutBase","sap/ui/layout/cssgrid/GridSettings","sap/ui/Device"],function(t,i,e){"use strict";var o=/^([X][L](?:[1-9]|1[0-2]))? ?([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var s=o.exec("XL7 L6 M4 S2");var a={Phone:"sapUiLayoutCSSGridBoxLayoutSizeS",Tablet:"sapUiLayoutCSSGridBoxLayoutSizeM",Desktop:"sapUiLayoutCSSGridBoxLayoutSizeL",LargeDesktop:"sapUiLayoutCSSGridBoxLayoutSizeXL"};var r={XL:"sapUiLayoutCSSGridBoxLayoutSpanXL7",L:"sapUiLayoutCSSGridBoxLayoutSpanL6",M:"sapUiLayoutCSSGridBoxLayoutSpanM4",S:"sapUiLayoutCSSGridBoxLayoutSpanS2"};var n=t.extend("sap.ui.layout.cssgrid.GridBoxLayout",{metadata:{library:"sap.ui.layout",properties:{boxMinWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxesPerRowConfig:{type:"sap.ui.layout.BoxesPerRowConfig",group:"Behavior",defaultValue:"XL7 L6 M4 S2"}}}});n.prototype.getActiveGridSettings=function(){return new i({gridTemplateColumns:this._getTemplateColumns(),gridGap:"0.5rem 0.5rem",gridAutoRows:"1fr"})};n.prototype._applySingleGridLayout=function(i){if(this.isGridSupportedByBrowser()){t.prototype._applySingleGridLayout.call(this,i)}};n.prototype.renderSingleGridLayout=function(t){this._addSpanClasses(t);if(this.isGridSupportedByBrowser()){t.addClass("sapUiLayoutCSSGridBoxLayoutContainer")}else{t.addClass("sapUiLayoutCSSGridBoxLayoutPolyfill")}};n.prototype.onGridAfterRendering=function(i){t.prototype.onGridAfterRendering.call(this,i);if(!this._hasBoxWidth()){this._applySizeClass(i)}if(!this.isGridSupportedByBrowser()){this._calcWidth(i);this._flattenHeight(i)}};n.prototype.isResponsive=function(){return true};n.prototype.onGridResize=function(t){if(t){if(!this._hasBoxWidth()){this._applySizeClass(t.control)}}if(!this.isGridSupportedByBrowser()){this._flattenHeight(t.control)}};n.prototype._calcWidth=function(t){if(this._hasBoxWidth()){var i=this.getBoxWidth()||this.getBoxMinWidth();this._loopOverGridItems(t,function(t){t.style.width=i})}};n.prototype._flattenHeight=function(t){var i=0;this._loopOverGridItems(t,function(t){t.style.height=null;i=Math.max(t.getBoundingClientRect().height,i)});this._loopOverGridItems(t,function(t){if(t.getBoundingClientRect().height<i){t.style.height=i+"px"}})};n.prototype._applySizeClass=function(t){var i=e.media.getCurrentRange("StdExt",t.$().width()),o=a[i.name];t.getGridDomRefs().forEach(function(t){if(!t.classList.contains(o)){Object.keys(a).map(function(i){t.classList.remove(a[i])});t.classList.add(o)}})};n.prototype._getTemplateColumns=function(){var t="";if(this.getBoxWidth()){t="repeat(auto-fit, "+this.getBoxWidth()+")"}else if(this.getBoxMinWidth()){t="repeat(auto-fit, minmax("+this.getBoxMinWidth()+", 1fr))"}return t};n.prototype._hasBoxWidth=function(){if(this.getBoxWidth()||this.getBoxMinWidth()){return true}else{return false}};n.prototype._addSpanClasses=function(t){var i,e,a=this.getBoxesPerRowConfig(),n,p,u,d;if(this._hasBoxWidth()){return}if(!a||!a.lenght===0){i=s}else{i=o.exec(a)}if(i){for(var h=1;h<i.length;h++){e=i[h];if(e){e=e.toUpperCase();switch(e.substr(0,1)){case"X":if(e.substr(1,1)==="L"){n=this._getBoxesPerRowClass(e,2)}break;case"L":p=this._getBoxesPerRowClass(e,1);break;case"M":u=this._getBoxesPerRowClass(e,1);break;case"S":d=this._getBoxesPerRowClass(e,1);break;default:break}}}}n=n||r.XL;p=p||r.L;u=u||r.M;d=d||r.S;t.addClass([n,p,u,d].join(" "))};n.prototype._getBoxesPerRowClass=function(t,i){var e=parseInt(t.substr(i,t.length));if(e&&e>0&&e<13){return"sapUiLayoutCSSGridBoxLayoutSpan"+t}};n.prototype._loopOverGridItems=function(t,i){t.getGridDomRefs().forEach(function(t){if(t.children){for(var e=0;e<t.children.length;e++){i(t.children[e])}}})};return n});