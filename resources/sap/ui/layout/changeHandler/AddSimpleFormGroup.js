/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/JsControlTreeModifier","sap/base/Log"],function(e,t,r){"use strict";var n={};n.CONTENT_AGGREGATION="content";var o=function(e,t,r){for(var n=0;n<r.length;n++){var o=e.getControlType(r[n]);if(t.indexOf(o)===-1){if(e.getVisible(r[n])){return true}}else{return false}}};var i=function(e,t,r,n){var i;var a=-1;if(n===0){return n}if(o(e,t,r)){a++}for(var l=0;l<r.length;l++){var u=e.getControlType(r[l]);if(t.indexOf(u)>-1){a++;if(a===n){i=r[l];return r.indexOf(i)}}}return r.length};n.applyChange=function(t,o,a){var l=a.modifier;var u=a.view;var f=a.appComponent,g;var c=t.getDefinition();if(c.texts&&c.texts.groupLabel&&c.texts.groupLabel.value&&c.content&&c.content.group&&(c.content.group.selector||c.content.group.id)){var p=c.content.group.selector;var s;if(p){if(p.idIsLocal){s=f.createId(p.id)}else{s=p.id}}else{s=c.content.group.id}t.setRevertData({groupId:s});var d=c.texts.groupLabel.value;var v=l.getAggregation(o,n.CONTENT_AGGREGATION);var C;var b;if(typeof c.content.group.index==="number"){C=c.content.group.index}else{b=c.content.group.relativeIndex;C=i(l,["sap.ui.core.Title","sap.m.Title","sap.m.Toolbar","sap.m.OverflowToolbar"],v,b)}if(l.bySelector(s,f)){return e.markAsNotApplicable("Control to be created already exists:"+s)}g=l.createControl("sap.ui.core.Title",f,u,s);l.setProperty(g,"text",d);l.insertAggregation(o,"content",g,C,u)}else{r.error("Change does not contain sufficient information to be applied: ["+c.layer+"]"+c.namespace+"/"+c.fileName+"."+c.fileType)}return true};n.completeChangeContent=function(r,n,o){var i=r.getDefinition();var a=o.appComponent;if(n.newLabel){e.setTextInChange(i,"groupLabel",n.newLabel,"XFLD")}else{throw new Error("oSpecificChangeInfo.newLabel attribute required")}if(!i.content){i.content={}}if(!i.content.group){i.content.group={}}if(n.newControlId){i.content.group.selector=t.getSelector(n.newControlId,a)}else{throw new Error("oSpecificChangeInfo.newControlId attribute required")}if(n.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required")}else{i.content.group.relativeIndex=n.index}};n.getControlIdFromChangeContent=function(e){var t;if(e&&e._oDefinition){t=e._oDefinition.content.group.id}return t};n.revertChange=function(e,t,r){var o=r.appComponent;var i=r.view;var a=r.modifier;var l=e.getRevertData().groupId;var u=a.getSelector(l,o);var f=a.bySelector(u,o,i);a.removeAggregation(t,n.CONTENT_AGGREGATION,f);a.destroy(f);e.resetRevertData();return true};n.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getDefinition().content.group.selector]}};return n},true);