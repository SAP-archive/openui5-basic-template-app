/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/JsControlTreeModifier","sap/base/Log"],function(e,t){"use strict";var n={};var r=function(e,t){var n=t.getControlType(e);return n==="sap.ui.core.Title"||n==="sap.m.Title"||n==="sap.m.Toolbar"||n==="sap.m.OverflowToolbar"};var o=function(e,t){var n;for(n=0;n<e.length;++n){if(r(e[n],t)){return e[n]}}};n.applyChange=function(e,n,i){try{var a=i.modifier;var l=i.view;var g=i.appComponent;var s=e.getDefinition();var f=a.bySelector(s.content.elementSelector||s.content.sHideId,g,l);var c=a.getAggregation(n,"content");var m=-1;var u=this._getState(n,a,g);e.setRevertData(u);a.removeAllAggregation(n,"content");for(var v=0;v<c.length;++v){a.insertAggregation(n,"content",c[v],v,l)}if(s.changeType==="hideSimpleFormField"){c.some(function(e,t){if(e===f){m=t;a.setVisible(e,false)}if(m>=0&&t>m){if(a.getControlType(e)==="sap.m.Label"||a.getControlType(e)==="sap.ui.comp.smartfield.SmartLabel"||r(e,a)){return true}else{a.setVisible(e,false)}}})}else if(s.changeType==="removeSimpleFormGroup"){var p=o(c,a);var d=p&&!f;c.some(function(e,t){if(!p){a.setVisible(e,false)}else if(d){m=0;a.setVisible(e,false);d=false}else{if(e===f){m=t}if(m>=0&&t>m){if(r(e,a)){if(m===0){a.removeAggregation(n,"content",e,l);a.insertAggregation(n,"content",e,0,l)}return true}else{a.setVisible(e,false)}}}});if(f){a.removeAggregation(n,"content",f,l);a.insertAggregation(n,"dependents",f,0,l)}}return true}catch(n){e.resetRevertData();t.error(n.message||n.name)}};n._getStableElement=function(e){if(e.getMetadata().getName()==="sap.ui.layout.form.FormContainer"){return e.getTitle()||e.getToolbar()}else if(e.getMetadata().getName()==="sap.ui.layout.form.FormElement"){return e.getLabel()}else{return e}};n.completeChangeContent=function(t,n,r){var o=t.getDefinition();if(n.removedElement&&n.removedElement.id){var i=this._getStableElement(sap.ui.getCore().byId(n.removedElement.id));o.content.elementSelector=e.getSelector(i,r.appComponent);t.addDependentControl(i,"elementSelector",r)}else{throw new Error("oSpecificChangeInfo.removedElement.id attribute required")}};n._getState=function(e,t,n){var r=t.getAggregation(e,"content");return{content:r.map(function(e){return{elementSelector:t.getSelector(t.getId(e),n),visible:e.getVisible?e.getVisible():undefined,index:r.indexOf(e)}})}};n.revertChange=function(e,t,n){var r=e.getRevertData();var o=n.appComponent;var i=n.modifier;i.removeAllAggregation(t,"content");r.content.forEach(function(e){var r=i.bySelector(e.elementSelector,o,n.view);var a=i.getAggregation(t,"dependents");a.some(function(e){if(i.getProperty(e,"id")===i.getProperty(r,"id")){i.removeAggregation(t,"dependents",e,n.view);return true}});i.insertAggregation(t,"content",r,e.index,n.view);i.setProperty(r,"visible",e.visible)});e.resetRevertData();return true};n.getChangeVisualizationInfo=function(e){return{affectedControls:[e.getDefinition().content.elementSelector]}};return n},true);