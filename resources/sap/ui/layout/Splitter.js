/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","./library","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/ui/core/RenderManager","./SplitterRenderer","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/layout/SplitterLayoutData"],function(e,t,i,r,s,a,o,n,h){"use strict";var u=i.Orientation;var l=16;var d=e.extend("sap.ui.layout.Splitter",{metadata:{library:"sap.ui.layout",properties:{orientation:{type:"sap.ui.core.Orientation",group:"Behavior",defaultValue:u.Horizontal},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"}},defaultAggregation:"contentAreas",aggregations:{contentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"contentArea"}},events:{resize:{parameters:{id:{type:"string"},oldSizes:{type:"int[]"},newSizes:{type:"int[]"}}}},designtime:"sap/ui/layout/designtime/Splitter.designtime"},renderer:a});d.prototype.init=function(){this._liveResize=true;this._keyboardEnabled=true;this._bHorizontal=true;this._calculatedSizes=[];this._move={};this._resizeTimeout=null;this._resizeCallback=this._delayedResize.bind(this);this._resizeHandlerId=null;this._autoResize=true;this.enableAutoResize();this._boundBarMoveEnd=this._onBarMoveEnd.bind(this);this._boundBarMove=this._onBarMove.bind(this);this._initOrientationProperties();this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",20),decrease:this._onKeyboardResize.bind(this,"dec",20),increaseMore:this._onKeyboardResize.bind(this,"incMore",20),decreaseMore:this._onKeyboardResize.bind(this,"decMore",20),max:this._onKeyboardResize.bind(this,"max",20),min:this._onKeyboardResize.bind(this,"min",20)};this._enableKeyboardListeners()};d.prototype.exit=function(){this.disableAutoResize();delete this._resizeCallback;delete this._boundBarMoveEnd;delete this._boundBarMove;delete this._$SplitterOverlay;delete this._$SplitterOverlayBar};d.prototype.onBeforeRendering=function(){this._initOrientationProperties()};d.prototype.onAfterRendering=function(){this._$SplitterOverlay=this.$("overlay");this._$SplitterOverlayBar=this.$("overlayBar");this._resize()};d.prototype.triggerResize=function(e){if(e){this._resize()}else{this._delayedResize()}};d.prototype.resetContentAreasSizes=function(){var e=this._getContentAreas();for(var t=0;t<e.length;t++){var i=e[t].getLayoutData();var r=i.getMinSize()!=0;var s=r?i.getMinSize()+"px":"auto";i.setSize(s);this.$("content-"+t).css(this._sizeType,s)}};d.prototype.getCalculatedSizes=function(){return this._calculatedSizes};d.prototype.enableAutoResize=function(e){if(e&&!this._autoResize){return}this._autoResize=true;var t=this;sap.ui.getCore().attachInit(function(){t._resizeHandlerId=r.register(t,t._resizeCallback)});this._delayedResize()};d.prototype.disableAutoResize=function(e){r.deregister(this._resizeHandlerId);if(!e){this._autoResize=false}};d.prototype.enableLiveResize=function(){this._liveResize=true;this.removeStyleClass("sapUiLoSplitterAnimated")};d.prototype.disableLiveResize=function(){this._liveResize=false;this.addStyleClass("sapUiLoSplitterAnimated")};d.prototype.enableKeyboardSupport=function(){var e=this.$().find(".sapUiLoSplitterBar");e.attr("tabindex","0");this._enableKeyboardListeners()};d.prototype.disableKeyboardSupport=function(){var e=this.$().find(".sapUiLoSplitterBar");e.attr("tabindex","-1");this._disableKeyboardListeners()};d.prototype.onLayoutDataChange=function(){this._delayedResize()};d.prototype.ontouchstart=function(e){if(this._ignoreTouch){return}var t=this._getBar(e.target);if(!t){return}if(!e.changedTouches||!e.changedTouches[0]){return}this._ignoreMouse=true;this._onBarMoveStart(e.changedTouches[0],t,true)};d.prototype.onmousedown=function(e){if(this._ignoreMouse){return}var t=this._getBar(e.target);if(!t){return}this._ignoreTouch=true;this._onBarMoveStart(e,t);this._oLastDOMclicked=t};d.prototype._onBarMoveStart=function(e,t,i){var r=this.getId();this.disableAutoResize(true);var s=e[this._moveCord];var a=parseInt(t.id.substr((r+"-splitbar-").length));var o=n(t);var h=this.getCalculatedSizes();var u=this._bHorizontal?o.outerWidth():o.outerHeight();var l=this._getContentAreas();var d=l[a].getLayoutData();var p=l[a+1].getLayoutData();if(!d.getResizable()||!p.getResizable()){c(i);return}var v=0-u;for(var _=0;_<=a;++_){v+=h[_]+u}this._move={start:s,relStart:v,barNum:a,$bar:o,c1Size:h[a],c1MinSize:d?parseInt(d.getMinSize()):0,c2Size:h[a+1],c2MinSize:p?parseInt(p.getMinSize()):0};if(i){document.addEventListener("touchend",this._boundBarMoveEnd);document.addEventListener("touchmove",this._boundBarMove)}else{document.addEventListener("mouseup",this._boundBarMoveEnd);document.addEventListener("mousemove",this._boundBarMove)}this._$SplitterOverlay.css("display","block");this._$SplitterOverlayBar.css(this._sizeDirNot,"");this._move.$bar.css("visibility","hidden");this._onBarMove(e)};d.prototype._onBarMove=function(e){if(e.preventDefault&&!e.changedTouches){e.preventDefault()}var t=e;if(e.changedTouches&&e.changedTouches[0]){t=t.changedTouches[0]}var i=t[this._moveCord];var r=i-this._move.start;if(this.getOrientation()==u.Horizontal&&this._bRtl){r=-r}var s=this._move.c1Size+r;var a=this._move.c2Size-r;var o=s>=0&&a>=0&&s>=this._move.c1MinSize&&a>=this._move.c2MinSize;if(o){this._$SplitterOverlayBar.css(this._sizeDir,this._move.relStart+r);if(this._liveResize){var n=this._move["start"]-t[this._moveCord];if(this.getOrientation()==u.Horizontal&&this._bRtl){n=-n}this._resizeContents(this._move["barNum"],-n,false)}}};d.prototype._onBarMoveEnd=function(e){this._ignoreMouse=false;this._ignoreTouch=false;var t=e;if(e.changedTouches&&e.changedTouches[0]){t=t.changedTouches[0]}var i=t[this._moveCord];var r=this._move["start"]-i;if(this.getOrientation()==u.Horizontal&&this._bRtl){r=-r}this._resizeContents(this._move["barNum"],-r,true);this._move.$bar.css("visibility","");this._$SplitterOverlay.css("display","");document.removeEventListener("mouseup",this._boundBarMoveEnd);document.removeEventListener("mousemove",this._boundBarMove);document.removeEventListener("touchend",this._boundBarMoveEnd);document.removeEventListener("touchmove",this._boundBarMove);this.enableAutoResize(true);if(this._move.$bar){this._move.$bar.trigger("focus")}};d.prototype._resizeContents=function(e,t,i){if(isNaN(t)){o.warning("Splitter: Received invalid resizing values - resize aborted.");return}var r=this._getContentAreas();var s=r[e].getLayoutData();var a=r[e+1].getLayoutData();var n=s.getSize();var h=a.getSize();var u=this.$("content-"+e);var l=this.$("content-"+(e+1));var d=this._move.c1Size+t;var p=this._move.c2Size-t;var c=parseInt(s.getMinSize());var v=parseInt(a.getMinSize());var _;if(d<c){_=c-d;t+=_;d=c;p-=_}else if(p<v){_=v-p;t-=_;p=v;d-=_}if(i){if(n==="auto"&&h!=="auto"){a.setSize(p+"px")}else if(n!=="auto"&&h==="auto"){s.setSize(d+"px")}else{s.setSize(d+"px");a.setSize(p+"px")}}else{u.css(this._sizeType,d+"px");l.css(this._sizeType,p+"px")}};d.prototype._delayedResize=function(e){if(e===undefined){e=0}if(this.getDomRef()){clearTimeout(this._resizeTimeout);this._resizeTimeout=setTimeout(this._resize.bind(this),e)}};d.prototype._resizeBars=function(e){var t,i;var r=this.$();for(t=0;t<e.length-1;++t){i=this.$("splitbar-"+t);i.css(this._sizeTypeNot,"")}for(t=0;t<e.length-1;++t){i=this.$("splitbar-"+t);var s=this._bHorizontal?r.height():r.width();i.css(this._sizeType,"");i.css(this._sizeTypeNot,s+"px")}};d.prototype._resize=function(){var e=this.getDomRef();if(!e||s.getPreserveAreaRef().contains(e)){return}var t=0,i;var r=this._getContentAreas();this._resizeBars(r);var a=this.getCalculatedSizes();this._recalculateSizes();var o=this.getCalculatedSizes();var n=false;for(t=0;t<o.length;++t){if(o[t]!==0){n=true;break}}if(!n){this._delayedResize(100);return}var h=true;for(t=0;t<r.length;++t){var u=this.$("content-"+t);var l=r[t];u.css(this._sizeType,o[t]+"px");u.css(this._sizeTypeNot,"");var d=l.getLayoutData();var c=d&&d.getResizable();if(t>0){var v=c&&h;i=this.$("splitbar-"+(t-1));i.toggleClass("sapUiLoSplitterNoResize",!v);i.attr("tabindex",v&&this._keyboardEnabled?"0":"-1")}h=c}this._resizeBars(r);if(p(a,o)){this.fireResize({oldSizes:a,newSizes:o})}};d.prototype._calculateAvailableContentSize=function(e){var t=0;var i=this.$();var r=this._bHorizontal?i.innerWidth():i.innerHeight();var s=0;var a=false;for(t=0;t<e.length;++t){var o=e[t];if(o.indexOf("%")>-1){s++}if(e[t]=="auto"){a=true}}s+=a?1:0;if(this.getOrientation()===u.Horizontal){r-=s}var n=e.length-1;var h=0;for(t=0;t<n;++t){h+=this._bHorizontal?this.$("splitbar-"+t).outerWidth():this.$("splitbar-"+t).outerHeight()}return Math.max(0,r-h)};d.prototype._recalculateSizes=function(){var e,t,i,r,s;var a=[];var n=this._getContentAreas();for(e=0;e<n.length;++e){i=n[e].getLayoutData();t=i?i.getSize():"auto";a.push(t)}this._calculatedSizes=[];var h=this._calculateAvailableContentSize(a);var u=[];var d=[];var p=[];var c=h;for(e=0;e<a.length;++e){t=a[e];var v;if(t.indexOf("rem")>-1){v=parseFloat(t)*l;c-=v;this._calculatedSizes[e]=v}else if(t.indexOf("px")>-1){v=parseInt(t);c-=v;this._calculatedSizes[e]=v}else if(t.indexOf("%")>-1){p.push(e)}else if(a[e]=="auto"){i=n[e].getLayoutData();if(i&&parseInt(i.getMinSize())!=0){d.push(e)}else{u.push(e)}}else{o.error("Illegal size value: "+a[e])}}var _=false;if(c<0){_=true;c=0}var f=p.length;for(e=0;e<f;++e){s=p[e];r=Math.floor(parseFloat(a[s])/100*h);this._calculatedSizes[s]=r;c-=r}h=c;if(h<0){_=true;h=0}r=Math.floor(h/(d.length+u.length),0);var g=d.length;for(e=0;e<g;++e){s=d[e];var z=parseInt(n[s].getLayoutData().getMinSize());if(z>r){this._calculatedSizes[s]=z;h-=z}else{this._calculatedSizes[s]=r;h-=r}}if(h<0){_=true;h=0}c=h;var y=u.length;r=Math.floor(h/y,0);for(e=0;e<y;++e){s=u[e];this._calculatedSizes[s]=r;c-=r}if(_){o.info("[Splitter] The set sizes and minimal sizes of the splitter contents are bigger "+"than the available space in the UI.")}};d.prototype._initOrientationProperties=function(){this._bHorizontal=this.getOrientation()===u.Horizontal;if(this._bHorizontal){this._sizeDirNot="top";this._sizeTypeNot="height";this._sizeType="width";this._moveCord="pageX";if(this._bRtl){this._sizeDir="right"}else{this._sizeDir="left"}}else{this._moveCord="pageY";this._sizeType="height";this._sizeTypeNot="width";this._sizeDir="top";this._sizeDirNot="left"}};d.prototype._onKeyboardResize=function(e,t,i){var r=this.getId()+"-splitbar-";if(!i||!i.target||!i.target.id||i.target.id.indexOf(r)!==0){return}var s=999999;var a=parseInt(i.target.id.substr(r.length));var n=this.getCalculatedSizes();this._move.c1Size=n[a];this._move.c2Size=n[a+1];var h=0;switch(e){case"inc":h=t;break;case"incMore":h=t*10;break;case"dec":h=0-t;break;case"decMore":h=0-t*10;break;case"max":h=s;break;case"min":h=0-s;break;default:o.warn("[Splitter] Invalid keyboard resize type");break}this._resizeContents(a,h,true)};d.prototype._enableKeyboardListeners=function(){this.onsapright=this._keyListeners.increase;this.onsapdown=this._keyListeners.increase;this.onsapleft=this._keyListeners.decrease;this.onsapup=this._keyListeners.decrease;this.onsappageup=this._keyListeners.decreaseMore;this.onsappagedown=this._keyListeners.increaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true};d.prototype._disableKeyboardListeners=function(){delete this.onsapincreasemodifiers;delete this.onsapdecreasemodifiers;delete this.onsapendmodifiers;delete this.onsaphomemodifiers;this._keyboardEnabled=false};d.prototype._getBar=function(e){var t=e,i=this.getId();function r(e,t){if(e.getAttribute("class")){return e.getAttribute("class").indexOf(t)>-1}return null}if(r(t,"sapUiLoSplitterBarGripIcon")){t=e.parentElement}if(r(t,"sapUiLoSplitterBarDecorationBefore")||r(t,"sapUiLoSplitterBarDecorationAfter")||r(t,"sapUiLoSplitterBarGrip")){t=t.parentElement}if(!t.id||t.id.indexOf(i+"-splitbar")!==0){return null}return t};function p(e,t){if(e===t){return false}if(!e||!t||e.length===undefined||t.length===undefined){return true}if(e.length!=t.length){return true}for(var i=0;i<e.length;++i){if(e[i]!==t[i]){return true}}return false}function c(e){var t=function(t){if(!e){t.preventDefault()}};var i=null;i=function(){document.removeEventListener("touchend",i);document.removeEventListener("touchmove",t);document.removeEventListener("mouseup",i);document.removeEventListener("mousemove",t)};if(e){this._ignoreMouse=true;document.addEventListener("touchend",i);document.addEventListener("touchmove",t)}else{document.addEventListener("mouseup",i);document.addEventListener("mousemove",t)}}d.prototype._ensureLayoutData=function(e){var t=e.getLayoutData();if(t&&(!t.getResizable||!t.getSize||!t.getMinSize)){o.warning('Content "'+e.getId()+'" for the Splitter contained wrong LayoutData. '+"The LayoutData has been replaced with default values.");t=null}if(!t){e.setLayoutData(new h)}};d.prototype.invalidate=function(t){var i=t&&this.indexOfContentArea(t)!=-1||t&&t instanceof sap.ui.core.CustomData&&t.getWriteToDom()||t===undefined;if(i){e.prototype.invalidate.apply(this,arguments)}};d.prototype.addContentArea=function(e){this._ensureLayoutData(e);return this.addAggregation("contentAreas",e)};d.prototype.insertContentArea=function(e,t){this._ensureLayoutData(e);return this.insertAggregation("contentAreas",e,t)};d.prototype._getContentAreas=function(){return this.getContentAreas()};return d});