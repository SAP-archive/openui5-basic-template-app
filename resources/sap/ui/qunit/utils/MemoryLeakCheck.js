/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Control","sap/ui/core/Core"],function(e,t){"use strict";if(typeof QUnit==="undefined"){sap.ui.requireSync("sap/ui/qunit/qunit-css");sap.ui.requireSync("sap/ui/thirdparty/qunit");sap.ui.requireSync("sap/ui/qunit/qunit-junit");sap.ui.requireSync("sap/ui/qunit/qunit-coverage")}QUnit.config.reorder=false;var n={};function o(){return e.registry.all()}var r=function(e){var t=e.getMetadata().getAllProperties();for(var n in t){if(e.isPropertyInitial(n)){var o=t[n];try{e[o._sMutator]("dummyValueForMemLeakTest")}catch(e){}}}if(!e.getTooltip()){e.setTooltip("test")}};var a=function(e,n,a,c){QUnit.test("Control "+e+" should not have any memory leaks",function(e){var l=n();e.ok(l,"calling fnControlFactory() should return something (a control)");e.ok(l instanceof t,"calling fnControlFactory() should return something that is really instanceof sap.ui.core.Control");if(l.placeAt&&!c){try{l.getMetadata().getRenderer()}catch(t){e.ok(false,"Error: control does not have a renderer. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl")}}r(l);if(l.placeAt&&!c){try{l.placeAt("qunit-fixture");sap.ui.getCore().applyChanges()}catch(t){e.ok(false,"Error: control has a renderer, but could not be rendered. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl");throw t}}if(a){a(l);sap.ui.getCore().applyChanges()}l.destroy();sap.ui.getCore().applyChanges();var s=o(),u=n();r(u);if(u.placeAt&&!c){u.placeAt("qunit-fixture");sap.ui.getCore().applyChanges();u.rerender();sap.ui.getCore().applyChanges()}if(a){a(u);sap.ui.getCore().applyChanges()}u.destroy();sap.ui.getCore().applyChanges();var f=o();i(e,f,s,"Memory leak check should not find any leftover controls after creating two instances and rendering twice"+(a?"\n(and calling fnSomeAdditionalFunction)":""))})};var i=function(e,t,n,o){var r=[];for(var a in t){if(!n[a]){r.push(t[a])}}for(var i=0;i<r.length;i++){if(typeof r[i].getText==="function"){r[i]+=" (text: '"+r[i].getText()+"')"}}o=o+(r.length>0?". LEFTOVERS: "+r.join(", "):"");e.equal(r.length,0,o)};n.checkControl=function(t,n,r,i){if(typeof t!=="string"){i=r;r=n;n=t;t="[some control, id: "+Math.random()+" - please update your test to also pass the control name]"}if(r===true||r===false){i=r;r=undefined}var c;QUnit.module("MemoryLeakCheck.checkControl: "+t,{beforeEach:function(){c=o()},afterEach:function(t){e.registry.forEach(function(e,n){if(!c[n]){t.ok(e.getMetadata().getName(),"Cleanup of id: "+n+", control: "+e.getMetadata().getName());e.destroy()}})}});QUnit.test("MemoryLeakCheck.checkControl(fnControlFactory) should receive a control factory",function(e){e.equal(typeof n,"function","MemoryLeakCheck should have received a control factory");e.ok(document.getElementById("qunit-fixture"),"the test page HTML should contain an element with ID 'qunit-fixture'")});a(t,n,r,i)};return n},true);