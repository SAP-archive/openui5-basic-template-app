/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Core","sap/ui/base/Object","sap/ui/core/Element","sap/ui/core/Control"],function(e,t,o,n,a){"use strict";e.sap.require("sap.ui.qunit.qunit-css");e.sap.require("sap.ui.thirdparty.qunit");e.sap.require("sap.ui.qunit.qunit-junit");e.sap.require("sap.ui.qunit.qunit-coverage");QUnit.config.reorder=false;var r={};function i(){return n.registry.all()}var l=function(e){var t=e.getMetadata().getAllProperties();for(var o in t){if(e.isPropertyInitial(o)){var n=t[o];try{e[n._sMutator]("dummyValueForMemLeakTest")}catch(e){}}}if(!e.getTooltip()){e.setTooltip("test")}};var s=function(e,t,o,n){QUnit.test("Control "+e+" should not have any memory leaks",function(e){var r=t();e.ok(r,"calling fnControlFactory() should return something (a control)");e.ok(r instanceof a,"calling fnControlFactory() should return something that is really instanceof sap.ui.core.Control");if(r.placeAt&&!n){try{r.getMetadata().getRenderer()}catch(t){e.ok(false,"Error: control does not have a renderer. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl")}}l(r);if(r.placeAt&&!n){try{r.placeAt("qunit-fixture");sap.ui.getCore().applyChanges()}catch(t){e.ok(false,"Error: control has a renderer, but could not be rendered. If this is known, please set the 'bControlCannotRender' flag when calling MemoryLeakCheck.checkControl");throw t}}if(o){o(r);sap.ui.getCore().applyChanges()}r.destroy();sap.ui.getCore().applyChanges();var s=i(),u=t();l(u);if(u.placeAt&&!n){u.placeAt("qunit-fixture");sap.ui.getCore().applyChanges();u.rerender();sap.ui.getCore().applyChanges()}if(o){o(u);sap.ui.getCore().applyChanges()}u.destroy();sap.ui.getCore().applyChanges();var f=i();c(e,f,s,"Memory leak check should not find any leftover controls after creating two instances and rendering twice"+(o?"\n(and calling fnSomeAdditionalFunction)":""))})};var c=function(e,t,o,n){var a=[];for(var r in t){if(!o[r]){a.push(t[r])}}for(var i=0;i<a.length;i++){if(typeof a[i].getText==="function"){a[i]+=" (text: '"+a[i].getText()+"')"}}n=n+(a.length>0?". LEFTOVERS: "+a.join(", "):"");e.equal(a.length,0,n)};r.checkControl=function(e,t,o,a){if(typeof e!=="string"){a=o;o=t;t=e;e="[some control, id: "+Math.random()+" - please update your test to also pass the control name]"}if(o===true||o===false){a=o;o=undefined}var r;QUnit.module("MemoryLeakCheck.checkControl: "+e,{beforeEach:function(){r=i()},afterEach:function(e){n.registry.forEach(function(t,o){if(!r[o]){e.ok(t.getMetadata().getName(),"Cleanup of id: "+o+", control: "+t.getMetadata().getName());t.destroy()}})}});QUnit.test("MemoryLeakCheck.checkControl(fnControlFactory) should receive a control factory",function(e){e.equal(typeof t,"function","MemoryLeakCheck should have received a control factory");e.ok(document.getElementById("qunit-fixture"),"the test page HTML should contain an element with ID 'qunit-fixture'")});s(e,t,o,a)};return r},true);