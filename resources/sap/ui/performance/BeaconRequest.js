/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log"],function(e){"use strict";var t=function(e){e=e||{};if(!t.isSupported()){throw Error("Beacon API is not supported")}if(typeof e.url!=="string"){throw Error("Beacon url must be valid")}this._nMaxBufferLength=e.maxBufferLength||10;this._aBuffer=[];this._sUrl=e.url;document.addEventListener("visibilitychange",function(){if(document.visibilityState==="hidden"){this.send()}}.bind(this));window.addEventListener("beforeunload",function(){this.send()}.bind(this))};t.isSupported=function(){return"navigator"in window&&"sendBeacon"in window.navigator&&"Blob"in window};t.prototype.append=function(e,t){this._aBuffer.push({key:e,value:t});if(this.getBufferLength()===this._nMaxBufferLength){this.send()}};t.prototype.getBufferLength=function(){return this._aBuffer.length};t.prototype.send=function(){if(this.getBufferLength()){var e=this._aBuffer.reduce(function(e,t){e+="&"+t.key+"="+t.value;return e},"sap-fesr-only=1");var t=new Blob([e],{type:"application/x-www-form-urlencoded;charset=UTF-8"});window.navigator.sendBeacon(this._sUrl,t);this.clear()}};t.prototype.clear=function(){this._aBuffer=[]};return t});