/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/performance/Measurement","sap/ui/performance/XHRInterceptor","sap/base/util/LoaderExtensions","sap/base/util/now","sap/base/util/uid","sap/base/Log","sap/ui/thirdparty/URI"],function(e,t,i,n,r,s,o){"use strict";var a=window.location.host,u="INTERACTION",p=[],d=m(),f={"application/zip":true,"application/vnd.rar":true,"application/gzip":true,"application/x-tar":true,"application/java-archive":true,"image/jpeg":true,"application/pdf":true},c="zip,rar,arj,z,gz,tar,lzh,cab,hqx,ace,jar,ear,war,jpg,jpeg,pdf,gzip";function g(e){var t=new o(e).host();return t&&t!==a}function l(e){var t=e.toString();var i="";for(var n=0;n<t.length;n+=2){i+=String.fromCharCode(parseInt(t.substr(n,2),16))}return i.trim()}function m(e){return{event:"startup",trigger:"undetermined",component:"undetermined",appVersion:"undetermined",start:e||window.performance.timing.fetchStart,end:0,navigation:0,roundtrip:0,processing:0,duration:0,requests:[],measurements:[],sapStatistics:[],requestTime:0,networkTime:0,bytesSent:0,bytesReceived:0,requestCompression:"X",busyDuration:0,id:r(),passportAction:"undetermined_startup_0"}}function h(e){if(e.start>d.start&&e.end<d.end){return e}}function y(e){var t=e.startTime>0&&e.startTime<=e.requestStart&&e.requestStart<=e.responseEnd;return t&&e.initiatorType==="xmlhttprequest"}function v(e){this.end=e.responseEnd>this.end?e.responseEnd:this.end;d.requestTime+=e.responseEnd-e.startTime;if(this.roundtripHigherLimit<=e.startTime){d.navigation+=this.navigationHigherLimit-this.navigationLowerLimit;d.roundtrip+=this.roundtripHigherLimit-this.roundtripLowerLimit;this.navigationLowerLimit=e.startTime;this.roundtripLowerLimit=e.startTime}if(e.responseEnd>this.roundtripHigherLimit){this.roundtripHigherLimit=e.responseEnd}if(e.requestStart>this.navigationHigherLimit){this.navigationHigherLimit=e.requestStart}}function L(e){var t={start:e[0].startTime,end:e[0].responseEnd,navigationLowerLimit:e[0].startTime,navigationHigherLimit:e[0].requestStart,roundtripLowerLimit:e[0].startTime,roundtripHigherLimit:e[0].responseEnd};e.forEach(v,t);d.navigation+=t.navigationHigherLimit-t.navigationLowerLimit;d.roundtrip+=t.roundtripHigherLimit-t.roundtripLowerLimit;if(d.networkTime){var i=d.requestTime-d.networkTime;d.networkTime=i/e.length}else{d.networkTime=0}if(d.processing===0){var n=d.start-window.performance.timing.fetchStart;d.duration=t.end-n;d.processing=t.start-n}}function S(t){if(d){var i=window.performance.getEntriesByType("resource");d.end=t;d.duration=d.processing;d.requests=i.filter(y);d.completeRoundtrips=0;d.measurements=e.filterMeasurements(h,true);if(d.requests.length>0){L(d.requests)}d.completeRoundtrips=d.requests.length;var n=d.processing-d.navigation-d.roundtrip;d.processing=n>-1?n:0;d.completed=true;Object.freeze(d);p.push(d);var r=p[p.length-1];if(P.onInteractionFinished&&r){P.onInteractionFinished(r)}if(s.isLoggable()){s.debug("Interaction step finished: trigger: "+d.trigger+"; duration: "+d.duration+"; requests: "+d.requests.length,"Interaction.js")}d=null}}function b(e){var t,i;if(e){var n,r;n=sap.ui.require("sap/ui/core/Component");while(n&&e&&e.getParent){r=n.getOwnerComponentFor(e);if(r||e instanceof n){r=r||e;var s=r.getManifestEntry("sap.app");t=s&&s.id||r.getMetadata().getName();i=s&&s.applicationVersion&&s.applicationVersion.version}e=e.getParent()}}return{id:t?t:"undetermined",version:i?i:""}}var I=false,T=false,E,w,H=false,q=false,R=0,A=0,_=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src");function C(){Object.defineProperty(HTMLScriptElement.prototype,"src",{set:function(e){var t;if(!this.dataset.sapUiCoreInteractionHandled){t=P.notifyAsyncStep();this.addEventListener("load",function(){t()});this.addEventListener("error",function(){t()});this.dataset.sapUiCoreInteractionHandled="true"}_.set.call(this,e)},get:_.get})}function D(){t.register(u,"send",function(){if(this.pendingInteraction){this.pendingInteraction.bytesSent+=arguments[0]?arguments[0].length:0}});t.register(u,"setRequestHeader",function(e,t){if(!this.requestHeaderLength){this.requestHeaderLength=0}this.requestHeaderLength+=(e+"").length+(t+"").length});t.register(u,"open",function(){var e,t,i;function n(e){if(this.readyState===4){e()}}if(d){if(!g(arguments[1])){e=P.passportHeader.get(this);if(e&&e.length>=370){t=l(e.substring(150,230));if(parseInt(e.substring(8,10),16)>2){i=e.substring(372,404)}}if(!e||t&&i&&d.passportAction.endsWith(t)){this.addEventListener("readystatechange",N.bind(this,d.id))}}this.addEventListener("readystatechange",n.bind(this,P.notifyAsyncStep()));this.pendingInteraction=d;this._ui5RequestUrl=arguments[1]||""}})}function j(e,t,i,n){var r=e.split(".").pop().split(/\#|\?/)[0];if(t==="gzip"||t==="br"||i in f||r&&c.indexOf(r)!==-1||n<1024){return true}else{return false}}function N(e){if(this.readyState===4){if(this.pendingInteraction&&!this.pendingInteraction.completed&&d.id===e){var t=this.getResponseHeader("content-length"),i=j(this.responseURL||this._ui5RequestUrl,this.getResponseHeader("content-encoding"),this.getResponseHeader("content-type"),t),n=this.getResponseHeader("sap-perf-fesrec");this.pendingInteraction.bytesReceived+=t?parseInt(t):0;this.pendingInteraction.bytesReceived+=this.getAllResponseHeaders().length;this.pendingInteraction.bytesSent+=this.requestHeaderLength||0;this.pendingInteraction.requestCompression=i&&this.pendingInteraction.requestCompression!==false;this.pendingInteraction.networkTime+=n?Math.round(parseFloat(n,10)/1e3):0;var r=this.getResponseHeader("sap-statistics");if(r){var s=window.performance.getEntriesByType("resource");this.pendingInteraction.sapStatistics.push({url:this.responseURL,statistics:r,timing:s?s[s.length-1]:undefined})}delete this.requestHeaderLength;delete this.pendingInteraction}}}var P={getAll:function(e){if(e){P.end(true)}return p},filter:function(e){var t=[];if(e){for(var i=0,n=p.length;i<n;i++){if(e(p[i])){t.push(p[i])}}}return t},getPending:function(){return d},clear:function(){p=[]},start:function(e,t){var i=n();if(d){S(i)}if(w){clearTimeout(w)}R=0;if(window.performance.clearResourceTimings){window.performance.clearResourceTimings()}var r=b(t);d=m(i);d.event=e;d.component=r.id;d.appVersion=r.version;d.start=i;if(t&&t.getId){d.trigger=t.getId()}if(s.isLoggable(null,"sap.ui.Performance")){console.time("INTERACTION: "+d.trigger+" - "+d.event)}if(s.isLoggable()){s.debug("Interaction step started: trigger: "+d.trigger+"; type: "+d.event,"Interaction.js")}},end:function(e){if(d){if(e){if(s.isLoggable(null,"sap.ui.Performance")){console.timeEnd("INTERACTION: "+d.trigger+" - "+d.event)}S(d.preliminaryEnd||n());if(s.isLoggable()){s.debug("Interaction ended...")}}else{d.preliminaryEnd=n();d.processing=d.preliminaryEnd-d.start}}},getActive:function(){return I},setActive:function(e){if(e&&!I){D();C();i.notifyResourceLoading=P.notifyAsyncStep}I=e},notifyShowBusyIndicator:function(e){e._sapui_fesr_fDelayedStartTime=n()+e.getBusyIndicatorDelay()},notifyHideBusyIndicator:function(e){if(e._sapui_fesr_fDelayedStartTime){var t=n()-e._sapui_fesr_fDelayedStartTime;P.addBusyDuration(t>0?t:0);delete e._sapui_fesr_fDelayedStartTime}},notifyStepStart:function(e,t){if(I){if(!d&&E&&!T||t){var i;if(t){i="startup"}else if(E.originalEvent){i=E.originalEvent.type}else{i=E.type}P.start(i,e);d=P.getPending();if(d&&!d.completed&&P.onInteractionStarted){d.passportAction=P.onInteractionStarted(d,t)}E=null;T=true;setTimeout(function(){E=null;T=false},0)}}},notifyAsyncStep:function(e){if(d){if(s.isLoggable(null,"sap.ui.Performance")&&e){console.time(e)}var t=d.id;P.notifyAsyncStepStart();return function(){P.notifyAsyncStepEnd(t);if(s.isLoggable(null,"sap.ui.Performance")&&e){console.timeEnd(e)}}}else{return function(){}}},notifyAsyncStepStart:function(){if(d){R++;clearTimeout(w);H=false;if(s.isLoggable()){s.debug("Interaction relevant step started - Number of pending steps: "+R)}}},notifyAsyncStepEnd:function(e){if(d&&e===d.id){R--;P.notifyStepEnd(true);if(s.isLoggable()){s.debug("Interaction relevant step stopped - Number of pending steps: "+R)}}},notifyStepEnd:function(e){if(I&&!q){if(R===0||!e){if(H||!e){P.end(true);if(s.isLoggable()){s.debug("Interaction stopped")}H=false}else{P.end();H=true;if(w){clearTimeout(w)}w=setTimeout(P.notifyStepEnd,250);if(s.isLoggable()){s.debug("Interaction check for idle time - Number of pending steps: "+R)}}}}},notifyEventStart:function(e){E=I?e:null},notifyScrollEvent:function(e){if(I){if(!A){P.notifyEventStart(e)}else{clearTimeout(A)}A=setTimeout(function(){P.notifyStepStart(e.sourceElement);A=0;P.notifyStepEnd()},250)}},notifyEventEnd:function(){if(E){if(E.type.match(/^(mousedown|touchstart|keydown)$/)){P.end(true)}}},onInteractionStarted:null,onInteractionFinished:null,setStepComponent:function(e){if(I&&d&&e&&!d.stepComponent){d.stepComponent=e}},addBusyDuration:function(e){if(I&&d){if(!d.busyDuration){d.busyDuration=0}d.busyDuration+=e}}};return P});