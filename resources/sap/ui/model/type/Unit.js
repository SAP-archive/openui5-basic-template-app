/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/strings/hash","sap/base/util/each","sap/base/util/extend","sap/base/util/isEmptyObject","sap/ui/core/LocaleData","sap/ui/core/format/NumberFormat","sap/ui/model/CompositeType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException"],function(t,e,a,i,s,n,r,o,u,m){"use strict";var c=r.extend("sap.ui.model.type.Unit",{constructor:function(t,e,a){r.apply(this,arguments);this.sName="Unit";this.bShowMeasure=!t||!("showMeasure"in t)||t.showMeasure;this.bShowNumber=!t||!("showNumber"in t)||t.showNumber;this.bUseRawValues=true;this.aDynamicFormatOptionNames=a}});c.prototype._getInstance=function(e,i){var r=this.createFormatOptions(e);if(i&&!this.oFormatOptions.customUnits&&!r.customUnits){var o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var u=s.getInstance(o);var m=u.getUnitFromMapping(i)||i;var p=u.getUnitFormat(m);if(p){var h=a({},p);h.decimals=r.decimals!=undefined?r.decimals:h.decimals;h.precision=r.precision!=undefined?r.precision:h.precision;r.customUnits={};r.customUnits[i]=h}}var l=r;if(this.oFormatOptions){l=a({},this.oFormatOptions,r)}if(this.getMetadata().getClass()!==c){var f=this.getMetadata();f._mTypeInstanceCache=f._mTypeInstanceCache||{};var g=t(JSON.stringify(l)||"");var y=f._mTypeInstanceCache[g];if(!y){y=n.getUnitInstance(l);f._mTypeInstanceCache[g]=y}return y}else{return n.getUnitInstance(l)}};c.prototype._clearInstances=function(){if(this.getMetadata().getClass()!==c){var t=this.getMetadata();if(t._mTypeInstanceCache){t._mTypeInstanceCache={}}}};c.prototype.createFormatOptions=function(t){var e={};if(this.aDynamicFormatOptionNames&&t.length>=this.aDynamicFormatOptionNames.length){this.aDynamicFormatOptionNames.forEach(function(a,i){if(a){e[a]=t[i]}})}return e};c.prototype.extractArguments=function(t){return Array.isArray(t)&&t.length>2?t.slice(2):[]};c.prototype.formatValue=function(t,e){var a=t;if(t==undefined||t==null){return null}if(this.oInputFormat){a=this.oInputFormat.parse(t)}if(!Array.isArray(a)){throw new o("Cannot format Unit: "+t+" has the wrong format")}if((a[0]==undefined||a[0]==null)&&this.bShowNumber){return null}switch(this.getPrimitiveType(e)){case"string":this.aDynamicValues=this.extractArguments(a);this.oOutputFormat=this._getInstance(this.aDynamicValues,a[1]);return this.oOutputFormat.format(a);case"int":case"float":case"any":default:throw new o("Don't know how to format Unit to "+e)}};c.prototype.parseValue=function(t,e){var a;switch(this.getPrimitiveType(e)){case"string":this.oOutputFormat=this._getInstance(this.aDynamicValues);a=this.oOutputFormat.parse(t);if(!Array.isArray(a)||this.bShowNumber&&isNaN(a[0])){throw this.getParseException()}break;case"int":case"float":default:throw new u("Don't know how to parse Unit from "+e)}if(this.oInputFormat){a=this.oInputFormat.format(a)}return a};c.prototype.validateValue=function(t){if(this.oConstraints){var a=sap.ui.getCore().getLibraryResourceBundle(),i=[],s=[],r=t,o;if(this.oInputFormat){r=this.oInputFormat.parse(t)}o=r[0];e(this.oConstraints,function(t,e){switch(t){case"minimum":if(o<e){i.push("minimum");s.push(a.getText("Unit.Minimum",[e]))}break;case"maximum":if(o>e){i.push("maximum");s.push(a.getText("Unit.Maximum",[e]))}break;case"decimals":var r=n._shiftDecimalPoint(o,e);if(Math.floor(r)!==r){i.push("decimals");s.push(a.getText("Unit.Decimals",[e]))}break;default:break}});if(i.length>0){throw new m(s.join(" "),i)}}};c.prototype.setFormatOptions=function(t){this.oFormatOptions=Object.assign(t.style!=="short"&&t.style!=="long"?{preserveDecimals:true}:{},t);this._clearInstances();this._createInputFormat()};c.prototype._handleLocalizationChange=function(){this._clearInstances();this._createInputFormat()};c.prototype._createInputFormat=function(){var t=this.oFormatOptions.source;if(t){if(i(t)){t={groupingEnabled:false,groupingSeparator:",",decimalSeparator:"."}}this.oInputFormat=n.getUnitInstance(t)}};c.prototype.getParseException=function(){var t=sap.ui.getCore().getLibraryResourceBundle(),e;if(!this.bShowNumber){e=t.getText("Unit.InvalidMeasure")}else if(!this.bShowMeasure){e=t.getText("EnterNumber")}else{e=t.getText("Unit.Invalid")}return new u(e)};c.prototype.getPartsIgnoringMessages=function(){if(!this.bShowMeasure){return[1]}else if(!this.bShowNumber){return[0]}return[]};return c});