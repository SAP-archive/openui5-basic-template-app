/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/base/util/each","sap/base/util/extend","sap/ui/model/ChangeReason","sap/ui/model/ClientListBinding"],function(t,e,i,s,n,a,h){"use strict";var o=h.extend("sap.ui.model.json.JSONListBinding");o.prototype.getContexts=function(e,i){this.iLastStartIndex=e;this.iLastLength=i;if(!e){e=0}if(!i){i=Math.min(this.iLength,this.oModel.iSizeLimit)}var s=this._getContexts(e,i),n=[];if(this.bUseExtendedChangeDetection){try{for(var a=0;a<s.length;a++){n.push(this.getContextData(s[a]))}if(this.aLastContextData&&e<this.iLastEndIndex){s.diff=this.diffData(this.aLastContextData,n)}this.iLastEndIndex=e+i;this.aLastContexts=s.slice(0);this.aLastContextData=n.slice(0)}catch(e){this.bUseExtendedChangeDetection=false;t.warning("JSONListBinding: Extended change detection has been disabled as JSON data could not be serialized.")}}return s};o.prototype.getCurrentContexts=function(){if(this.bUseExtendedChangeDetection){return this.aLastContexts||[]}else{return this.getContexts(this.iLastStartIndex,this.iLastLength)}};o.prototype.updateIndices=function(){var t;this.aIndices=[];if(Array.isArray(this.oList)){for(t=0;t<this.oList.length;t++){this.aIndices.push(t)}}else{for(t in this.oList){this.aIndices.push(t)}}};o.prototype.update=function(){var t=this.oModel._getObject(this.sPath,this.oContext);if(t){if(Array.isArray(t)){if(this.bUseExtendedChangeDetection){this.oList=i([],t)}else{this.oList=t.slice(0)}}else{this.oList=this.bUseExtendedChangeDetection?i({},t):n({},t)}this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength()}else{this.oList=[];this.aIndices=[];this.iLength=0}};o.prototype.checkUpdate=function(t){var i;if(this.bSuspended&&!this.bIgnoreSuspend&&!t){return}if(!this.bUseExtendedChangeDetection){i=this.oModel._getObject(this.sPath,this.oContext)||[];if(!e(this.oList,i)||t){this.update();this._fireChange({reason:a.Change})}}else{var n=false;var h=this;i=this.oModel._getObject(this.sPath,this.oContext)||[];if(this.oList.length!=i.length){n=true}if(!e(this.oList,i)){this.update()}var o=this._getContexts(this.iLastStartIndex,this.iLastLength);if(this.aLastContexts){if(this.aLastContexts.length!=o.length){n=true}else{s(this.aLastContextData,function(t,e){var i=h.getContextData(o[t]);if(i!==e){n=true;return false}return true})}}else{n=true}if(n||t){this._fireChange({reason:a.Change})}}};return o});