/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/Model","sap/ui/model/odata/v2/ODataAnnotations","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/CountMode","sap/ui/model/odata/UpdateMethod","sap/ui/model/odata/OperationMode","./ODataContextBinding","./ODataListBinding","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataPropertyBinding","./ODataTreeBinding","sap/ui/model/FilterProcessor","sap/ui/model/odata/ODataMetaModel","sap/ui/core/message/MessageParser","sap/ui/model/odata/ODataMessageParser","sap/ui/thirdparty/datajs","sap/base/Log","sap/base/assert","sap/base/util/uid","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/merge","sap/base/security/encodeURL","sap/ui/thirdparty/jquery","sap/base/util/isPlainObject"],function(e,t,a,r,s,i,n,o,u,d,h,f,c,p,l,g,_,m,y,v,b,q,R,C,M,E,S,P){"use strict";var T=r.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(e,a){r.apply(this,arguments);var d,h,c,p,l,g,_,m,y,v,b,q,R,C,M,E,S,P,A,D,x,U,I,O,k,H,L=this;if(typeof e==="object"){a=e;e=a.serviceUrl}if(a){d=a.user;h=a.password;c=a.headers;p=a.tokenHandling;l=a.withCredentials;g=a.maxDataServiceVersion;_=a.useBatch;m=a.refreshAfterChange;y=a.annotationURI;v=a.loadAnnotationsJoined;R=a.defaultBindingMode;b=a.defaultCountMode;q=a.preliminaryContext;C=a.defaultOperationMode;M=a.metadataNamespaces;E=a.serviceUrlParams;S=a.metadataUrlParams;P=a.json;A=a.messageParser;D=a.skipMetadataAnnotationParsing;x=a.defaultUpdateMethod;U=a.disableHeadRequestForToken;I=a.sequentializeRequests;O=a.disableSoftStateHeader;k=a.bindableResponseHeaders;H=a.warmupUrl}this.sWarmupUrl=H;this.bWarmup=!!H;this.mSupportedBindingModes={OneWay:true,OneTime:true,TwoWay:true};this.mUnsupportedFilterOperators={Any:true,All:true};this.sDefaultBindingMode=R||t.OneWay;this.bJSON=P!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=x||o.Merge;this.bTokenHandling=p!==false;this.bWithCredentials=l===true;this.bUseBatch=_!==false;this.bRefreshAfterChange=m!==false;this.sMaxDataServiceVersion=g;this.bLoadAnnotationsJoined=v!==false;this.sAnnotationURI=y;this.sDefaultCountMode=b||n.Request;this.sDefaultOperationMode=C||u.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!D;this.bDisableHeadRequestForToken=!!U;this.bSequentializeRequests=!!I;this.bDisableSoftStateHeader=!!O;this.aBindableResponseHeaders=k?k:null;this.bPreliminaryContext=q||false;this.mMetadataUrlParams=S||{};if(A){A.setProcessor(this)}this.oMessageParser=A;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=e;var B=e.split("?");if(B.length>1){this.sServiceUrl=B[0];if(B[1]){this.aUrlParams.push(B[1])}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=d;this.sPassword=h;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true")}this.oHeaders={};this.setHeaders(c);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header"}var G=this._getServerUrl();var w=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=T._getSharedData("server",G);this.oSharedServiceData=T._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=T._getSharedData("meta",w);this.bUseCache=this._cacheSupported(w);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new f(w,{async:true,cacheKey:this.bUseCache?w:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:M,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata}}else{this.oMetadata=this.oSharedMetaData.oMetadata}this.oAnnotations=new s(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(w),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"]}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(E){this.aUrlParams=this.aUrlParams.concat(i._createUrlParamsArray(E))}this.onMetadataFailed=function(e){L.fireMetadataFailed(e.getParameters())};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed)}this.oMetadata.loaded().then(function(){L._initializeMetadata()});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata"}else{this.oHeaders["Accept"]="application/json"}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml"}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});T.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};T.prototype.attachBatchRequestFailed=function(e,t,a){this.attachEvent("batchRequestFailed",e,t,a);return this};T.prototype.detachBatchRequestFailed=function(e,t){this.detachEvent("batchRequestFailed",e,t);return this};T.prototype.fireBatchRequestFailed=function(e){this.fireEvent("batchRequestFailed",e);return this};T.prototype.attachBatchRequestSent=function(e,t,a){this.attachEvent("batchRequestSent",e,t,a);return this};T.prototype.detachBatchRequestSent=function(e,t){this.detachEvent("batchRequestSent",e,t);return this};T.prototype.fireBatchRequestSent=function(e){this.fireEvent("batchRequestSent",e);return this};T.prototype.attachBatchRequestCompleted=function(e,t,a){this.attachEvent("batchRequestCompleted",e,t,a);return this};T.prototype.detachBatchRequestCompleted=function(e,t){this.detachEvent("batchRequestCompleted",e,t);return this};T.prototype.fireBatchRequestCompleted=function(e){this.fireEvent("batchRequestCompleted",e);return this};T.mSharedData={server:{},service:{},meta:{}};T._getSharedData=function(e,t){var a=this.mSharedData[e][t];if(!a){a={};this.mSharedData[e][t]=a}return a};T.prototype._initializeMetadata=function(){if(this.bDestroyed){return}var e=function(){this.fireMetadataLoaded({metadata:this.oMetadata});v.debug(this+" - metadataloaded fired")}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(e,this.fireMetadataFailed.bind(this))}else{e()}};T.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh()}};T.prototype.fireAnnotationsLoaded=function(e){this.fireEvent("annotationsLoaded",e);return this};T.prototype.attachAnnotationsLoaded=function(e,t,a){this.attachEvent("annotationsLoaded",e,t,a);return this};T.prototype.detachAnnotationsLoaded=function(e,t){this.detachEvent("annotationsLoaded",e,t);return this};T.prototype.fireAnnotationsFailed=function(e){this.fireEvent("annotationsFailed",e);v.debug(this+" - annotationsfailed fired");return this};T.prototype.attachAnnotationsFailed=function(e,t,a){this.attachEvent("annotationsFailed",e,t,a);return this};T.prototype.detachAnnotationsFailed=function(e,t){this.detachEvent("annotationsFailed",e,t);return this};T.prototype.fireMetadataLoaded=function(e){this.fireEvent("metadataLoaded",e);return this};T.prototype.attachMetadataLoaded=function(e,t,a){this.attachEvent("metadataLoaded",e,t,a);return this};T.prototype.detachMetadataLoaded=function(e,t){this.detachEvent("metadataLoaded",e,t);return this};T.prototype.fireMetadataFailed=function(e){this.fireEvent("metadataFailed",e);return this};T.prototype.attachMetadataFailed=function(e,t,a){this.attachEvent("metadataFailed",e,t,a);return this};T.prototype.detachMetadataFailed=function(e,t){this.detachEvent("metadataFailed",e,t);return this};T.prototype._createEventInfo=function(e,t,a){var r={};r.url=e.requestUri;r.method=e.method;r.async=e.async;r.headers=e.headers;if(a){r.requests=[];for(var s=0;s<a.length;s++){var i={};if(Array.isArray(a[s])){var n=a[s];for(var o=0;o<n.length;o++){var e=n[o].request;var u=a[s][o].response;i={};i.url=e.requestUri;i.method=e.method;i.headers=e.headers;if(u){i.response={};if(e._aborted){i.success=false;i.response.statusCode=0;i.response.statusText="abort"}else{i.success=true;if(u.message){i.response.message=u.message;u=u.response;i.response.responseText=u.body;i.success=false}i.response.headers=u.headers;i.response.statusCode=u.statusCode;i.response.statusText=u.statusText}}r.requests.push(i)}}else{var e=a[s].request;var u=a[s].response;i.url=e.requestUri;i.method=e.method;i.headers=e.headers;if(u){i.response={};if(e._aborted){i.success=false;i.response.statusCode=0;i.response.statusText="abort"}else{i.success=true;if(u.message){i.response.message=u.message;u=u.response;i.response.responseText=u.body;i.success=false}i.response.headers=u.headers;i.response.statusCode=u.statusCode;i.response.statusText=u.statusText}}r.requests.push(i)}}}if(t){r.response={};r.success=true;if(t.message){r.response.message=t.message;r.success=false}if(t.response){t=t.response}if(t&&t.statusCode!=undefined){r.response.headers=t.headers;r.response.statusCode=t.statusCode;r.response.statusText=t.statusText;r.response.responseText=t.body!==undefined?t.body:t.responseText}}r.ID=e.requestID;return r};T.prototype._createRequestID=function(){var e;e=q();return e};T.prototype._getServerUrl=function(){var t,a;t=new e(this.sServiceUrl).absoluteTo(document.baseURI);a=new e("/").absoluteTo(t).toString();return a};T.prototype._createMetadataUrl=function(e){if(e.indexOf(this.sServiceUrl)==-1){if(!e.startsWith("/")){e="/"+e}e=this.sServiceUrl+e}var t=new R(e||window.location.href).mParams||{};Object.keys(t).forEach(function(e){t[e]=t[e][0]});var a=S.extend({},this.mMetadataUrlParams,t);var r=i._createUrlParamsArray(a);var s=e.split("?");if(s.length>1){e=s[0]}return this._addUrlParams(e,r)};T.prototype._addUrlParams=function(e,t){var a=[];if(this.aUrlParams){a=a.concat(this.aUrlParams)}if(t){a=a.concat(t)}if(a&&a.length>0){e+="?"+a.join("&")}return e};T.prototype._createRequestUrl=function(e,t,a,r){var s,i="";s=this._normalizePath(e,t);if(!r){i=this.sServiceUrl+s}else{i=s.substr(s.indexOf("/")+1)}return this._addUrlParams(i,a)};T.prototype._importData=function(e,t,a){var r=this,s,i,n,o;if(e.results){s=[];S.each(e.results,function(e,i){var n=r._importData(i,t,a);if(n){s.push(n)}});return s}else{i=this._getKey(e);if(!i){return i}o=this._getEntity(i);if(!o||o.__metadata&&o.__metadata.invalid){o=e;this._addEntity(o)}if(this.aBindableResponseHeaders){var u={};for(var d in a.headers){var h=d.toLowerCase();if(this.aBindableResponseHeaders.indexOf(h)>-1){u[h]=a.headers[d]}}if(!S.isEmptyObject(u)){if(!e.__metadata){e.__metadata={}}e.__metadata.headers=u}}S.each(e,function(e,s){if(s&&(s.__metadata&&s.__metadata.uri||s.results)&&!s.__deferred){n=r._importData(s,t,a);if(Array.isArray(n)){o[e]={__list:n}}else{o[e]={__ref:n}}}else if(!s||!s.__deferred){o[e]=s}});var f={};f[i]=o;this._updateChangedEntities(f);t[i]=true;return i}};T.prototype._removeReferences=function(e){var t=this,a;if(!e){return e}if(e.results){a=[];S.each(e.results,function(e,r){a.push(t._removeReferences(r))});return a}else{S.each(e,function(t,a){if(a){if(a["__ref"]||a["__list"]){delete e[t]}}});return e}};T.prototype._restoreReferences=function(e,t){var a=this,r,s,i;function n(e){var r=t[e];if(!r){r=a._getObject("/"+e);b(r,"ODataModel inconsistent: "+e+" not found!");if(r){r=M({},r);t[e]=r;a._restoreReferences(r,t)}}return r}if(!t){t={}}S.each(e,function(t,a){if(a){if(a.__ref){r=a.__ref;s=n(r);if(s){e[t]=s}delete a.__ref}else if(a.__list){i=[];S.each(a.__list,function(e,t){s=n(t);if(s){i.push(s)}});delete a.__list;a.results=i}}});return e};T.prototype.removeData=function(){this.oData={}};T.prototype.initialize=function(){var e=this.aBindings.slice(0);e.forEach(function(e){e.initialize()})};T.prototype.invalidate=function(e){var t;for(var a in this.oData){t=this.oData[a];if(!e||e(a,t)){t.__metadata.invalid=true}}};T.prototype.invalidateEntry=function(e){var t;if(typeof e==="string"){if(e.indexOf("/")===0){t=this._getObject(e)}else{t=this.oData[e]}}else if(e instanceof a){t=this._getObject(e.getPath())}if(t&&t.__metadata){t.__metadata.invalid=true}};T.prototype.invalidateEntityType=function(e){var t;for(var a in this.oData){t=this.oData[a];if(t.__metadata.type===e){t.__metadata.invalid=true}}};T.prototype.refresh=function(e,t,a){if(typeof e==="string"){a=e;e=false;t=false}if(t){this.removeData()}this._refresh(e,a)};T.prototype._refresh=function(e,t,a,r){var s=this.aBindings.slice(0);this.sRefreshGroupId=t;s.forEach(function(t){t._refresh(e,a,r)});this.sRefreshGroupId=undefined};T.prototype.checkUpdate=function(e,t,a,r){if(t){if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(e,false,a)}.bind(this),0)}return}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null}var s=this.aBindings.slice(0);s.forEach(function(t){if(!r||this.isMetaModelPath(t.getPath())){t.checkUpdate(e,a)}}.bind(this));this._processAfterUpdate()};T.prototype.checkDataState=function(e){var t=this.aBindings.slice(0);t.forEach(function(t){if(t.checkDataState){t.checkDataState(e)}})};T.prototype.bindProperty=function(e,t,a){var r=new c(this,e,t,a);return r};T.prototype.bindList=function(e,t,a,r,s){var i=new h(this,e,t,a,r,s);return i};T.prototype.bindTree=function(e,t,a,r,s){var i=new p(this,e,t,a,r,s);return i};T.prototype.createBindingContext=function(e,t,a,r,s){var i,n,o,u,d=this;if(t!==null&&typeof t==="object"&&!(t instanceof sap.ui.model.Context)){s=r;r=a;a=t;t=undefined}if(typeof t=="function"){s=a;r=t;a=undefined;t=undefined}if(typeof t=="boolean"){s=t;r=undefined;a=undefined;t=undefined}if(typeof a=="function"){s=r;r=a;a=undefined}if(typeof a=="boolean"){s=a;r=undefined;a=undefined}if(typeof r=="boolean"){s=r;r=undefined}i=this.resolve(e,t);if(!i){if(r){r(null)}return null}if(s===undefined){s=this._isReloadNeeded(i,a)}if(!s){n=this.resolve(e,t,true);o=this.getContext(n);if(r){r(o)}return o}function h(a){var s=a?d._getKey(a):null,i=!(e===""||e.indexOf("/")>0),n=null,u,h;o=null;if(s){o=d.getContext("/"+s);n={__ref:s}}if(t&&c&&i){u=t.getPath();u=u.substr(1);h=d._getEntity(u);if(h){h[e]=n}}r(o)}function f(a){var s;if(a.statusCode=="404"&&t&&c){var i=t.getPath();i=i.substr(1);s=d._getEntity(i);if(s){s[e]={__ref:null}}}r(null)}if(r){var c=!e.startsWith("/");if(i){var p=[],l=this.createCustomParams(a);if(l){p.push(l)}if(a&&(a.batchGroupId||a.groupId)){u=a.groupId||a.batchGroupId}this.read(i,{groupId:u,urlParameters:p,success:h,error:f})}else{r(null)}}if(a&&a.createPreliminaryContext){i=this.resolve(e,t);o=this.getContext(i);return o}};T.prototype._updateContext=function(e,t){if(!t.startsWith("/")){throw new Error("Path "+t+" must start with a / ")}e.sPath=t;this.mContexts[t]=e};T.prototype._splitEntries=function(e){return e.replace(/\s/g,"").split(",").map(function(e){return e.split("/")})};T.prototype._filterOwnSelect=function(e,t){var a,r;if(!t){return[]}r=t.map(function(e){return e.name});a=e.filter(function(e){return e.length===1}).map(function(e){return e[0]});if(e.length===0||a.indexOf("*")!==-1||a.indexOf("**")!==-1){return r}else{return a.filter(function(e){return r.indexOf(e)!==-1})}};T.prototype._filterOwnExpand=function(e,t){return e.map(function(e){return e[0]}).filter(function(e,t,a){return a.indexOf(e)===t}).filter(function(e){return t.length===0||t.some(function(t){return t.indexOf(e)===0||t.indexOf("**")===0})})};T.prototype._filterSelectByNavProp=function(e,t){return e.filter(function(e){return e[0]===t}).map(function(e){return e.length>1?e.slice(1):["**"]})};T.prototype._filterExpandByNavProp=function(e,t){return e.filter(function(e){return e.length>1&&e[0]===t}).map(function(e){return e.slice(1)})};T.prototype._isReloadNeeded=function(e,t){var a=this,r=this.oMetadata,s,i=this._getObject(e),n=[],o=[];if(!this.oMetadata.isLoaded()){return true}s=this.oMetadata._getEntityTypeByPath(e);if(this._isCreatedEntity(i)){return false}function u(e,t,s,i){var n,o,d,h,f,c,p,l,g;if(!e){return false}if(t===null){return false}if(!t){return true}if(t.__metadata&&t.__metadata.invalid){return true}n=a._filterOwnSelect(s,e.property);for(var _=0;_<n.length;_++){g=n[_];if(t[g]===undefined){return true}}o=a._filterOwnExpand(i,s);for(var _=0;_<o.length;_++){l=o[_];d=t[l];if(d===null){continue}if(d===undefined||d.__deferred){return true}h=r._getEntityTypeByNavProperty(e,l);c=a._filterSelectByNavProp(s,l);p=a._filterExpandByNavProp(i,l);if(d.__ref){f=a._getEntity(d.__ref);if(u(h,f,c,p)){return true}}if(d.__list){for(var m=0;m<d.__list.length;m++){f=a._getEntity(d.__list[m]);if(u(h,f,c,p)){return true}}}}return false}if(t){if(t.select){o=this._splitEntries(t.select)}if(t.expand){n=this._splitEntries(t.expand)}}return u(s,i,o,n)};T.prototype.createCustomParams=function(e){var t=[],a,r={expand:true,select:true};for(var s in e){if(s in r){t.push("$"+s+"="+E(e[s]))}if(s==="custom"){a=e[s];for(s in a){if(s.indexOf("$")===0){v.warning(this+" - Trying to set OData parameter '"+s+"' as custom query option!")}else if(typeof a[s]==="string"){t.push(s+"="+E(a[s]))}else{t.push(s)}}}}return t.join("&")};T.prototype.bindContext=function(e,t,a){var r=new d(this,e,t,a);return r};T.prototype.setDefaultCountMode=function(e){this.sDefaultCountMode=e};T.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode};T.prototype._addEntity=function(e){var t=this._getKey(e);this.oData[t]=e};T.prototype._removeEntity=function(e){e=e&&i._normalizeKey(e);delete this.oData[e];delete this.mChangedEntities[e];delete this.mContexts["/"+e]};T.prototype._getEntity=function(e){var t=this.oData[e];if(!t){e=e&&i._normalizeKey(e);t=this.oData[e]}return t};T.prototype._getKey=function(e){var t,r;if(e instanceof a){t=e.getPath().substr(1)}else if(e&&e.__metadata&&e.__metadata.uri){r=e.__metadata.uri;t=r.substr(r.lastIndexOf("/")+1)}else if(typeof e==="string"){t=e.substr(e.lastIndexOf("/")+1)}if(!this.oData[t]){t=t&&i._normalizeKey(t)}return t};T.prototype.getKey=function(e){return this._getKey(e)};T.prototype.createKey=function(e,t){var a=this.oMetadata._getEntityTypeByPath(e),r=e,s=this,n,o;b(a,'Could not find entity type of collection "'+e+'" in service metadata!');r+="(";if(a.key.propertyRef.length===1){n=a.key.propertyRef[0].name;b(n in t,'Key property "'+n+'" is missing in object!');o=this.oMetadata._getPropertyMetadata(a,n);r+=encodeURIComponent(i.formatValue(t[n],o.type))}else{S.each(a.key.propertyRef,function(e,u){if(e>0){r+=","}n=u.name;b(n in t,'Key property "'+n+'" is missing in object!');o=s.oMetadata._getPropertyMetadata(a,n);r+=n;r+="=";r+=encodeURIComponent(i.formatValue(t[n],o.type))})}r+=")";return r};T.prototype.getProperty=function(e,t,a){var r=this._getObject(e,t);if(!a){return r}if(!P(r)){return r}r=M({},r);if(a===true){return this._restoreReferences(r)}else{return this._removeReferences(r)}};T.prototype.getObject=function(e,t,a){if(P(t)){a=t;t=undefined}var r=this,s=this.resolve(e,t),i=this._getObject(s),n=this.oMetadata._getEntityTypeByPath(s),o=[],u=[];if(!n||!P(i)||!i.__metadata||!i.__metadata.uri){return i}if(!a||!(a.select||a.expand)){return M({},i)}function d(e,t,a,s){var i,n,o,u,h,f,c,p,l,g,_,m,y;if(!t){return undefined}if(!e){return undefined}o=r._filterOwnSelect(a,e.property);n={};for(var b=0;b<o.length;b++){m=o[b];if(t[m]!==undefined){n[m]=t[m]}else{v.fatal("No data loaded for select property: "+m+" of entry: "+r.getKey(t));return undefined}}if(t.__metadata){n.__metadata=t.__metadata}i=r._filterOwnExpand(s,a);for(var b=0;b<i.length;b++){_=i[b];h=t[_];f=r.oMetadata._getEntityTypeByNavProperty(e,_);l=r._filterSelectByNavProp(a,_);g=r._filterExpandByNavProp(s,_);if(h&&h.__ref){p=r._getObject("/"+h.__ref);c=d(f,p,l,g);if(c!==undefined){n[_]=c}else{v.fatal("No data loaded for expand property: "+_+" of entry: "+r.getKey(c));return undefined}}if(h&&h.__list){y=[];for(var q=0;q<h.__list.length;q++){p=r._getObject("/"+h.__list[q]);c=d(f,p,l,g);if(c!==undefined){y.push(c)}else{v.fatal("No data loaded for expand property: "+_+" of entry: "+r.getKey(c));return undefined}}n[_]=y}}u=r._filterOwnSelect(a,e.navigationProperty);for(var R=0;R<u.length;R++){_=u[R];if(i.indexOf(_)===-1){var C=n.__metadata.uri+"/"+_;n[_]={__deferred:{uri:C}}}}return n}if(a.select){u=this._splitEntries(a.select)}if(a.expand){o=this._splitEntries(a.expand)}i=d(n,i,u,o);return i};T.prototype._getObject=function(e,t,a){var r=this.isLegacySyntax()?this.oData:null,s,i,n=this.resolve(e,t),o,u,d,h,f,c;if(!n){return r}if(this._isMetadataPath(n)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(n)){o=n.indexOf("/##");c=this.getMetaModel();if(!this.bMetaModelLoaded){return null}u=n.substr(0,o);d=n.substr(o+3);h=c.getMetaContext(u);r=c.getProperty(d,h)}else{r=this.oMetadata._getAnnotation(n)}}}else{if(n==="/"){return this.oData}var p=n.split("/"),l=0;f=p[1];p.splice(0,2);s=this.mChangedEntities[f];i=this._getEntity(f);r=a?i:s||i;while(r&&p[l]){var g=s&&s.hasOwnProperty(p[l]);s=s&&s[p[l]];i=i&&i[p[l]];r=a||!g?i:s;if(r){if(r.__ref){s=this.mChangedEntities[r.__ref];i=this._getEntity(r.__ref);r=a?i:s||i}else if(r.__list){r=r.__list}else if(r.__deferred){r=undefined}}l++}}if(P(s)){r=a?i:M({},i,s)}return r};T.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken()}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken}}};T.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken};T.prototype.getSecurityToken=function(){var e=this.oSharedServiceData.securityToken;if(!e){this.refreshSecurityToken();e=this.oSharedServiceData.securityToken}return e};T.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken)}else{this.pSecurityToken=new Promise(function(e,t){this.refreshSecurityToken(function(){e(this.oSharedServiceData.securityToken)}.bind(this),function(){t()},true)}.bind(this))}}return this.pSecurityToken};T.prototype.refreshSecurityToken=function(e,t,a){var r;var s=this;var i=this._createRequestUrl("/");var n={abort:function(){this.request.abort()}};function o(t,a){if(a){r=s._getHeader("x-csrf-token",a.headers);s._setSessionContextIdHeader(s._getHeader("sap-contextid",a.headers));if(r){s.oSharedServerData.securityToken=r;s.oSharedServiceData.securityToken=r;s.pSecurityToken=Promise.resolve(r);s.oHeaders["x-csrf-token"]=r}else{s.resetSecurityToken();s.bTokenHandling=false}}if(e){e(t,a)}}function u(e){s.resetSecurityToken();s.bTokenHandling=false;s._handleError(e);if(t){t(e)}}function d(e){n.request=h("GET",u)}function h(e,t){var r=s._createRequest(i,e,s._getHeaders(undefined,true),null,null,!!a);r.headers["x-csrf-token"]="Fetch";return s._request(r,o,t,undefined,undefined,s.getServiceMetadata())}if(this.bDisableHeadRequestForToken){n.request=h("GET",u)}else{n.request=h("HEAD",d)}return n};T.prototype._submitRequest=function(e,t,a){var r=this,s,i,n,o,u;o=new Promise(function(e,t){u=e});function d(e,a){if(t){t(e,a)}u()}function h(t){if(r.bTokenHandling&&t.response){var s=r._getHeader("x-csrf-token",t.response.headers);if(!e.bTokenReset&&t.response.statusCode=="403"&&s&&s.toLowerCase()==="required"){r.resetSecurityToken();e.bTokenReset=true;c();return}}if(a){a(t)}u()}function f(e){if(r.bTokenHandling&&e.method!=="GET"){r.pReadyForRequest=r.securityTokenAvailable()}return r.pReadyForRequest}function c(){f(e).then(function(t){if(r.bTokenHandling&&e.method!=="GET"){e.headers["x-csrf-token"]=t}l()},function(){l()})}function p(e,t,a){var s,i=t.eventInfo.requests;if(i){S.each(i,function(t,a){if(Array.isArray(a)){a.forEach(function(t){S.each(t.parts,function(a,i){s=r._createEventInfo(t.request,i.fnError);r["fireRequest"+e](s)})})}else{if(a.parts){S.each(a.parts,function(t,i){s=r._createEventInfo(a.request,i.fnError);r["fireRequest"+e](s)})}else{s=r._createEventInfo(a.request,a.fnError);r["fireRequest"+e](s)}}});if(t.eventInfo.batch){s=r._createEventInfo(t,a,i);r["fireBatchRequest"+e](s)}}}function l(){if(r.sSessionContextId){e.headers["sap-contextid"]=r.sSessionContextId}i=r._request(e,d,h,s,undefined,r.getServiceMetadata());if(e.eventInfo){p("Sent",e,null);delete e.eventInfo}if(n){i.abort()}}s=r._getODataHandler(e.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){c()});this.pSequentialRequestCompleted=o}else{c()}return{abort:function(){if(i){i.abort()}n=true}}};T.prototype._setSessionContextIdHeader=function(e){if(e){this.sSessionContextId=e}};T.prototype._submitSingleRequest=function(e){var t=this,a,r={},s={},i={};function n(a,n){if(a===undefined&&n.statusCode===200){o({message:"Response did not contain a valid OData result",response:n});return}function u(a,n){for(var o=0;o<e.parts.length;o++){if(e.parts[o].request._aborted){t._processAborted(e.parts[o].request,n)}else if(e.parts[o].fnSuccess){e.parts[o].fnSuccess(a,n)}}if(e.request.requestUri.indexOf("$count")===-1){t.checkUpdate(false,false,s);if(e.bRefreshAfterChange){t._refresh(false,undefined,r,i)}}}t._processSuccess(e.request,n,u,s,r,i);t._setSessionContextIdHeader(t._getHeader("sap-contextid",n.headers))}function o(a){if(a.message=="Request aborted"){for(var r=0;r<e.parts.length;r++){t._processAborted(e.parts[r].request,a)}}else{for(var r=0;r<e.parts.length;r++){t._processError(e.parts[r].request,a,e.parts[r].fnError)}}t._processAfterUpdate()}e.request.eventInfo={requests:e.parts,batch:false};a=this._submitRequest(e.request,n,o);return a};T.prototype._submitBatchRequest=function(e,t,a,r){var s=this,i={},n={},o={};function u(e,t,a){for(var r=0;r<e.parts.length;r++){if(a||e.parts[r].request._aborted){s._processAborted(e.parts[r].request,t)}else if(t.message){s._processError(e.parts[r].request,t,e.parts[r].fnError)}else{s._processSuccess(e.parts[r].request,t,e.parts[r].fnSuccess,n,i,o)}}}function d(r,d){if(r===undefined&&d.statusCode===200){h({message:"Response did not contain a valid OData batch result",response:d});return}var f,c,p,l=r.__batchResponses;if(l){var g,_;for(g=0;g<l.length;g++){f=l[g];if(Array.isArray(t[g])){if(f.message){for(_=0;_<t[g].length;_++){c=t[g][_];u(c,f);c.response=f}}else{p=f.__changeResponses;for(_=0;_<p.length;_++){var m=p[_];c=t[g][_];u(c,m);c.response=m}}}else{c=t[g];u(c,f);c.response=f}}s.checkUpdate(false,false,n)}s._processSuccess(e,d,a,n,i,o,true,t);s._setSessionContextIdHeader(s._getHeader("sap-contextid",d.headers))}function h(a){var i=a.message=="Request aborted";S.each(t,function(e,t){if(Array.isArray(t)){t.forEach(function(e){u(e,a,i)})}else{u(t,a,i)}});s._processAfterUpdate();if(i){s._processAborted(e,a,true)}else{s._processError(e,a,r,true,t)}}e.eventInfo={requests:t,batch:true};var f=this._submitRequest(e,d,h);function c(e){var t;for(var a=0;a<e.parts.length;a++){t=e.parts[a].fnError;if(!e.parts[a].request._aborted&&t){t(A)}}}var p={abort:function(){S.each(t,function(e,t){if(Array.isArray(t)){t.forEach(function(e){c(e)})}else{c(t)}});f.abort()}};return p};T.prototype._createBatchRequest=function(e){var t,a,r={},s={},i=true;s.__batchRequests=e;for(var n in e){if(e[n]&&e[n].__changeRequests||e[n]&&e[n].headers&&!e[n].headers["sap-cancel-on-close"]){i=false;break}}t=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){t+="?"+this.aUrlParams.join("&")}S.extend(r,this.mCustomHeaders,this.oHeaders);r["Accept"]="multipart/mixed";delete r["Content-Type"];r["sap-cancel-on-close"]=i;a={headers:r,requestUri:t,method:"POST",data:s,user:this.sUser,password:this.sPassword,async:true};a.withCredentials=this.bWithCredentials;return a};T.prototype.abortInternalRequest=function(e,t){var a=this.mRequests;if(t in this.mDeferredGroups){a=this.mDeferredRequests}var r=a[t];if(r&&e in r.map){var s=r.map[e];for(var i=0;i<s.parts.length;i++){s.parts[i].requestHandle.abort()}}};T.prototype._pushToRequestQueue=function(e,t,a,r,s,i,n,o){var u=e[t],d=r.key?r.key:r.method+":"+r.requestUri;if(this.bWarmup){return}if(!u){u={};u.map={};u.requests=[];e[t]=u}if(d in u.map&&(r.key||r.method==="GET")){var h=u.map[d];var f=h.request;if(h.bRefreshAfterChange===undefined){h.bRefreshAfterChange=o}if(!r.key){h.parts.push({request:r,fnSuccess:s,fnError:i,requestHandle:n})}if(r.method==="GET"){delete f.data}else{f.method=r.method;f.headers=r.headers;f.data=r.data;f.requestUri=r.requestUri;if(r.method==="PUT"){delete f.headers["x-http-method"]}if(f._aborted){delete f._aborted}}}else{var h={request:r,bRefreshAfterChange:o,parts:[{request:r,fnSuccess:s,fnError:i,requestHandle:n}]};if(r.method==="GET"){u.requests.push(h)}else{if(!u.changes){u.changes={}}var c=u.changes[a];if(!c){c=[];u.changes[a]=c}h.changeSetId=a;c.push(h)}u.map[d]=h}};T.prototype._collectChangedEntities=function(e,t,a){var r=this;if(e.changes){S.each(e.changes,function(e,s){for(var i=0;i<s.length;i++){if(s[i].bRefreshAfterChange){var n=s[i].request,o="/"+n.requestUri.split("?")[0],u,d;if(n.method==="POST"||n.method==="DELETE"){var h=r.oMetadata._getEntityTypeByPath(o);if(h){a[h.entityType]=true}}else{u=r._getObject(o);if(u){d=r._getKey(u)}else if(o.lastIndexOf("/")===0){d=r._getKey(o)}if(d){t[d]=true}}}}})}};T.prototype._processRequestQueue=function(e,t,a,r){var s=this,i,n=[];function o(e,t){for(var a=0;a<e.parts.length;a++){var r=e.parts[a];if(r.request._aborted){s._processAborted(e.request,null);e.parts.splice(a,1);a--}else if(t){r.request._handle=t;t.iRelevantRequests++}}}function u(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort()}}}}if(this.bUseBatch){S.each(e,function(e,a){if(e===t||!t){var r={},i={};s._collectChangedEntities(a,r,i);if(Object.keys(r).length||Object.keys(i).length){s.bIncludeInCurrentBatch=true;s._refresh(false,e,r,i);s.bIncludeInCurrentBatch=false}}});S.each(e,function(d,h){if(d===t||!t){var f=[],c=[],p,l;var g=u();if(h.changes){S.each(h.changes,function(e,t){p={__changeRequests:[]};l=[];for(var a=0;a<t.length;a++){i="/"+s.getKey(t[a].request.data);s.increaseLaundering(i,t[a].request.data);o(t[a],g);if(t[a].parts.length>0){if(t[a].request.data&&t[a].request.data.__metadata){delete t[a].request.data.__metadata.created}p.__changeRequests.push(t[a].request);l.push(t[a])}}if(p.__changeRequests&&p.__changeRequests.length>0){f.push(p);c.push(l)}})}if(h.requests){var _=h.requests;for(var m=0;m<_.length;m++){o(_[m],g);if(_[m].parts.length>0){f.push(_[m].request);c.push(_[m])}}}if(f.length>0){var y=s._createBatchRequest(f);g.oRequestHandle=s._submitBatchRequest(y,c,a,r);n.push(g.oRequestHandle)}delete e[d]}})}else{S.each(e,function(a,r){if(a===t||!t){if(r.changes){S.each(r.changes,function(e,t){for(var a=0;a<t.length;a++){var r=u();i="/"+s.getKey(t[a].request.data);s.increaseLaundering(i,t[a].request.data);o(t[a],r);if(t[a].parts.length>0){r.oRequestHandle=s._submitSingleRequest(t[a]);n.push(r.oRequestHandle)}}})}if(r.requests){var d=r.requests;for(var h=0;h<d.length;h++){var f=u();o(d[h],f);if(d[h].parts.length>0){f.oRequestHandle=s._submitSingleRequest(d[h]);n.push(f.oRequestHandle)}}}delete e[a]}})}this.checkDataState(this.mLaunderingState);return n.length==1?n[0]:n};T.prototype._processRequestQueueAsync=function(e){var t=this;if(!this.pCallAsnyc){this.pCallAsnyc=new Promise(function(e,a){t.oMetadata.loaded().then(function(){e()})});this.pCallAsnyc.then(function(){t._processRequestQueue(e);t.pCallAsnyc=undefined})}};T.prototype._processSuccess=function(e,t,a,r,s,i,n,o){var u=t.data,d,h,f,c,p,l,g,_={},m={},y=this;if(!n){h=!(t.statusCode===204||t.statusCode==="204");f=e.requestUri;c=f.replace(this.sServiceUrl,"");if(!c.startsWith("/")){c="/"+c}c=this._normalizePath(c);this.decreaseLaundering(c,e.data);if(h&&u===undefined&&t){this._parseResponse(t,e);v.fatal(this+" - No data was retrieved by service: '"+t.requestUri+"'");y.fireRequestCompleted({url:t.requestUri,type:"GET",async:t.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false}if(u&&u.results&&!Array.isArray(u.results)){u=u.results}if(!t._imported&&u&&(Array.isArray(u)||typeof u=="object")){d=M({},u);y._importData(d,_,t);t._imported=true}l=this._getEntity(e.key);if(_&&l&&l.__metadata.created&&l.__metadata.created.functionImport){var b=[];var q=l["$result"];if(q&&q.__list){S.each(_,function(e){b.push(e)});q.__list=b}else if(q&&q.__ref){S.each(_,function(e){q.__ref=e})}}if(!h){p=c.split("/");if(p[1]){m[p[1]]=e;var R={};R[p[1]]=e.data;this._updateChangedEntities(R)}if(e.method==="DELETE"&&p[2]!=="$links"){this._removeEntity(p[1])}}if(h&&e.method==="POST"){g=this.oMetadata._getEntityTypeByPath(c);if(g){i[g.entityType]=true}if(e.key){if(e.created){var C=this._getKey(u);var E=this.getContext("/"+e.key);E.bCreated=false;this._updateContext(E,"/"+C);l=this._getEntity(C);if(l){delete l.__metadata.created}}this._removeEntity(e.key)}}this._parseResponse(t,e,_,m);S.extend(r,_);S.extend(s,m);this._updateETag(e,t)}if(a){a(u,t)}var P=this._createEventInfo(e,t,o);if(n){this.fireBatchRequestCompleted(P)}else{this.fireRequestCompleted(P)}return true};T.prototype._processError=function(e,t,a,r,s){var i,n=this._handleError(t,e);if(!r){i="/"+this.getKey(e.data);this.decreaseLaundering(i,e.data)}if(a){a(n)}var o=this._createEventInfo(e,n,s);if(r){this.fireBatchRequestCompleted(o);this.fireBatchRequestFailed(o)}else{this.fireRequestCompleted(o);this.fireRequestFailed(o)}};var A={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};T.prototype._processAborted=function(e,t,a){var r;if(!a){r="/"+this.getKey(e.data);this.decreaseLaundering(r,e.data)}if(t){var s=this._createEventInfo(e,A);s.success=false;if(a){this.fireBatchRequestCompleted(s)}else{this.fireRequestCompleted(s)}}};T.prototype._processAfterUpdate=function(){var e=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var t=0;t<e.length;t++){e[t]()}};T.prototype._processChange=function(e,t,a){var r,s,n,o,u,d,h,f,c,p,l,g=this;s=this.oMetadata._getEntityTypeByPath(e);if(!a){a="MERGE"}r=M({},this._getObject("/"+e,true),t);if(t.__metadata&&t.__metadata.created){o=t.__metadata.created.method?t.__metadata.created.method:"POST";e=t.__metadata.created.key;h=true;n=t.__metadata.created;if(t.__metadata.created.functionImport){n.urlParameters=this._createFunctionImportParameters(t.__metadata.created.key,o,r);r=undefined}else{delete r.__metadata["uri"]}}else if(a==="MERGE"){o="MERGE";l=this._getEntity(e)}else{o="PUT"}if(r&&r.__metadata){for(var _ in r.__metadata){if(_!=="type"&&_!=="uri"&&_!=="etag"&&_!=="content_type"&&_!=="media_src"){delete r.__metadata[_]}}}if(r&&s){var m=this.oMetadata._getNavigationPropertyNames(s);m.forEach(function(e){delete r[e]})}if(o==="MERGE"&&s&&l){S.each(r,function(t,a){if(t!=="__metadata"){if(C(l[t],a)&&!g.isLaundering("/"+e+"/"+t)){delete r[t]}}});var y="/"+e,v;S.each(r,function(e,t){if(e!=="__metadata"){v=g.getProperty(y+"/"+e+"/#@sap:unit");if(v){if(r[v]===undefined){r[v]=l[v]}}}})}r=this._removeReferences(r);c=n&&n.urlParameters?i._createUrlParamsArray(n.urlParameters):undefined;f=n?this._getHeaders(n.headers):this._getHeaders();u=n&&n.eTag?n.eTag:this.getETag(r);d=this._createRequestUrl("/"+e,null,c,this.bUseBatch);p=this._createRequest(d,o,f,r,u);if(h){p.created=true}if(this.bUseBatch){p.requestUri=p.requestUri.replace(this.sServiceUrl+"/","")}return p};T.prototype._resolveGroup=function(e){var t,a,r,s,i,n;a=this.oMetadata._getEntityTypeByPath(e);n=this._getObject("/"+e);if(n){r=n.__metadata.created;if(r){return{groupId:r.groupId,changeSetId:r.changeSetId}}}if(this.mChangeGroups[a.name]){t=this.mChangeGroups[a.name];s=t.groupId;i=t.single?q():t.changeSetId}else if(this.mChangeGroups["*"]){t=this.mChangeGroups["*"];s=t.groupId;i=t.single?q():t.changeSetId}return{groupId:s,changeSetId:i}};T.prototype._updateETag=function(e,t){var a,r,s;a=e.requestUri.replace(this.sServiceUrl+"/","");if(!a.startsWith("/")){a="/"+a}r=this._getObject(a.split("?")[0]);s=this._getHeader("etag",t.headers);if(r&&r.__metadata&&s){r.__metadata.etag=s}};T.prototype._handleError=function(e,t){var a={},r;var s="The following problem occurred: "+e.message;a.message=e.message;if(e.response){this._parseResponse(e.response,t);if(this.bTokenHandling){r=this._getHeader("x-csrf-token",e.response.headers);if(e.response.statusCode=="403"&&r&&r.toLowerCase()==="required"){this.resetSecurityToken()}}s+=e.response.statusCode+","+e.response.statusText+","+e.response.body;a.statusCode=e.response.statusCode;a.statusText=e.response.statusText;a.headers=e.response.headers;a.responseText=e.response.body}v.fatal(s);return a};T.prototype.getData=function(e,t,a){return this.getProperty(e,t,a)};T.prototype._getODataHandler=function(e){if(e.indexOf("$batch")>-1){return y.batchHandler}else if(e.indexOf("$count")>-1){return undefined}else if(this.bJSON){return y.jsonHandler}else{return y.atomHandler}};T.prototype.getETag=function(e,t,a){if(typeof e=="object"){a=e;e=""}return this._getETag(e,t,a)};T.prototype._getETag=function(e,t,a){if(!a||!a.__metadata){a=this._getObject(e,t)}if(a&&a.__metadata){return a.__metadata.etag}return null};T.prototype.forceEntityUpdate=function(e){var t=this.mChangedEntities[e];if(t&&t.__metadata){t.__metadata.etag="*"}else{v.error(this+" - Entity with key "+e+" does not exist or has no change")}};T.prototype._createRequest=function(e,t,a,r,s,i){i=i!==false;if(s&&t!=="GET"){a["If-Match"]=s}if(!a["Content-Type"]&&t!=="DELETE"&&t!=="GET"){if(this.bJSON){a["Content-Type"]="application/json"}else{a["Content-Type"]="application/atom+xml"}}if(e.indexOf("$count")>-1){a["Accept"]="text/plain, */*;q=0.5"}if(t==="MERGE"&&!this.bUseBatch){a["x-http-method"]="MERGE";t="POST"}var n={headers:a,requestUri:e,method:t,user:this.sUser,password:this.sPassword,async:i};if(r){n.data=r}if(this.bWithCredentials){n.withCredentials=this.bWithCredentials}n.requestID=this._createRequestID();return n};T.prototype._processRequest=function(e,t){var a,r,s=false,i=this;if(this.bWarmup){return{abort:function(){}}}a={abort:function(){if(!s&&t){t(A)}if(r){r._aborted=true;if(r._handle){r._handle.abort()}}s=true}};this.oMetadata.loaded().then(function(){r=e(a);i._processRequestQueueAsync(i.mRequests);if(s){a.abort()}});return a};T.prototype.update=function(e,t,a){var r,s,n,o,u,d,h,f,c,p,l,g,_,m,y=this;if(a){f=a.groupId||a.batchGroupId;c=a.changeSetId;u=a.context;r=a.success;s=a.error;d=a.eTag;l=a.headers;p=a.urlParameters;m=a.refreshAfterChange;if(a.merge!==undefined){g=a.merge?"MERGE":"PUT"}}m=this._getRefreshAfterChange(m,f);h=i._createUrlParamsArray(p);l=this._getHeaders(l);g=g?g:this.sDefaultUpdateMethod;d=d||this._getETag(e,u,t);return this._processRequest(function(a){o=y._createRequestUrl(e,u,h,y.bUseBatch);n=y._createRequest(o,g,l,t,d);_=y.mRequests;if(f in y.mDeferredGroups){_=y.mDeferredRequests}y._pushToRequestQueue(_,f,c,n,r,s,a,m);return n},s)};T.prototype.create=function(e,t,a){var r,s,n,o,u,d,h,f,c,p,l,g,_,m,y,v=this;if(a){o=a.context;h=a.urlParameters;u=a.success;d=a.error;g=a.groupId||a.batchGroupId;m=a.changeSetId;l=a.eTag;c=a.headers;y=a.refreshAfterChange}y=this._getRefreshAfterChange(y,g);p=i._createUrlParamsArray(h);c=this._getHeaders(c);_="POST";return this._processRequest(function(a){s=v._createRequestUrl(e,o,p,v.bUseBatch);r=v._createRequest(s,_,c,t,l);e=v._normalizePath(e,o);n=v.oMetadata._getEntityTypeByPath(e);r.entityTypes={};if(n){r.entityTypes[n.entityType]=true}f=v.mRequests;if(g in v.mDeferredGroups){f=v.mDeferredRequests}v._pushToRequestQueue(f,g,m,r,u,d,a,y);return r},d)};T.prototype.remove=function(e,t){var a,r,s,n,o,u,d,h,f,c,p,l,g,_,m,y=this;if(t){d=t.groupId||t.batchGroupId;h=t.changeSetId;a=t.context;s=t.success;n=t.error;f=t.eTag;l=t.headers;p=t.urlParameters;c=t.refreshAfterChange}c=this._getRefreshAfterChange(c,d);g=i._createUrlParamsArray(p);l=this._getHeaders(l);_="DELETE";f=f||this._getETag(e,a);function v(e,t){r=u.substr(u.lastIndexOf("/")+1);if(r.indexOf("?")!==-1){r=r.substr(0,r.indexOf("?"))}y._removeEntity(r);if(s){s(e,t)}}return this._processRequest(function(t){u=y._createRequestUrl(e,a,g,y.bUseBatch);o=y._createRequest(u,_,l,undefined,f);m=y.mRequests;if(d in y.mDeferredGroups){m=y.mDeferredRequests}y._pushToRequestQueue(m,d,h,o,v,n,t,c);return o},n)};T.prototype.callFunction=function(e,t){var a,r,s,n,o,u,d,h,f="GET",c,p,l,g,_=this,m,y,R,C,M,E,P,T={};if(t){c=t.groupId||t.batchGroupId;p=t.changeSetId;f=t.method?t.method:f;o=S.extend({},t.urlParameters);g=t.eTag;d=t.success;h=t.error;l=t.headers;P=t.refreshAfterChange}P=this._getRefreshAfterChange(P,c);if(!e.startsWith("/")){v.fatal(this+" callFunction: path '"+e+"' must be absolute!");return}l=this._getHeaders(l);M=new Promise(function(e,t){R=e;C=t});E=this._processRequest(function(t){s=_.oMetadata._getFunctionImportMetadata(e,f);b(s,_+": Function "+e+" not found in the metadata !");if(!s){C();return}var M=s.entitySet||s.entitySetPath;if(M){T.$result={__list:[]};if(s.returnType&&s.returnType.indexOf("Collection")==-1){T.$result={__ref:{}}}}if(s.parameter!=null){S.each(s.parameter,function(e,t){T[t.name]=_._createPropertyValue(t.type);if(o&&o[t.name]!==undefined){T[t.name]=o[t.name];o[t.name]=i.formatValue(o[t.name],t.type)}else{v.warning(_+" - No value for parameter '"+t.name+"' found!'")}})}m=e.substring(1)+"('"+q()+"')";T.__metadata={uri:_.sServiceUrl+"/"+m,created:{key:e.substring(1),success:d,error:h,headers:l,method:f,groupId:c,changeSetId:p,eTag:g,functionImport:true}};_._addEntity(T);y=_.getContext("/"+m);R(y);u=i._createUrlParamsArray(o);r=_._createRequestUrl(e,null,u,_.bUseBatch);a=_._createRequest(r,f,l,undefined,g);a.key=m;n=_.mRequests;if(c in _.mDeferredGroups){n=_.mDeferredRequests}_._pushToRequestQueue(n,c,p,a,d,h,t,P);return a},h);E.contextCreated=function(){return M};return E};T.prototype._createFunctionImportParameters=function(e,t,a){var r=S.extend(true,{},a);delete r.__metadata;delete r["$result"];var s=this.oMetadata._getFunctionImportMetadata(e,t);b(s,this+": Function "+e+" not found in the metadata !");if(!s){return}if(s.parameter!=null){S.each(s.parameter,function(e,t){if(r&&r[t.name]!==undefined){r[t.name]=i.formatValue(r[t.name],t.type)}})}return r};T.prototype.read=function(e,t){var a,r,s,n,o,u,d,h,f,c,p,g,_,m,y,v,b,q,R,C=this;if(t){s=t.context;n=t.urlParameters;o=t.success;u=t.error;d=t.filters;h=t.sorters;b=t.groupId||t.batchGroupId;y=t.headers}if(this.sRefreshGroupId){b=this.sRefreshGroupId}m=i._createUrlParamsArray(n);y=this._getHeaders(y,true);v="GET";q=this._getETag(e,s);var M={abort:function(){if(a){a._aborted=true}}};function E(t){c=i.createSortParams(h);if(c){m.push(c)}var n=e;var M=e.indexOf("$count");if(M!==-1){n=e.substring(0,M-1)}_=C._normalizePath(n,s);g=C.oMetadata._getEntityTypeByPath(_);p=l.groupFilters(d);f=i.createFilterParams(p,C.oMetadata,g);if(f){m.push(f)}r=C._createRequestUrl(e,s,m,C.bUseBatch);a=C._createRequest(r,v,y,null,q);R=C.mRequests;if(b in C.mDeferredGroups){R=C.mDeferredRequests}C._pushToRequestQueue(R,b,null,a,o,u,t,false);return a}if(this.bUseBatch&&this.bIncludeInCurrentBatch){a=E(M);return M}else{return this._processRequest(E,u)}};T.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata()}};T.prototype.metadataLoaded=function(){var e=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var t=function(){return e};return this.pAnnotationsLoaded.then(t,t)}else{return e}};T.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded};T.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed()};T.prototype.getServiceAnnotations=function(){var e=this.oAnnotations.getData();return S.isEmptyObject(e)?null:e};T.prototype.onAnnotationsFailed=function(e){this.fireAnnotationsFailed(e.getParameters())};T.prototype.onAnnotationsLoaded=function(e){this.fireAnnotationsLoaded(e.getParameters())};T.prototype.addAnnotationUrl=function(e){var t=[].concat(e),a=[],r=[],s=[],i=this;t.forEach(function(e){var t=e.indexOf("$metadata");if(t>=0){e=i._createMetadataUrl(e);a.push(e)}else{r.push(e)}});return this.oMetadata._addUrl(a).then(function(e){return Promise.all(S.map(e,function(e){s=s.concat(e.entitySets);return i.oAnnotations.addSource({type:"xml",data:e["metadataString"]})}))}).then(function(){return i.oAnnotations.addSource(r)}).then(function(e){return{annotations:i.oAnnotations.getData(),entitySets:s}})};T.prototype.addAnnotationXML=function(e,t){return this.oAnnotations.addSource({type:"xml",data:e})};T.prototype.submitChanges=function(e){var t,a,r,s,i,n,o,u=false,d,h,f=this.bRefreshAfterChange,c,p=this;if(e){a=e.groupId||e.batchGroupId;s=e.success;i=e.error;if(e.merge!==undefined){d=e.merge?"MERGE":"PUT"}}if(a&&!this.mDeferredGroups[a]){v.fatal(this+' submitChanges: "'+a+'" is not a deferred group!')}h=M({},p.mChangedEntities);this.oMetadata.loaded().then(function(){S.each(h,function(e,s){r=p._resolveGroup(e);if(r.groupId===a||!a){t=p._processChange(e,s,d||p.sDefaultUpdateMethod);t.key=e;c=s.__metadata&&s.__metadata.created?s.__metadata.created:{};var i={abort:function(){t._aborted=true}};if(r.groupId in p.mDeferredGroups){p._pushToRequestQueue(p.mDeferredRequests,r.groupId,r.changeSetId,t,c.success,c.error,i,f)}}});var e,l,g,_,m,y;for(e in p.mDeferredRequests){g=p.mDeferredRequests[e];for(l in g.changes){_=g.changes[l];for(y=_.length-1;y>=0;y--){m=_[y];if(m.bRefreshAfterChange===undefined){m.bRefreshAfterChange=f}}}}o=p._processRequestQueue(p.mDeferredRequests,a,s,i);if(u){n.abort()}});n={abort:function(){if(o){if(Array.isArray(o)){o.forEach(function(e){e.abort()})}else{o.abort()}}else{if(!u&&i){i(A)}u=true}}};return n};T.prototype._updateChangedEntities=function(e){var t=this,a;function r(e,s){S.each(s,function(i){var n=a+"/"+i;if(P(s[i])&&P(e[i])){r(e[i],s[i]);if(S.isEmptyObject(s[i])){delete s[i]}}else if(C(s[i],e[i])&&!t.isLaundering(n)){delete s[i]}})}S.each(e,function(e,s){if(e in t.mChangedEntities){var i=t._getObject("/"+e,null,true);var n=t._getObject("/"+e);M(i,s);a="/"+e;r(i,n);if(S.isEmptyObject(n)){delete t.mChangedEntities[e];t.abortInternalRequest(e,t._resolveGroup(e).groupId)}else{t.mChangedEntities[e]=n;n.__metadata={};S.extend(n.__metadata,i.__metadata)}}})};T.prototype.resetChanges=function(e){var t=this,a,r={},s,i;if(e){S.each(e,function(e,n){t.getEntityByPath(n,null,r);a=r.propertyPath.split("/");var o=r.key;s=t.mChangedEntities[o];for(var u=0;u<a.length-1;u++){if(s.hasOwnProperty(a[u])){s=s[a[u]]}else{s=undefined}}if(s){delete s[a[a.length-1]]}if(t.mChangedEntities[o]){i=t.mChangedEntities[o].__metadata;delete t.mChangedEntities[o].__metadata;if(S.isEmptyObject(t.mChangedEntities[o])||!r.propertyPath){t.oMetadata.loaded().then(function(){t.abortInternalRequest(o,t._resolveGroup(o).groupId)});delete t.mChangedEntities[o];sap.ui.getCore().getMessageManager().removeMessages(t.getMessagesByEntity(o,true))}else{t.mChangedEntities[o].__metadata=i}}else{v.warning(t+" - resetChanges: "+n+" is not changed")}})}else{S.each(this.mChangedEntities,function(e,a){t.oMetadata.loaded().then(function(){t.abortInternalRequest(e,t._resolveGroup(e).groupId)});delete t.mChangedEntities[e];sap.ui.getCore().getMessageManager().removeMessages(t.getMessagesByEntity(e,true))})}this.checkUpdate(true)};T.prototype.setProperty=function(e,t,a,r){var s,i,n,o,u,d,h,f,c,p,l,g,_={},m={},y,v,b,q=false,R=this,M;function E(e,t){S.each(t,function(a){if(P(t[a])&&P(e[a])){E(e[a],t[a]);if(S.isEmptyObject(t[a])){delete t[a]}}else if(C(t[a],e[a])){delete t[a]}})}h=this.resolve(e,a,true);d=this.getEntityByPath(h,null,m);if(!d){return false}i=h.substring(h.lastIndexOf("/")+1);c=m.key;u=this._getObject("/"+c,null,true);s=this._getObject(e,a,true);if(!this.mChangedEntities[c]){g=d.__metadata;d={};d.__metadata=S.extend({},g);this.mChangedEntities[c]=d}v=this.mChangedEntities[c];f=m.propertyPath.split("/");for(var T=0;T<f.length-1;T++){if(!v.hasOwnProperty(f[T])){v[f[T]]={}}v=v[f[T]]}q=u.__metadata.created&&u.__metadata.created.functionImport;v[i]=t;if(C(t,s)&&!this.isLaundering("/"+c)&&!q){g=this.mChangedEntities[c].__metadata;M=g&&g.created;delete this.mChangedEntities[c].__metadata;if(!M){E(u,this.mChangedEntities[c])}if(S.isEmptyObject(this.mChangedEntities[c])){delete this.mChangedEntities[c];_[c]=true;this.checkUpdate(false,r,_);R.oMetadata.loaded().then(function(){R.abortInternalRequest(c,R._resolveGroup(c).groupId)});return true}this.mChangedEntities[c].__metadata=g}p=this._resolveGroup(c);n=this.mRequests;if(p.groupId in this.mDeferredGroups){n=this.mDeferredRequests;o=this._processChange(c,{__metadata:d.__metadata})}else{o=this._processChange(c,this._getObject("/"+c))}o.key=c;y=v.__metadata&&v.__metadata.created?v.__metadata.created:{};b=this._getRefreshAfterChange(undefined,p.groupId);this.oMetadata.loaded().then(function(){l={abort:function(){o._aborted=true}};R._pushToRequestQueue(n,p.groupId,p.changeSetId,o,y.success,y.error,l,b);R._processRequestQueueAsync(R.mRequests)});_[c]=true;this.checkUpdate(false,r,_);return true};T.prototype._isHeaderPrivate=function(e){switch(e.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false}};T.prototype.setHeaders=function(e){var t={},a=this;this.mCustomHeaders={};if(e){S.each(e,function(e,r){if(a._isHeaderPrivate(e)){v.warning(this+" - modifying private header: '"+e+"' not allowed!")}else{t[e]=r}});this.mCustomHeaders=t}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders)}};T.prototype._getHeaders=function(e,t){var a={},r=this;if(e){S.each(e,function(e,t){if(r._isHeaderPrivate(e)){v.warning(this+" - modifying private header: '"+e+"' not allowed!")}else{a[e]=t}})}return S.extend({"sap-cancel-on-close":!!t},this.mCustomHeaders,a,this.oHeaders)};T.prototype.getHeaders=function(){return S.extend({},this.mCustomHeaders,this.oHeaders)};T.prototype._getHeader=function(e,t){var a;for(a in t){if(a.toLowerCase()===e.toLowerCase()){return t[a]}}return null};T.prototype.hasPendingChanges=function(){return!S.isEmptyObject(this.mChangedEntities)};T.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0};T.prototype.getPendingChanges=function(){return M({},this.mChangedEntities)};T.prototype.updateBindings=function(e){this.checkUpdate(e)};T.prototype.setTokenHandlingEnabled=function(e){this.bTokenHandling=e};T.prototype.setUseBatch=function(e){this.bUseBatch=e};T.prototype.formatValue=function(e,t){return i.formatValue(e,t)};T.prototype.deleteCreatedEntry=function(e){var t=this,a,r;if(e){var a=e.getPath().substr(1);r=this._resolveGroup(a).groupId;t.oMetadata.loaded().then(function(){t.abortInternalRequest(a,r)});t._removeEntity(a);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(e.getPath(),true))}};T.prototype.createEntry=function(e,t){var a,r,s,n,o,u,d,h,f,c,p,l,g,_,m,y={},R,C="POST",E=this;if(t){m=t.properties;f=t.groupId||t.batchGroupId;c=t.changeSetId;u=t.context;a=t.success;r=t.error;R=t.created;o=t.eTag;g=t.headers;l=t.urlParameters;p=t.refreshAfterChange}g=g||{};p=this._getRefreshAfterChange(p,f);f=f?f:this.sDefaultChangeGroup;h=i._createUrlParamsArray(l);var S={abort:function(){if(s){s._aborted=true}}};function P(){var t;if(!e.startsWith("/")){e="/"+e}var i=E.oMetadata._getEntityTypeByPath(e);if(!i){b(i,"No Metadata for collection "+e+" found");return undefined}if(typeof m==="object"&&!Array.isArray(m)){y=M({},m)}else{for(var v=0;v<i.property.length;v++){var R=i.property[v];var P=(m?m.indexOf(R.name):-1)>-1;if(!m||P){y[R.name]=E._createPropertyValue(R.type);if(P){m.splice(m.indexOf(R.name),1)}}}if(m){b(m.length===0,"No metadata for the following properties found: "+m.join(","))}}var T=E.oMetadata._getEntitySetByType(i);d=T.name+"('"+q()+"')";y.__metadata={type:""+i.entityType,uri:E.sServiceUrl+"/"+d,created:{key:e.substring(1),success:a,error:r,headers:g,urlParameters:l,groupId:f,changeSetId:c,eTag:o}};E._addEntity(M({},y));E.mChangedEntities[d]=y;n=E._createRequestUrl(e,u,h,E.bUseBatch);s=E._createRequest(n,C,g,y,o);t=E.getContext("/"+d);t.bCreated=true;s.key=d;s.created=true;_=E.mRequests;if(f in E.mDeferredGroups){_=E.mDeferredRequests}E.oMetadata.loaded().then(function(){E._pushToRequestQueue(_,f,c,s,a,r,S,p);E._processRequestQueueAsync(E.mRequests)});return t}if(R){this.oMetadata.loaded().then(function(){R(P())})}else if(this.oMetadata.isLoaded()){return P()}else{v.error("Tried to use createEntry without created-callback, before metadata is available!")}};T.prototype._isCreatedEntity=function(e){return!!(e&&e.__metadata&&e.__metadata.created)};T.prototype._createPropertyValue=function(e){var t=this.oMetadata._splitName(e);var a=t.namespace;var r=t.name;if(a.toUpperCase()!=="EDM"){var s={};var i=this.oMetadata._getObjectMetadata("complexType",r,a);b(i,"Complex type "+e+" not found in the metadata !");for(var n=0;n<i.property.length;n++){var o=i.property[n];s[o.name]=this._createPropertyValue(o.type)}return s}else{return this._getDefaultPropertyValue(r,a)}};T.prototype._getDefaultPropertyValue=function(e,t){return undefined};T.prototype._normalizePath=function(e,t){if(e&&e.indexOf("?")!==-1){e=e.substr(0,e.indexOf("?"))}if(!t&&!e.startsWith("/")){v.fatal(this+" path "+e+" must be absolute if no Context is set")}return this.resolve(e,t)};T.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange};T.prototype.setRefreshAfterChange=function(e){this.bRefreshAfterChange=e};T.prototype.isList=function(e,t){e=this.resolve(e,t);return e&&e.substr(e.lastIndexOf("/")).indexOf("(")===-1};T.prototype._isMetadataPath=function(e){var t=false;if(e&&e.indexOf("/#")>-1){t=true}return t};T.prototype.isMetaModelPath=function(e){return e.indexOf("##")==0||e.indexOf("/##")>-1};T.prototype._request=function(e,t,a,r,s,i){var n;if(this.bDestroyed){return{abort:function(){}}}var o=this;function u(e){return function(){if(o.aPendingRequestHandles){var t=o.aPendingRequestHandles.indexOf(n);if(t>-1){o.aPendingRequestHandles.splice(t,1)}}if(!(n&&n.bSuppressErrorHandlerCall)){e.apply(this,arguments)}}}n=y.request(e,u(t||y.defaultSuccess),u(a||y.defaultError),r,s,i);if(e.async!==false){this.aPendingRequestHandles.push(n)}return n};T.prototype.destroy=function(){this.bDestroyed=true;r.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var e=this.aPendingRequestHandles.length-1;e>=0;e--){var t=this.aPendingRequestHandles[e];if(t&&t.abort){t.bSuppressErrorHandlerCall=true;t.abort()}}delete this.aPendingRequestHandles}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent)}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent)}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata}delete this.oMetadata}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations}};T.prototype.setDeferredBatchGroups=function(e){this.setDeferredGroups(e)};T.prototype.setDeferredGroups=function(e){var t=this;this.mDeferredGroups={};S.each(e,function(e,a){t.mDeferredGroups[a]=a})};T.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups()};T.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups)};T.prototype.setChangeBatchGroups=function(e){S.each(e,function(e,t){t.groupId=t.batchGroupId});this.setChangeGroups(e)};T.prototype.setChangeGroups=function(e){this.mChangeGroups=e};T.prototype.getChangeBatchGroups=function(){return this.getChangeGroups()};T.prototype.getChangeGroups=function(){return this.mChangeGroups};T.prototype.setMessageParser=function(e){if(!(e instanceof _)){v.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this}e.setProcessor(this);this.oMessageParser=e;return this};T.prototype._parseResponse=function(e,t,a,r){try{if(!this.oMessageParser){this.oMessageParser=new m(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this)}this.oMessageParser.parse(e,t,a,r)}catch(e){v.error("Error parsing OData messages: "+e)}};T.prototype.callAfterUpdate=function(e){this.aCallAfterUpdate.push(e)};T.prototype.getMetaModel=function(){var e=this;if(!this.oMetaModel){this.oMetaModel=new g(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){e.bMetaModelLoaded=true;e.checkUpdate(false,false,null,true)},function(e){var t=e.message,a;if(!t&&e.xmlDoc&&e.xmlDoc.parseError){t=e.xmlDoc.parseError.reason;a=e.xmlDoc.parseError.srcText}v.error("error in ODataMetaModel.loaded(): "+t,a,"sap.ui.model.odata.v2.ODataModel")})}return this.oMetaModel};T.prototype.getOriginalProperty=function(e,t){return this._getObject(e,t,true)};T.prototype.getEntityByPath=function(e,t,a){var s=r.prototype.resolve.call(this,e,t);if(!s){return null}var i=s.split("/"),n=null,o=[];while(i.length>0){var u=i.join("/"),d=this._getObject(u);if(P(d)){var h=this._getKey(d);if(h){n=d;break}}o.unshift(i.pop())}if(n){a.propertyPath=o.join("/");a.key=h;return n}return null};T.prototype.resolve=function(e,t,a){var s=r.prototype.resolve.call(this,e,t);if(!this._isMetadataPath(s)&&a){var i={},n=this.getEntityByPath(e,t,i);if(n){if(i.propertyPath){return"/"+i.key+"/"+i.propertyPath}else{return"/"+i.key}}else{return undefined}}return s};T.prototype.isLaundering=function(e,t){var a=this.resolve(e,t);return a in this.mLaunderingState&&this.mLaunderingState[a]>0};T.prototype.increaseLaundering=function(e,t){if(!t){return}for(var a in t){if(a==="__metadata"){continue}var r=t[a];if(P(r)){this.increaseLaundering(e+"/"+a,r)}else{var s=e+"/"+a;if(!(s in this.mLaunderingState)){this.mLaunderingState[s]=0}this.mLaunderingState[s]++}}if(!(e in this.mLaunderingState)){this.mLaunderingState[e]=0}this.mLaunderingState[e]++};T.prototype.decreaseLaundering=function(e,t){if(!t){return}for(var a in t){if(a==="__metadata"){continue}var r=t[a],s=e+"/"+a;if(P(r)){this.decreaseLaundering(s,r)}else{if(s in this.mLaunderingState){this.mLaunderingState[s]--;if(this.mLaunderingState[s]===0){delete this.mLaunderingState[s]}}}}this.mLaunderingState[e]--;if(this.mLaunderingState[e]===0){delete this.mLaunderingState[e]}};T.prototype._getRefreshAfterChange=function(e,t){if(e===undefined&&!(t in this.mDeferredGroups)){return this.bRefreshAfterChange}return e};T.prototype.getMessagesByEntity=function(e,t){var a=e,r=[],s;function i(e){var a=[];for(var r=0;r<e.length;r++){if(!t||t&&!e[r].persistent){a.push(e[r])}}return a}if(!a.startsWith("/")){a="/"+a}if(this.mMessages){for(s in this.mMessages){if(typeof a=="string"&&a.length>0&&s.startsWith(a)){r=r.concat(i(this.mMessages[s]))}}return r}return null};T.prototype._cacheSupported=function(e){var t=/\/~[\w\-]+~[A-Z0-9]?/;var a=[e];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}a=a.concat(this.sAnnotationURI)}a=a.filter(function(e){return e.indexOf("sap-context-token")===-1});a=a.filter(function(e){return!t.test(e)});return a.length===0?true:false};T.prototype._getAnnotationCacheKey=function(e){var t;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){t=e+"#annotations"}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI]}this.sAnnotationURI=this.sAnnotationURI.map(function(e){return e+"#annotations"});t=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):t+"_"+this.sAnnotationURI.join("_")}}return t};return T});