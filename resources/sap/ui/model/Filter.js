/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","./FilterOperator","sap/base/Log"],function(t,e,r){"use strict";var i=t.extend("sap.ui.model.Filter",{constructor:function(t,i,n,s){if(typeof t==="object"&&!Array.isArray(t)){this.sPath=t.path;this.sOperator=t.operator;this.oValue1=t.value1;this.oValue2=t.value2;this.sVariable=t.variable;this.oCondition=t.condition;this.aFilters=t.filters||t.aFilters;this.bAnd=t.and||t.bAnd;this.fnTest=t.test;this.fnCompare=t.comparator;this.bCaseSensitive=t.caseSensitive}else{if(Array.isArray(t)){this.aFilters=t}else{this.sPath=t}if(typeof i==="boolean"){this.bAnd=i}else if(typeof i==="function"){this.fnTest=i}else{this.sOperator=i}this.oValue1=n;this.oValue2=s;if(this.sOperator===e.Any||this.sOperator===e.All){throw new Error("The filter operators 'Any' and 'All' are only supported with the parameter object notation.")}}if(this.sOperator===e.Any){if(this.sVariable&&this.oCondition){this._checkLambdaArgumentTypes()}else if(!this.sVariable&&!this.oCondition){}else{throw new Error("When using the filter operator 'Any', a lambda variable and a condition have to be given or neither.")}}else if(this.sOperator===e.All){this._checkLambdaArgumentTypes()}else if(Array.isArray(this.aFilters)&&!this.sPath&&!this.sOperator&&!this.oValue1&&!this.oValue2){this._bMultiFilter=true;if(!this.aFilters.every(a)){r.error("Filter in aggregation of multi filter has to be instance of"+" sap.ui.model.Filter")}}else if(!this.aFilters&&this.sPath!==undefined&&(this.sOperator&&this.oValue1!==undefined||this.fnTest)){this._bMultiFilter=false}else{r.error("Wrong parameters defined for filter.")}}});i.prototype._checkLambdaArgumentTypes=function(){if(!this.sVariable||typeof this.sVariable!=="string"){throw new Error("When using the filter operators 'Any' or 'All', a string has to be given as argument 'variable'.")}if(!a(this.oCondition)){throw new Error("When using the filter operator 'Any' or 'All', a valid instance of sap.ui.model.Filter has to be given as argument 'condition'.")}};function a(t){return t instanceof i}var n={Logical:"Logical",Binary:"Binary",Unary:"Unary",Lambda:"Lambda",Reference:"Reference",Literal:"Literal",Variable:"Variable",Call:"Call",Custom:"Custom"};var s={Equal:"==",NotEqual:"!=",LessThan:"<",GreaterThan:">",LessThanOrEqual:"<=",GreaterThanOrEqual:">=",And:"&&",Or:"||",Not:"!"};var o={Contains:"contains",StartsWith:"startswith",EndsWith:"endswith"};i.prototype.getAST=function(t){var r,i,a,h,l,u,f,p,c;function b(t,e,r){return{type:n.Logical,op:t,left:e,right:r}}function d(t,e,r){return{type:n.Binary,op:t,left:e,right:r}}function y(t,e){return{type:n.Unary,op:t,arg:e}}function g(t,e,r,i){return{type:n.Lambda,op:t,ref:e,variable:r,condition:i}}function A(t){return{type:n.Reference,path:t}}function m(t){return{type:n.Literal,value:t}}function T(t){return{type:n.Variable,name:t}}function C(t,e){return{type:n.Call,name:t,args:e}}if(this.aFilters){i=this.bAnd?s.And:s.Or;a=this.bAnd?"AND":"OR";r=this.aFilters[this.aFilters.length-1].getAST(t);for(var V=this.aFilters.length-2;V>=0;V--){r=b(i,this.aFilters[V].getAST(t),r)}}else{i=this.sOperator;a=this.sOperator;h=A(this.sPath);l=m(this.oValue1);switch(i){case e.EQ:r=d(s.Equal,h,l);break;case e.NE:r=d(s.NotEqual,h,l);break;case e.LT:r=d(s.LessThan,h,l);break;case e.GT:r=d(s.GreaterThan,h,l);break;case e.LE:r=d(s.LessThanOrEqual,h,l);break;case e.GE:r=d(s.GreaterThanOrEqual,h,l);break;case e.Contains:r=C(o.Contains,[h,l]);break;case e.StartsWith:r=C(o.StartsWith,[h,l]);break;case e.EndsWith:r=C(o.EndsWith,[h,l]);break;case e.NotContains:r=y(s.Not,C(o.Contains,[h,l]));break;case e.NotStartsWith:r=y(s.Not,C(o.StartsWith,[h,l]));break;case e.NotEndsWith:r=y(s.Not,C(o.EndsWith,[h,l]));break;case e.BT:u=l;f=m(this.oValue2);r=b(s.And,d(s.GreaterThanOrEqual,h,u),d(s.LessThanOrEqual,h,f));break;case e.NB:u=l;f=m(this.oValue2);r=b(s.Or,d(s.LessThan,h,u),d(s.GreaterThan,h,f));break;case e.Any:case e.All:p=T(this.sVariable);c=this.oCondition.getAST(t);r=g(i,h,p,c);break;default:throw new Error("Unknown operator: "+i)}}if(t&&!r.origin){r.origin=a}return r};i.prototype.getComparator=function(){return this.fnCompare};i.prototype.getCondition=function(){return this.oCondition};i.prototype.getOperator=function(){return this.sOperator};i.prototype.getPath=function(){return this.sPath};i.prototype.getFilters=function(){return this.aFilters&&this.aFilters.slice()};i.prototype.getTest=function(){return this.fnTest};i.prototype.getValue1=function(){return this.oValue1};i.prototype.getValue2=function(){return this.oValue2};i.prototype.getVariable=function(){return this.sVariable};i.prototype.isAnd=function(){return!!this.bAnd};i.prototype.isCaseSensitive=function(){return this.bCaseSensitive};i.defaultComparator=function(t,e){if(t==e){return 0}if(t==null||e==null){return NaN}if(typeof t=="string"&&typeof e=="string"){return t.localeCompare(e)}if(t<e){return-1}if(t>e){return 1}return NaN};return i});