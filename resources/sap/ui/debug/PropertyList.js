/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define("sap/ui/debug/PropertyList",["sap/ui/base/DataType","sap/ui/base/EventProvider","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/strings/capitalize","sap/base/security/encodeXML","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/rect"],function(DataType,EventProvider,Element,ElementMetadata,isEmptyObject,ObjectPath,capitalize,encodeXML,jQuery){"use strict";var PropertyList=EventProvider.extend("sap.ui.debug.PropertyList",{constructor:function(e,t,i){EventProvider.apply(this,arguments);this.oWindow=t;this.oParentDomRef=i;this.oCore=e;this.bEmbedded=top.window==t;this.mProperties={};this.onclick=PropertyList.prototype.onclick.bind(this);i.addEventListener("click",this.onclick);this.onfocus=PropertyList.prototype.onfocus.bind(this);i.addEventListener("focusin",this.onfocus);this.onkeydown=PropertyList.prototype.onkeydown.bind(this);i.addEventListener("keydown",this.onkeydown);if(!this.bEmbedded){this.onmouseover=PropertyList.prototype.onmouseover.bind(this);i.addEventListener("mouseover",this.onmouseover);this.onmouseout=PropertyList.prototype.onmouseout.bind(this);i.addEventListener("mouseout",this.onmouseout)}}});PropertyList.prototype.exit=function(){this.oParentDomRef.removeEventListener("click",this.onclick);this.oParentDomRef.removeEventListener("focusin",this.onfocus);this.oParentDomRef.removeEventListener("keydown",this.onkeydown);if(!this.bEmbedded){this.oParentDomRef.removeEventListener("mouseover",this.onmouseover);this.oParentDomRef.removeEventListener("mouseout",this.onmouseout)}};PropertyList.prototype.update=function(e){var t=e.getParameter("controlId");this.oParentDomRef.innerHTML="";var i=this.oCore.byId(t);if(!i){this.oParentDomRef.innerHTML="Please select a valid control";return}if(!i.getMetadata||!i.getMetadata()){this.oParentDomRef.innerHTML="Control does not provide Metadata.";return}this.mProperties={};var o=i.getMetadata(),r=[];r.push("<span data-sap-ui-quickhelp='"+this._calcHelpId(o)+"'>Type : "+o.getName()+"</span><br >");r.push("Id : "+i.getId()+"<br >");r.push("<button id='sap-debug-propertylist-apply' data-id='"+t+"' style='border:solid 1px gray;background-color:#d0d0d0;font-size:8pt;'>Apply Changes</button>");if(!this.bEmbedded){r.push("<div id='sap-ui-quickhelp' style='position:fixed;display:none;padding:5px;background-color:rgb(200,220,231);border:1px solid gray;overflow:hidden'>Help</div>")}r.push("<div style='border-bottom:1px solid gray'>&nbsp;</div><table cellspacing='1' style='font-size:8pt;width:100%;table-layout:fixed'>");while(o instanceof ElementMetadata){var s=o.getProperties();var a=false;if(!isEmptyObject(s)){if(!a&&o!==i.getMetadata()){r.push('<tr><td colspan="2">BaseType: ');r.push(o.getName());r.push("</td></tr>");a=true}this.printProperties(r,i,s)}var s=this.getAggregationsAsProperties(o);if(!isEmptyObject(s)){if(!a&&o!==i.getMetadata()){r.push('<tr><td colspan="2">BaseType: ');r.push(o.getName());r.push("</td></tr>");a=true}this.printProperties(r,i,s)}o=o.getParent()}r.push("</table>");this.oParentDomRef.innerHTML=r.join("");this.mHelpDocs={}};PropertyList.prototype.getAggregationsAsProperties=function(e){function t(e){if(!e){return false}while(e.endsWith("[]")){e=e.slice(0,-"[]".length)}if(e==="boolean"||e==="string"||e==="int"||e==="float"){return true}if(e==="void"){return false}return false}var i={};for(var o in e.getAggregations()){var r=e.getAggregations()[o];if(r.altTypes&&r.altTypes[0]&&t(r.altTypes[0])){i[o]={name:o,type:r.altTypes[0],_oParent:r._oParent}}}return i};PropertyList.prototype.printProperties=function(e,t,i,o){for(var r in i){var s=r,a=i[r].type,n=t["get"+s];if(!n){s=capitalize(s,0)}var p=t["get"+s]();e.push("<tr><td>");this.mProperties[s]=a;e.push("<span data-sap-ui-quickhelp='",this._calcHelpId(i[r]._oParent,r),"' >",s,"</span>");e.push("</td><td>");var u="";if(a=="string"||a=="int"||a=="float"||a.endsWith("[]")){var l="";if(p===null){l="color:#a5a5a5;";p="(null)"}else if(p instanceof Element){l="color:#a5a5a5;";if(Array.isArray(p)){p=p.join(", ")}else{p=p.toString()}u=' title="This aggregation currently references an Element. You can set a '+a+' value instead"'}e.push("<input type='text' style='width:100%;font-size:8pt;background-color:#f5f5f5;"+l+"' value='"+encodeXML(""+p)+"'"+u+" data-name='"+s+"'>")}else if(a=="boolean"){e.push("<input type='checkbox' data-name='"+s+"' ");if(p==true){e.push("checked='checked'")}e.push(">")}else if(a!="void"){var d=ObjectPath.get(a||"");if(!d||d instanceof DataType){e.push("<input type='text' style='width:100%;font-size:8pt;background-color:#f5f5f5;' value='"+encodeXML(""+p)+"'"+u+" data-name='"+s+"'>")}else{e.push("<select style='width:100%;font-size:8pt;background-color:#f5f5f5;' data-name='"+s+"'>");a=a.replace("/",".");for(var h in d){e.push("<option ");if(h==p){e.push(" selected ")}e.push("value='"+a+"."+h+"'>");e.push(h);e.push("</option>")}e.push("</select>")}}else{e.push("&nbsp;")}e.push("</td></tr>")}};PropertyList.prototype.onkeydown=function(e){if(e.keyCode==13){this.applyChanges("sap-debug-propertylist-apply")}};PropertyList.prototype.onclick=function(e){var t=e.target;if(t.id=="sap-debug-propertylist-apply"){this.applyChanges("sap-debug-propertylist-apply")}};PropertyList.prototype.onfocus=function(e){var t=e.target;if(t.tagName==="INPUT"&&t.dataset.name){if(t.style.color==="#a5a5a5"){t.style.color="";t.value=""}}};PropertyList.prototype.applyChanges=function(sId){var oSource=this.oParentDomRef.ownerDocument.getElementById(sId),sControlId=oSource.dataset.id,oControl=this.oCore.byId(sControlId),aInput=oSource.parentNode.getElementsByTagName("INPUT"),aSelect=oSource.parentNode.getElementsByTagName("SELECT"),oMethod;for(var i=0;i<aInput.length;i++){var oInput=aInput[i],sName=oInput.dataset.name;oMethod=oControl["set"+sName];if(!oMethod){sName=capitalize(sName,0)}if(oControl["set"+sName]){var oType=DataType.getType(this.mProperties[sName]);var vValue=this.mProperties[sName]==="boolean"?oInput.checked:oType.parseValue(oInput.value);if(oType.isValid(vValue)&&vValue!=="(null)"){oControl["set"+sName](vValue)}}}for(var i=0;i<aSelect.length;i++){var oSelect=aSelect[i],sName=oSelect.dataset.name;oMethod=oControl["set"+sName];if(!oMethod){sName=capitalize(sName,0)}var oValue=null;if(oSelect.value){eval("oValue = "+oSelect.value);oControl["set"+sName](oValue)}}this.oCore.applyChanges()};PropertyList.prototype.showQuickHelp=function(e){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var t=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(t){this.sCurrentHelpId=e.getAttribute("data-sap-ui-quickhelp");var i=jQuery(e).rect();t.style.left=i.left+40+10+"px";t.style.top=i.top-40+"px";t.style.display="block";t.style.opacity="0.2";t.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=20)";if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{t.innerHTML="<b>Quickhelp</b> for "+this.sCurrentHelpId+" is being retrieved...";this.sCurrentHelpDoc=this.sCurrentHelpId;this.sCurrentHelpDocPart=undefined;if(this.sCurrentHelpId.indexOf("#")>=0){this.sCurrentHelpDoc=this.sCurrentHelpId.substring(0,this.sCurrentHelpId.indexOf("#"));this.sCurrentHelpDocPart=this.sCurrentHelpId.substring(this.sCurrentHelpId.indexOf("#")+1)}var o=this.oWindow.jQuery.sap.getModulePath(this.sCurrentHelpDoc,".control");var r=this;jQuery.ajax({url:o,dataType:"xml",error:function(e,t){r.receiveQuickHelp(undefined)},success:function(e){r.receiveQuickHelp(e)}});this.oQuickHelpTimer=setTimeout(function(){r.hideQuickHelp()},2e3)}}};PropertyList.prototype.receiveQuickHelp=function(e){if(e){var t=e.getElementsByTagName("control")[0];if(t){var i=function(e,t){var i=[];var o=e.firstChild;while(o){if(t===o.nodeName){i.push(o)}o=o.nextSibling}return i};var o=i(t,"name");var r="";if(o[0]){r=o[0].text||o[0].textContent}var s=i(t,"documentation");if(s[0]){if(r&&s[0]){var a=[];a.push("<div style='font-size:10pt;font-weight:bold;padding:5px 0px;margin-bottom:5px;border-bottom:1px solid gray'>",r.replace("/","."),"</div>");a.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");this.mHelpDocs[this.sCurrentHelpDoc]=a.join("")}}var n=i(t,"properties");if(n[0]){n=i(n[0],"property")}for(var p=0,u=n.length;p<u;p++){var l=n[p];var r=l.getAttribute("name");var d=l.getAttribute("type")||"string";var h=l.getAttribute("defaultValue")||"empty/undefined";var s=i(l,"documentation");if(r&&s[0]){var a=[];a.push("<div style='font-size:10pt;font-weight:bold;padding:3px 0px;margin-bottom:3px;border-bottom:1px solid gray'>",r,"</div>");a.push("<div style='padding:2px 0px;'><i><strong>Type</strong></i>: ",d,"</div>");a.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");a.push("<div style='padding:2px 0px;'><i><strong>Default Value</strong></i>: ",h,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+r]=a.join("")}}var n=i(t,"aggregations");if(n[0]){n=i(n[0],"aggregation")}for(var p=0,u=n.length;p<u;p++){var l=n[p];var r=l.getAttribute("name");var d=l.getAttribute("type")||"sap.ui.core/Control";var h=l.getAttribute("defaultValue")||"empty/undefined";var s=i(l,"documentation");if(r&&s[0]&&!this.mHelpDocs[this.sCurrentHelpDoc+"#"+r]){var a=[];a.push("<div style='font-size:10pt;font-weight:bold;padding:3px 0px;margin-bottom:3px;border-bottom:1px solid gray'>",r,"</div>");a.push("<div style='padding:2px 0px;'><i><strong>Type</strong></i>: ",d,"</div>");a.push("<div style='padding:2px 0px;'>",s[0].text||s[0].textContent,"</div>");a.push("<div style='padding:2px 0px;'><i><strong>Default Value</strong></i>: ",h,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+r]=a.join("")}}}if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{this.updateQuickHelp(undefined,0)}}else{this.updateQuickHelp(undefined,0)}};PropertyList.prototype.updateQuickHelp=function(e,t){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){if(!e){i.innerHTML="<i>No quick help...</i>";i.style.display="none"}else{i.innerHTML=e;var o=this;this.oQuickHelpTimer=setTimeout(function(){o.hideQuickHelp()},t)}}};PropertyList.prototype.hideQuickHelp=function(){var e=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(e){e.style.display="none"}this.bMovedOverTooltip=false};PropertyList.prototype._calcHelpId=function(e,t){var i=e.getName();if(t){i=i+"#"+t}return i};PropertyList.prototype._isChildOfQuickHelp=function(e){while(e){if(e.id==="sap-ui-quickhelp"){return true}e=e.parentNode}return false};PropertyList.prototype.onmouseover=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=true;var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){i.style.opacity="";i.style.filter=""}}else if(t.getAttribute("data-sap-ui-quickhelp")){this.showQuickHelp(t)}};PropertyList.prototype.onmouseout=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=false;var i=this;this.oQuickHelpTimer=setTimeout(function(){i.hideQuickHelp()},50)}else if(t.getAttribute("data-sap-ui-quickhelp")){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}if(!this.bMovedOverTooltip){var i=this;this.oQuickHelpTimer=setTimeout(function(){i.hideQuickHelp()},800)}}};return PropertyList});