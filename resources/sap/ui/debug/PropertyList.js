/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define("sap/ui/debug/PropertyList",["sap/ui/base/DataType","sap/ui/base/EventProvider","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/base/util/isEmptyObject","sap/base/security/encodeXML","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/rect"],function(e,t,i,s,o,n,r){"use strict";var a=t.extend("sap.ui.debug.PropertyList",{constructor:function(e,i,s){t.apply(this,arguments);this.oWindow=i;this.oParentDomRef=s;this.oCore=e;this.bEmbedded=window.top===i;var o=window.top.document.createElement("link");o.rel="stylesheet";o.href=window.top.sap.ui.require.toUrl("sap/ui/debug/PropertyList.css");window.top.document.head.appendChild(o);this.onchange=a.prototype.onchange.bind(this);s.addEventListener("change",this.onchange);this.onfocus=a.prototype.onfocus.bind(this);s.addEventListener("focusin",this.onfocus);this.onkeydown=a.prototype.onkeydown.bind(this);s.addEventListener("keydown",this.onkeydown);if(!this.bEmbedded){this.onmouseover=a.prototype.onmouseover.bind(this);s.addEventListener("mouseover",this.onmouseover);this.onmouseout=a.prototype.onmouseout.bind(this);s.addEventListener("mouseout",this.onmouseout)}}});a.prototype.exit=function(){this.oParentDomRef.removeEventListener("change",this.onchange);this.oParentDomRef.removeEventListener("focusin",this.onfocus);this.oParentDomRef.removeEventListener("keydown",this.onkeydown);if(!this.bEmbedded){this.oParentDomRef.removeEventListener("mouseover",this.onmouseover);this.oParentDomRef.removeEventListener("mouseout",this.onmouseout)}};a.prototype.update=function(e){var t=this.sControlId=e.getParameter("controlId");this.oParentDomRef.innerHTML="";var i=this.oCore.byId(t);if(!i){this.oParentDomRef.innerHTML="Please select a valid control";return}var n=i.getMetadata(),r=[];r.push("<span data-sap-ui-quickhelp='"+this._calcHelpId(n)+"'>Type : "+n.getName()+"</span><br >");r.push("Id : "+i.getId()+"<br >");if(!this.bEmbedded){r.push("<div id='sap-ui-quickhelp' class='sapDbgQH'>Help</div>")}r.push("<div class='sapDbgSeparator'>&nbsp;</div>");r.push("<table class='sapDbgPropertyList' cellspacing='1'><tbody>");while(n instanceof s){var a=this.getPropertyLikeSettings(n);if(!o(a)){if(n!==i.getMetadata()){r.push("<tr><td class='sapDbgPLSubheader' colspan=\"2\">BaseType: ");r.push(n.getName());r.push("</td></tr>")}this.renderSettings(r,i,a)}n=n.getParent()}r.push("</tbody></table>");this.oParentDomRef.innerHTML=r.join("");this.mHelpDocs={}};a.prototype.getPropertyLikeSettings=function(t){var i={};Object.values(t.getProperties()).forEach(function(e){i[e.name]=e});Object.values(t.getAggregations()).forEach(function(t){if(t.multiple===false&&t.altTypes&&t.altTypes.length&&e.getType(t.altTypes[0])!=null){i[t.name]=t}});return i};a.prototype.renderSettings=function(t,s,o){Object.values(o).forEach(function(o){var r=o.name,a=o.get(s),p=o.multiple===false?e.getType(o.altTypes[0]):o.getType();t.push("<tr><td>");t.push("<span data-sap-ui-quickhelp='",this._calcHelpId(o._oParent,r),"' >",r,"</span>");t.push("</td><td>");var u="";if(p.getPrimitiveType().getName()==="boolean"){t.push("<input type='checkbox' data-name='"+r+"' ");if(a==true){t.push("checked='checked'")}t.push(">")}else if(p.isEnumType()){var l=p.getEnumValues();t.push("<select data-name='"+r+"'>");for(var d in l){t.push("<option ");if(d===a){t.push(" selected ")}t.push("value='"+n(d)+"'>");t.push(n(d));t.push("</option>")}t.push("</select>")}else{var c="";if(a===null){c="class='sapDbgComplexValue'";a="(null)"}else if(a instanceof i){c="class='sapDbgComplexValue'";if(Array.isArray(a)){a=a.join(", ")}else{a=String(a)}u=' title="This aggregation currently references an Element. You can set a '+p.getName()+' value instead"'}t.push("<input type='text' "+c+" value='"+n(""+a)+"'"+u+" data-name='"+r+"'>")}t.push("</td></tr>")}.bind(this))};a.prototype.onkeydown=function(e){var t=e.target;if(e.keyCode==13&&t.tagName==="INPUT"&&t.type==="text"){this.applyChange(t)}};a.prototype.onchange=function(e){var t=e.target;if(t.tagName==="SELECT"||t.tagName==="INPUT"){this.applyChange(t)}};a.prototype.onfocus=function(e){var t=e.target;if(t.tagName==="INPUT"&&t.dataset.name){if(t.style.color==="#a5a5a5"){t.style.color="";t.value=""}}};a.prototype.applyChange=function(t){var i=this.oCore.byId(this.sControlId),s=t.dataset.name,o=i.getMetadata().getPropertyLikeSetting(s);if(o){var n=t.type==="checkbox"?String(t.checked):t.value,r=o.multiple!=null?e.getType(o.altTypes[0]):o.getType();if(r){var a=r.parseValue(n);if(r.isValid(a)&&a!=="(null)"){o.set(i,a);t.classList.remove("sapDbgComplexValue")}}}};a.prototype.showQuickHelp=function(e){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var t=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(t){this.sCurrentHelpId=e.getAttribute("data-sap-ui-quickhelp");var i=r(e).rect();t.style.left=i.left+40+10+"px";t.style.top=i.top-40+"px";t.style.display="block";t.style.opacity="0.2";if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{t.innerHTML="<b>Quickhelp</b> for "+this.sCurrentHelpId+" is being retrieved...";this.sCurrentHelpDoc=this.sCurrentHelpId;this.sCurrentHelpDocPart=undefined;if(this.sCurrentHelpId.indexOf("#")>=0){this.sCurrentHelpDoc=this.sCurrentHelpId.substring(0,this.sCurrentHelpId.indexOf("#"));this.sCurrentHelpDocPart=this.sCurrentHelpId.substring(this.sCurrentHelpId.indexOf("#")+1)}var s=this.oWindow.jQuery.sap.getModulePath(this.sCurrentHelpDoc,".control");var o=this;r.ajax({url:s,dataType:"xml",error:function(e,t){o.receiveQuickHelp(undefined)},success:function(e){o.receiveQuickHelp(e)}});this.oQuickHelpTimer=setTimeout(function(){o.hideQuickHelp()},2e3)}}};a.prototype.receiveQuickHelp=function(e){if(e){var t=e.getElementsByTagName("control")[0];if(t){var i=function(e,t){var i=[];var s=e.firstChild;while(s){if(t===s.nodeName){i.push(s)}s=s.nextSibling}return i};var s=i(t,"name");var o="";if(s[0]){o=s[0].text||s[0].textContent}var n=i(t,"documentation");if(n[0]){if(o&&n[0]){var r=[];r.push("<div class='sapDbgQHClassTitle'>",o.replace("/","."),"</div>");r.push("<div class='sapDbgQHDocPadding'>",n[0].text||n[0].textContent,"</div>");this.mHelpDocs[this.sCurrentHelpDoc]=r.join("")}}var a=i(t,"properties");if(a[0]){a=i(a[0],"property")}for(var p=0,u=a.length;p<u;p++){var l=a[p];var o=l.getAttribute("name");var d=l.getAttribute("type")||"string";var c=l.getAttribute("defaultValue")||"empty/undefined";var n=i(l,"documentation");if(o&&n[0]){var r=[];r.push("<div class='sapDbgQHSettingDoc'>",o,"</div>");r.push("<div class='sapDbgQHDocPadding'><i><strong>Type</strong></i>: ",d,"</div>");r.push("<div class='sapDbgQHDocPadding'>",n[0].text||n[0].textContent,"</div>");r.push("<div class='sapDbgQHDocPadding'><i><strong>Default Value</strong></i>: ",c,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]=r.join("")}}var a=i(t,"aggregations");if(a[0]){a=i(a[0],"aggregation")}for(var p=0,u=a.length;p<u;p++){var l=a[p];var o=l.getAttribute("name");var d=l.getAttribute("type")||"sap.ui.core/Control";var c=l.getAttribute("defaultValue")||"empty/undefined";var n=i(l,"documentation");if(o&&n[0]&&!this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]){var r=[];r.push("<div class='sapDbgQHSettingTitle'>",o,"</div>");r.push("<div class='sapDbgQHDocPadding'><i><strong>Type</strong></i>: ",d,"</div>");r.push("<div class='sapDbgQHDocPadding'>",n[0].text||n[0].textContent,"</div>");r.push("<div class='sapDbgQHDocPadding'><i><strong>Default Value</strong></i>: ",c,"</div>");this.mHelpDocs[this.sCurrentHelpDoc+"#"+o]=r.join("")}}}if(this.mHelpDocs[this.sCurrentHelpId]){this.updateQuickHelp(this.mHelpDocs[this.sCurrentHelpId],2e3)}else{this.updateQuickHelp(undefined,0)}}else{this.updateQuickHelp(undefined,0)}};a.prototype.updateQuickHelp=function(e,t){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){if(!e){i.innerHTML="<i>No quick help...</i>";i.style.display="none"}else{i.innerHTML=e;this.oQuickHelpTimer=setTimeout(function(){this.hideQuickHelp()}.bind(this),t)}}};a.prototype.hideQuickHelp=function(){var e=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(e){e.style.display="none"}this.bMovedOverTooltip=false};a.prototype._calcHelpId=function(e,t){var i=e.getName();if(t){i=i+"#"+t}return i};a.prototype._isChildOfQuickHelp=function(e){while(e){if(e.id==="sap-ui-quickhelp"){return true}e=e.parentNode}return false};a.prototype.onmouseover=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=true;var i=this.oParentDomRef.ownerDocument.getElementById("sap-ui-quickhelp");if(i){i.style.opacity=""}}else if(t.getAttribute("data-sap-ui-quickhelp")){this.showQuickHelp(t)}};a.prototype.onmouseout=function(e){var t=e.target;if(this._isChildOfQuickHelp(t)){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}this.bMovedOverTooltip=false;this.oQuickHelpTimer=setTimeout(function(){this.hideQuickHelp()}.bind(this),50)}else if(t.getAttribute("data-sap-ui-quickhelp")){if(this.oQuickHelpTimer){clearTimeout(this.oQuickHelpTimer);this.oQuickHelpTimer=undefined}if(!this.bMovedOverTooltip){this.oQuickHelpTimer=setTimeout(function(){this.hideQuickHelp()}.bind(this),800)}}};return a});