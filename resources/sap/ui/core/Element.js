/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../base/Object","../base/ManagedObject","./ElementMetadata","../Device","sap/ui/performance/trace/Interaction","sap/base/Log","sap/base/assert","sap/ui/thirdparty/jquery"],function(e,t,r,o,n,i,a,s){"use strict";var l=t.extend("sap.ui.core.Element",{metadata:{stereotype:"element",abstract:true,publicMethods:["getId","getMetadata","getTooltip_AsString","getTooltip_Text","getModel","setModel","hasModel","bindElement","unbindElement","getElementBinding","prop","getLayoutData","setLayoutData"],library:"sap.ui.core",aggregations:{tooltip:{name:"tooltip",type:"sap.ui.core.TooltipBase",altTypes:["string"],multiple:false},customData:{name:"customData",type:"sap.ui.core.CustomData",multiple:true,singularName:"customData"},layoutData:{name:"layoutData",type:"sap.ui.core.LayoutData",multiple:false,singularName:"layoutData"},dependents:{name:"dependents",type:"sap.ui.core.Element",multiple:true},dragDropConfig:{name:"dragDropConfig",type:"sap.ui.core.dnd.DragDropBase",multiple:true,singularName:"dragDropConfig"}}},constructor:function(e,r){t.apply(this,arguments)},renderer:null},r);l.defineClass=function(t,o,n){return e.defineClass(t,o,n||r)};l.prototype.getInterface=function(){return this};l.prototype._handleEvent=function(e){var t=this,r="on"+e.type;function o(o){var n,i,a;if(o&&(i=o.length)>0){o=i===1?o:o.slice();for(n=0;n<i;n++){if(e.isImmediateHandlerPropagationStopped()){return}a=o[n].oDelegate;if(a[r]){a[r].call(o[n].vThis===true?t:o[n].vThis||a,e)}}}}o(this.aBeforeDelegates);if(e.isImmediateHandlerPropagationStopped()){return}if(this[r]){this[r](e)}o(this.aDelegates)};l.prototype.init=function(){};l.prototype.exit=function(){};l.create=t.create;l.prototype.toString=function(){return"Element "+this.getMetadata().getName()+"#"+this.sId};l.prototype.getDomRef=function(e){return(e?this.getId()+"-"+e:this.getId())?window.document.getElementById(e?this.getId()+"-"+e:this.getId()):null};l.prototype.$=function(e){return s(this.getDomRef(e))};l.prototype.isActive=function(){return this.oParent&&this.oParent.isActive()};l.prototype.prop=function(e,t){var r=this.getMetadata().getAllSettings()[e];if(r){if(arguments.length==1){return this[r._sGetter]()}else{this[r._sMutator](t);return this}}};l.prototype.insertDependent=function(e,t){return this.insertAggregation("dependents",e,t,true)};l.prototype.addDependent=function(e){return this.addAggregation("dependents",e,true)};l.prototype.removeDependent=function(e){return this.removeAggregation("dependents",e,true)};l.prototype.removeAllDependents=function(){return this.removeAllAggregation("dependents",true)};l.prototype.destroyDependents=function(){return this.destroyAggregation("dependents",true)};l.prototype.rerender=function(){if(this.oParent){this.oParent.rerender()}};l.prototype.getUIArea=function(){return this.oParent?this.oParent.getUIArea():null};l.prototype.destroy=function(e){if(this.bIsDestroyed){return}l._updateFocusInfo(this);t.prototype.destroy.call(this,e);if(e!=="KeepDom"||this.getMetadata().isInstanceOf("sap.ui.core.PopupInterface")){this.$().remove()}else{i.debug("DOM is not removed on destroy of "+this)}};l.prototype.fireEvent=function(e,r,o,i){if(this.hasListeners(e)){n.notifyStepStart(this)}if(typeof r==="boolean"){i=o;o=r;r=null}r=r||{};r.id=r.id||this.getId();if(l._trackEvent){l._trackEvent(e,this)}return t.prototype.fireEvent.call(this,e,r,o,i)};l._trackEvent=undefined;l.prototype.addDelegate=function(e,t,r,o){a(e,"oDelegate must be not null or undefined");if(!e){return this}this.removeDelegate(e);if(typeof t==="object"){o=r;r=t;t=false}if(typeof r==="boolean"){o=r;r=undefined}(t?this.aBeforeDelegates:this.aDelegates).push({oDelegate:e,bClone:!!o,vThis:r===this?true:r});return this};l.prototype.removeDelegate=function(e){var t;for(t=0;t<this.aDelegates.length;t++){if(this.aDelegates[t].oDelegate==e){this.aDelegates.splice(t,1);t--}}for(t=0;t<this.aBeforeDelegates.length;t++){if(this.aBeforeDelegates[t].oDelegate==e){this.aBeforeDelegates.splice(t,1);t--}}return this};l.prototype.addEventDelegate=function(e,t){return this.addDelegate(e,false,t,true)};l.prototype.removeEventDelegate=function(e){return this.removeDelegate(e)};l.prototype.getFocusDomRef=function(){return this.getDomRef()||null};function u(e){var t,r=[];t=e.parentNode;while(t){r.push({node:t,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop});t=t.parentNode}return r}function p(e){e.forEach(function(e){var t=e.node;if(t.scrollLeft!==e.scrollLeft){t.scrollLeft=e.scrollLeft}if(t.scrollTop!==e.scrollTop){t.scrollTop=e.scrollTop}})}l.prototype.focus=function(e){var t=this.getFocusDomRef(),r;e=e||{};if(t){if(e.preventScroll===true){r=u(t)}t.focus();if(r&&r.length>0){if(o.browser.safari||o.browser.msie||o.browser.edge){setTimeout(p.bind(null,r),0)}else{p(r)}}}};l.prototype.getFocusInfo=function(){return{id:this.getId()}};l.prototype.applyFocusInfo=function(e){this.focus(e);return this};l.prototype._refreshTooltipBaseDelegate=function(e){var t=sap.ui.require("sap/ui/core/TooltipBase");if(t){var r=this.getTooltip();if(r instanceof t){this.removeDelegate(r)}if(e instanceof t){e._currentControl=this;this.addDelegate(e)}}};l.prototype.setTooltip=function(e){this._refreshTooltipBaseDelegate(e);this.setAggregation("tooltip",e);return this};l.prototype.getTooltip=function(){return this.getAggregation("tooltip")};l.runWithPreprocessors=t.runWithPreprocessors;l.prototype.getTooltip_AsString=function(){var e=this.getTooltip();if(typeof e==="string"||e instanceof String){return e}return undefined};l.prototype.getTooltip_Text=function(){var e=this.getTooltip();if(e&&typeof e.getText==="function"){return e.getText()}return e};(function(){var e=function(e,t){var r=e.getAggregation("customData");if(r){for(var o=0;o<r.length;o++){if(r[o].getKey()==t){return r[o]}}}return null};var t=function(t,r,o,n){if(o===null){var i=e(t,r);if(!i){return}var a=t.getAggregation("customData").length;if(a==1){t.destroyAggregation("customData",true)}else{t.removeAggregation("customData",i,true);i.destroy()}}else{var s=sap.ui.requireSync("sap/ui/core/CustomData");var i=e(t,r);if(i){i.setValue(o);i.setWriteToDom(n)}else{var i=new s({key:r,value:o,writeToDom:n});t.addAggregation("customData",i,true)}}};l.prototype.data=function(){var r=arguments.length;if(r==0){var o=this.getAggregation("customData"),n={};if(o){for(var i=0;i<o.length;i++){n[o[i].getKey()]=o[i].getValue()}}return n}else if(r==1){var a=arguments[0];if(a===null){this.destroyAggregation("customData",true);return this}else if(typeof a=="string"){var s=e(this,a);return s?s.getValue():null}else if(typeof a=="object"){for(var l in a){t(this,l,a[l])}return this}else{throw new Error("When data() is called with one argument, this argument must be a string, an object or null, but is "+typeof a+":"+a+" (on UI Element with ID '"+this.getId()+"')")}}else if(r==2){t(this,arguments[0],arguments[1]);return this}else if(r==3){t(this,arguments[0],arguments[1],arguments[2]);return this}else{throw new Error("data() may only be called with 0-3 arguments (on UI Element with ID '"+this.getId()+"')")}}})();l.prototype.clone=function(e,r){var o=t.prototype.clone.apply(this,arguments);for(var n=0;n<this.aDelegates.length;n++){if(this.aDelegates[n].bClone){o.aDelegates.push(this.aDelegates[n])}}for(var n=0;n<this.aBeforeDelegates.length;n++){if(this.aBeforeDelegates[n].bClone){o.aBeforeDelegates.push(this.aBeforeDelegates[n])}}if(this._sapui_declarativeSourceInfo){o._sapui_declarativeSourceInfo=s.extend({},this._sapui_declarativeSourceInfo)}return o};l.prototype.findElements=t.prototype.findAggregatedObjects;function g(e){var t=e.getParent();if(t){var r=s.Event("LayoutDataChange");r.srcControl=e;t._handleEvent(r)}}l.prototype.setLayoutData=function(e){this.setAggregation("layoutData",e,true);g(this);return this};l.prototype.destroyLayoutData=function(){this.destroyAggregation("layoutData",true);g(this);return this};l.prototype.bindElement=t.prototype.bindObject;l.prototype.unbindElement=t.prototype.unbindObject;l.prototype.getElementBinding=t.prototype.getObjectBinding;l.prototype._getFieldGroupIds=function(){var e;if(this.getMetadata().hasProperty("fieldGroupIds")){e=this.getFieldGroupIds()}if(!e||e.length==0){var t=this.getParent();if(t&&t._getFieldGroupIds){return t._getFieldGroupIds()}}return e||[]};l.prototype.getDomRefForSetting=function(e){var t=this.getMetadata().getAllSettings()[e];if(t&&t.selector){var r=this.getDomRef();if(r){r=r.parentNode;if(r&&r.querySelector){var o=t.selector.replace(/\{id\}/g,this.getId().replace(/(:|\.)/g,"\\$1"));return r.querySelector(o)}}}return null};l.prototype._getMediaContainerWidth=function(){if(typeof this._oContextualSettings==="undefined"){return undefined}return this._oContextualSettings.contextualWidth};l.prototype._getCurrentMediaContainerRange=function(e){var t=this._getMediaContainerWidth();e=e||o.media.RANGESETS.SAP_STANDARD;return o.media.getCurrentRange(e,t)};l.prototype._onContextualSettingsChanged=function(){var e=this._getMediaContainerWidth(),t=e!==undefined,r=t^!!this._bUsingContextualWidth,n=this._aContextualWidthListeners||[];if(r){if(t){n.forEach(function(e){o.media.detachHandler(e.callback,e.listener,e.name)})}else{n.forEach(function(e){o.media.attachHandler(e.callback,e.listener,e.name)})}this._bUsingContextualWidth=t}n.forEach(function(e){var t=this._getCurrentMediaContainerRange(e.name);if(t.from!==e.media.from){e.media=t;e.callback.call(e.listener||window,t)}},this)};l.prototype._attachMediaContainerWidthChange=function(e,t,r){r=r||o.media.RANGESETS.SAP_STANDARD;this._aContextualWidthListeners=this._aContextualWidthListeners||[];this._aContextualWidthListeners.push({callback:e,listener:t,name:r,media:this._getCurrentMediaContainerRange(r)});if(!this._bUsingContextualWidth){o.media.attachHandler(e,t,r)}};l.prototype._detachMediaContainerWidthChange=function(e,t,r){var n;r=r||o.media.RANGESETS.SAP_STANDARD;if(!this._aContextualWidthListeners){return}for(var i=0,a=this._aContextualWidthListeners.length;i<a;i++){n=this._aContextualWidthListeners[i];if(n.callback===e&&n.listener===t&&n.name===r){if(!this._bUsingContextualWidth){o.media.detachHandler(e,t,r)}this._aContextualWidthListeners.splice(i,1);break}}};return l});