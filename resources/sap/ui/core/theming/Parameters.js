/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","../Element","sap/base/util/UriParameters","sap/base/Log","sap/base/util/extend","sap/ui/core/ThemeCheck","sap/ui/thirdparty/jquery"],function(e,r,a,t,n,i,s){"use strict";var o=window["sap-ui-config"]||{};var u=0;if(o["xx-nosync"]==="warn"||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){u=1}if(o["xx-nosync"]===true||o["xx-nosync"]==="true"||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){u=2}var f={};var c=null;var l=null;var p=[];var m=new e(sap.ui.require.toUrl(""),document.baseURI).origin();var g={};var d=/url[\s]*\('?"?([^\'")]*)'?"?\)/;var h=a.fromQuery(window.location.search).get("sap-ui-xx-no-inline-theming-parameters")!=="true";function v(){c=null}function y(r,a){var t=d.exec(r);if(t){var n=new e(t[1]);if(n.is("relative")){var i=n.absoluteTo(a).normalize().toString();r="url('"+i+"')"}}return r}function b(e,r,a){for(var t in r){if(typeof e[t]==="undefined"){e[t]=y(r[t],a)}}return e}function w(e,r){if(typeof e["default"]!=="object"){e={default:e,scopes:{}}}c=c||{};c["default"]=c["default"]||{};c["scopes"]=c["scopes"]||{};b(c["default"],e["default"],r);if(typeof e["scopes"]==="object"){for(var a in e["scopes"]){c["scopes"][a]=c["scopes"][a]||{};b(c["scopes"][a],e["scopes"][a],r)}}}function x(e){s("link[id^=sap-ui-theme-]").each(function(){e(this.getAttribute("id"))})}function C(r){var a=document.getElementById(r);if(!a){t.warning("Could not find stylesheet element with ID",r,"sap.ui.core.theming.Parameters");return}var n=a.href;var o=new e(n).filename("").query("").toString();var f=i.checkStyle(r);if(!f){t.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters")}if(f&&h){var c=s(a);var l=c.css("background-image");var p=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(l);if(p&&p.length>=2){var d=p[1];if(d.charAt(0)!=="{"&&d.charAt(d.length-1)!=="}"){try{d=decodeURIComponent(d)}catch(e){t.warning("Could not decode theme parameters URI from "+n)}}try{var v=JSON.parse(d);w(v,o);return}catch(e){t.warning("Could not parse theme parameters from "+n+". Loading library-parameters.json as fallback solution.")}}}var y=n.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(e,r,a){return"/library-parameters.json"+(a?a:"")});if(u===2){t.error("[nosync] Loading library-parameters.json ignored",y,"sap.ui.core.theming.Parameters");return}else if(u===1){t.error("[nosync] Loading library-parameters.json with sync XHR",y,"sap.ui.core.theming.Parameters")}var b=new e(o).origin();var x=g[b];var C=[];if(x===undefined){if(y.startsWith(m)){C=[false,true]}else{C=[true,false]}}else{C=[x]}N(y,o,C)}function N(r,a,n){var i=n.shift();var o=i?{"X-Requested-With":"XMLHttpRequest"}:{};s.ajax({url:r,dataType:"json",async:false,xhrFields:{withCredentials:i},headers:o,success:function(r,t,n){var s=new e(a).origin();g[s]=i;if(Array.isArray(r)){for(var o=0;o<r.length;o++){var u=r[o];w(u,a)}}else{w(r,a)}},error:function(e,s,o){t.error("Could not load theme parameters from: "+r,o);if(n.length>0){t.warning("Initial library-parameters.json request failed ('withCredentials="+i+"'; sUrl: '"+r+"').\n"+"Retrying with 'withCredentials="+!i+"'.","sap.ui.core.theming.Parameters");N(r,a,n)}}})}function P(){if(!c){w({},"");l=sap.ui.getCore().getConfiguration().getTheme();x(C)}return c}function j(){p.forEach(C);p=[]}f._addLibraryTheme=function(e){if(c){p.push("sap-ui-theme-"+e)}};function A(e){var r=P();if(e.scopeName){r=r["scopes"][e.scopeName]}else{r=r["default"]}var a=r[e.parameterName];if(typeof a==="undefined"&&typeof e.parameterName==="string"){var t=e.parameterName.indexOf(":");if(t!==-1){e.parameterName=e.parameterName.substr(t+1)}a=r[e.parameterName]}if(e.loadPendingParameters&&typeof a==="undefined"){j();a=A({parameterName:e.parameterName,scopeName:e.scopeName,loadPendingParameters:false})}return a}function R(e,r){for(var a=0;a<r.length;a++){var t=r[a];for(var n=0;n<t.length;n++){var i=t[n];var s=A({parameterName:e,scopeName:i});if(s){return s}}}return A({parameterName:e})}f._getScopes=function(e){if(e&&!c){return}var r=P();var a=Object.keys(r["scopes"]);return a};f.getActiveScopesFor=function(e){var a=[];if(e instanceof r){var t=e.getDomRef();j();var n=this._getScopes();if(t){var i=function(e){var r=t.classList;return r&&r.contains(e)};while(t){var s=n.filter(i);if(s.length>0){a.push(s)}t=t.parentNode}}else{var o=function(r){return typeof e.hasStyleClass==="function"&&e.hasStyleClass(r)};while(e){var s=n.filter(o);if(s.length>0){a.push(s)}e=typeof e.getParent==="function"&&e.getParent()}}}return a};f.get=function(e,a){var n;if(!sap.ui.getCore().isInitialized()){t.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.")}if(arguments.length===0){j();var i=P();return Object.assign({},i["default"])}if(!e){return undefined}if(a instanceof r){j();var s=this.getActiveScopesFor(a);if(typeof e==="string"){return R(e,s)}else if(Array.isArray(e)){var o={};for(var u=0;u<e.length;u++){var c=e[u];o[c]=R(c,s)}return o}}else{if(typeof e==="string"){n=A({parameterName:e,loadPendingParameters:true});return n}else if(Array.isArray(e)){var o={};for(var l=0;l<e.length;l++){var c=e[l];o[c]=f.get(c)}return o}}};f._setOrLoadParameters=function(e){c={default:{},scopes:{}};l=sap.ui.getCore().getConfiguration().getTheme();x(function(r){var a=r.substr(13);if(e[a]){n(c["default"],e[a])}else{C(r)}})};f.reset=function(){var e=arguments[0]===true;if(!e||sap.ui.getCore().getConfiguration().getTheme()!==l){v()}};f._getThemeImage=function(e,r){e=e||"sapUiGlobalLogo";var a=f.get(e);if(a){var t=d.exec(a);if(t){a=t[1]}else if(a==="''"||a==="none"){a=null}}if(!!r&&!a){return sap.ui.resource("sap.ui.core","themes/base/img/1x1.gif")}return a};return f},true);