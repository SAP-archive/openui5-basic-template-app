/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./View","./JSONViewRenderer","./EventHandlerResolver","sap/base/util/merge","sap/ui/base/ManagedObject","sap/ui/core/library","sap/ui/model/resource/ResourceModel","sap/base/Log","sap/base/util/LoaderExtensions"],function(e,t,r,n,i,o,s,a,u,c){"use strict";var w=s.mvc.ViewType;var l=t.extend("sap.ui.core.mvc.JSONView",{metadata:{library:"sap.ui.core"}});l.create=function(e){var r=i({},e);for(var n in r){if(n==="preprocessors"){delete r["preprocessors"];u.warning("JSView.create does not support the option preprocessors!")}}r.type=w.JSON;return t.create(r)};sap.ui.jsonview=function(e,t){return sap.ui.view(e,t,w.JSON)};l._sType=w.JSON;l.asyncSupport=true;l.prototype.initViewSettings=function(e){if(!e){throw new Error("mSettings must be given")}if(e.viewName&&e.viewContent){throw new Error("View name and view content are given. There is no point in doing this, so please decide.")}else if(!e.viewName&&!e.viewContent){throw new Error("Neither view name nor view content is given. One of them is required.")}var t=this;var r=function(){if((t._oJSONView.resourceBundleName||t._oJSONView.resourceBundleUrl)&&(!e.models||!e.models[t._oJSONView.resourceBundleAlias])){var r=new a({bundleName:t._oJSONView.resourceBundleName,bundleUrl:t._oJSONView.resourceBundleUrl,async:e.async});var n=r.getResourceBundle();if(n instanceof Promise){return n.then(function(){t.setModel(r,t._oJSONView.resourceBundleAlias)})}t.setModel(r,t._oJSONView.resourceBundleAlias)}};if(e.viewName){if(e.async){return this._loadTemplate(e.viewName,{async:true}).then(r)}else{this._loadTemplate(e.viewName);r()}}else if(e.viewContent){this.mProperties["viewContent"]=e.viewContent;if(typeof e.viewContent==="string"){this._oJSONView=JSON.parse(e.viewContent);if(!this._oJSONView){throw new Error("error when parsing viewContent: "+e.viewContent)}}else if(typeof e.viewContent==="object"){this._oJSONView=e.viewContent}else{throw new Error("viewContent must be a JSON string or object, but is a "+typeof e.viewContent)}if(e.async){return Promise.resolve().then(r)}else{r()}}};l.prototype.onControllerConnected=function(e){var t=this;o.runWithPreprocessors(function(){t.applySettings({content:t._oJSONView.content},e)},{id:function(e){return t.createId(e)},settings:function(r){var i=this.getMetadata(),o=i.getJSONKeys(),s,a,u;for(s in r){if((u=o[s])!==undefined){a=r[s];switch(u._iKind){case 3:if(typeof a==="string"){r[s]=t.createId(a)}break;case 5:if(typeof a==="string"){r[s]=n.resolveEventHandler(a,e)}break}}}}})};l.prototype._loadTemplate=function(e,t){var r=e.replace(/\./g,"/")+".view.json";if(!t||!t.async){this._oJSONView=c.loadResource(r)}else{var n=this;return c.loadResource(r,t).then(function(e){n._oJSONView=e})}};l.prototype.getControllerName=function(){return this._oJSONView.controllerName};return l});