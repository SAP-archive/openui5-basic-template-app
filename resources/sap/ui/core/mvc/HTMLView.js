/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./View","./HTMLViewRenderer","./ViewType","sap/base/util/merge","sap/ui/base/ManagedObject","sap/ui/core/DeclarativeSupport","sap/ui/model/resource/ResourceModel","sap/base/util/LoaderExtensions"],function(e,t,r,n,o,i,a,l,s){"use strict";var u=t.extend("sap.ui.core.mvc.HTMLView",{metadata:{library:"sap.ui.core"},renderer:r});u.create=function(e){var r=o({},e);r.type=n.HTML;return t.create(r)};sap.ui.htmlview=function(e,t){return sap.ui.view(e,t,n.HTML)};u._sType=n.HTML;u.asyncSupport=true;u._mTemplates={};u._mAllowedSettings={viewName:true,controller:true,viewContent:true,definition:true,controllerName:true,resourceBundleName:true,resourceBundleUrl:true,resourceBundleLocale:true,resourceBundleAlias:true};u._getTemplate=function(e,t){var r=this._getViewUrl(e);var n=this._mTemplates[r];if(!n){n=this._loadTemplate(e,t);if(t&&t.async){var o=this;return n.then(function(e){o._mTemplates[r]=e;return Promise.resolve(e)})}else{this._mTemplates[r]=n}}return t.async?Promise.resolve(n):n};u.prototype.getControllerName=function(){return this._controllerName};u._getViewUrl=function(e){return sap.ui.require.toUrl(e.replace(/\./g,"/"))+".view.html"};u._loadTemplate=function(e,t){var r=e.replace(/\./g,"/")+".view.html";return s.loadResource(r,t)};u.prototype.initViewSettings=function(t){if(!t){throw new Error("mSettings must be given")}if(t.viewName&&t.viewContent){throw new Error("View name and view content are given. There is no point in doing this, so please decide.")}else if(!t.viewName&&!t.viewContent){throw new Error("Neither view name nor view content is given. One of them is required.")}var r=this;function n(){r._oTemplate=document.createElement("div");if(typeof o==="string"){r._oTemplate.innerHTML=o}else{var n=o;var i=document.createDocumentFragment();for(var s=0;s<n.length;s++){i.appendChild(n.item(s))}r._oTemplate.appendChild(i)}var c=r._oTemplate.getElementsByTagName("template")[0];var p=r.getMetadata().getAllProperties();if(c){e.each(c.attributes,function(e,n){var o=a.convertAttributeToSettingName(n.name,r.getId());var i=n.value;var l=p[o];if(!t[o]){if(l){t[o]=a.convertValueToType(a.getPropertyDataType(l),i)}else if(u._mAllowedSettings[o]){t[o]=i}}});r._oTemplate=c}if(r._oTemplate.content){var i=r._oTemplate.content;r._oTemplate=document.createElement("div");r._oTemplate.appendChild(i)}if(t.controllerName){r._controllerName=t.controllerName}if((t.resourceBundleName||t.resourceBundleUrl)&&(!t.models||!t.models[t.resourceBundleAlias])){var m=new l({bundleName:t.resourceBundleName,bundleUrl:t.resourceBundleUrl,bundleLocale:t.resourceBundleLocale,async:t.async});var d=m.getResourceBundle();if(d instanceof Promise){return d.then(function(){r.setModel(m,t.resourceBundleAlias)})}r.setModel(m,t.resourceBundleAlias)}}var o=t.viewContent;if(!o){o=u._getTemplate(t.viewName,{async:t.async})}if(t.async){return o.then(function(e){o=e;return n()})}n()};u.prototype.onControllerConnected=function(e){var t=this;i.runWithPreprocessors(function(){a.compile(t._oTemplate,t)},{settings:this._fnSettingsPreprocessor})};u.prototype.exit=function(){this._oTemplate=null;t.prototype.exit.call(this);if(this._connectedControls){for(var e=0;e<this._connectedControls.length;e++){this._connectedControls[e].destroy()}this._connectedControls=null}};u.prototype.connectControl=function(e){this._connectedControls=this._connectedControls||[];this._connectedControls.push(e)};return u});