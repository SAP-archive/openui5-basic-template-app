/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/base/util/extend","sap/ui/base/EventProvider","sap/ui/base/ManagedObject","sap/ui/core/mvc/ControllerMetadata","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/base/Log","sap/ui/thirdparty/jquery"],function(e,t,n,r,i,o,a,s,l){"use strict";var f={};var u={};var d=n.extend("sap.ui.core.mvc.Controller",{metadata:{stereotype:"controller",methods:{byId:{public:true,final:true},getView:{public:true,final:true},getInterface:{public:false,final:true},onInit:{public:false,final:false,overrideExecution:a.After},onExit:{public:false,final:false,overrideExecution:a.Before},onBeforeRendering:{public:false,final:false,overrideExecution:a.Before},onAfterRendering:{public:false,final:false,overrideExecution:a.After}}},constructor:function(e){var r=null;if(typeof e=="string"){if(!f[e]){s.warning("Do not call sap.ui.core.mvc.Controller constructor for non typed scenario!")}r=f[e]}n.apply(this,arguments);if(r){t(this,f[e])}if(this.extension){throw new Error("The keyword 'extension' cannot be used as a member of a controller")}this["_sapui_Extensions"]={};d.extendByMember(this,false);this._sapui_isExtended=false},_isExtended:function(){return this._sapui_isExtended},getInterface:function(){var e={};var t=this.getMetadata();var n=t.getAllPublicMethods();n.forEach(function(t){var n=this[t];if(typeof n==="function"){e[t]=function(){var e=n.apply(this,arguments);return e instanceof d?e.getInterface():e}.bind(this)}}.bind(this));this.getInterface=function(){return e};return e}},i);function c(t,n,r){var i=n.getMetadata().getName();var a=t.getMetadata();var l=t["_sapui_Extensions"];var f=t.getInterface();var u=o.getMetadata().getLifecycleConfiguration();var d={namespace:i,extension:n,reloadNeeded:false};n._setController(f);if(n.getMetadata().hasOverrides()){var c,g,v,p,h=n.getMetadata().getOverrides(),x=n.getMetadata().getStaticOverrides();for(p in x){v=n.getMetadata();if(!v.isMethodFinal(p)){o.overrideMethod(p,n,x,n,v.getOverrideExecution(p))}else{s.error("Method '"+p+"' of extension '"+i+"' is flagged final and cannot be overridden by calling 'override'")}}for(p in h){if(p!=="extension"){if(p in n.base){s.debug("Overriding  member '"+p+"' of original controller.");var y=h[p];var E=t[p];if(typeof E=="object"&&typeof y=="object"){g=l[p];v=g.extension.getMetadata();for(c in y){if(!v.isMethodFinal(c)){o.overrideMethod(c,E,y,n,v.getOverrideExecution(c))}else{s.error("Method '"+c+"' of extension '"+g.namespace+"' is flagged final and cannot be overridden by extension '"+i+"'")}}}else if(!a.isMethodFinal(p)){o.overrideMethod(p,t,h,n,a.getOverrideExecution(p))}else{s.error("Method '"+p+"' of controller '"+t.getMetadata().getName()+"' is flagged final and cannot be overridden by extension '"+i+"'")}}else if(p in u){o.overrideMethod(p,t,h,n,a.getOverrideExecution(p))}else{s.error("Method '"+p+"' does not exist in controller "+t.getMetadata().getName()+" and cannot be overridden")}}if(h.extension){for(var b in h.extension){v=l[b].extension.getMetadata();var M=e.create(b,t.extension);var m=l[b].extension;var C=h.extension[b];for(c in C){if(!v.isMethodFinal(c)){o.overrideMethod(c,M,C,n,v.getOverrideExecution(c));o.overrideMethod(c,m,C,n,v.getOverrideExecution(c))}else{s.error("Method '"+c+"' of extension '"+b+"' is flagged final and cannot be overridden by extension '"+i+"'")}}}}d.reloadNeeded=true}}var w=n.getInterface();if(r){l[r]=d;d.location=r;t[r]=w;f[r]=w}else{l[i]=d;d.location="extension."+i;e.set("extension."+i,w,t);e.set("extension."+i,w,f)}}function g(e,t,n){if(t instanceof o){c(e,t,n)}else if(t.getMetadata&&t.getMetadata().getStereotype()=="controllerextension"){var r=new t;c(e,r,n)}else{var i=o.getMetadata().getLifecycleConfiguration();for(var a in t){if(a in i){o.overrideMethod(a,e,t,e,i[a].overrideExecution)}else{o.overrideMethod(a,e,t)}}}}function v(t,n){if(!t){throw new Error("Controller name ('sName' parameter) is required")}var r=t.replace(/\./g,"/")+".controller",i=o(sap.ui.require(r));function o(n){if(n){return n}else if(f[t]){return d}else{return e.get(t)}}if(n){return new Promise(function(e,t){if(!i){sap.ui.require([r],function(t){e(o(t))},t)}else{e(i)}})}else if(!i){i=sap.ui.requireSync(r);return o(i)}else{return i}}function p(e,t){var n=d._sExtensionProvider.replace(/\./g,"/"),r=u[n];if(t){return new Promise(function(e,t){if(n){if(r){e(r)}else{sap.ui.require([n],function(t){r=new t;u[n]=r;e(r)},t)}}else{e()}})}else if(n){if(r){return r}else{var i=sap.ui.requireSync(n);r=new i;u[n]=r;return r}}}function h(e,t){var n;if(f[t]){n=new e(t)}else{n=new e}if(!n){throw new Error("Controller "+t+" couldn't be instantiated")}return n}d.extendByMember=function(e,t){var n;for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){e[n]=new e[n]}}for(n in e){if(e[n]&&e[n].getMetadata&&e[n].getMetadata().getStereotype()=="controllerextension"){g(e,e[n],n)}}if(t){return Promise.resolve(e)}else{return e}};d.extendByCustomizing=function(e,t,n){var i=sap.ui.require("sap/ui/core/CustomizingConfiguration");if(!i){return n?Promise.resolve(e):e}function o(e,t){return v(e,n).then(function(n){n=f[e]||n;if(n!==undefined){if(n.getMetadata&&n.getMetadata().isA("sap.ui.core.mvc.Controller")){s.warning("Attempt to load Extension Controller "+e+" was not successful","Controller extension should be a plain object.",null,function(){return{type:"ControllerExtension",name:e}})}else{g(t,n)}return t}},function(t){s.error("Attempt to load Extension Controller "+e+" was not successful - is the Controller correctly defined in its file?")})}var a,l=[],u,d=n?Promise.resolve(e):e,c=i.getControllerExtension(t,r._sOwnerId);if(c){u=typeof c==="string"?c:c.controllerName;l=c.controllerNames||[];if(u){l.unshift(u)}}for(var p=0,h=l.length;p<h;p++){var x=l[p];if(typeof x==="string"){s.info("Customizing: Controller '"+t+"' is now extended by '"+x+"'");if(n){d=d.then(o.bind(null,x,e))}else{if(!f[x]&&!sap.ui.require(x)){v(x)}if((a=f[x])!==undefined){g(e,a)}else{s.error("Attempt to load Extension Controller "+x+" was not successful - is the Controller correctly defined in its file?")}}}}return d};d.extendByProvider=function(e,t,n,r){if(!d._sExtensionProvider){return r?Promise.resolve(e):e}s.info("Customizing: Controller '"+t+"' is now extended by Controller Extension Provider '"+d._sExtensionProvider+"'");var i,o;if(r){return p(e,r).then(function(e){return e.getControllerExtensions(t,n,r)}).then(function(t){if(t&&t.length){for(var n=0,r=t.length;n<r;n++){g(e,t[n])}}return e},function(t){s.error("Controller Extension Provider: Error '"+t+"' thrown in "+d._sExtensionProvider+"; extension provider ignored.");return e})}else{o=p(e,r);i=o.getControllerExtensions(t,n,r);if(i&&Array.isArray(i)){for(var a=0,l=i.length;a<l;a++){g(e,i[a])}}else{s.error("Controller Extension Provider: Error in ExtensionProvider.getControllerExtensions: "+d._sExtensionProvider+" - no valid extensions returned")}}return e};d.create=function(e){return x(e.name,undefined,true)};sap.ui.controller=function(e,t,n){if(n){s.info("Do not use deprecated factory function 'sap.ui.controller("+e+")'. Use 'sap.ui.core.mvc.Controller.create(...)' instead.","sap.ui.controller",null,function(){return{type:"sap.ui.controller",name:e}})}else{s.warning("Do not use synchronous controller creation for controller '"+e+"'! Use the new asynchronous factory 'sap.ui.core.mvc.Controller.create(...)' instead.","sap.ui.controller",null,function(){return{type:"sap.ui.controller",name:e}})}return x.apply(this,arguments)};function x(e,t,n){var i,o,a=r._sOwnerId;if(typeof t==="boolean"){t=undefined}if(!t){if(n){return v(e,n).then(function(t){return h(t,e)}).then(function(t){return d.extendByCustomizing(t,e,n)}).then(function(t){return d.extendByProvider(t,e,a,n)}).then(function(e){e._sapui_isExtended=true;return e})}else{o=v(e,n);i=h(o,e);i=d.extendByCustomizing(i,e,n);i=d.extendByProvider(i,e,a,n);i._sapui_isExtended=true}return i}else{f[e]=t;s.info("For defining controllers use Controller.extend instead")}}d.prototype.getPublicMethods=function(){var e={},n=this.getMetadata(),r=n.getAllMethods(),i=n.getLifecycleConfiguration();Object.keys(r).forEach(function(t){if(n.isMethodPublic(t)){e[t]=r[t];e[t].reloadNeeded=!!(t in i)}});delete e.extension;var o=this["_sapui_Extensions"];Object.keys(o).forEach(function(n){var r=o[n];var i=r.extension.getInterface();var a=r.extension.getMetadata().getAllMethods();Object.keys(i).forEach(function(n){delete e[r.location];var i=t({},a[n],{reloadNeeded:r.reloadNeeded});e[r.location+"."+n]=i})});return e};d.prototype.destroy=function(){Object.keys(this["_sapui_Extensions"]).forEach(function(t){e.set(t.location,null,this)}.bind(this));delete this["_sapui_Extensions"];delete this["_sapui_Interface"];n.prototype.destroy.apply(this,arguments)};d.prototype.getView=function(){return this.oView};d.prototype.byId=function(e){return this.oView?this.oView.byId(e):undefined};d.prototype.createId=function(e){return this.oView?this.oView.createId(e):undefined};d.prototype.getOwnerComponent=function(){var e=sap.ui.requireSync("sap/ui/core/Component");return e.getOwnerComponentFor(this.getView())};d.prototype.connectToView=function(e){this.oView=e;if(this.onInit){e.attachAfterInit(this.onInit,this)}if(this.onExit){e.attachBeforeExit(this.onExit,this)}if(this.onAfterRendering){e.attachAfterRendering(this.onAfterRendering,this)}if(this.onBeforeRendering){e.attachBeforeRendering(this.onBeforeRendering,this)}};d._sExtensionProvider=null;d.registerExtensionProvider=function(e){d._sExtensionProvider=e};return d});