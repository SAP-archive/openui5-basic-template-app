/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery"],function(e,t,i,s){"use strict";var r=t.getLogger("sap.ui.core.ResizeHandler",t.Level.ERROR);var n=null;var o=e.extend("sap.ui.core.ResizeHandler",{constructor:function(t){e.apply(this);n=t;this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.iIdCounter=0;this.fDestroyHandler=this.destroy.bind(this);s(window).bind("unload",this.fDestroyHandler);i.attachActivate(d,this)}});function a(){if(this.bRegistered){this.bRegistered=false;sap.ui.getCore().detachIntervalTimer(this.checkSizes,this)}}function d(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;sap.ui.getCore().attachIntervalTimer(this.checkSizes,this)}}o.prototype.destroy=function(e){i.detachActivate(d,this);s(window).unbind("unload",this.fDestroyHandler);n=null;this.aResizeListeners=[];this.aSuspendedDomRefs=[];a.call(this)};o.prototype.attachListener=function(t,i){var s=e.isA(t,"sap.ui.core.Control"),n=s?t.getDomRef():t,o=n?n.offsetWidth:0,a=n?n.offsetHeight:0,u="rs-"+Date.now()+"-"+this.iIdCounter++,f;if(s){f="Control "+t.getId()}else if(t.id){f=t.id}else{f=String(t)}this.aResizeListeners.push({sId:u,oDomRef:s?null:t,oControl:s?t:null,fHandler:i,iWidth:o,iHeight:a,dbg:f});r.debug("registered "+f);d.call(this);return u};o.prototype.detachListener=function(e){var t=this.aResizeListeners;for(var i=0;i<t.length;i++){if(t[i].sId===e){t.splice(i,1);r.debug("deregistered "+e);break}}if(t.length===0){a.call(this)}};o.prototype.checkSizes=function(){var e=r.isLoggable();if(e){r.debug("checkSizes:")}this.aResizeListeners.forEach(function(t){if(t){var i=!!t.oControl,n=i?t.oControl.getDomRef():t.oDomRef;if(n&&s.contains(document.documentElement,n)&&!this._isSuspended(n)){var o=t.iWidth,a=t.iHeight,d=n.offsetWidth,u=n.offsetHeight;if(o!=d||a!=u){t.iWidth=d;t.iHeight=u;var f=s.Event("resize");f.target=n;f.currentTarget=n;f.size={width:d,height:u};f.oldSize={width:o,height:a};f.control=i?t.oControl:null;if(e){r.debug("resize detected for '"+t.dbg+"': "+f.oldSize.width+"x"+f.oldSize.height+" -> "+f.size.width+"x"+f.size.height)}t.fHandler(f)}}}},this);if(o._keepActive!=true&&o._keepActive!=false){o._keepActive=false}if(!i.isActive()&&!o._keepActive){a.call(this)}};o.register=function(e,t){if(!n||!n.oResizeHandler){return null}return n.oResizeHandler.attachListener(e,t)};o.deregister=function(e){if(!n||!n.oResizeHandler){return}n.oResizeHandler.detachListener(e)};o.deregisterAllForControl=function(e){if(!n||!n.oResizeHandler){return}n.oResizeHandler.aResizeListeners.filter(function(t){return t&&t.oControl&&t.oControl.getId()===e}).forEach(function(e){o.deregister(e.sId)})};o.suspend=function(e){if(!n||!n.oResizeHandler){return false}if(!e||!s.contains(document.documentElement,e)){return false}var t=n.oResizeHandler;if(t.aSuspendedDomRefs.indexOf(e)===-1){t.aSuspendedDomRefs.push(e)}return true};o.resume=function(e){if(!n||!n.oResizeHandler){return false}var t=n.oResizeHandler,i=t.aSuspendedDomRefs.indexOf(e);if(i===-1){return false}t.aSuspendedDomRefs.splice(i,1);t.checkSizes();return true};o.prototype._isSuspended=function(e){var t=this.aSuspendedDomRefs,i;for(var r=0;r<t.length;r++){i=t[r];if(i===e||s.contains(i,e)){return true}}return false};return o});