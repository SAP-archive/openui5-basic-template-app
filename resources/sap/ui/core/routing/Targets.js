/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","./Target","./async/Targets","./sync/Targets","sap/base/util/UriParameters","sap/base/Log","sap/ui/thirdparty/jquery"],function(t,e,i,r,a,n,s){"use strict";var o=t.extend("sap.ui.core.routing.Targets",{constructor:function(e){var s,o;t.apply(this);this._mTargets={};this._oConfig=e.config;this._oCache=e.cache||e.views;if(!this._oConfig){this._oConfig={_async:false}}function h(){if(new a(window.location.href).get("sap-ui-xx-asyncRouting")==="true"){n.warning("Activation of async view loading in routing via url parameter is only temporarily supported and may be removed soon","Targets");return true}return false}if(this._oConfig._async===undefined){this._oConfig._async=this._oConfig.async===undefined?h():this._oConfig.async}var g=this._oConfig._async?i:r;for(var f in g){this[f]=g[f]}for(s in e.targets){if(e.targets.hasOwnProperty(s)){this._createTarget(s,e.targets[s])}}for(o in this._mTargets){if(this._mTargets.hasOwnProperty(o)){this._addParentTo(this._mTargets[o])}}},destroy:function(){var e;t.prototype.destroy.apply(this);for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){this._mTargets[e].destroy()}}this._mTargets=null;this._oCache=null;this._oConfig=null;this.bIsDestroyed=true;return this},getViews:function(){return this._oCache},getCache:function(){return this._oCache},getTarget:function(t){var e=this,i=[];if(Array.isArray(t)){t.forEach(function(t){var r=e._mTargets[t];if(r){i.push(r)}else{n.error('The target you tried to get "'+t+'" does not exist!',e)}});return i}return this._mTargets[t]},addTarget:function(t,e){var i=this.getTarget(t),r;if(i){n.error("Target with name "+t+" already exists",this)}else{r=this._createTarget(t,e);this._addParentTo(r)}return this},attachDisplay:function(t,e,i){return this.attachEvent(this.M_EVENTS.DISPLAY,t,e,i)},detachDisplay:function(t,e){return this.detachEvent(this.M_EVENTS.DISPLAY,t,e)},fireDisplay:function(t){return this.fireEvent(this.M_EVENTS.DISPLAY,t)},attachTitleChanged:function(t,e,i){this.attachEvent(this.M_EVENTS.TITLE_CHANGED,t,e,i);return this},detachTitleChanged:function(t,e){return this.detachEvent(this.M_EVENTS.TITLE_CHANGED,t,e)},fireTitleChanged:function(t){return this.fireEvent(this.M_EVENTS.TITLE_CHANGED,t)},M_EVENTS:{DISPLAY:"display",TITLE_CHANGED:"titleChanged"},_createTarget:function(t,e){var i,r;r=s.extend(true,{_name:t},this._oConfig,e);i=this._constructTarget(r);i.attachDisplay(function(e){var i=e.getParameters();this.fireDisplay({name:t,view:i.view,control:i.control,config:i.config,data:i.data})},this);this._mTargets[t]=i;return i},_addParentTo:function(t){var e,i=t._oOptions.parent;if(!i){return}e=this._mTargets[i];if(!e){n.error("The target '"+t._oOptions._name+" has a parent '"+i+"' defined, but it was not found in the other targets",this);return}t._oParent=e},_constructTarget:function(t,i){return new e(t,this._oCache,i)},_setRootViewId:function(t){var e,i;for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){i=this._mTargets[e]._oOptions;if(i.rootView===undefined){i.rootView=t}}}},_getTitleTargetName:function(t,e){var i,r;r=e||typeof t==="string"&&t;if(!r){t.some(function(t){i=this.getTarget(t);while(i&&i._oParent&&i._oParent._oOptions.title){i=i._oParent}if(i&&i._oOptions.title){r=i._oOptions._name;return true}}.bind(this))}return r},_forwardTitleChanged:function(t){this.fireTitleChanged({name:t.getParameter("name"),title:t.getParameter("title")})},_attachTitleChanged:function(t,e){var i;e=this._getTitleTargetName(t,e);i=this.getTarget(e);if(this._oLastTitleTarget){this._oLastTitleTarget.detachTitleChanged(this._forwardTitleChanged,this);this._oLastTitleTarget._bIsDisplayed=false}if(i){i.attachTitleChanged({name:i._oOptions._name},this._forwardTitleChanged,this);this._oLastTitleTarget=i}else if(e){n.error('The target with the name "'+e+'" where the titleChanged event should be fired does not exist!',this)}}});return o});