/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/ComponentContainer","sap/ui/core/library"],function(e,t,n){"use strict";return{display:function(e){var t=Promise.resolve();return this._display(e,t).catch(function(e){if(e instanceof Error){return Promise.reject(e)}else{return e}})},_display:function(e,t){if(this._oParent){t=this._oParent._display(e,t)}return this._place(e,t)},_place:function(n,o){if(n instanceof Promise){o=n;n=undefined}var r=this._oOptions,i=this,a,s,c,u,d;if(r.name&&r.type){s=this._getEffectiveObjectName(r.name);switch(r.type){case"View":c={name:s,type:r.viewType,id:r.id,async:true};break;case"Component":c=Object.assign({},r.options||{},{name:s,id:r.id});break;default:throw new Error("The given type "+r.type+" isn't support by sap.ui.core.routing.Target")}a=this._oCache._get(c,r.type,this._bUseRawViewId);if(!(a instanceof Promise)){if(a.isA("sap.ui.core.mvc.View")){d=a.loaded()}else{d=Promise.resolve(a)}}else{d=a}o=o.then(function(e){return d.then(function(t){return{object:t,parentInfo:e||{}}},function(e){return Promise.reject({name:r._name,error:e})})}).then(function(e){var t=i._isValid(e.parentInfo);a=e.object;if(a.isA("sap.ui.core.mvc.View")){i._bindTitleInTitleProvider(a);i._addTitleProviderAsDependent(a)}if(t!==true){u=t;return i._refuseInvalidTarget(r._name,u)}var n=e.parentInfo.view,o=e.parentInfo.control,s=Promise.resolve(o);if(n&&n.isA("sap.ui.core.UIComponent")){n=n.getRootControl()}if(!n&&r.rootView){n=sap.ui.getCore().byId(r.rootView);if(!n){u="Did not find the root view with the id "+r.rootView;return i._refuseInvalidTarget(r._name,u)}}if(r.controlId){if(n){s=n.loaded().then(function(e){return e.byId(r.controlId)})}s=s.then(function(e){if(!e){e=sap.ui.getCore().byId(r.controlId)}if(!e){u="Control with ID "+r.controlId+" could not be found";return i._refuseInvalidTarget(r._name,u)}else{return e}}).catch(function(){u="Something went wrong during loading the root view with id "+r.rootView;return i._refuseInvalidTarget(r._name,u)})}return s}).then(function(o){var c,d,f;if(o.error){return o}if(a.isA("sap.ui.core.UIComponent")){c=a;d=c.getId()+"-container";a=sap.ui.getCore().byId(d);if(!a){a=new t(d,{component:c,height:"100%",width:"100%",lifecycle:sap.ui.core.ComponentLifecycle.Application});f=c.exit;c.exit=function(){if(f){f.apply(this)}a.destroy()}}}i._beforePlacingViewIntoContainer({container:o,view:a,data:n});var l=o.getMetadata().getJSONKeys()[r.controlAggregation];if(!l){u="Control "+r.controlId+" does not have an aggregation called "+r.controlAggregation;return i._refuseInvalidTarget(r._name,u)}if(r.clearControlAggregation===true){o[l._sRemoveAllMutator]()}e.info("Did place the "+r.type.toLowerCase()+" '"+s+"' with the id '"+a.getId()+"' into the aggregation '"+r.controlAggregation+"' of a control with the id '"+o.getId()+"'",i);o[l._sMutator](a);i.fireDisplay({view:a.isA("sap.ui.core.mvc.View")?a:undefined,object:a,control:o,config:i._oOptions,data:n});return{name:r._name,view:a,control:o}})}else{o=o.then(function(){return{name:r._name}})}return o},_isValid:function(t){var n=this._oOptions,o=t&&t.control,r=o||n.controlId,i=true,a="";if(!r){a="The target "+n._name+" has no controlId set and no parent so the target cannot be displayed.";i=false}if(!n.controlAggregation){a="The target "+n._name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";i=false}if(a){e.error(a,this)}return i||a},_refuseInvalidTarget:function(t,n){if(n){e.error(n,this)}return{name:t,error:n}}}});