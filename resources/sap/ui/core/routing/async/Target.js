/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/ComponentContainer","sap/ui/core/library"],function(e,t,n){"use strict";var o=n.ComponentLifecycle;return{display:function(e){var t=Promise.resolve();return this._display(e,t)},_display:function(e,t,n){if(this._oParent){t=this._oParent._display(e,t,n)}return this._place(e,t,n)},suspend:function(){if(this._oParent){this._oParent.suspend()}if(this._isLoaded()){var t=this._get(),n;if(t.isA("sap.ui.core.UIComponent")&&(n=t.getRouter())){n.stop()}}else{e.warning("The target with name '"+this._oOptions._name+"' can't be suspended because it's being loaded or not loaded yet")}return this},_isLoaded:function(){return this._bIsLoaded},_get:function(e){var t=this._getEffectiveObjectName(this._oOptions.name),n=this._oOptions,o;switch(n.type){case"View":o={name:t,type:n.viewType,id:n.id,async:true};break;case"Component":o={id:n.id};if(n.usage){o.usage=n.usage}else{o.name=t}o=Object.assign({},n.options||{},o);break;default:throw new Error("The given type "+n.type+" isn't support by sap.ui.core.routing.Target")}return this._oCache._get(o,n.type,this._bUseRawViewId,e)},_load:function(e){var t=this._get(e),n;if(!(t instanceof Promise)){if(t.isA("sap.ui.core.mvc.View")){n=t.loaded()}else{n=Promise.resolve(t)}}else{n=t}return n.then(function(e){this._bIsLoaded=true;return e}.bind(this))},_place:function(n,i,r){if(n instanceof Promise){r=i;i=n;n=undefined}var a=this._oOptions,s=this,c,u,d,f=true,g,l;if((a.name||a.usage)&&a.type){l=new Promise(function(e){g=e});d=this._load(r).then(function(e){if(e.isA("sap.ui.core.UIComponent")){var t=e.getRouter();if(t){var n=t.getHashChanger().getHash();var o=t.getRouteByHash(n);if(!t._oConfig.async){throw new Error("The router of component '"+e.getId()+"' which is loaded via the target '"+s._oOptions._name+"' is defined as synchronous which is not supported using as a nested component.")}if(t._oOwner){t._oOwner._bRoutingPropagateTitle=r.propagateTitle}if(o&&o._oConfig.target){f=false;t.attachRouteMatched(g)}if(t.isStopped()){t.initialize()}}}if(f){g()}return e});i=i.then(function(e){return d.then(function(t){return{object:t,parentInfo:e||{}}})}).then(function(e){var t=s._isValid(e.parentInfo),n,o;c=e.object;if(c.isA("sap.ui.core.UIComponent")){o=c.getRootControl();if(o&&o.isA("sap.ui.core.mvc.View")){n=o}}else{n=c}s._bindTitleInTitleProvider(n);s._addTitleProviderAsDependent(n);if(t!==true){u=t;return s._refuseInvalidTarget(a._name,u)}var i=e.parentInfo.view,r=e.parentInfo.control,d=Promise.resolve(r);if(i&&i.isA("sap.ui.core.ComponentContainer")){i=i.getComponentInstance().getRootControl()}if(!i&&a.rootView){i=sap.ui.getCore().byId(a.rootView);if(!i){u="Did not find the root view with the id "+a.rootView;return s._refuseInvalidTarget(a._name,u)}}if(a.controlId){if(i&&i.isA("sap.ui.core.mvc.View")){d=i.loaded().then(function(e){return e.byId(a.controlId)})}d=d.then(function(e){if(!e){e=sap.ui.getCore().byId(a.controlId)}if(!e){u="Control with ID "+a.controlId+" could not be found";return s._refuseInvalidTarget(a._name,u)}else{return e}})}return d}).then(function(i){var r,d,f;if(c.isA("sap.ui.core.UIComponent")){r=c;d=r.getId()+"-container";c=sap.ui.getCore().byId(d);if(!c){var g=Object.assign({component:r,height:"100%",width:"100%",lifecycle:o.Application},a.containerOptions);c=new t(d,g);f=r.destroy;r.destroy=function(){if(f){f.apply(this)}c.destroy()}}}s._beforePlacingViewIntoContainer({container:i,view:c,data:n});var l=i.getMetadata().getJSONKeys()[a.controlAggregation];if(!l){u="Control "+a.controlId+" does not have an aggregation called "+a.controlAggregation;return s._refuseInvalidTarget(a._name,u)}if(a.clearControlAggregation===true){i[l._sRemoveAllMutator]()}e.info("Did place the "+a.type.toLowerCase()+" target '"+(a.name?s._getEffectiveObjectName(a.name):a.usage)+"' with the id '"+c.getId()+"' into the aggregation '"+a.controlAggregation+"' of a control with the id '"+i.getId()+"'",s);i[l._sMutator](c);return{name:a._name,view:c,control:i}})}else{i=i.then(function(){return{name:a._name}})}return Promise.all([i,l]).then(function(e){var t=e[0].control;var o=e[0].view;if(t&&o){s.fireDisplay({view:o.isA("sap.ui.core.mvc.View")?o:undefined,object:o,control:t,config:s._oOptions,data:n})}return e[0]})},_isValid:function(t){var n=this._oOptions,o=t&&t.control,i=o||n.controlId,r=true,a="";if(!i){a="The target "+n._name+" has no controlId set and no parent so the target cannot be displayed.";r=false}if(!n.controlAggregation){a="The target "+n._name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";r=false}if(a){e.error(a,this)}return r||a},_refuseInvalidTarget:function(e,t){return Promise.reject(new Error(t+" - Target: "+e))}}});