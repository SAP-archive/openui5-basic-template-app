/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/IconPool","sap/m/library","sap/m/Popover","sap/m/Text","sap/ui/layout/form/SimpleForm","sap/m/Button","sap/m/Label","sap/m/Link","sap/ui/core/HTML","sap/ui/core/Title","sap/ui/thirdparty/jquery"],function(t,e,a,r,i,n,s,o,p,l,d,u){"use strict";var c=a.PlacementType;var h=t.extend("sap.ui.core.support.controls.InteractionTree",{metadata:{library:"sap.ui.core"},constructor:function(){this.start=0;this.end=1}});h.expandIcon="sap-icon://navigation-right-arrow";h.collapseIcon="sap-icon://navigation-down-arrow";h.headerIcon='<img class="sapUiInteractionSvgImage" src="HeaderIcon.svg">';h.prototype.setInteractions=function(t){this.interactions=t;this.start=0;this.end=1;this.updateRanges()};h.prototype.setRange=function(t,e){this.start=t;this.end=e;this.updateRanges();this.update()};h.prototype.updateRanges=function(){var t=this.interactions;if(!t||!t.length){return}this.startTime=t[0].start;this.endTime=t[t.length-1].end;var e=this.endTime-this.startTime;this.actualStartTime=this.startTime+this.start*e;this.actualEndTime=this.startTime+this.end*e;this.timeRange=this.actualEndTime-this.actualStartTime};h.prototype.update=function(){if(!this.parent){return}u(this.parent).find("#"+this.getId()).remove();this.renderAt(this.parent)};h.prototype.renderAt=function(t){this.parent=t;var e=sap.ui.getCore().createRenderManager();this.render(e);e.flush(t);e.destroy();this.attachEvents();this.attachInteractionDetailsPopover();this.attachRequestDetailsPopover()};h.prototype.render=function(t){t.write('<div id="'+this.getId()+'" class="sapUiInteractionTreeContainer sapUiSizeCompact">');t.write('<div class="sapUiInteractionGridLinesContainer"></div>');t.write("<ul");t.addClass("sapUiInteractionTree");t.writeClasses();t.write(">");this.renderHeaders(t);var e,a=this.interactions;if(!a||!a.length){return}for(var r=0;r<a.length;r++){e=a[r];this.renderInteraction(t,e,r)}t.write("</ul>");t.write("</div>")};h.prototype.attachEvents=function(){var t=this,e=u(".sapUiInteractionTreeContainer .sapUiInteractionTree");this.gridContainer=u(".sapUiInteractionTreeContainer .sapUiInteractionGridLinesContainer");this.gridContainerWidth=0;e.on("click",function(e){var a=u(e.target);if(a.hasClass("sapUiInteractionLeft")){t.handleInteractionClick(a)}});this.gridContainer.on("resize",function(e){t.updateGridLines()});u(window).on("resize",function(e){t.updateGridLines()});t.updateGridLines()};h.prototype.updateGridLines=function(){var t=this.gridContainer,e=this.timeRange,a=this.gridContainer.width();if(this.gridContainerWidth==a){return}t.empty();t.append('<div style="left:'+(this.getPosition(a,e,0)+6)+'px" class="sapUiInteractionGridLineIntervalText">'+this.formatGridLineDuration(0)+"</div>");var r=this.calculateInterval(a,e);for(var i=r;i<e;i+=r){var n=this.getPosition(a,e,i);if(i+r<e){t.append('<div style="left:'+(n+6)+'px" class="sapUiInteractionGridLineIntervalText">'+this.formatGridLineDuration(i)+"</div>")}t.append('<div style="left:'+n+'px" class="sapUiInteractionGridLine"></div>')}this.gridContainerWidth=a};h.prototype.calculateInterval=function(t,e){var a=4;var r=Math.max(t*a/200,1);var i=e/r;var n=Math.pow(10,Math.floor(Math.log(i)/Math.LN10));var s=[10,5,2,1];for(var o=0;o<s.length;o++){var p=s[o];var l=n*p;if(r<e/l){break}i=l}return i};h.prototype.getPosition=function(t,e,a){var r=t/e*a;return r};h.prototype.handleInteractionClick=function(t){var e=t.find(".sapUiInteractionTreeIcon");if(!e.length){return}var a=e.attr("expanded")=="true";var r=e.parent();e.remove();var i=this.getIconHTML(!a);r.children().eq(0).after(i);var n=r.parent().parent();n.toggleClass("sapUiInteractionItemExpanded");var s=parseInt(n.attr("data-interaction-index"));this.interactions[s].isExpanded=!a;var o=n.find("ul");var p=a?"slideUp":"slideDown";o.stop(true,true)[p]("fast",function(){o.toggleClass("sapUiHiddenUiInteractionItems")})};h.prototype.renderHeaders=function(t){t.write("<li>");t.write("<div");t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionItemDiv");t.addClass("sapUiInteractionHeader");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionTreeItemLeft">');t.write("<div>");t.write('<span class="sapUiInteractionItemComponentText">');t.writeEscaped("Component");t.write("</span>");t.write("<br>");t.write('<span class="sapUiInteractionItemTriggerText">');t.writeEscaped("Trigger");t.write("</span>");t.write("</div>");t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight">');t.write("</div>");t.write("</div>");t.write("</li>")};h.prototype.isInteractionVisible=function(t){var e=t.start;var a=t.end;if(this.actualStartTime>a||this.actualEndTime<e){return false}if(this.actualStartTime<e+t.duration&&this.actualEndTime>e){return true}return this.hasVisibleRequests(t)};h.prototype.hasVisibleRequests=function(t){var e,a,r,i=t.requests;for(var n=0;n<i.length;n++){e=i[n];a=e.fetchStartOffset+e.startTime;r=e.fetchStartOffset+e.startTime+this.getRequestDuration(e);if(this.actualStartTime<r&&this.actualEndTime>a){return true}}return false};h.prototype.renderInteraction=function(t,e,a){var r,i=e.requests;if(!this.isInteractionVisible(e)){return}t.write('<li data-interaction-index="'+a+'"');if(e.isExpanded){t.addClass("sapUiInteractionItemExpanded");t.writeClasses()}t.write(">");this.renderInteractionDiv(t,e);t.write("<ul");t.addClass("sapUiInteractionItem");if(!e.isExpanded){t.addClass("sapUiHiddenUiInteractionItems")}t.writeClasses();t.write(">");for(var n=0;n<i.length;n++){r=i[n];this.renderRequest(t,e,r,n)}t.write("</ul>");t.write("</li>")};h.prototype.renderInteractionDiv=function(t,e){t.write("<div");t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionItemDiv");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionLeft sapUiInteractionTreeItemLeft">');t.write("<div>");t.write('<span class="sapUiInteractionItemComponentText">');t.writeEscaped(e.component!=="undetermined"?e.component:"Initial Loading");t.write("</span>");t.write("<br>");t.write('<span class="sapUiInteractionItemTriggerText">');t.writeEscaped(e.trigger+" / "+e.event);t.write("</span>");t.write("</div>");if(e.requests.length){this.renderIcon(t,e.isExpanded)}if(e.sapStatistics.length&&e.requests.length){t.write('<div class="sapUiInteractionHeaderIcon">'+h.headerIcon+"</div>")}t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight">');var a=Math.round(e.start+e.duration);this.renderInteractionPart(t,e.start,a,"sapUiInteractionBlue");t.write("</div>");t.write("</div>")};h.prototype.renderInteractionPart=function(t,e,a,r){if(this.actualStartTime>a||this.actualEndTime<e){return}a=Math.min(a,this.actualEndTime);e=Math.max(e,this.actualStartTime);var i=100/this.timeRange*(e-this.actualStartTime);var n=100/this.timeRange*(a-this.actualStartTime);var s=n-i;t.write('<span style="margin-left: '+i+"%; width: "+s+'%" class="sapUiInteractionTimeframe sapUiInteractionTimeInteractionFrame '+r+'"></span>')};h.prototype.renderRequest=function(t,e,a,r){var i=a.fetchStartOffset;var n=i+a.startTime;var s=i+a.startTime+this.getRequestDuration(a);if(this.actualStartTime>s||this.actualEndTime<n){return}t.write('<li data-request-index="'+r+'"');t.addClass("sapUiInteractionTreeItem");t.addClass("sapUiInteractionRequest");t.writeClasses();t.write(">");t.write('<div class="sapUiInteractionTreeItemLeft sapUiInteractionRequestLeft">');var o=a.initiatorType||a.entryType;var p=this.getRequestColorClass(o);t.write('<span class="sapUiInteractionRequestIcon '+p+'"></span>');t.write('<span class="sapUiInteractionItemEntryTypeText">');t.writeEscaped(o);t.write("</span>");if(this.getRequestSapStatistics(e,a)){t.write('<div class="sapUiInteractionRequestHeaderIcon">'+h.headerIcon+"</div>")}t.write("</div>");t.write('<div class="sapUiInteractionTreeItemRight"');t.write(">");var l=this.getRequestRequestStart(a)+i;var d=this.getRequestResponseStart(a)+i;this.renderRequestPart(t,n,l,p+"70");this.renderRequestPart(t,l,d,p);this.renderRequestPart(t,d,s,p+"70");t.write("</div>");t.write("</li>")};h.prototype.getRequestSapStatistics=function(t,e){var a,r=t.sapStatistics;for(var i=0;i<r.length;i++){if(r[i].timing&&e.startTime===r[i].timing.startTime){a=r[i];return a}}return false};h.prototype.getRequestColorClass=function(t){var e;switch(t){case"xmlhttprequest":e="sapUiPurple";break;case"OData":e="sapUiRed";break;case"link":case"css":e="sapUiAccent1";break;default:e="sapUiAccent8";break}return e};h.prototype.attachRequestDetailsPopover=function(){var t,a,h,v,I,f,m,T,S,w,g,y,C,U,x,R,q;var b=this;var L=u(".sapUiInteractionRequest.sapUiInteractionTreeItem .sapUiInteractionTreeItemRight");if(L.length){var D=O();for(var E=0;E<L.length;E++){L[E].addEventListener("click",function(t){A.call(this);M.call(this);P.call(this);var e=u(this).children()[0];D.openBy(e)})}}function P(){var e=u(this);var a=e.parents("li[data-request-index]");var r=e.parents("li[data-interaction-index]");var i=parseInt(r.attr("data-interaction-index"));var n=parseInt(a.attr("data-request-index"));var s=b.interactions[i];var o=s.requests[n];if(!s||!o){return}var p=b.getRequestSapStatistics(s,o);if(p){if(!g.getParent()){t.addContent(g);t.addContent(y);t.addContent(C);t.addContent(U);t.addContent(x);t.addContent(R);t.addContent(q)}var l=p.statistics;C.setText(b.formatDuration(parseFloat(l.substring(l.indexOf("total=")+"total=".length,l.indexOf(",")))));l=l.substring(l.indexOf(",")+1);x.setText(b.formatDuration(parseFloat(l.substring(l.indexOf("fw=")+"fw=".length,l.indexOf(",")))));l=l.substring(l.indexOf(",")+1);q.setText(b.formatDuration(parseFloat(l.substring(l.indexOf("app=")+"app=".length,l.indexOf(",")))))}else if(g.getParent()){t.removeContent(g);t.removeContent(y);t.removeContent(C);t.removeContent(U);t.removeContent(x);t.removeContent(R);t.removeContent(q)}}function M(){var t=b.getRequestFromElement(u(this));I.setText(t.initiatorType||"");f.setText(t.entryType||"");m.setText(t.name);m.setHref(t.name);var e=b.getRequestDuration(t);var a=t.fetchStartOffset+t.startTime;var r=a+e;T.setText(b.formatTime(a));S.setText(b.formatTime(r));w.setText(b.formatDuration(e))}function A(){var t=b.getRequestFromElement(u(this));var e=t.fetchStartOffset;var r=b.getRequestDuration(t);var i=e+t.startTime;var n=i+r;var s=b.getRequestRequestStart(t)+e;var o=b.getRequestResponseStart(t)+e;var p=s-i;var l=o-s;var d=n-o;var c=Math.floor(100*l/r);var v=Math.floor(100*d/r);var I=Math.floor(100*p/r);var f='<span class="sapUiInteractionTitleSection"><div class="sapUiInteractionTitleText">{Title}</div><div class="sapUiInteractionTitleSubText">{Subtitle}</div></span>';var m='<div class="sapUiInteractionTitle">';m+=f.replace("{Title}","PREPROCESSING").replace("{Subtitle}",b.formatDuration(p));m+=f.replace("{Title}","SERVER").replace("{Subtitle}",b.formatDuration(l));m+=f.replace("{Title}","CLIENT").replace("{Subtitle}",b.formatDuration(d));m+="</div>";a.setContent(m);var T=t.initiatorType||t.entryType;var S=b.getRequestColorClass(T);var w=S+"70";var g="<span class='sapUiSupportIntProgressBar "+w+"'' style=\"width:calc("+I+"% - 1px)\"></span><span class='sapUiSupportIntProgressBarSeparator'></span>";var y="<span class='sapUiSupportIntProgressBar "+S+"' style=\"width:calc("+c+'% - 1px)"></span>'+"<span class='sapUiSupportIntProgressBarSeparator'></span>";var C="<span class='sapUiSupportIntProgressBar "+w+"'' style=\"width:calc("+v+'% - 1px)"></span>';var U="<div class='sapUiSupportIntProgressBarParent'>"+g+y+C+"</div>";h.setContent(U)}function O(){var t=new r({placement:c.Auto,contentWidth:"400px",showHeader:false,showArrow:true,verticalScrolling:true,horizontalScrolling:false,content:[k()]}).addStyleClass("sapUiSupportPopover");t.attachAfterOpen(function(t){t.getSource().$().trigger("focus")});return t}function k(){a=new l;h=new l;v=new s({icon:e.getIconURI("decline"),type:"Transparent",press:function(){D.close()}}).addStyleClass("sapUiSupportReqPopoverCloseButton");v.setTooltip("Close");I=(new i).addStyleClass("sapUiSupportIntRequestText");f=(new i).addStyleClass("sapUiSupportIntRequestText");m=new p({target:"_blank",wrapping:true}).addStyleClass("sapUiSupportIntRequestLink");T=(new i).addStyleClass("sapUiSupportIntRequestText");S=(new i).addStyleClass("sapUiSupportIntRequestText");w=(new i).addStyleClass("sapUiSupportIntRequestText");g=new d({text:"SAP STATISTICS FOR ODATA CALLS"});y=new o({text:"Gateway Total"}).addStyleClass("sapUiSupportIntRequestLabel");C=(new i).addStyleClass("sapUiSupportIntRequestText");U=new o({text:"Framework"}).addStyleClass("sapUiSupportIntRequestLabel");x=(new i).addStyleClass("sapUiSupportIntRequestText");R=new o({text:"Application"}).addStyleClass("sapUiSupportIntRequestLabel");q=(new i).addStyleClass("sapUiSupportIntRequestText");t=new n({maxContainerCols:2,minWidth:400,labelMinWidth:100,editable:false,layout:"ResponsiveGridLayout",labelSpanM:3,emptySpanM:0,columnsM:1,breakpointM:0,content:[new d({text:"REQUEST DATA"}),new o({text:"Initiator Type"}).addStyleClass("sapUiSupportIntRequestLabel"),I,new o({text:"Entry Type"}).addStyleClass("sapUiSupportIntRequestLabel"),f,new o({text:"Name"}).addStyleClass("sapUiSupportIntRequestLabel"),m,new o({text:"Start Time"}).addStyleClass("sapUiSupportIntRequestLabel"),T,new o({text:"End Time"}).addStyleClass("sapUiSupportIntRequestLabel"),S,new o({text:"Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),w]});return[a,h,v,t]}};h.prototype.getRequestFromElement=function(t){var e=t.parents("li[data-request-index]");var a=t.parents("li[data-interaction-index]");var r=parseInt(a.attr("data-interaction-index"));var i=parseInt(e.attr("data-request-index"));var n=this.interactions[r].requests[i];return n};h.prototype.attachInteractionDetailsPopover=function(){var t,a,p,l,h,v,I,f,m;var T=this;var S=u(".sapUiInteractionItemDiv.sapUiInteractionTreeItem .sapUiInteractionTreeItemRight");if(S.length){var w=C();for(var g=0;g<S.length;g++){S[g].addEventListener("click",function(t){y.call(this);var e=u(this).children()[0];w.openBy(e)})}}function y(){var t=u(this).parent().parent();var e=parseInt(t.attr("data-interaction-index"));var a=T.interactions[e];if(!a){return}p.setText(T.formatDuration(a.duration));l.setText(T.formatDuration(a.duration-a.roundtrip));h.setText(T.formatDuration(a.requestTime));v.setText(T.formatDuration(a.roundtrip));I.setText(a.bytesReceived);f.setText(a.requests.length);m.setText(T.formatTime(a.start))}function C(){var t=new r({placement:c.Auto,contentWidth:"350px",showHeader:false,showArrow:true,verticalScrolling:true,horizontalScrolling:false,content:[U()]}).addStyleClass("sapUiSupportPopover");t.attachAfterOpen(function(t){t.getSource().$().trigger("focus")});return t}function U(){a=new s({icon:e.getIconURI("decline"),type:"Transparent",press:function(){w.close()}}).addStyleClass("sapUiSupportIntPopoverCloseButton");a.setTooltip("Close");p=(new i).addStyleClass("sapUiSupportIntRequestText");l=(new i).addStyleClass("sapUiSupportIntRequestText");h=(new i).addStyleClass("sapUiSupportIntRequestText");v=(new i).addStyleClass("sapUiSupportIntRequestText");I=(new i).addStyleClass("sapUiSupportIntRequestText");f=(new i).addStyleClass("sapUiSupportIntRequestText");m=(new i).addStyleClass("sapUiSupportIntRequestText");t=new n({maxContainerCols:2,minWidth:400,labelMinWidth:100,editable:false,layout:"ResponsiveGridLayout",labelSpanM:7,emptySpanM:0,columnsM:1,breakpointM:0,content:[new d({text:"INTERACTION DATA"}),new o({text:"Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),p,new o({text:"Client Processing Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),l,new o({text:"Total Requests Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),h,new o({text:"Roundtrip Duration"}).addStyleClass("sapUiSupportIntRequestLabel"),v,new o({text:"Bytes Received"}).addStyleClass("sapUiSupportIntRequestLabel"),I,new o({text:"Request Count"}).addStyleClass("sapUiSupportIntRequestLabel"),f,new o({text:"Start Time"}).addStyleClass("sapUiSupportIntRequestLabel"),m]}).addStyleClass("sapUiSupportIntPopoverForm");return[a,t]}};h.prototype.renderRequestPart=function(t,e,a,r){if(this.actualStartTime>a||this.actualEndTime<e){return}a=Math.min(a,this.actualEndTime);e=Math.max(e,this.actualStartTime);var i=100/this.timeRange*(e-this.actualStartTime);var n=100/this.timeRange*(a-this.actualStartTime);var s=n-i;t.write('<span style="margin-left: '+i+"%; width: "+s+'%" class="sapUiInteractionTimeframe sapUiInteractionTimeRequestFrame '+r+'"></span>')};h.prototype.getRequestDuration=function(t){if(t.duration>0){return t.duration}var e=t.responseStart||t.requestStart||t.fetchStart;return e-t.startTime};h.prototype.getRequestRequestStart=function(t){if(t.requestStart>0){return t.requestStart}return t.fetchStart||t.startTime};h.prototype.getRequestResponseStart=function(t){if(t.responseStart>0){return t.responseStart}return t.requestStart||t.fetchStart||t.startTime};h.prototype.pad0=function(t,e){return("000"+String(t)).slice(-e)};h.prototype.formatGridLineDuration=function(t){var e=this.actualStartTime-this.startTime;t+=e;return t>100?(t/1e3).toFixed(2)+" s":t.toFixed(0)+" ms"};h.prototype.formatDuration=function(t){t=Math.max(t,0);if(t<3){return t.toFixed(2)+" ms"}return t>=1e3?(t/1e3).toFixed(3)+" s":t.toFixed(0)+" ms"};h.prototype.formatTime=function(t){var e=new Date(t);return this.pad0(e.getHours(),2)+":"+this.pad0(e.getMinutes(),2)+":"+this.pad0(e.getSeconds(),2)+"."+this.pad0(e.getMilliseconds(),3)};h.prototype.renderIcon=function(t,e){var a=this.getIconHTML(e);t.write(a)};h.prototype.getIconHTML=function(t){var a=t?h.collapseIcon:h.expandIcon;var r="sapUiIcon sapUiInteractionTreeIcon";if(n&&!n.suppressMirroring){r+=" sapUiIconMirrorInRTL"}var i='<span aria-hidden="true" expanded="'+t+'" class="'+r+'" ';var n=e.getIconInfo(a);if(n){i+='data-sap-ui-icon-content="'+n.content+'"';i+=" style=\"font-family:'SAP-icons'\""}i+="></span>";return i};return h});