/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","../../Component","../../Element","../../routing/Router"],function(e,t,n,o){"use strict";var i={};var a={global:["modelContextChange","beforeRendering","afterRendering","propertyChanged","beforeGeometryChanged","geometryChanged","aggregationChanged","componentCreated","afterInit","updateStarted","updateFinished","load","scroll"],controls:{}};i.getEventsExcludeList=function(){return JSON.parse(JSON.stringify(a))};i.setEventsExcludeList=function(t){if(this._isValidConfig(t)){a=JSON.parse(JSON.stringify(t))}else{if(e.isLoggable()){e.error("Provided ExcludeList configuration is not valid. Continuing to use previously/default set configuration.")}}};i.enable=function(){n._interceptEvent=function(e,t,n){i.broadcastEvent(e,t,n)};o._interceptRouteMatched=function(e,t){i.broadcastRouteMatched(o.M_EVENTS.ROUTE_MATCHED,e,t)}};i.disable=function(){if(n._interceptEvent){delete n._interceptEvent}if(o._interceptRouteMatched){delete o._interceptRouteMatched}};i.broadcastEvent=function(t,n,o){var a=new Date;setTimeout(function(){var r={},s;if(i._shouldExpose(t,n)){s=i._createOwnerComponentInfo(n);r={componentId:s.id,componentVersion:s.version,eventName:t,targetId:n.getId(),targetType:n.getMetadata().getName(),timestamp:a.getTime()};if(e.isLoggable()){e.debug("EventBroadcaster: Broadcast Event: ",JSON.stringify(r))}r.additionalAttributes=o;i._dispatchCustomEvent(r)}})};i.broadcastRouteMatched=function(t,n,o){var a=new Date;setTimeout(function(){var r=i._createOwnerComponentInfo(sap.ui.getCore().byId(n)),s={componentId:r.id,componentVersion:r.version,eventName:t,targetId:n,targetType:"sap.ui.core.routing.Router",timestamp:a.getTime(),additionalAttributes:{fullURL:document&&document.baseURI,hash:o.getHashChanger().getHash(),previousHash:i._previousHash}};i._previousHash=s.additionalAttributes.hash;if(e.isLoggable()){e.debug("EventBroadcaster: Broadcast Route Matched: ",JSON.stringify(s))}i._dispatchCustomEvent(s)})};i._dispatchCustomEvent=function(e){var t=new window.CustomEvent("UI5Event",{detail:e});window.dispatchEvent(t)};i._shouldExpose=function(e,t){var n=i.getEventsExcludeList(),o=n.global.indexOf(e)===-1&&i._isPublicElementEvent(e,t),a=i._isTrackableControlEvent(n,e,t);return o&&a};i._isTrackableControlEvent=function(e,t,n){var o,i,a=true,r=n.getMetadata().getName();if(e.controls[r]){o=e.controls[r].exclude;i=e.controls[r].include;if(!o&&!i){a=false}if(i&&i.indexOf(t)>-1){a=true}if(o&&o.indexOf(t)>-1){a=false}}return a};i._isPublicElementEvent=function(e,t){return t.getMetadata().hasEvent(e)};i._isValidConfig=function(e){var t=e.hasOwnProperty("global"),n=e.hasOwnProperty("controls");return t&&n};i._createOwnerComponentInfo=function(e){var n,o,i,a;if(e){while(e&&e.getParent){i=t.getOwnerComponentFor(e);if(i||e.getMetadata().isA("sap.ui.core.Component")){i=i||e;a=i.getManifestEntry("sap.app");n=a&&a.id||i.getMetadata().getName();o=a&&a.applicationVersion&&a.applicationVersion.version}e=e.getParent()}}return{id:n||"undetermined",version:o||""}};function r(){if(typeof window.CustomEvent==="function"){return false}function e(e,t){t=t||{bubbles:false,cancelable:false,detail:undefined};var n=document.createEvent("CustomEvent");n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail);return n}e.prototype=window.Event.prototype;window.CustomEvent=e}r();return i});