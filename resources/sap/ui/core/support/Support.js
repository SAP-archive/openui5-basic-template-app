/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","./Plugin","sap/ui/Device","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/deepExtend","sap/base/security/encodeURL"],function(t,i,e,n,o,r,s,a){"use strict";var u=t.extend("sap.ui.core.support.Support",{constructor:function(i){if(!d){throw Error()}t.apply(this);var e=this;this._sType=i;this._sLocalOrigin=window.location.protocol+"//"+window.location.host;var r=o.proxy(this._receiveEvent,this);if(window.addEventListener){window.addEventListener("message",r,false)}else{window.attachEvent("onmessage",r)}switch(i){case p.APPLICATION:this._isOpen=false;this.attachEvent(f.TEAR_DOWN,function(t){e._isOpen=false;v(e._oRemoteWindow);e._oRemoteWindow=null;u.exitPlugins(e,false)});this.attachEvent(f.LIBS,function(t){var i=u.getDiagnosticLibraries(),n=[];for(var o=0;o<i.length;o++){n.push(i[o].name)}e.sendEvent(f.LIBS,n)});this.attachEvent(f.SETUP,function(t){e._isOpen=true;u.initPlugins(e,false)});break;case p.TOOL:this._oRemoteWindow=window.opener;this._sRemoteOrigin=n.fromQuery(window.location.search).get("sap-ui-xx-support-origin");o(window).on("unload",function(t){e.sendEvent(f.TEAR_DOWN);u.exitPlugins(e,true)});this.attachEvent(f.LIBS,function(t){var i=t.mParameters;if(!Array.isArray(i)){i=Object.keys(i).map(function(t){return i[t]})}sap.ui.getCore().loadLibraries(i,true).then(function(){o(function(){u.initPlugins(e,true).then(function(){e.sendEvent(f.SETUP)})})})});this.sendEvent(f.LIBS);break}}});var p={APPLICATION:"APPLICATION",TOOL:"TOOL"};var f={LIBS:"sapUiSupportLibs",SETUP:"sapUiSupportSetup",TEAR_DOWN:"sapUiSupportTeardown"};u.StubType=p;u.EventType=f;var l=[];u.getStub=function(t){if(c){return c}if(t!=p.APPLICATION&&t!=p.TOOL){t=p.APPLICATION}d=true;c=new u(t);d=false;return c};u.getToolPlugins=function(){var t=[];for(var e=0;e<l.length;e++){if(l[e]instanceof i&&l[e].isToolPlugin()){t.push(l[e])}}return t};u.getAppPlugins=function(){var t=[];for(var e=0;e<l.length;e++){if(l[e]instanceof i&&l[e].isAppPlugin()){t.push(l[e])}}return t};u.prototype.getType=function(){return this._sType};u.prototype.isToolStub=function(){return this._sType===u.StubType.TOOL};u.prototype.isAppStub=function(){return this._sType===u.StubType.APPLICATION};u.prototype._receiveEvent=function(t){var i=t.data;if(typeof i==="string"&&i.indexOf("SAPUI5SupportTool*")===0){i=i.substr(18)}else{return}if(t.source!=this._oRemoteWindow){return}this._oRemoteOrigin=t.origin;var e=JSON.parse(i);var n=e.eventId;var o=e.params;this.fireEvent(n,o)};u.prototype.sendEvent=function(t,i){if(!this._oRemoteWindow){return}i=i?i:{};var n=i;if(e.browser.msie){n={};s(n,i)}var o={eventId:t,params:n};var r="SAPUI5SupportTool*"+JSON.stringify(o);this._oRemoteWindow.postMessage(r,this._sRemoteOrigin)};u.prototype.openSupportTool=function(){var t=sap.ui.require.toUrl("sap/ui/core/support/support.html");var i="?sap-ui-xx-noless=true&sap-ui-xx-support-origin="+a(this._sLocalOrigin);var e;if(this._sType===p.APPLICATION){var n=window.document.getElementById("sap-ui-bootstrap");if(n){var o=sap.ui.require.toUrl("");var r=n.getAttribute("src");if(typeof r==="string"&&r.indexOf(o)===0){e=r.substr(o.length)}}}if(e&&e!=="sap-ui-core.js"&&e.indexOf("/")===-1){i+="&sap-ui-xx-support-bootstrap="+a(e)}function s(t){return t.indexOf(".")==0||t.indexOf("/")==0||t.indexOf("://")<0}if(this._sType===p.APPLICATION){if(!this._isOpen){this._oRemoteWindow=g(t+i);this._sRemoteOrigin=s(t)?this._sLocalOrigin:t}else{this._oRemoteWindow.focus()}}};u.prototype.toString=function(){return"sap.ui.core.support.Support"};var d=false;var c;function g(t){return window.open(t,"sapUiSupportTool","width=800,height=700,status=no,toolbar=no,menubar=no,resizable=yes,location=no,directories=no,scrollbars=yes")}function v(t){if(!t){return}try{t.close()}catch(t){}}u.getDiagnosticLibraries=function(){var t=sap.ui.getCore().getLoadedLibraries(),i=[];for(var e in t){var n=t[e];if(n.extensions&&n.extensions["sap.ui.support"]&&n.extensions["sap.ui.support"].diagnosticPlugins){i.push(n)}}return i};u.initPlugins=function(t,e){return new Promise(function(e,n){l=[];var o=u.getDiagnosticLibraries();for(var r=0;r<o.length;r++){var s=o[r],a=s.extensions["sap.ui.support"].diagnosticPlugins;if(Array.isArray(a)){for(var p=0;p<a.length;p++){if(l.indexOf(a[p])===-1){l.push(a[p])}}}}var f=[],d=[],r;for(r=0;r<l.length;r++){if(typeof l[r]==="string"){f.push(l[r]);d.push(r)}}sap.ui.require(f,function(){var n,o,r;for(o=0;o<arguments.length;o++){r=arguments[o];n=d[o];if(t.isToolStub()&&r.prototype.isToolPlugin()){l[n]=new r(t);h(l[n])}else if(t.isAppStub()&&r.prototype.isAppPlugin()){l[n]=new r(t)}}for(n=0;n<l.length;n++){if(l[n]instanceof i){if(t.isToolStub()&&l[n].isToolPlugin()){l[n].init(t)}else if(t.isAppStub()&&l[n].isAppPlugin()){l[n].init(t)}}}e()})})};u.exitPlugins=function(t,e){for(var n=0;n<l.length;n++){if(l[n]instanceof i){if(l[n].isToolPlugin()&&t.isToolStub()&&e){l[n].exit(t,true)}else if(l[n].isAppPlugin()&&t.isAppStub()&&!e){l[n].exit(t,false)}}}};function h(t){t.$().replaceWith("<div  id='"+t.getId()+"-Panel' class='sapUiSupportPnl'>"+"<div id='"+t.getId()+"-PanelHeader' class='sapUiSupportPnlHdr'>"+"<div id='"+t.getId()+"-PanelHandle' class='sapUiSupportPnlHdrHdl sapUiSupportPnlHdrHdlClosed'>"+"</div>"+"<div class='sapUiSupportPanelTitle'>"+t.getTitle()+"</div>"+"</div>"+"<div id='"+t.getId()+"-PanelContent' class='sapUiSupportPnlCntnt sapUiSupportHidden'>"+"<div id='"+t.getId()+"' class='sapUiSupportPlugin'></div>"+"</div>"+"</div>");t.$("PanelHeader").on("click",function(){var i=t.$("PanelHandle");if(i.hasClass("sapUiSupportPnlHdrHdlClosed")){i.removeClass("sapUiSupportPnlHdrHdlClosed");t.$("PanelContent").removeClass("sapUiSupportHidden")}else{i.addClass("sapUiSupportPnlHdrHdlClosed");t.$("PanelContent").addClass("sapUiSupportHidden")}})}u.initializeSupportMode=function(t,i){if(t.indexOf("true")>-1||t.indexOf("viewinfo")>-1){u._initializeSupportInfo(i)}};u._initializeSupportInfo=function(t){var i=[],e=[],n=[],o="support:data",s="support",a="http://schemas.sap.com/sapui5/extension/sap.ui.core.support.Support.info/1",p={};var f=function(){var t="sap-ui-support.probe",i;try{localStorage.setItem(t,t);i=localStorage.getItem(t);localStorage.removeItem(t);return i===t}catch(t){return false}}();function l(){if(f){localStorage.setItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href,JSON.stringify(e))}}function d(){if(f){localStorage.setItem("sap-ui-support.aSupportXMLModifications/"+document.location.href,JSON.stringify(n))}}if(f){var c=localStorage.getItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href);if(c){e=JSON.parse(c)}var c=localStorage.getItem("sap-ui-support.aSupportXMLModifications/"+document.location.href);if(c){n=JSON.parse(c)}}u.info=function(t){t._idx=i.length;if(t._idx>0&&!t.context){t.context=i[i.length-1].context}if(!t.context){r.debug("Support Info does not have a context and is ignored");return t}if(t.context&&t.context.ownerDocument&&t.context.nodeType===1){var n=t._idx+"";if(!t.context.hasAttributeNS(a,"data")){t.context.setAttribute("xmlns:"+s,a)}else{n=t.context.getAttributeNS(a,"data")+","+n}t.context.setAttributeNS(a,o,n)}i.push(t);if(e.indexOf(t._idx)>-1){r.info(t);r.info("To remove this breakpoint execute:","\nsap.ui.core.support.Support.info.removeBreakpointAt("+t._idx+")");debugger}return t._idx};u.info.getAll=function(t){if(t===undefined){return i}else{return i.filter(function(i){return i.env&&i.env.caller===t})}};u.info.getInfos=function(t){if(t&&typeof t==="string"){t=t.split(",")}else{t=[]}var e=[];for(var n=0;n<t.length;n++){if(i[t[n]]){e.push(i[t[n]])}}return e};u.info.byIndex=function(t){return i[t]};u.info.getAllBreakpoints=function(){return e};u.info.hasBreakpointAt=function(t){return e.indexOf(t)>-1};u.info.addBreakpointAt=function(t){if(e.indexOf(t)>-1){return}e.push(t);l()};u.info.removeBreakpointAt=function(t){var i=e.indexOf(t);if(i>-1){e.splice(i,1);l()}};u.info.removeAllBreakpoints=function(){e=[];l()};u.info.addSupportInfo=function(t,i){if(t&&i){if(p[t]){p[t]+=","+i}else{p[t]=i}}};u.info.byId=function(t){return p[t]||null};u.info.getIds=function(t){var i=[];for(var e in p){var n=p[e];if(n&&n.indexOf(t)>-1){i.push(e)}}return i};u.info.getElements=function(t){var i=[];for(var e in p){var n=p[e];if(n&&n.indexOf(t)===0){var o=sap.ui.getCore().byId(e);if(o){i.push(sap.ui.getCore().byId(e))}}}return i};u.info.getAllXMLModifications=function(){return n};u.info.hasXMLModifications=function(){return n.length>0};u.info.addXMLModification=function(t,i,e){n.push({id:t,idx:i,change:e});d()};u.info.removeXMLModification=function(t){var i=n.indexOf(t);if(i>-1){n.splice(i,1);d()}};u.info.removeAllXMLModification=function(){n=[];d()};u.info.modifyXML=function(t,i){if(!u.info.hasXMLModifications()){return}var e=i;if(!e||!e.nodeType||!(e.nodeType==1||e.nodeType==9)){return}if(e.nodeType===9){e=e.firstChild}var o=e.querySelectorAll("*");var r=[e];for(var s=0;s<o.length;s++){r.push(o[s])}for(var s=0;s<n.length;s++){var a=n[s],p=a.change;if(a.id===t){var f=r[a.idx];if(f.nodeType===1&&p.setAttribute){var l=f.getAttribute(p.setAttribute[0]);f.setAttribute(p.setAttribute[0],p.setAttribute[1]);if(!f._modified){f._modified=[]}f._modified.push(p.setAttribute[0]);if(!f._oldValues){f._oldValues=[]}f._oldValues.push(l)}}}};u.info._breakAtProperty=function(t){return function(i){if(i.getParameter("name")===t){debugger}}};u.info._breakAtMethod=function(t){return function(){debugger;return t.apply(this,arguments)}};var g=["sap/ui/base/ManagedObject","sap/ui/core/mvc/View","sap/ui/core/XMLTemplateProcessor","sap/ui/thirdparty/datajs"];function v(t,i,e,n){t._supportInfo=u.info;i._supportInfo=u.info;e._supportInfo=u.info;if(window.datajs){window.datajs._sap={_supportInfo:u.info}}r.info("sap.ui.core.support.Support.info initialized.")}if(t){sap.ui.require(g,v)}else{v.apply(null,g.map(sap.ui.requireSync))}};return u});