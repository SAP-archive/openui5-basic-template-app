/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/support/Plugin","sap/ui/core/util/serializer/ViewSerializer","sap/ui/core/util/File","sap/ui/thirdparty/jszip","sap/ui/base/DataType","sap/ui/core/Element","sap/ui/core/ElementMetadata","sap/ui/core/UIArea","sap/ui/core/mvc/View","sap/ui/core/mvc/XMLView","sap/ui/model/Binding","sap/ui/model/CompositeBinding","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes","sap/base/security/encodeXML","sap/ui/core/mvc/Controller"],function(t,e,i,o,r,a,n,s,p,l,d,c,u,g,h,f){"use strict";var v=jQuery;var b=t.extend("sap.ui.core.support.plugins.ControlTree",{constructor:function(e){t.apply(this,["sapUiSupportControlTree","Control Tree",e]);this._oStub=e;if(this.runsAsToolPlugin()){this._aEventIds=["sapUiSupportSelectorSelect",this.getId()+"ReceiveControlTree",this.getId()+"ReceiveControlTreeExport",this.getId()+"ReceiveControlTreeExportError",this.getId()+"TriggerRequestProperties",this.getId()+"ReceiveProperties",this.getId()+"ReceiveBindingInfos",this.getId()+"ReceiveMethods",this.getId()+"ReceivePropertiesMethods"];this._breakpointId="sapUiSupportBreakpoint";this._tab={properties:"Properties",bindinginfos:"BindingInfos",breakpoints:"Breakpoints",exports:"Export"};this._currentTab=this._tab.properties}else{this._aEventIds=[this.getId()+"RequestControlTree",this.getId()+"RequestControlTreeSerialize",this.getId()+"RequestProperties",this.getId()+"RequestBindingInfos",this.getId()+"ChangeProperty",this.getId()+"RefreshBinding"];var i=this;sap.ui.getCore().registerPlugin({startPlugin:function(t){i.oCore=t},stopPlugin:function(){i.oCore=undefined}})}}});b.prototype.init=function(e){t.prototype.init.apply(this,arguments);if(this.runsAsToolPlugin()){C.call(this,e)}else{S.call(this,e)}};function C(t){v(document).on("click","li img.sapUiControlTreeIcon",v.proxy(this._onIconClick,this)).on("click","li.sapUiControlTreeElement div",v.proxy(this._onNodeClick,this)).on("click","li.sapUiControlTreeLink div",v.proxy(this._onControlTreeLinkClick,this)).on("click","#sapUiSupportControlTabProperties",v.proxy(this._onPropertiesTab,this)).on("click","#sapUiSupportControlTabBindingInfos",v.proxy(this._onBindingInfosTab,this)).on("click","#sapUiSupportControlTabBreakpoints",v.proxy(this._onMethodsTab,this)).on("click","#sapUiSupportControlTabExport",v.proxy(this._onExportTab,this)).on("change","[data-sap-ui-name]",v.proxy(this._onPropertyChange,this)).on("change","[data-sap-ui-method]",v.proxy(this._onPropertyBreakpointChange,this)).on("keyup",'.sapUiSupportControlMethods input[type="text"]',v.proxy(this._autoComplete,this)).on("blur",'.sapUiSupportControlMethods input[type="text"]',v.proxy(this._updateSelectOptions,this)).on("change",".sapUiSupportControlMethods select",v.proxy(this._selectOptionsChanged,this)).on("click","#sapUiSupportControlAddBreakPoint",v.proxy(this._onAddBreakpointClicked,this)).on("click","#sapUiSupportControlExportToXml",v.proxy(this._onExportToXmlClicked,this)).on("click","#sapUiSupportControlExportToHtml",v.proxy(this._onExportToHtmlClicked,this)).on("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint",v.proxy(this._onRemoveBreakpointClicked,this)).on("click","#sapUiSupportControlPropertiesArea a.control-tree",v.proxy(this._onNavToControl,this)).on("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding",v.proxy(this._onRefreshBinding,this));this.renderContentAreas()}b.prototype.exit=function(e){t.prototype.exit.apply(this,arguments);if(this.runsAsToolPlugin()){v(document).off("click","li img.sapUiControlTreeIcon").off("click","li div").off("click","li.sapUiControlTreeLink").off("click","#sapUiSupportControlTabProperties").off("click","#sapUiSupportControlTabBindings").off("click","#sapUiSupportControlTabBreakpoints").off("click","#sapUiSupportControlTabExport").off("change","[data-sap-ui-name]").off("change","[data-sap-ui-method]").off("keyup",'.sapUiSupportControlMethods input[type="text"]').off("blur",".sapUiSupportControlMethods select").off("change",".sapUiSupportControlMethods select").off("click","#sapUiSupportControlAddBreakPoint").off("click","#sapUiSupportControlExportToXml").off("click","#sapUiSupportControlExportToHtml").off("click","#sapUiSupportControlActiveBreakpoints img.remove-breakpoint").off("click","#sapUiSupportControlPropertiesArea a.control-tree").off("click","#sapUiSupportControlPropertiesArea img.sapUiSupportRefreshBinding")}};function m(t){if(t==null){return""}t=String(t);return t.slice(1+t.lastIndexOf("."))}function w(t){return t==null?"":f(String(t))}b.prototype.renderContentAreas=function(){var t=sap.ui.getCore().createRenderManager();t.write('<div class="sapUiSupportControlTreeTitle">You can find a control in this tree by clicking it in the application UI while pressing the Ctrl+Alt+Shift keys.</div>');t.write('<div id="sapUiSupportControlTreeArea"><ul class="sapUiSupportControlTreeList"></ul></div>');t.write('<div id="sapUiSupportControlTabs" class="sapUiSupportControlTabsHidden">');t.write('<button id="sapUiSupportControlTabProperties" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabLeft">Properties</button>');t.write('<button id="sapUiSupportControlTabBindingInfos" class="sapUiSupportBtn sapUiSupportTab">Binding Infos</button>');t.write('<button id="sapUiSupportControlTabBreakpoints" class="sapUiSupportBtn sapUiSupportTab">Breakpoints</button>');t.write('<button id="sapUiSupportControlTabExport" class="sapUiSupportBtn sapUiSupportTab sapUiSupportTabRight">Export</button>');t.write("</div>");t.write('<div id="sapUiSupportControlPropertiesArea"></div>');t.flush(this.$().get(0));t.destroy()};b.prototype.renderControlTree=function(t){var e=sap.ui.getCore().createRenderManager();function i(t,o){var r=o.aggregation.length>0||o.association.length>0;e.write('<li id="sap-debug-controltree-'+w(o.id)+'" class="sapUiControlTreeElement">');var a=r?"minus":"space";e.write('<img class="sapUiControlTreeIcon" src="../../debug/images/'+a+'.gif">');if(o.isAssociation){e.write('<img title="Association" class="sapUiControlTreeIcon" src="../../debug/images/link.gif">')}var n=m(o.type);e.write("<div>");e.write('<span class="name" title="'+w(o.type)+'">'+w(n)+" - "+w(o.id)+"</span>");e.write('<span class="sapUiSupportControlTreeBreakpointCount sapUiSupportItemHidden" title="Number of active breakpoints / methods"></span>');e.write("</div>");if(o.aggregation.length>0){e.write("<ul>");v.each(o.aggregation,i);e.write("</ul>")}if(o.association.length>0){e.write("<ul>");v.each(o.association,function(t,o){if(o.isAssociationLink){var r=m(o.type);e.write('<li data-sap-ui-controlid="'+w(o.id)+'" class="sapUiControlTreeLink">');e.write('<img class="sapUiControlTreeIcon" align="middle" src="../../debug/images/space.gif">');e.write('<img class="sapUiControlTreeIcon" align="middle" src="../../debug/images/link.gif">');e.write("<div><span title=\"Association '"+w(o.name)+"' to '"+w(o.id)+"' with type '"+w(o.type)+"'\">"+w(r)+" - "+w(o.id)+" ("+w(o.name)+")</span></div>");e.write("</li>")}else{i(0,o)}});e.write("</ul>")}e.write("</li>")}v.each(t,i);e.flush(this.$().find("#sapUiSupportControlTreeArea > ul.sapUiSupportControlTreeList").get(0));e.destroy()};b.prototype.renderPropertiesTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+w(e)+'">');v.each(t,function(t,e){i.write("<li>");i.write("<span><label class='sapUiSupportLabel'>BaseType:</label> <code>"+w(e.control)+"</code></span>");if(e.properties.length>0||e.aggregations.length>0){i.write('<div class="get" title="Activate debugger for get-method">G</div><div class="set" title="Activate debugger for set-method">S</div>');i.write('<div class="sapUiSupportControlProperties"><table><colgroup><col width="50%"><col width="50%"></colgroup>');v.each(e.properties,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+w(e.name)+(e.isBound?'<img title="Value is bound (see Binding Infos)" src="../../debug/images/link.gif">':"")+"</label>");i.write("</td><td>");if(e.type==="boolean"){i.write("<input type='checkbox' ");i.write("data-sap-ui-name='"+w(e.name)+"' ");if(e.value==true){i.write("checked='checked'")}i.write(">")}else if(e.enumValues){i.write("<div><select ");i.write("data-sap-ui-name='"+w(e.name)+"'>");v.each(e.enumValues,function(t,o){i.write("<option");if(t===e.value){i.write(" selected")}i.write(">");i.writeEscaped(""+t);i.write("</option>")});i.write("</select></div>")}else{i.write("<div><input type='text' ");i.write("data-sap-ui-name='"+w(e.name)+"' ");if(e.value){i.write("value='");i.writeEscaped(""+e.value);i.write("'")}i.write("></div>")}i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+w(e._sGetter)+'" title="Activate debugger for '+w(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+w(e._sMutator)+'" title="Activate debugger for '+w(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("></td>");i.write("</tr>")});v.each(e.aggregations,function(t,e){i.write("<tr><td>");i.write("<label class='sapUiSupportLabel'>"+w(e.name)+"</label>");i.write("</td><td>");i.write(w(e.value));i.write("</td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+w(e._sGetter)+'" title="Activate debugger for '+w(e._sGetter)+'"');if(e.bp_sGetter){i.write("checked='checked'")}i.write("></td>");i.write('<td><input type="checkbox" data-sap-ui-method="'+w(e._sMutator)+'" title="Activate debugger for '+w(e._sMutator)+'"');if(e.bp_sMutator){i.write("checked='checked'")}i.write("></td>");i.write("</tr>")});i.write("</table></div>")}i.write("</li>")});i.write("</ul>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.$().find("#sapUiSupportControlTabs").removeClass("sapUiSupportControlTabsHidden");this.selectTab(this._tab.properties)};b.prototype.renderBindingsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();if(t.contexts.length>0){i.write("<h2>Contexts</h2>");i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+w(e)+'">');v.each(t.contexts,function(t,e){i.write("<li>");i.write('<span><label class="sapUiSupportLabel">Model Name: '+w(e.modelName)+"</label></span>");i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(e.invalidPath){i.write(' class="sapUiSupportModelPathInvalid"')}else if(e.unverifiedPath){i.write(' class="sapUiSupportModelPathUnverified"')}i.write(">"+w(e.path));if(e.invalidPath){i.write(" (invalid)")}else if(e.unverifiedPath){i.write(" (unverified)")}i.write("</span></div>");i.write("</td></tr>");if(e.location){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Inherited from</label>');i.write("</td><td>");i.write('<div><a class="control-tree sapUiSupportLink" title="'+w(e.location.name)+'" data-sap-ui-control-id="'+w(e.location.id)+'" href="#">'+w(m(e.location.name))+" ("+w(e.location.id)+")</a></div>");i.write("</td></tr>")}i.write("</tbody></table></div></li>")});i.write("</ul>")}if(t.bindings.length>0){i.write("<h2>Bindings</h2>");i.write('<ul class="sapUiSupportControlTreeList" data-sap-ui-controlid="'+w(e)+'">');v.each(t.bindings,function(t,e){i.write('<li data-sap-ui-binding-name="'+w(e.name)+'">');i.write("<span>");i.write('<label class="sapUiSupportLabel">'+w(e.name)+"</label>");i.write('<img class="sapUiSupportRefreshBinding" title="Refresh Binding" src="../../debug/images/refresh.gif">');i.write("</span>");v.each(e.bindings,function(t,o){i.write('<div class="sapUiSupportControlProperties">');i.write('<table><colgroup><col width="15%"><col width="35%"><col width="50%"></colgroup>');i.write("<tbody>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Path</label>');i.write("</td><td>");i.write("<div><span");if(o.invalidPath){i.write(' class="sapUiSupportModelPathInvalid"')}else if(o.unverifiedPath){i.write(' class="sapUiSupportModelPathUnverified"')}i.write(">"+w(o.path));if(o.invalidPath){i.write(" (invalid)")}else if(o.unverifiedPath){i.write(" (unverified)")}i.write("</span></div>");i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Absolute Path</label>');i.write("</td><td>");if(typeof o.absolutePath!=="undefined"){i.write("<div>"+w(o.absolutePath)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Relative</label>');i.write("</td><td>");if(typeof o.isRelative!=="undefined"){i.write("<div>"+w(o.isRelative)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Type</label>');i.write("</td><td>");if(!e.type){i.write("<div>No binding</div>")}else{i.write('<div title="'+w(e.type)+'">'+w(m(e.type))+"</div>")}i.write("</td></tr>");if(o.mode){i.write('<tr><td colspan="2">');i.write('<label class="sapUiSupportLabel">Binding Mode</label>');i.write("</td><td>");i.write("<div>"+w(o.mode)+"</div>");i.write("</td></tr>")}i.write("<tr><td>");i.write('<label class="sapUiSupportLabel">Model</label>');i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Name</label>');i.write("</td><td>");if(o.model&&o.model.name){i.write("<div>"+w(o.model.name)+"</div>")}else{i.write("<div>No binding</div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Type</label>');i.write("</td><td>");if(o.model&&o.model.type){i.write('<div><span title="'+w(o.model.type)+'">'+w(m(o.model.type))+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Default Binding Mode</label>');i.write("</td><td>");if(o.model&&o.model.bindingMode){i.write("<div><span>"+w(o.model.bindingMode)+"</span></div>")}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("<tr><td>");i.write("</td><td>");i.write('<label class="sapUiSupportLabel">Location</label>');i.write("</td><td>");if(o.model&&o.model.location&&o.model.location.type){if(o.model.location.type==="control"){i.write('<div><a class="control-tree sapUiSupportLink" title="'+w(o.model.location.name)+'" data-sap-ui-control-id="'+w(o.model.location.id)+'" href="#">'+w(m(o.model.location.name))+" ("+w(o.model.location.id)+")</a></div>")}else{i.write('<div><span title="sap.ui.getCore()">Core</span></div>')}}else{i.write("<div><span>No binding</span></div>")}i.write("</td></tr>");i.write("</tbody></table></div>")});i.write("</li>")});i.write("</ul>")}i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy()};b.prototype.renderBreakpointsTab=function(t,e){var i=sap.ui.getCore().createRenderManager();i.write('<div class="sapUiSupportControlMethods" data-sap-ui-controlid="'+w(e)+'">');i.write('<select id="sapUiSupportControlMethodsSelect" class="sapUiSupportAutocomplete sapUiSupportSelect"><option></option>');v.each(t,function(t,e){if(!e.active){i.write("<option>"+w(e.name)+"</option>")}});i.write("</select>");i.write('<input class="sapUiSupportControlBreakpointInput sapUiSupportAutocomplete" type="text">');i.write('<button id="sapUiSupportControlAddBreakPoint" class="sapUiSupportRoundedButton ">Add breakpoint</button>');i.write('<hr class="no-border"><ul id="sapUiSupportControlActiveBreakpoints" class="sapUiSupportList sapUiSupportBreakpointList">');v.each(t,function(t,e){if(!e.active){return}i.write("<li><span>"+w(e.name)+"</span>"+'<img class="remove-breakpoint"  src="../../debug/images/delete.gif"></li>')});i.write("</ul></div>");i.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));i.destroy();this.selectTab(this._tab.breakpoints);this.$().find(".sapUiSupportControlBreakpointInput").trigger("focus")};b.prototype.renderExportTab=function(){var t=sap.ui.getCore().createRenderManager();t.write('<button id="sapUiSupportControlExportToXml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To XML</button>');t.write("<br><br>");t.write('<button id="sapUiSupportControlExportToHtml" class="sapUiSupportRoundedButton sapUiSupportExportButton">Export To HTML</button>');t.flush(this.$().find("#sapUiSupportControlPropertiesArea").get(0));t.destroy();this.selectTab(this._tab.exports)};b.prototype.requestProperties=function(t){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceivePropertiesMethods"})};b.prototype.updateBreakpointCount=function(t,e){var i=v("#sap-debug-controltree-"+t+" > div span.sapUiSupportControlTreeBreakpointCount");if(e.active>0){i.text(e.active+" / "+e.all).toggleClass("sapUiSupportItemHidden",false)}else{i.text("").toggleClass("sapUiSupportItemHidden",true)}};b.prototype.onsapUiSupportControlTreeTriggerRequestProperties=function(t){this.requestProperties(t.getParameter("controlId"))};b.prototype.onsapUiSupportControlTreeReceivePropertiesMethods=function(t){var e=t.getParameter("controlId");this._oStub.sendEvent(this.getId()+"RequestProperties",{id:e,breakpointMethods:t.getParameter("methods")});this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};b.prototype.onsapUiSupportControlTreeReceiveControlTree=function(t){this.renderControlTree(JSON.parse(t.getParameter("controlTree")))};b.prototype.onsapUiSupportControlTreeReceiveControlTreeExportError=function(t){var e=t.getParameter("errorMessage");this._drawAlert(e)};b.prototype._drawAlert=function(t){alert("ERROR: The selected element cannot not be exported.\nPlease choose an other one.\n\nReason:\n"+t)};b.prototype.onsapUiSupportControlTreeReceiveControlTreeExport=function(t){var e;var r=JSON.parse(t.getParameter("serializedViews"));var a=t.getParameter("sType");if(!v.isEmptyObject(r)){e=new o;for(var n in r){var s=r[n];e.file(n.replace(/\./g,"/")+".view."+a.toLowerCase(),s)}}if(e){var p=e.generate({type:"blob"});i.save(p,a.toUpperCase()+"Export","zip","application/zip")}};b.prototype.onsapUiSupportSelectorSelect=function(t){this.selectControl(t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveProperties=function(t){this.renderPropertiesTab(JSON.parse(t.getParameter("properties")),t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveBindingInfos=function(t){this.renderBindingsTab(JSON.parse(t.getParameter("bindinginfos")),t.getParameter("id"))};b.prototype.onsapUiSupportControlTreeReceiveMethods=function(t){var e=t.getParameter("controlId");this.renderBreakpointsTab(JSON.parse(t.getParameter("methods")),e);this.updateBreakpointCount(e,JSON.parse(t.getParameter("breakpointCount")))};b.prototype._onNodeClick=function(t){var e=v(t.target);var i=e.closest("li");if(i.hasClass("sapUiControlTreeElement")){v(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");i.children("div").addClass("sapUiSupportControlTreeSelected");this._oStub.sendEvent("sapUiSupportSelectorHighlight",{id:i.attr("id").substring("sap-debug-controltree-".length)});var o=i.attr("id").substring("sap-debug-controltree-".length);if(e.hasClass("sapUiSupportControlTreeBreakpointCount")){this._currentTab=this._tab.breakpoints}this.onAfterControlSelected(o)}t.stopPropagation()};b.prototype._onIconClick=function(t){var e=v(t.target);if(e.parent().attr("data-sap-ui-collapsed")){e.attr("src",e.attr("src").replace("plus","minus")).parent().removeAttr("data-sap-ui-collapsed");e.siblings("ul").toggleClass("sapUiSupportItemHidden",false)}else{e.attr("src",e.attr("src").replace("minus","plus")).parent().attr("data-sap-ui-collapsed","true");e.siblings("ul").toggleClass("sapUiSupportItemHidden",true)}if(t.stopPropagation){t.stopPropagation()}};b.prototype._onControlTreeLinkClick=function(t){this.selectControl(v(t.target).closest("li").attr("data-sap-ui-controlid"))};b.prototype._onPropertiesTab=function(t){if(this.selectTab(this._tab.properties)){this.requestProperties(this.getSelectedControlId())}};b.prototype._onBindingInfosTab=function(t){if(this.selectTab(this._tab.bindinginfos)){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};b.prototype._onMethodsTab=function(t){if(this.selectTab(this._tab.breakpoints)){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:this.getSelectedControlId(),callback:this.getId()+"ReceiveMethods"})}};b.prototype._onExportTab=function(t){if(this.selectTab(this._tab.exports)){this.renderExportTab()}};b.prototype._autoComplete=function(t){if(t.keyCode==h.ENTER){this._updateSelectOptions(t);this._onAddBreakpointClicked()}if(t.keyCode>=h.ARROW_LEFT&&t.keyCode<=h.ARROW_DOWN){return}var e=v(t.target),i=e.prev("select"),o=e.val();if(o==""){return}var r=i.find("option").map(function(){return v(this).val()}).get();var a;for(var n=0;n<r.length;n++){a=r[n];if(a.toUpperCase().indexOf(o.toUpperCase())==0){var s=e.cursorPos();if(t.keyCode==h.BACKSPACE){s--}e.val(a);e.selectText(s,a.length);break}}return};b.prototype._updateSelectOptions=function(t){var e=t.target;if(e.tagName=="INPUT"){var i=e.value;e=e.previousSibling;var o=e.options;for(var r=0;r<o.length;r++){var a=o[r].value||o[r].text;if(a.toUpperCase()==i.toUpperCase()){e.selectedIndex=r;break}}}var n=e.selectedIndex;var s=e.options[n].value||e.options[n].text;if(e.nextSibling&&e.nextSibling.tagName=="INPUT"){e.nextSibling.value=s}};b.prototype._onAddBreakpointClicked=function(t){var e=this.$().find("#sapUiSupportControlMethodsSelect");this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.val(),active:true,callback:this.getId()+"ReceiveMethods"})};b.prototype._onExportToXmlClicked=function(t){this._startSerializing("XML")};b.prototype._onExportToHtmlClicked=function(t){this._startSerializing("HTML")};b.prototype._startSerializing=function(t){var e=this.getSelectedControlId();if(e){this._oStub.sendEvent(this.getId()+"RequestControlTreeSerialize",{controlID:e,sType:t})}else{this._drawAlert("Nothing to export. Please select an item in the control tree.")}};b.prototype._onRemoveBreakpointClicked=function(t){var e=v(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.siblings("span").text(),active:false,callback:this.getId()+"ReceiveMethods"})};b.prototype._selectOptionsChanged=function(t){var e=t.target;var i=e.nextSibling;i.value=e.options[e.selectedIndex].value};b.prototype._onPropertyChange=function(t){var e=t.target;var i=v(e);var o=i.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var r=i.val();if(i.attr("type")==="checkbox"){r=""+i.is(":checked")}this._oStub.sendEvent(this.getId()+"ChangeProperty",{id:o,name:i.attr("data-sap-ui-name"),value:r})};b.prototype._onPropertyBreakpointChange=function(t){var e=v(t.target);this._oStub.sendEvent(this._breakpointId+"ChangeInstanceBreakpoint",{controlId:e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid"),methodName:e.attr("data-sap-ui-method"),active:e.is(":checked"),callback:this.getId()+"TriggerRequestProperties"})};b.prototype._onNavToControl=function(t){var e=v(t.target);var i=e.attr("data-sap-ui-control-id");if(i!==this.getSelectedControlId()){this.selectControl(i)}};b.prototype._onRefreshBinding=function(t){var e=v(t.target);var i=e.closest("[data-sap-ui-controlid]").attr("data-sap-ui-controlid");var o=e.closest("[data-sap-ui-binding-name]").attr("data-sap-ui-binding-name");this._oStub.sendEvent(this.getId()+"RefreshBinding",{id:i,name:o})};b.prototype.selectTab=function(t){var e=this.$().find("#sapUiSupportControlTab"+t);if(e.hasClass("active")){return false}this.$().find("#sapUiSupportControlTabs button").removeClass("active");e.addClass("active");this._currentTab=t;return true};b.prototype.getSelectedControlId=function(){var t=this.$().find(".sapUiSupportControlTreeSelected");if(t.length===0){return undefined}else{return t.parent().attr("id").substring("sap-debug-controltree-".length)}};b.prototype.selectControl=function(t){if(!t){return}v(".sapUiControlTreeElement > div").removeClass("sapUiSupportControlTreeSelected");var e=this;g(document.getElementById("sap-debug-controltree-"+t)).parents("[data-sap-ui-collapsed]").each(function(t,i){e._onIconClick({target:v(i).find("img:first").get(0)})});var i=g(document.getElementById("sap-debug-controltree-"+t)).children("div").addClass("sapUiSupportControlTreeSelected").position();var o=this.$().find("#sapUiSupportControlTreeArea").scrollTop();this.$().find("#sapUiSupportControlTreeArea").scrollTop(o+i.top);this.onAfterControlSelected(t)};b.prototype.onAfterControlSelected=function(t){if(this._currentTab==this._tab.properties){this.requestProperties(t)}else if(this._currentTab==this._tab.breakpoints){this._oStub.sendEvent(this._breakpointId+"RequestInstanceMethods",{controlId:t,callback:this.getId()+"ReceiveMethods"})}else if(this._currentTab==this._tab.bindinginfos){this._oStub.sendEvent(this.getId()+"RequestBindingInfos",{id:this.getSelectedControlId()})}};function S(t){this.onsapUiSupportControlTreeRequestControlTree()}b.prototype.onsapUiSupportControlTreeRequestControlTree=function(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTree",{controlTree:JSON.stringify(this.getControlTree())})};b.prototype.onsapUiSupportControlTreeRequestControlTreeSerialize=function(t){var i=this.oCore.byId(t.getParameter("controlID"));var o=t.getParameter("sType");var r;var a;var n=o+"ViewExported";l.create({definition:document}).then(function(s){s.setViewName(n);s._controllerName=o+"ViewController";try{if(i){if(i instanceof p){r=new e(i,window,"sap.m")}else{s.addContent(i.clone());r=new e(s,window,"sap.m")}a=o&&o!=="XML"?r.serializeToHTML():r.serializeToXML()}else{var l=this.oCore.getUIArea(t.getParameter("controlID"));var d=l.getContent();for(var c=0;c<d.length;c++){s.addContent(d[c])}r=new e(s,window,"sap.m");a=o&&o!=="XML"?r.serializeToHTML():r.serializeToXML();for(var c=0;c<d.length;c++){l.addContent(d[c])}}if(r){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExport",{serializedViews:JSON.stringify(a),sType:o})}}catch(t){this._oStub.sendEvent(this.getId()+"ReceiveControlTreeExportError",{errorMessage:t.message})}}.bind(this))};b.prototype.onsapUiSupportControlTreeRequestProperties=function(t){var e=JSON.parse(t.getParameter("breakpointMethods"));var i=this.getControlProperties(t.getParameter("id"),e);this._oStub.sendEvent(this.getId()+"ReceiveProperties",{id:t.getParameter("id"),properties:JSON.stringify(i)})};b.prototype.onsapUiSupportControlTreeChangeProperty=function(t){var e=t.getParameter("id");var i=this.oCore.byId(e);if(i){var o=t.getParameter("name");var a=t.getParameter("value");var n=i.getMetadata().getProperty(o);if(n&&n.type){var s=r.getType(n.type);if(s instanceof r){var p=s.parseValue(a);if(s.isValid(p)&&p!=="(null)"){i[n._sMutator](p)}}else if(s){if(s[a]){i[n._sMutator](a)}}}}};b.prototype.onsapUiSupportControlTreeRequestBindingInfos=function(t){var e=t.getParameter("id");this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};b.prototype.onsapUiSupportControlTreeRefreshBinding=function(t){var e=t.getParameter("id");var i=t.getParameter("name");this.refreshBinding(e,i);this._oStub.sendEvent(this.getId()+"ReceiveBindingInfos",{id:e,bindinginfos:JSON.stringify(this.getControlBindingInfos(e))})};b.prototype.getControlTree=function(){var t=this.oCore,e=[],i={};function o(t){var e={id:t.getId(),type:"",aggregation:[],association:[]};i[e.id]=e.id;if(t instanceof s){e.library="sap.ui.core";e.type="sap.ui.core.UIArea";v.each(t.getContent(),function(t,i){var r=o(i);e.aggregation.push(r)})}else{e.library=t.getMetadata().getLibraryName();e.type=t.getMetadata().getName();if(t.mAggregations){for(var r in t.mAggregations){var n=t.mAggregations[r];if(n){var p=v.isArray(n)?n:[n];v.each(p,function(t,i){if(i instanceof a){var r=o(i);e.aggregation.push(r)}})}}}if(t.mAssociations){var l=t.getMetadata().getAllAssociations();for(var d in t.mAssociations){var c=t.mAssociations[d];var u=l[d]?l[d].type:null;if(c&&u){var g=v.isArray(c)?c:[c];v.each(g,function(t,i){e.association.push({id:i,type:u,name:d,isAssociationLink:true})})}}}}return e}v.each(t.mUIAreas,function(t,i){var r=o(i);e.push(r)});function r(e,a){for(var n=0;n<a.association.length;n++){var s=a.association[n];if(!i[s.id]){var p=u.get(s.type||"");if(!(typeof p==="function")){continue}var l=p.getMetadata().getStereotype(),d=null;switch(l){case"element":case"control":d=t.byId(s.id);break;case"component":d=t.getComponent(s.id);break;case"template":d=t.getTemplate(s.id);break;default:break}if(!d){continue}a.association[n]=o(d);a.association[n].isAssociation=true;r(0,a.association[n])}}v.each(a.aggregation,r)}v.each(e,r);return e};b.prototype.getControlProperties=function(t,e){var i=/^((boolean|string|int|float)(\[\])?)$/;var o=[];var a=this.oCore.byId(t);if(!a&&this.oCore.getUIArea(t)){o.push({control:"sap.ui.core.UIArea",properties:[],aggregations:[]})}else if(a){var s=a.getMetadata();while(s instanceof n){var p={control:s.getName(),properties:[],aggregations:[]};var l=s.getProperties();v.each(l,function(t,i){var o={};v.each(i,function(t,a){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){o[t]=a}if(t=="_sGetter"||t=="_sMutator"){o["bp"+t]=e.filter(function(t){return t.name===a&&t.active}).length===1}var n=r.getType(i.type);if(n&&!(n instanceof r)){o["enumValues"]=n}});o.value=a.getProperty(t);o.isBound=!!a.mBindingInfos[t];p.properties.push(o)});var d=s.getAggregations();v.each(d,function(t,o){if(o.altTypes&&o.altTypes[0]&&i.test(o.altTypes[0])&&typeof a.getAggregation(t)!=="object"){var r={};v.each(o,function(t,i){if(t.substring(0,1)!=="_"||(t=="_sGetter"||t=="_sMutator")){r[t]=i}if(t=="_sGetter"||t=="_sMutator"){r["bp"+t]=e.filter(function(t){return t.name===i&&t.active}).length===1}});r.value=a.getAggregation(t);p.aggregations.push(r)}});o.push(p);s=s.getParent()}}return o};b.prototype.getControlBindingInfos=function(t){var e={bindings:[],contexts:[]};var i=this.oCore.byId(t);if(!i){return e}var o=i.mBindingInfos;var r=this;for(var a in o){if(o.hasOwnProperty(a)){var n=o[a];var s=[];var p,l=[];if(v.isArray(n.parts)){p=n.parts}else{p=[n]}if(n.binding instanceof c){l=n.binding.getBindings()}else if(n.binding instanceof d){l=[n.binding]}v.each(p,function(t,e){var o={};o.invalidPath=true;o.path=e.path;o.mode=e.mode;o.model={name:e.model};if(l.length>t&&l[t]){var a=l[t],n=a.getModel(),p=a.getPath(),d;if(n){d=n.resolve(p,a.getContext());if(n.isA("sap.ui.model.odata.v4.ODataModel")){o.unverifiedPath=true;o.invalidPath=false}else{if(n.getProperty(d)!==undefined&&n.getProperty(d)!==null){o.invalidPath=false}else if(n.getProperty(p)!==undefined&&n.getProperty(p)!==null){o.invalidPath=false;d=p}}}o.absolutePath=typeof d==="undefined"?"Unresolvable":d;o.isRelative=a.isRelative();o.model=r.getBindingModelInfo(a,i)}s.push(o)});e.bindings.push({name:a,type:n.binding?n.binding.getMetadata().getName():undefined,bindings:s})}}function u(t,e){var i={modelName:e==="undefined"?"none (default)":e,path:t.getPath()};if(t.getModel().isA("sap.ui.model.odata.v4.ODataModel")){i.unverifiedPath=true}else{if(!t.getObject()==null){i.invalidPath=true}}return i}var g=i.oBindingContexts;for(var h in g){if(g.hasOwnProperty(h)){e.contexts.push(u(g[h],h))}}var g=i.oPropagatedProperties.oBindingContexts;for(var h in g){if(g.hasOwnProperty(h)&&!i.oBindingContexts[h]){var f=u(g[h],h);var b=i;do{if(b.oBindingContexts[h]==g[h]){f.location={id:b.getId(),name:b.getMetadata().getName()};break}}while(b=b.getParent());e.contexts.push(f)}}return e};b.prototype.getBindingModelInfo=function(t,e){var i={};var o=t.getModel();function r(t){for(var e in t){if(t.hasOwnProperty(e)){if(t[e]===o){return e}}}return null}i.name=r(e.oModels)||r(e.oPropagatedProperties.oModels);if(i.name){var a=e;do{if(a.oModels[i.name]===o){i.location={type:"control",id:a.getId(),name:a.getMetadata().getName()};break}}while(a=a.getParent());if(!i.location){var n=null;if(i.name==="undefined"){n=this.oCore.getModel()}else{n=this.oCore.getModel(i.name)}if(n){i.location={type:"core"}}}}i.type=o.getMetadata().getName();i.bindingMode=o.getDefaultBindingMode();i.name=i.name==="undefined"?"none (default)":i.name;return i};b.prototype.refreshBinding=function(t,e){var i=this.oCore.byId(t);var o=i.mBindingInfos[e];if(!i||!o){return}var r=o.binding;if(!r){return}if(r instanceof c){var a=r.getBindings();for(var n=0;n<a.length;n++){a[n].refresh()}}else{r.refresh()}};return b});