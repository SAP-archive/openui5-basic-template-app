/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/support/Plugin","sap/ui/core/format/DateFormat","sap/base/Log","sap/base/security/encodeXML"],function(e,t,o,r){"use strict";var n=e.extend("sap.ui.core.support.plugins.Trace",{constructor:function(r){e.apply(this,["sapUiSupportTrace","JavaScript Trace",r]);this._aEventIds=this.runsAsToolPlugin()?[this.getId()+"Entry"]:[];if(this.runsAsToolPlugin()){this._aLogEntries=[];this._iLogLevel=o.Level.ALL;this._oDateFormat=t.getDateTimeInstance()}else{var n=this;this._oldLogLevel=o.getLevel();o.setLevel(o.Level.ALL);o.addLogListener({onLogEntry:function(e){if(n.isActive()){r.sendEvent(n.getId()+"Entry",{entry:e})}}})}}});n.prototype.onsapUiSupportTraceEntry=function(e){l(this,e.getParameter("entry"))};n.prototype.init=function(t){e.prototype.init.apply(this,arguments);if(!this.runsAsToolPlugin()){return}var o=this;var r=sap.ui.getCore().createRenderManager();r.openStart("div").class("sapUiSupportToolbar").openEnd();r.openStart("button",this.getId()+"-clear").class("sapUiSupportRoundedButton").openEnd().text("Clear").close("button");r.openStart("label").class("sapUiSupportLabel").openEnd().text("Filter:").close("label");r.voidStart("input",this.getId()+"-filter").class("sapUiSupportTxtFld").attr("type","text").voidEnd();r.openStart("label").class("sapUiSupportLabel").openEnd().text("Log Level:").close("label");r.openStart("select",this.getId()+"-loglevel").class("sapUiSupportTxtFld").class("sapUiSupportSelect").openEnd();r.openStart("option").attr("value","0").openEnd().text("FATAL").close("option");r.openStart("option").attr("value","1").openEnd().text("ERROR").close("option");r.openStart("option").attr("value","2").openEnd().text("WARNING").close("option");r.openStart("option").attr("value","3").openEnd().text("INFO").close("option");r.openStart("option").attr("value","4").openEnd().text("DEBUG").close("option");r.openStart("option").attr("value","5").openEnd().text("TRACE").close("option");r.openStart("option").attr("value","6").attr("selected","").openEnd().text("ALL").close("option");r.close("select");r.close("div");r.openStart("div").class("sapUiSupportTraceCntnt").openEnd().close("div");r.flush(this.$().get(0));r.destroy();this._fClearHandler=function(){l(o)};this._fLogLevelHandler=function(){o._iLogLevel=o.$("loglevel").val();var e=[];for(var t=0;t<o._aLogEntries.length;t++){if(i(o._filter,o._iLogLevel,o._aLogEntries[t])){e.push(a(o,o._aLogEntries[t]))}}l(o,e.join(""))};this._fFilterHandler=function(){o._filter=o.$("filter").val();o._filter=o._filter?o._filter.toLowerCase():"";var e=[];for(var t=0;t<o._aLogEntries.length;t++){if(i(o._filter,o._iLogLevel,o._aLogEntries[t])){e.push(a(o,o._aLogEntries[t]))}}l(o,e.join(""))};this.$("clear").on("click",this._fClearHandler);this.$("filter").on("change",this._fFilterHandler);this.$("loglevel").on("change",this._fLogLevelHandler)};n.prototype.exit=function(t){if(this.runsAsToolPlugin()){if(this._fClearHandler){this.$("clear").off("click",this._fClearHandler);this._fClearHandler=null}if(this._fFilterHandler){this.$("filter").off("change",this._fFilterHandler);this._fFilterHandler=null}if(this._fLogLevelHandler){this.$("loglevel").off("change",this._fLogLevelHandler);this._fLogLevelHandler=null}}else{o.setLevel(this._oldLogLevel);this._oldLogLevel=null}e.prototype.exit.apply(this,arguments)};function l(e,t){var o=jQuery(".sapUiSupportTraceCntnt",e.$());if(!t){o.html("");e._aLogEntries=[]}else if(typeof t==="string"){o.html(r(t));o[0].scrollTop=o[0].scrollHeight}else{t._levelInfo=s(t.level);if(i(e._filter,e._iLogLevel,t)){o.append(a(e,t));o[0].scrollTop=o[0].scrollHeight}e._aLogEntries.push(t)}}function a(e,t){var o=t._levelInfo;var n="<div class='sapUiSupportTraceEntry'><span class='sapUiSupportTraceEntryLevel sapUiSupportTraceEntryLevel_"+o[0]+"'>"+o[0]+"</span><span class='sapUiSupportTraceEntryTime'>"+e._oDateFormat.format(new Date(t.timestamp))+"</span><span class='sapUiSupportTraceEntryMessage'>"+r(t.message||"")+"</div>";return n}function i(e,t,o){var r=o._levelInfo;if(o._levelInfo[1]<=t){if(e){var n=e.split(" ");var l=true;for(var a=0;a<n.length;a++){l=l&&o.message.toLowerCase().indexOf(n[a])>=0||r[0].toLowerCase().indexOf(n[a])>=0}return l}return true}return false}function s(e){switch(e){case o.Level.FATAL:return["FATAL",e];case o.Level.ERROR:return["ERROR",e];case o.Level.WARNING:return["WARNING",e];case o.Level.INFO:return["INFO",e];case o.Level.DEBUG:return["DEBUG",e];case o.Level.TRACE:return["TRACE",e];default:return["unknown",e]}}return n});