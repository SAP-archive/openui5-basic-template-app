/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/support/Plugin","sap/base/security/encodeXML","sap/ui/events/KeyCodes"],function(e,t,s){"use strict";var i=jQuery;var o=e.extend("sap.ui.core.support.plugins.Debugging",{constructor:function(t){e.apply(this,["sapUiSupportDebugging","Debugging",t]);this._oStub=t;this._aEventIds=[this.getId()+"ReceiveClasses",this.getId()+"ReceiveClassMethods",this.getId()+"SaveUrlIfNew",this.getId()+"AppendUserUrls"];this._breakpointId="sapUiSupportBreakpoint";this._localStorageId="sapUiSupportLocalStorage";this._techInfoId="sapUiSupportTechInfo";this._aClasses=[];this._mAddedClasses={};this._sSelectedClass="";this._mRebootUrls={}}});o.prototype.isToolPlugin=function(){return true};o.prototype.isAppPlugin=function(){return false};o.prototype.init=function(t){e.prototype.init.apply(this,arguments);var s=this.$();s.on("click","#sapUiSupportDebuggingReboot",i.proxy(this._onUseOtherUI5Version,this));s.on("change","#sapUiSupportDebuggingRebootSelect",this._onUI5VersionDropdownChanged);s.on("keyup","#sapUiSupportDebuggingClassInput",i.proxy(this._autoComplete,this));s.on("blur","#sapUiSupportDebuggingClassInput",i.proxy(this._updateSelectOptions,this));s.on("change","#sapUiSupportDebuggingClassSelect",i.proxy(this._selectOptionsChanged,this));s.on("click","#sapUiSupportDebuggingAddClass",i.proxy(this._onAddClassClicked,this));s.on("click","#sapUiSupportDebuggingClassList li div",i.proxy(this._onSelectClass,this));s.on("click","#sapUiSupportDebuggingClassList li img.remove-class",i.proxy(this._onRemoveClass,this));s.on("keyup","#sapUiSupportDebuggingMethodInput",i.proxy(this._autoComplete,this));s.on("blur","#sapUiSupportDebuggingMethodInput",i.proxy(this._updateSelectOptions,this));s.on("change","#sapUiSupportDebuggingMethodSelect",i.proxy(this._selectOptionsChanged,this));s.on("click","#sapUiSupportDebuggingAddBreakpoint",i.proxy(this._onAddBreakpointClicked,this));s.on("click","#sapUiSupportDebuggingBreakpointList li img.remove-breakpoint",i.proxy(this._onRemoveBreakpoint,this));this.renderContainer();this._populateRebootUrls();this._oStub.sendEvent(this._breakpointId+"RequestClasses",{callback:this.getId()+"ReceiveClasses"})};o.prototype.exit=function(t){e.prototype.exit.apply(this,arguments);var s=this.$();s.off("keyup","#sapUiSupportDebuggingClassInput");s.off("blur","#sapUiSupportDebuggingClassInput");s.off("change","#sapUiSupportDebuggingClassSelect");s.off("click","#sapUiSupportDebuggingAddClass");s.off("click","#sapUiSupportDebuggingClassList li div");s.off("click","#sapUiSupportDebuggingClassList li img.remove-class");s.off("keyup","#sapUiSupportDebuggingMethodInput");s.off("blur","#sapUiSupportDebuggingMethodInput");s.off("change","#sapUiSupportDebuggingMethodSelect");s.off("click","#sapUiSupportDebuggingAddBreakpoint");s.off("click","#sapUiSupportDebuggingBreakpointList li img.remove-breakpoint")};o.prototype.renderContainer=function(){var e=sap.ui.getCore().createRenderManager();e.write('<div id="sapUiSupportDebuggingRebootContainer" class="sapUiSupportContainer">');e.write('<div class="sapUISupportLabel sapUISupportLabelBold">Note: Designed to work with apps loaded with the standard UI5 loading bootstrap script tag:</div>');e.write('<div class="sapUISupportLabel sapUISupportLabelBold">&lt;script id="sap-ui-bootstrap" src="somepath/resources/sap-ui-core.js" ...<br/><br/></div>');e.write('<div class="sapUISupportLabel">Boot application with different UI5 version on next reload:</div>');e.write('<select id="sapUiSupportDebuggingRebootSelect" class="sapUiSupportSelect">');e.write('<option value="none">Disabled (no custom reboot URL)</option>');e.write('<option value="other" id="sapUiSupportDebuggingRebootOther">Other (enter URL to sap-ui-core.js below)...:</option>');e.write("</select>");e.write('<input type="text" id="sapUiSupportDebuggingRebootInput" disabled="disabled">');e.write('<button id="sapUiSupportDebuggingReboot" class="sapUiSupportRoundedButton">Activate Reboot URL</button>');e.write("</div>");e.write('<div id="sapUiSupportDebuggingClassContainer" class="sapUiSupportContainer"></div>');e.write('<div id="sapUiSupportDebuggingMethodContainer" class="sapUiSupportContainer"></div>');e.flush(this.$().get(0));e.destroy()};o.prototype.renderClasses=function(){var e=this;var s=this._aClasses;var o=sap.ui.getCore().createRenderManager();o.write('<div class="sapUISupportLabel">Select Class:</div>');o.write('<select id="sapUiSupportDebuggingClassSelect" class="sapUiSupportAutocomplete  sapUiSupportSelect"><option></option>');i.each(s,function(t,s){if(typeof e._mAddedClasses[s]==="undefined"){o.write("<option>");o.writeEscaped(""+s);o.write("</option>")}});o.write("</select>");o.write('<input id="sapUiSupportDebuggingClassInput" class="sapUiSupportAutocomplete" type="text">');o.write('<button id="sapUiSupportDebuggingAddClass" class="sapUiSupportRoundedButton">Add class</button>');o.write('<hr class="no-border"><ul id="sapUiSupportDebuggingClassList" class="sapUiSupportList">');i.each(s,function(s,i){if(typeof e._mAddedClasses[i]==="undefined"){return}var a=e._mAddedClasses[i].bpCount;var p="";if(a){p=a.active+" / "+a.all}o.write('<li data-class-name="');o.writeEscaped(""+i);o.write('"');if(e._sSelectedClass===i){o.write(' class="selected"')}o.write('><div><span class="className">'+t(i+"")+"</span>"+'<span class="breakpoints">'+t(p+"")+"</span></div>"+'<img class="remove-class" src="../../debug/images/delete.gif" alt="X"></li>')});o.write("</ul>");o.flush(i("#sapUiSupportDebuggingClassContainer").get(0));o.destroy()};o.prototype.renderMethods=function(e){var s=sap.ui.getCore().createRenderManager();if(typeof e==="undefined"){s.write("<p>Select a class in the list on the left side to add breakpoint.</p>");s.flush(i("#sapUiSupportDebuggingMethodContainer").get(0));s.destroy();return}s.write('<div class="sapUISupportLabel">Select Method:</div>');s.write('<select id="sapUiSupportDebuggingMethodSelect" class="sapUiSupportAutocomplete sapUiSupportSelect"><option></option>');i.each(e,function(e,t){if(!t.active){s.write('<option data-method-type="');s.writeEscaped(""+t.type);s.write('">');s.writeEscaped(""+t.name);s.write("</option>")}});s.write("</select>");s.write('<input id="sapUiSupportDebuggingMethodInput" class="sapUiSupportAutocomplete" type="text">');s.write('<button id="sapUiSupportDebuggingAddBreakpoint" class="sapUiSupportRoundedButton">Add breakpoint</button>');s.write('<hr class="no-border"><ul id="sapUiSupportDebuggingBreakpointList" class="sapUiSupportList sapUiSupportBreakpointList">');i.each(e,function(e,i){if(!i.active){return}s.write('<li data-method-type="'+t(i.type+"")+'"><span>'+t(i.name+"")+"</span>"+'<img class="remove-breakpoint" src="../../debug/images/delete.gif" alt="Remove"></li>')});s.write("</ul>");s.flush(i("#sapUiSupportDebuggingMethodContainer").get(0));s.destroy()};o.prototype.onsapUiSupportDebuggingReceiveClasses=function(e){this._aClasses=JSON.parse(e.getParameter("classes"));this.renderClasses();this.renderMethods();i("#sapUiSupportDebuggingClassInput").trigger("focus")};o.prototype.onsapUiSupportDebuggingReceiveClassMethods=function(e){var t=JSON.parse(e.getParameter("methods"));this.renderMethods(t);var s=e.getParameter("className");var o=JSON.parse(e.getParameter("breakpointCount"));this._mAddedClasses[s]={bpCount:o};var a=i('li[data-class-name="'+s+'"] span.breakpoints');a.text(o.active+" / "+o.all);i("#sapUiSupportDebuggingMethodInput").trigger("focus")};o.prototype._autoComplete=function(e){var t=i(e.target);if(e.keyCode==s.ENTER){this._updateSelectOptions(e);if(t.attr("id")==="sapUiSupportDebuggingClassInput"){this._onAddClassClicked()}else{this._onAddBreakpointClicked()}}if(e.keyCode>=s.ARROW_LEFT&&e.keyCode<=s.ARROW_DOWN){return}var o=t.prev("select"),a=t.val();if(a==""){return}var p=o.find("option").map(function(){return i(this).val()}).get();var r;for(var n=0;n<p.length;n++){r=p[n];if(r.toUpperCase().indexOf(a.toUpperCase())==0){var u=t.cursorPos();if(e.keyCode==s.BACKSPACE){u--}t.val(r);t.selectText(u,r.length);break}}return};o.prototype._onAddClassClicked=function(){var e=i("#sapUiSupportDebuggingClassInput").val();this._mAddedClasses[e]={};this.renderClasses();i("#sapUiSupportDebuggingClassInput").trigger("focus")};o.prototype._onRemoveClass=function(e){var t=i(e.target).prev().find("span.className").text();delete this._mAddedClasses[t];var s=false;if(this._sSelectedClass===t){this._sSelectedClass="";s=true}this._oStub.sendEvent(this._breakpointId+"RemoveAllClassBreakpoints",{className:t});this.renderClasses();if(s){this.renderMethods()}i("#sapUiSupportDebuggingClassInput").trigger("focus")};o.prototype._onAddBreakpointClicked=function(){this.changeBreakpoint(i("#sapUiSupportDebuggingClassList li.selected span.className").text(),i("#sapUiSupportDebuggingMethodInput").val(),i("#sapUiSupportDebuggingMethodSelect option:selected").attr("data-method-type"),true)};o.prototype._onRemoveBreakpoint=function(e){this.changeBreakpoint(i("#sapUiSupportDebuggingClassList li.selected span.className").text(),i(e.target).prev().text(),i(e.target).parent("li").attr("data-method-type"),false)};o.prototype._updateSelectOptions=function(e){var t=e.srcElement||e.target;if(t.tagName=="INPUT"){var s=t.value;t=t.previousSibling;var i=t.options;for(var o=0;o<i.length;o++){var a=i[o].value||i[o].text;if(a.toUpperCase()==s.toUpperCase()){t.selectedIndex=o;break}}}var p=t.selectedIndex;var r=t.options[p].value||t.options[p].text;if(t.nextSibling&&t.nextSibling.tagName=="INPUT"){t.nextSibling.value=r}};o.prototype._selectOptionsChanged=function(e){var t=e.srcElement||e.target;var s=t.nextSibling;s.value=t.options[t.selectedIndex].value};o.prototype._onSelectClass=function(e){var t=i(e.target).parents("li");if(t.hasClass("selected")){return}var s=t.find("span.className").text();t.addClass("selected").siblings("li").removeClass("selected");this._sSelectedClass=s;this._oStub.sendEvent(this._breakpointId+"RequestClassMethods",{className:s,callback:this.getId()+"ReceiveClassMethods"})};o.prototype._isClassSelected=function(){var e=false;i.each(this._mClasses,function(t,s){if(s.selected===true){e=true}});return e};o.prototype.changeBreakpoint=function(e,t,s,i){this._oStub.sendEvent(this._breakpointId+"ChangeClassBreakpoint",{className:e,methodName:t,active:i,type:parseInt(s),callback:this.getId()+"ReceiveClassMethods"})};o.prototype._populateRebootUrls=function(){this._mRebootUrls={"https://openui5.hana.ondemand.com/resources/sap-ui-core.js":"Public OpenUI5 server","https://openui5beta.hana.ondemand.com/resources/sap-ui-core.js":"Public OpenUI5 PREVIEW server","https://sapui5.hana.ondemand.com/resources/sap-ui-core.js":"Public SAPUI5 server","http://localhost:8080/testsuite/resources/sap-ui-core.js":"Localhost (port 8080), /testsuite ('grunt serve' URL)","http://localhost:8080/sapui5/resources/sap-ui-core.js":"Localhost (port 8080), /sapui5 (maven URL)"};this._testAndAddUrls(this._mRebootUrls);var e=this;window.setTimeout(function(){e._oStub.sendEvent(e._localStorageId+"GetItem",{id:"sap-ui-reboot-URLs",callback:e.getId()+"AppendUserUrls"})},0)};o.prototype._testAndAddUrls=function(e){var s=jQuery("#sapUiSupportDebuggingRebootOther");function i(i){return function(){var o="<option value='"+t(i)+"'>"+e[i]+"</option>";s.before(o)}}for(var o in e){jQuery.ajax({type:"HEAD",url:o,success:i(o)})}};o.prototype.onsapUiSupportDebuggingAppendUserUrls=function(e){var s=e.getParameter("value"),i={},o=s.split(" ");for(var a=0;a<o.length;a++){var p=o[a];if(p&&!this._mRebootUrls[p]){i[p]=t(p)+" (user-defined URL)"}}this._testAndAddUrls(i)};o.prototype._onUI5VersionDropdownChanged=function(){var e=jQuery("#sapUiSupportDebuggingRebootSelect").val(),t=jQuery("#sapUiSupportDebuggingRebootInput");if(e==="other"){t.removeAttr("disabled")}else{t.attr("disabled","disabled");if(e==="none"){t.val("")}else{t.val(e)}}};o.prototype._onUseOtherUI5Version=function(){var e=jQuery("#sapUiSupportDebuggingRebootSelect").val();if(e==="other"){e=jQuery("#sapUiSupportDebuggingRebootInput").val()}if(!e||e==="none"){this._oStub.sendEvent(this._techInfoId+"SetReboot",{rebootUrl:null});alert("Reboot URL cleared. App will start normally.")}else{this._oStub.sendEvent(this._techInfoId+"SetReboot",{rebootUrl:e});if(!this._mRebootUrls[e]){this._oStub.sendEvent(this._localStorageId+"GetItem",{id:"sap-ui-reboot-URLs",passThroughData:e,callback:this.getId()+"SaveUrlIfNew"})}}};o.prototype.onsapUiSupportDebuggingSaveUrlIfNew=function(e){var t=e.getParameter("value"),s=e.getParameter("passThroughData"),i=t.split(" ");if(i.indexOf(s)===-1){i.push(s.replace(/ /g,"%20"));this._oStub.sendEvent(this._localStorageId+"SetItem",{id:"sap-ui-reboot-URLs",value:i.join(" ")})}};return o});