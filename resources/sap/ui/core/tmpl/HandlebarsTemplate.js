/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Template","./TemplateControl","sap/ui/thirdparty/handlebars","sap/ui/base/ManagedObject","sap/base/util/ObjectPath","sap/base/security/encodeXML","sap/base/util/isEmptyObject","sap/ui/core/Core"],function(e,t,a,r,n,o,i){"use strict";var s=e.extend("sap.ui.core.tmpl.HandlebarsTemplate",{metadata:{library:"sap.ui.core"},constructor:function(t,a){e.apply(this,arguments)}});e.registerType("text/x-handlebars-template","sap.ui.core.tmpl.HandlebarsTemplate");function h(e){for(var t in e){e[t]=e[t].replace("&gt;",">").replace("&lt;","<").replace("&quot;",'"').replace("&amp;","&")}}function l(e,t){var a=/^((\w+)>)?(.*)/,r=a.exec(e),n=r[2],o=a.exec(t),i=o[2];var r=a.exec(e);if(t&&n==i){return t+r[3]}else{return e}}s.RENDER_HELPERS=function(){var e=a.helpers["each"],t=a.helpers["with"],s=a.helpers["if"],p=a.helpers["unless"],g=sap.ui.getCore().createRenderManager();g.renderControl=function(e){this.writeControlData(e);this.writeClasses(e);this.writeStyles(e)};var f={each:function(t,r){r=r||t;if(!r.hash.path){return e.apply(this,arguments)}else{h(r.hash);var n=r.data.renderManager,o=r.data.rootControl,i=r.data.path,s=r.data.parentControl,p=l(r.hash.path,i),g=o.bindList(p),f=[],d;if(r.data){d=a.createFrame(r.data)}if(g){for(var u in g){if(d){d.renderManager=n;d.rootControl=o;d.path=p+"/"+u+"/";d.parentControl=s}f.push(r.fn({},{data:d}))}}if(!s){return new a.SafeString(f.join(""))}}},with:function(e,a){a=a||e;if(!a.hash.path){return t.apply(this,arguments)}},if:function(e,t){t=t||e;if(!t.hash.path){return s.apply(this,arguments)}else{h(t.hash);var a=t.data.rootControl,r=t.data.path,n=l(t.hash.path,r);if(n){var o=a.bindProp(n);if(o){return t.fn(this)}else{return t.inverse(this)}}}},unless:function(e,t){t=t||e;if(!t.hash.path){return p.apply(this,arguments)}else{h(t.hash);var a=t.data.rootControl,r=t.data.path,n=l(t.hash.path,r);if(n){var o=a.bindProp(n);if(!o){return t.fn(this)}else{return t.inverse(this)}}}},text:function(e,t){t=t||e;h(t.hash);var r=t.data.rootControl,n=t.data.path,i=l(t.hash.path,n);if(i){var s=r.bindProp(i);return s&&new a.SafeString(o(s))}else{throw new Error('The expression "text" requires the option "path"!')}},element:function(e,t){t=t||e;h(t.hash);var r=t.data.renderManager,n=t.data.rootControl,o=n.createDOMElement(t.hash,t.data.path),i=t.data.parentElement;if(t.fn){t.fn({},{data:{renderManager:r,rootControl:n,parentElement:o}})}if(i){i.addElement(o);return}return new a.SafeString(r.getHTML(o))},control:function(e,t){t=t||e;h(t.hash);var o=t.data.renderManager,s=t.data.control;if(s){return new a.SafeString(o.getHTML(s))}var l=t.data.rootControl,p=t.data.path,g=t.data.children,f=t.hash["sap-ui-type"],d=n.get(f||""),u=d&&d.getMetadata(),c=t.hash["sap-ui-default-aggregation"]||u&&u.getDefaultAggregationName(),v=t.data.view;if(!d){throw new Error("Control of type "+f+" cannot be found.")}var m={};if(t.fn){t.fn({},{data:{rootControl:l,path:p,children:m,defaultAggregation:c,view:v}})}var C=Object.assign({},t.hash),w;for(var b in C){if(b==="sap-ui-class"&&typeof C[b]==="string"){w=C["sap-ui-class"]&&C["sap-ui-class"].split(" ");delete C[b]}else if(m[b]){delete C[b]}}var y=l.createControl(C,t.data.path,!!g,v);if(w&&w.length>0){w.forEach(y.addStyleClass.bind(y))}if(!i(m)){C=t.hash;var M=u.getAllAggregations();for(var E in m){var S=m[E];for(var T=0,A=S.length;T<A;T++){var x=S[T],j=M[E],H=j&&j.multiple;if(typeof C[E]==="string"){var L=r.bindingParser(C[E],v&&v.getController());L.template=x;y.bindAggregation(E,L)}else{if(H){y.addAggregation(E,x)}else{y.setAggregation(E,x)}}}}}if(g){var E=t.hash["sap-ui-aggregation"]||t.data.defaultAggregation;g[E]=g[E]||[];g[E].push(y);return}return new a.SafeString(o.getHTML(y))},property:function(e,t){t=t||e;h(t.hash);var a=t.data.rootControl,r=a.getMetadata(),n=t.hash.name,o=r.getProperty(n)._sGetter;return a[o]()},aggregation:function(e,t){t=t||e;h(t.hash);if(t.data.children){var r=t.hash.name;if(t.fn){var n=Object.assign({},t.data,{defaultAggregation:r});t.fn({},{data:n})}}else{var o=t.data.renderManager,i=t.data.rootControl,s=i.getMetadata(),r=t.hash.name,l=s.getAggregation(r)._sGetter,p=[];var g=i[l]();if(g){for(var f=0,d=g.length;f<d;f++){if(t.fn){p.push(t.fn({},{data:{renderManager:o,rootControl:i,control:g[f]}}))}else{p.push(o.getHTML(g[f]))}}}return new a.SafeString(p.join(""))}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;var r=t.data.rootControl;return new a.SafeString(g.getHTML(r))}};return f}();s.prototype.createMetadata=function(){var e=this.getContent(),r=this._fnTemplate=this._fnTemplate||a.compile(e);var n={},o=t.getMetadata().getAllSettings(),i=t.getMetadata().getAllPrivateAggregations();var s={property:function(e,t){t=t||e;h(t.hash);var a=t.hash.name;if(a&&a!=="id"&&!o[a]){n.properties=n.properties||{};n.properties[a]=Object.assign({},{type:"string"},t.hash)}else{throw new Error('The property name "'+a+'" is reserved.')}},aggregation:function(e,t){t=t||e;h(t.hash);var a=t.hash.name;if(a&&!o[a]&&!i[a]){t.hash.multiple=t.hash.multiple=="true";n.aggregations=n.aggregations||{};n.aggregations[a]=Object.assign({},t.hash)}else{throw new Error('The aggregation name "'+a+'" is reserved.')}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;n._hasControlData=true}};["each","if","unless","with"].forEach(function(e){s[e]=function(){}});r({},{helpers:s});return n};s.prototype.createRenderer=function(e){var t=this.getContent(),r=this._fnTemplate=this._fnTemplate||a.compile(t);var n=function(t,a){var n=r(a.getContext()||{},{data:{renderManager:t,rootControl:a,view:e},helpers:s.RENDER_HELPERS});t.write(n)};return n};return s});