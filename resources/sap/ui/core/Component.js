/*
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Manifest","./ComponentMetadata","./Element","sap/base/util/extend","sap/base/util/deepExtend","sap/base/util/merge","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectRegistry","sap/ui/thirdparty/URI","sap/ui/performance/trace/Interaction","sap/base/assert","sap/base/Log","sap/base/util/ObjectPath","sap/base/util/UriParameters","sap/base/util/isPlainObject","sap/base/util/LoaderExtensions","sap/ui/VersionInfo"],function(e,t,n,a,r,i,o,s,u,c,f,p,d,l,g,m,y){"use strict";var v={JSON:"JSON",XML:"XML",HTML:"HTML",JS:"JS",Template:"Template"};var h={lazy:"lazy",eager:"eager",waitFor:"waitFor"};function M(e){["sap-client","sap-server"].forEach(function(t){if(!e.hasSearch(t)){var n=sap.ui.getCore().getConfiguration().getSAPParam(t);if(n){e.addSearch(t,n)}}})}function _(e,t,n,a){if(n){for(var r in e){if(!t[r]&&n[r]&&n[r].uri){t[r]=a}}}}function b(e,n,a,i){var o=n.getEntry(a);if(o!==undefined&&!g(o)){return o}var s,u;if(i&&(s=e.getParent())instanceof t){u=s.getManifestEntry(a,i)}if(u||o){o=r({},u,o)}return o}function C(e,t){var n=Object.create(Object.getPrototypeOf(e));n._oMetadata=e;n._oManifest=t;for(var a in e){if(!/^(getManifest|getManifestObject|getManifestEntry|getMetadataVersion)$/.test(a)&&typeof e[a]==="function"){n[a]=e[a].bind(e)}}n.getManifest=function(){return t&&t.getJson()};n.getManifestObject=function(){return t};n.getManifestEntry=function(n,a){return b(e,t,n,a)};n.getMetadataVersion=function(){return 2};return n}function S(e,t,n){f(typeof e==="function","fn must be a function");var a=o._sOwnerId;try{o._sOwnerId=t;return e.call(n)}finally{o._sOwnerId=a}}var w=o.extend("sap.ui.core.Component",{constructor:function(e,t){var n=Array.prototype.slice.call(arguments);if(typeof e!=="string"){t=e;e=undefined}if(t&&typeof t._metadataProxy==="object"){this._oMetadataProxy=t._metadataProxy;this._oManifest=t._metadataProxy._oManifest;delete t._metadataProxy;this.getMetadata=function(){return this._oMetadataProxy}}if(t&&typeof t._cacheTokens==="object"){this._mCacheTokens=t._cacheTokens;delete t._cacheTokens}if(t&&Array.isArray(t._activeTerminologies)){this._aActiveTerminologies=t._activeTerminologies;delete t._activeTerminologies}if(t&&typeof t._manifestModels==="object"){this._mManifestModels=t._manifestModels;delete t._manifestModels}else{this._mManifestModels={}}this._mServices={};o.apply(this,n)},metadata:{stereotype:"component",abstract:true,specialSettings:{componentData:"any"},version:"0.0",includes:[],dependencies:{libs:[],components:[],ui5version:""},config:{},customizing:{},library:"sap.ui.core"}},t);s.apply(w,{onDeregister:function(e){n.registry.forEach(function(t){if(t._sapui_candidateForDestroy&&t._sOwnerId===e&&!t.getParent()){p.debug("destroying dangling template "+t+" when destroying the owner component");t.destroy()}})}});w.prototype.getManifest=function(){if(!this._oManifest){return this.getMetadata().getManifest()}else{return this._oManifest.getJson()}};w.prototype.getManifestEntry=function(e){return this._getManifestEntry(e)};w.prototype._getManifestEntry=function(e,t){if(!this._oManifest){return this.getMetadata().getManifestEntry(e,t)}else{return b(this.getMetadata(),this._oManifest,e,t)}};w.prototype.getManifestObject=function(){if(!this._oManifest){return this.getMetadata().getManifestObject()}else{return this._oManifest}};w.prototype._isVariant=function(){if(this._oManifest){var e=this.getManifestEntry("/sap.ui5/componentName");return e&&e!==this.getManifestEntry("/sap.app/id")}else{return false}};w.activateCustomizing=function(e){};w.deactivateCustomizing=function(e){};w.getOwnerIdFor=function(e){f(e instanceof o,"oObject must be given and must be a ManagedObject");var t=e instanceof o&&e._sOwnerId;return t||undefined};w.getOwnerComponentFor=function(e){return w.get(w.getOwnerIdFor(e))};w.prototype.runAsOwner=function(e){return S(e,this.getId())};w.prototype.getInterface=function(){return this};w.prototype._initCompositeSupport=function(e){this.oComponentData=e&&e.componentData;if(!this._isVariant()){this.getMetadata().init()}else{this._oManifest.init(this);var t=this._oManifest.getEntry("/sap.app/id");if(t){T(t,this._oManifest.resolveUri("./","manifest"))}}this.initComponentModels();if(this.onWindowError){this._fnWindowErrorHandler=function(e){var t=e.originalEvent;this.onWindowError(t.message,t.filename,t.lineno)}.bind(this);window.addEventListener("error",this._fnWindowErrorHandler)}if(this.onWindowBeforeUnload){this._fnWindowBeforeUnloadHandler=this.onWindowBeforeUnload.bind(this);window.addEventListener("beforeunload",this._fnWindowBeforeUnloadHandler)}if(this.onWindowUnload){this._fnWindowUnloadHandler=this.onWindowUnload.bind(this);window.addEventListener("unload",this._fnWindowUnloadHandler)}};w.prototype.destroy=function(){for(var e in this._mServices){if(this._mServices[e].instance){this._mServices[e].instance.destroy()}}delete this._mServices;for(var t in this._mManifestModels){this._mManifestModels[t].destroy()}delete this._mManifestModels;if(this._fnWindowErrorHandler){window.removeEventListener("error",this._fnWindowErrorHandler);delete this._fnWindowErrorHandler}if(this._fnWindowBeforeUnloadHandler){window.removeEventListener("beforeunload",this._fnWindowBeforeUnloadHandler);delete this._fnWindowBeforeUnloadHandler}if(this._fnWindowUnloadHandler){window.removeEventListener("unload",this._fnWindowUnloadHandler);delete this._fnWindowUnloadHandler}if(this._oEventBus){this._oEventBus.destroy();delete this._oEventBus}o.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);if(!this._isVariant()){this.getMetadata().exit()}else{this._oManifest.exit(this);delete this._oManifest}};w.prototype.getComponentData=function(){return this.oComponentData};w.prototype.getEventBus=function(){if(!this._oEventBus){var e=this.getMetadata().getName();p.warning("Synchronous loading of EventBus, due to #getEventBus() call on Component '"+e+"'.","SyncXHR",null,function(){return{type:"SyncXHR",name:e}});var t=sap.ui.requireSync("sap/ui/core/EventBus");this._oEventBus=new t}return this._oEventBus};w.prototype.initComponentModels=function(){var e=this.getMetadata();if(e.isBaseClass()){return}var t=this._getManifestEntry("/sap.app/dataSources",true)||{};var n=this._getManifestEntry("/sap.ui5/models",true)||{};this._initComponentModels(n,t,this._mCacheTokens)};w.prototype._initComponentModels=function(e,t,n){var a=w._createManifestModelConfigurations({models:e,dataSources:t,component:this,mergeParent:true,cacheTokens:n,activeTerminologies:this.getActiveTerminologies()});if(!a){return}var r={};for(var i in a){if(!this._mManifestModels[i]){r[i]=a[i]}}var o=w._createManifestModels(r,this.toString());for(var i in o){this._mManifestModels[i]=o[i]}for(var i in this._mManifestModels){var s=this._mManifestModels[i];this.setModel(s,i||undefined)}};w.prototype.getService=function(e){if(!this._mServices[e]){this._mServices[e]={};this._mServices[e].promise=new Promise(function(t,n){sap.ui.require(["sap/ui/core/service/ServiceFactoryRegistry"],function(a){var r=this._getManifestEntry("/sap.ui5/services/"+e,true);var i=r&&r.factoryName;if(!i){n(new Error("Service "+e+" not declared!"));return}var o=a.get(i);if(o){o.createInstance({scopeObject:this,scopeType:"component",settings:r.settings||{}}).then(function(a){if(!this.bIsDestroyed){this._mServices[e].instance=a;this._mServices[e].interface=a.getInterface();t(this._mServices[e].interface)}else{n(new Error("Service "+e+" could not be loaded as its Component was destroyed."))}}.bind(this)).catch(n)}else{var s="The ServiceFactory "+i+" for Service "+e+" not found in ServiceFactoryRegistry!";var u=this._getManifestEntry("/sap.ui5/services/"+e+"/optional",true);if(!u){p.error(s)}n(new Error(s))}}.bind(this),n)}.bind(this))}return this._mServices[e].promise};function O(e,t){var n=e._getManifestEntry("/sap.ui5/services",true);var a=t?[]:null;if(!n){return a}var r=Object.keys(n);if(!t&&r.some(function(e){return n[e].startup===h.waitFor})){throw new Error('The specified component "'+e.getMetadata().getName()+'" cannot be loaded in sync mode since it has some services declared with "startup" set to "waitFor"')}return r.reduce(function(t,a){if(n[a].lazy===false||n[a].startup===h.waitFor||n[a].startup===h.eager){var r=e.getService(a);if(n[a].startup===h.waitFor){t.push(r)}}return t},a)}w.prototype.createComponent=function(e){f(typeof e==="string"&&e||typeof e==="object"&&typeof e.usage==="string"&&e.usage,"vUsage either must be a non-empty string or an object with a non-empty usage id");var t={async:true};if(e){var n;if(typeof e==="object"){n=e.usage;["id","async","settings","componentData"].forEach(function(n){if(e[n]!==undefined){t[n]=e[n]}})}else if(typeof e==="string"){n=e}t=this._enhanceWithUsageConfig(n,t)}return w._createComponent(t,this)};w.prototype._enhanceWithUsageConfig=function(e,t){var n=this.getManifestEntry("/sap.ui5/componentUsages/"+e);if(!n){throw new Error('Component usage "'+e+'" not declared in Component "'+this.getManifestObject().getComponentName()+'"!')}if(n.activeTerminologies){throw new Error("Terminologies vector can't be used in component usages")}return r(n,t)};w.prototype.getActiveTerminologies=function(){return this._aActiveTerminologies?this._aActiveTerminologies.slice():undefined};w._createComponent=function(e,t){function n(){if(e.async===true){return w.create(e)}else{return sap.ui.component(e)}}if(t){return t.runAsOwner(n)}else{return n()}};w._applyCacheToken=function(e,t,n){var a=sap.ui.getCore().getConfiguration();var r=n?"Model":"DataSource";var i=n?'["sap.ui5"]["models"]':'["sap.app"]["dataSources"]';var o=n&&n["sap-language"]||e.search(true)["sap-language"];var s=n&&n["sap-client"]||e.search(true)["sap-client"];if(!o){p.warning('Component Manifest: Ignoring provided "sap-context-token='+t.cacheToken+'" for '+r+' "'+t.dataSource+'" ('+e.toString()+"). "+'Missing "sap-language" URI parameter',i+'["'+t.dataSource+'"]',t.componentName);return}if(!s){p.warning('Component Manifest: Ignoring provided "sap-context-token='+t.cacheToken+'" for '+r+' "'+t.dataSource+'" ('+e.toString()+"). "+'Missing "sap-client" URI parameter',i+'["'+t.dataSource+'"]',t.componentName);return}if(s!==a.getSAPParam("sap-client")){p.warning('Component Manifest: Ignoring provided "sap-context-token='+t.cacheToken+'" for '+r+' "'+t.dataSource+'" ('+e.toString()+"). "+'URI parameter "sap-client='+s+'" must be identical with configuration "sap-client='+a.getSAPParam("sap-client")+'"',i+'["'+t.dataSource+'"]',t.componentName);return}if(e.hasQuery("sap-context-token")&&!e.hasQuery("sap-context-token",t.cacheToken)||n&&n["sap-context-token"]&&n["sap-context-token"]!==t.cacheToken){p.warning('Component Manifest: Overriding existing "sap-context-token='+(e.query(true)["sap-context-token"]||n["sap-context-token"])+'" with provided value "'+t.cacheToken+'" for '+r+' "'+t.dataSource+'" ('+e.toString()+").",i+'["'+t.dataSource+'"]',t.componentName)}if(n){if(e.hasQuery("sap-context-token")){p.warning('Component Manifest: Move existing "sap-context-token='+e.query(true)["sap-context-token"]+'" to metadataUrlParams for '+r+' "'+t.dataSource+'" ('+e.toString()+").",i+'["'+t.dataSource+'"]',t.componentName)}e.removeQuery("sap-context-token");n["sap-context-token"]=t.cacheToken}else{e.setQuery("sap-context-token",t.cacheToken)}};w._createManifestModelConfigurations=function(e){var n=e.component;var a=e.manifest||n.getManifestObject();var r=e.mergeParent;var i=e.cacheTokens||{};var o=n?n.toString():a.getComponentName();var s=sap.ui.getCore().getConfiguration();var c=e.activeTerminologies;if(!e.models){return null}var f={models:e.models,dataSources:e.dataSources||{},origin:{dataSources:{},models:{}}};if(n&&r){var d=n.getMetadata();while(d instanceof t){var l=d.getManifestObject();var g=d.getManifestEntry("/sap.app/dataSources");_(f.dataSources,f.origin.dataSources,g,l);var m=d.getManifestEntry("/sap.ui5/models");_(f.models,f.origin.models,m,l);d=d.getParent()}}var y={};for(var v in f.models){var h=f.models[v];var b=false;var C=null;if(typeof h==="string"){h={dataSource:h}}if(h.dataSource){var S=f.dataSources&&f.dataSources[h.dataSource];if(typeof S==="object"){if(S.type===undefined){S.type="OData"}var O;if(!h.type){switch(S.type){case"OData":O=S.settings&&S.settings.odataVersion;if(O==="4.0"){h.type="sap.ui.model.odata.v4.ODataModel"}else if(!O||O==="2.0"){h.type="sap.ui.model.odata.v2.ODataModel"}else{p.error('Component Manifest: Provided OData version "'+O+'" in '+'dataSource "'+h.dataSource+'" for model "'+v+'" is unknown. '+'Falling back to default model type "sap.ui.model.odata.v2.ODataModel".','["sap.app"]["dataSources"]["'+h.dataSource+'"]',o);h.type="sap.ui.model.odata.v2.ODataModel"}break;case"JSON":h.type="sap.ui.model.json.JSONModel";break;case"XML":h.type="sap.ui.model.xml.XMLModel";break;default:}}if(h.type==="sap.ui.model.odata.v4.ODataModel"&&S.settings&&S.settings.odataVersion){h.settings=h.settings||{};h.settings.odataVersion=S.settings.odataVersion}if(!h.uri){h.uri=S.uri;b=true}if(S.type==="OData"&&S.settings&&typeof S.settings.maxAge==="number"){h.settings=h.settings||{};h.settings.headers=h.settings.headers||{};h.settings.headers["Cache-Control"]="max-age="+S.settings.maxAge}if(S.type==="OData"&&S.settings&&S.settings.annotations){var E=S.settings.annotations;for(var P=0;P<E.length;P++){var T=E[P];var U=f.dataSources[T];if(!U){p.error('Component Manifest: ODataAnnotation "'+T+'" for dataSource "'+h.dataSource+'" could not be found in manifest','["sap.app"]["dataSources"]["'+T+'"]',o);continue}if(U.type!=="ODataAnnotation"){p.error('Component Manifest: dataSource "'+T+'" was expected to have type "ODataAnnotation" but was "'+U.type+'"','["sap.app"]["dataSources"]["'+T+'"]',o);continue}if(!U.uri){p.error('Component Manifest: Missing "uri" for ODataAnnotation "'+T+'"','["sap.app"]["dataSources"]["'+T+'"]',o);continue}var k=new u(U.uri);if(h.type==="sap.ui.model.odata.v2.ODataModel"||h.type==="sap.ui.model.odata.v4.ODataModel"){var j=i.dataSources&&i.dataSources[U.uri];if(j||h.type==="sap.ui.model.odata.v2.ODataModel"){["sap-language","sap-client"].forEach(function(e){if(!k.hasQuery(e)&&s.getSAPParam(e)){k.setQuery(e,s.getSAPParam(e))}})}if(j){w._applyCacheToken(k,{cacheToken:j,componentName:o,dataSource:T})}}var N=f.origin.dataSources[E[P]]||a;var D=N._resolveUri(k).toString();h.settings=h.settings||{};h.settings.annotationURI=h.settings.annotationURI||[];h.settings.annotationURI.push(D)}}}else{p.error('Component Manifest: dataSource "'+h.dataSource+'" for model "'+v+'" not found or invalid','["sap.app"]["dataSources"]["'+h.dataSource+'"]',o);continue}}if(!h.type){p.error('Component Manifest: Missing "type" for model "'+v+'"','["sap.ui5"]["models"]["'+v+'"]',o);continue}if(h.type==="sap.ui.model.odata.ODataModel"&&(!h.settings||h.settings.json===undefined)){h.settings=h.settings||{};h.settings.json=true}if(h.type==="sap.ui.model.resource.ResourceModel"){if(h.uri&&h.settings&&h.settings.bundleUrl){p.warning("Defining both model uri and bundleUrl is not supported. Only model uri will be resolved.")}if(!h.uri&&h.settings&&h.settings.terminologies){if(h.bundleUrl||h.settings.bundleUrl){h.uri=h.bundleUrl||h.settings.bundleUrl;delete h.settings.bundleUrl}}}if(h.uri){var x=new u(h.uri);var A=(b?f.origin.dataSources[h.dataSource]:f.origin.models[v])||a;x=A._resolveUri(x);if(h.dataSource){M(x);if(h.type==="sap.ui.model.odata.v2.ODataModel"||h.type==="sap.ui.model.odata.v4.ODataModel"){var j=i.dataSources&&i.dataSources[S.uri];C=h.settings&&h.settings.metadataUrlParams;var I=(!C||typeof C["sap-language"]==="undefined")&&!x.hasQuery("sap-language")&&s.getSAPParam("sap-language");if(I&&h.type==="sap.ui.model.odata.v2.ODataModel"||j){h.settings=h.settings||{};C=h.settings.metadataUrlParams=h.settings.metadataUrlParams||{};if(I){C["sap-language"]=s.getSAPParam("sap-language")}}if(j){w._applyCacheToken(x,{cacheToken:j,componentName:o,dataSource:v},C)}}}h.uri=x.toString()}if(h.uriSettingName===undefined){switch(h.type){case"sap.ui.model.odata.ODataModel":case"sap.ui.model.odata.v2.ODataModel":case"sap.ui.model.odata.v4.ODataModel":h.uriSettingName="serviceUrl";break;case"sap.ui.model.resource.ResourceModel":h.uriSettingName="bundleUrl";break;default:}}var R;var H;if(n){H=n.getComponentData()}else{H=e.componentData}R=H&&H.startupParameters&&H.startupParameters["sap-system"];if(!R){R=s.getSAPParam("sap-system")}var B=false;var F;if(R&&["sap.ui.model.odata.ODataModel","sap.ui.model.odata.v2.ODataModel"].indexOf(h.type)!=-1){B=true;F=sap.ui.requireSync("sap/ui/model/odata/ODataUtils")}if(h.uri){if(B){h.preOriginBaseUri=h.uri.split("?")[0];h.uri=F.setOrigin(h.uri,{alias:R});h.postOriginBaseUri=h.uri.split("?")[0]}if(h.uriSettingName!==undefined){h.settings=h.settings||{};if(!h.settings[h.uriSettingName]){h.settings[h.uriSettingName]=h.uri}}else if(h.settings){h.settings=[h.uri,h.settings]}else{h.settings=[h.uri]}}else{if(B&&h.uriSettingName!==undefined&&h.settings&&h.settings[h.uriSettingName]){h.preOriginBaseUri=h.settings[h.uriSettingName].split("?")[0];h.settings[h.uriSettingName]=F.setOrigin(h.settings[h.uriSettingName],{alias:R});h.postOriginUri=h.settings[h.uriSettingName].split("?")[0]}}if(B&&h.settings&&h.settings.annotationURI){var W=[].concat(h.settings.annotationURI);var L=[];for(var P=0;P<W.length;P++){L.push(F.setAnnotationOrigin(W[P],{alias:R,preOriginBaseUri:h.preOriginBaseUri,postOriginBaseUri:h.postOriginBaseUri}))}h.settings.annotationURI=L}if(h.type==="sap.ui.model.resource.ResourceModel"&&h.settings){if(c){h.settings.activeTerminologies=c}a._processResourceConfiguration(h.settings,undefined,true)}if(h.settings&&!Array.isArray(h.settings)){h.settings=[h.settings]}y[v]=h}if(a.getEntry("/sap.ui5/commands")||n&&n._getManifestEntry("/sap.ui5/commands",true)){y["$cmd"]={type:"sap.ui.model.json.JSONModel"}}return y};w._createManifestModels=function(e,t){var n={};for(var a in e){var r=e[a];try{sap.ui.requireSync(r.type.replace(/\./g,"/"))}catch(e){p.error('Component Manifest: Class "'+r.type+'" for model "'+a+'" could not be loaded. '+e,'["sap.ui5"]["models"]["'+a+'"]',t);continue}var i=d.get(r.type);if(!i){p.error('Component Manifest: Class "'+r.type+'" for model "'+a+'" could not be found','["sap.ui5"]["models"]["'+a+'"]',t);continue}var o=[null].concat(r.settings||[]);var s=i.bind.apply(i,o);var u=new s;n[a]=u}return n};function E(e,t,n,a){var r={afterManifest:{},afterPreload:{}};var o=i({},e.getEntry("/sap.app/dataSources"));var s=i({},e.getEntry("/sap.ui5/models"));var u=w._createManifestModelConfigurations({models:s,dataSources:o,manifest:e,componentData:t,cacheTokens:n,activeTerminologies:a});var c=l.fromQuery(window.location.search).get("sap-ui-xx-preload-component-models-"+e.getComponentName());var f=c&&c.split(",");for(var d in u){var g=u[d];if(!g.preload&&f&&f.indexOf(d)>-1){g.preload=true;p.warning('FOR TESTING ONLY!!! Activating preload for model "'+d+'" ('+g.type+")",e.getComponentName(),"sap.ui.core.Component")}if(g.type==="sap.ui.model.resource.ResourceModel"&&Array.isArray(g.settings)&&g.settings.length>0&&g.settings[0].async!==true){r.afterPreload[d]=g}else if(g.preload){if(sap.ui.loader._.getModuleState(g.type.replace(/\./g,"/")+".js")){r.afterManifest[d]=g}else{p.warning('Can not preload model "'+d+'" as required class has not been loaded: "'+g.type+'"',e.getComponentName(),"sap.ui.core.Component")}}}return r}function P(e){return sap.ui.require.toUrl(e.replace(/\./g,"/")+"/manifest.json")}function T(e,t){m.registerResourcePath(e.replace(/\./g,"/"),t)}function U(e){var n=[];var a=[];function r(e){if(!e._oManifest){var i=e.getComponentName();var o=P(i);var s=m.loadResource({url:o,dataType:"json",async:true}).catch(function(e){p.error('Failed to load component manifest from "'+o+'" (component '+i+")! Reason: "+e);return{}});n.push(s);a.push(e)}var u=e.getParent();if(u&&u instanceof t&&!u.isBaseClass()){r(u)}}r(e);return Promise.all(n).then(function(e){for(var t=0;t<e.length;t++){if(e[t]){a[t]._applyManifest(e[t])}}})}w._fnLoadComponentCallback=null;w._fnOnInstanceCreated=null;w._fnPreprocessManifest=null;w.create=function(e){if(e==null||typeof e!=="object"){throw new TypeError("Component.create() must be called with a configuration object.")}var t=i({},e);t.async=true;if(t.manifest===undefined){t.manifest=true}return k(t)};sap.ui.component=function(e){if(!e){throw new Error("sap.ui.component cannot be called without parameter!")}var t=function(e){return{type:"sap.ui.component",name:e}};if(typeof e==="string"){p.warning("Do not use deprecated function 'sap.ui.component' ("+e+") + for Component instance lookup. "+"Use 'Component.get' instead","sap.ui.component",null,t.bind(null,e));return sap.ui.getCore().getComponent(e)}if(e.async){p.info("Do not use deprecated factory function 'sap.ui.component' ("+e["name"]+"). "+"Use 'Component.create' instead","sap.ui.component",null,t.bind(null,e["name"]))}else{p.warning("Do not use synchronous component creation ("+e["name"]+")! "+"Use the new asynchronous factory 'Component.create' instead","sap.ui.component",null,t.bind(null,e["name"]))}return k(e)};function k(e){var t=w.get(o._sOwnerId);var n=e.activeTerminologies||t&&t.getActiveTerminologies()||sap.ui.getCore().getConfiguration().getActiveTerminologies();if(!e.asyncHints||!e.asyncHints.cacheTokens){var r=t&&t._mCacheTokens;if(typeof r==="object"){e.asyncHints=e.asyncHints||{};e.asyncHints.cacheTokens=r}}function i(e,t){if(typeof w._fnOnInstanceCreated==="function"){var n=w._fnOnInstanceCreated(e,t);if(t.async&&n instanceof Promise){return n}}if(t.async){return Promise.resolve(e)}return e}function s(t){var r=e.name,o=e.id,s=e.componentData,u=r+".Component",c=e.settings;var d=new t(a({},c,{id:o,componentData:s,_cacheTokens:e.asyncHints&&e.asyncHints.cacheTokens,_activeTerminologies:n}));f(d instanceof w,'The specified component "'+u+'" must be an instance of sap.ui.core.Component!');p.info("Component instance Id = "+d.getId());var l=d.getMetadata().handleValidation()!==undefined||e.handleValidation;if(l){if(d.getMetadata().handleValidation()!==undefined){l=d.getMetadata().handleValidation()}else{l=e.handleValidation}sap.ui.getCore().getMessageManager().registerObject(d,l)}var g=O(d,e.async);if(e.async){return i(d,e).then(function(){return Promise.all(g)}).then(function(){return d})}else{i(d,e);return d}}var u=j(e,{failOnError:true,createModels:true,waitFor:e.asyncHints&&e.asyncHints.waitFor,activeTerminologies:n});if(e.async){var c=o._sOwnerId;return u.then(function(e){return S(function(){return s(e)},c)})}else{return s(u)}}w.load=function(e){var t=i({},e);t.async=true;if(t.manifest===undefined){t.manifest=true}return j(t,{preloadOnly:t.asyncHints&&t.asyncHints.preloadOnly})};w.get=function(e){return sap.ui.getCore().getComponent(e)};sap.ui.component.load=function(e,t){p.warning("Do not use deprecated function 'sap.ui.component.load'! Use 'Component.load' instead");return j(e,{failOnError:t,preloadOnly:e.asyncHints&&e.asyncHints.preloadOnly})};function j(t,n){var a=n.activeTerminologies,o=t.name,s=t.url,u=sap.ui.getCore().getConfiguration(),d=/^(sync|async)$/.test(u.getComponentPreload()),l=t.manifest,g,m,h,M,_,b;function S(n,a){var r=JSON.parse(JSON.stringify(n));if(t.async){return O(r).then(function(t){return new e(t,a)})}else{return new e(r,a)}}function O(e){if(typeof w._fnPreprocessManifest==="function"&&e!=null){try{var n=r({},t);return w._fnPreprocessManifest(e,n)}catch(e){p.error("Failed to execute flexibility hook for manifest preprocessing.",e);return Promise.reject(e)}}else{return Promise.resolve(e)}}f(!s||typeof s==="string","sUrl must be a string or undefined");if(o&&typeof s==="string"){T(o,s)}c.setStepComponent(o);if(l===undefined){g=t.manifestFirst===undefined?u.getManifestFirst():!!t.manifestFirst;m=t.manifestUrl}else{if(t.async===undefined){t.async=true}g=!!l;m=l&&typeof l==="string"?l:undefined;h=l&&typeof l==="object"?S(l,{url:t&&t.altManifestUrl,activeTerminologies:a}):undefined}if(!h&&m){h=e.load({activeTerminologies:a,manifestUrl:m,componentName:o,processJson:O,async:t.async,failOnError:true})}if(h&&!t.async){o=h.getComponentName();if(o&&typeof s==="string"){T(o,s)}}if(!(h&&t.async)){if(!o){throw new Error("The name of the component is undefined.")}f(typeof o==="string","sName must be a string")}if(g&&!h){h=e.load({activeTerminologies:a,manifestUrl:P(o),componentName:o,async:t.async,processJson:O,failOnError:false})}function k(){return(o+".Component").replace(/\./g,"/")}function j(e){var t=o+".Component";if(!e){var a="The specified component controller '"+t+"' could not be found!";if(n.failOnError){throw new Error(a)}else{p.warning(a)}}if(h){var r=C(e.getMetadata(),h);var i=function(){var t=Array.prototype.slice.call(arguments);var n;if(t.length===0||typeof t[0]==="object"){n=t[0]=t[0]||{}}else if(typeof t[0]==="string"){n=t[1]=t[1]||{}}n._metadataProxy=r;if(M){n._manifestModels=M}var a=Object.create(e.prototype);e.apply(a,t);return a};i.getMetadata=function(){return r};i.extend=function(){throw new Error("Extending Components created by Manifest is not supported!")};return i}else{return e}}function N(e,t){f(typeof e==="string"&&e||typeof e==="object"&&typeof e.name==="string"&&e.name,"reference either must be a non-empty string or an object with a non-empty 'name' and an optional 'url' property");if(typeof e==="object"){if(e.url){T(e.name,e.url)}return e.lazy&&t!==true?undefined:e.name}return e}function D(e,t){var n=e+".Component",a=sap.ui.getCore().getConfiguration().getDepCache(),r,i,o;if(d&&e!=null&&!sap.ui.loader._.getModuleState(n.replace(/\./g,"/")+".js")){if(t){i=y._getTransitiveDependencyForComponent(e);if(i&&!i.hasOwnPreload){o=[i.library];Array.prototype.push.apply(o,i.dependencies);return sap.ui.getCore().loadLibraries(o,{preloadOnly:true})}else{r=n.replace(/\./g,"/")+(a?"-h2-preload.js":"-preload.js");return sap.ui.loader._.loadJSResourceAsync(r,true)}}try{r=n+"-preload";sap.ui.requireSync(r.replace(/\./g,"/"))}catch(e){p.warning("couldn't preload component from "+r+": "+(e&&e.message||e))}}else if(t){return Promise.resolve()}}function x(e,t,n){var a=[];var r=n?function(e){a.push(e)}:function(){};var i=t.getEntry("/sap.ui5/dependencies/libs");if(i){var o=[];for(var s in i){if(!i[s].lazy){o.push(s)}}if(o.length>0){p.info('Component "'+e+'" is loading libraries: "'+o.join(", ")+'"');r(sap.ui.getCore().loadLibraries(o,{async:n}))}}var u=t.getEntry("/sap.ui5/extends/component");if(u){r(D(u,n))}var c=[];var f=t.getEntry("/sap.ui5/dependencies/components");if(f){for(var e in f){if(!f[e].lazy){c.push(e)}}}var d=t.getEntry("/sap.ui5/componentUsages");if(d){for(var l in d){if(d[l].lazy===false&&c.indexOf(d[l].name)===-1){c.push(d[l].name)}}}if(c.length>0){c.forEach(function(e){r(D(e,n))})}return n?Promise.all(a):undefined}if(t.async){var A=t.asyncHints||{},I=[],R=function(e){e=e.then(function(e){return{result:e,rejected:false}},function(e){return{result:e,rejected:true}});return e},H=function(e){if(e){I.push(R(e))}},B=function(e){return e},F,W;F=[];if(Array.isArray(A.preloadBundles)){A.preloadBundles.forEach(function(e){F.push(sap.ui.loader._.loadJSResourceAsync(N(e,true),true))})}if(Array.isArray(A.libs)){W=A.libs.map(N).filter(B);F.push(sap.ui.getCore().loadLibraries(W,{preloadOnly:true}))}F=Promise.all(F);if(W&&!n.preloadOnly){F=F.then(function(){return sap.ui.getCore().loadLibraries(W)})}H(F);if(A.components){Object.keys(A.components).forEach(function(e){H(D(N(A.components[e]),true))})}if(!h){H(D(o,true))}else{var L=[];h=h.then(function(e){var t=e.getComponentName();if(typeof s==="string"){T(t,s)}e.defineResourceRoots();e._preprocess({resolveUI5Urls:true,i18nProperties:L});return e});if(n.createModels){H(h.then(function(e){_=E(e,t.componentData,A.cacheTokens,a);return e}).then(function(e){if(Object.keys(_.afterManifest).length>0){M=w._createManifestModels(_.afterManifest,e.getComponentName())}return e}))}H(h.then(function(e){var t=Promise.resolve();if(!e.getEntry("/sap.app/embeddedBy")){t=D(e.getComponentName(),true)}return t.then(function(){return e._processI18n(true,L)}).then(function(){if(!n.createModels){return null}var t=Object.keys(_.afterPreload);if(t.length===0){return null}return new Promise(function(e,t){sap.ui.require(["sap/ui/model/resource/ResourceModel"],function(t){e(t)},t)}).then(function(a){function r(t){var r=_.afterPreload[t];if(Array.isArray(r.settings)&&r.settings.length>0){var i=r.settings[0];i.activeTerminologies=n.activeTerminologies;return a.loadResourceBundle(i,true).then(function(e){i.bundle=e;delete i.terminologies;delete i.activeTerminologies;delete i.enhanceWith},function(n){p.error("Component Manifest: Could not preload ResourceBundle for ResourceModel. "+"The model will be skipped here and tried to be created on Component initialization.",'["sap.ui5"]["models"]["'+t+'"]',e.getComponentName());p.error(n);delete _.afterPreload[t]})}else{return Promise.resolve()}}return Promise.all(t.map(r)).then(function(){if(Object.keys(_.afterPreload).length>0){var t=w._createManifestModels(_.afterPreload,e.getComponentName());if(!M){M={}}for(var n in t){M[n]=t[n]}}})})})}));b=function(e){if(typeof w._fnLoadComponentCallback==="function"){var n=r({},t);var a=i({},e);try{w._fnLoadComponentCallback(n,a)}catch(t){p.error('Callback for loading the component "'+e.getComponentName()+'" run into an error. The callback was skipped and the component loading resumed.',t,"sap.ui.core.Component")}}}}return Promise.all(I).then(function(e){var t=[],n=false,a;n=e.some(function(e){if(e&&e.rejected){a=e.result;return true}t.push(e.result)});if(n){return Promise.reject(a)}return t}).then(function(e){if(h&&b){h.then(b)}return e}).then(function(e){p.debug("Component.load: all promises fulfilled, then "+e);if(h){return h.then(function(e){h=e;o=h.getComponentName();return x(o,h,true)})}else{return e}}).then(function(){if(n.preloadOnly){return true}return new Promise(function(e,t){sap.ui.require([k()],function(t){e(t)},t)}).then(function(t){var r=t.getMetadata();var i=r.getComponentName();var o=P(i);var s;if(h&&typeof l!=="object"&&(typeof m==="undefined"||m===o)){r._applyManifest(JSON.parse(JSON.stringify(h.getRawJson())))}s=U(r);return s.then(function(){var i=Promise.resolve();if(!h&&n.activeTerminologies){h=new e(r.getManifestObject().getRawJson(),{process:false,activeTerminologies:a});i=h._processI18n(true)}return i.then(j.bind(undefined,t))})})}).then(function(e){if(!h){return e}var t=[];var n;var r=h.getEntry("/sap.ui5/rootView");if(typeof r==="string"){n="XML"}else if(r&&typeof r==="object"&&r.type){n=r.type}if(n&&v[n]){var o="sap/ui/core/mvc/"+v[n]+"View";t.push(o)}var s=h.getEntry("/sap.ui5/routing");if(s&&s.routes){var u=h.getEntry("/sap.ui5/routing/config/routerClass")||"sap.ui.core.routing.Router";var c=u.replace(/\./g,"/");t.push(c)}var f=i({},h.getEntry("/sap.ui5/models"));var d=i({},h.getEntry("/sap.app/dataSources"));var l=w._createManifestModelConfigurations({models:f,dataSources:d,manifest:h,cacheTokens:A.cacheTokens,activeTerminologies:a});for(var g in l){if(!l.hasOwnProperty(g)){continue}var m=l[g];if(!m.type){continue}var y=m.type.replace(/\./g,"/");if(t.indexOf(y)===-1){t.push(y)}}if(t.length>0){return Promise.all(t.map(function(e){return new Promise(function(t,n){var a=false;function r(n){if(a){return}p.warning('Can not preload module "'+e+'". '+"This will most probably cause an error once the module is used later on.",h.getComponentName(),"sap.ui.core.Component");p.warning(n);a=true;t()}sap.ui.require([e],t,r)})})).then(function(){return e})}else{return e}}).then(function(e){var t=n.waitFor;if(t){var a=Array.isArray(t)?t:[t];return Promise.all(a).then(function(){return e})}return e}).catch(function(e){if(M){for(var t in M){var n=M[t];if(n&&typeof n.destroy==="function"){n.destroy()}}}throw e})}if(h){h.defineResourceRoots();h._preprocess({resolveUI5Urls:true});x(o,h)}D(o);return j(sap.ui.requireSync(k()))}if(Math.sqrt(2)<1){sap.ui.require(["sap/ui/core/Core"],function(){})}w.prototype.getCommand=function(e){var t,n=this._getManifestEntry("/sap.ui5/commands",true);if(n&&e){t=n[e]}return e?t:n};return w});