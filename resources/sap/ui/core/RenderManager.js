/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./LabelEnablement","sap/ui/base/Object","sap/ui/dom/patch","sap/ui/performance/trace/Interaction","sap/base/util/uid","sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/assert","sap/ui/performance/Measurement","sap/base/Log"],function(e,t,n,r,i,a,s,o,l,u,f){"use strict";var d=["renderControl","translate","getConfiguration","getHTML","cleanupControlWithoutRendering"];var c=["write","writeEscaped","writeAcceleratorKey","writeControlData","writeInvisiblePlaceholderData","writeElementData","writeAttribute","writeAttributeEscaped","addClass","writeClasses","addStyle","writeStyles","writeAccessibilityState","writeIcon"];var p=["openStart","openEnd","close","voidStart","voidEnd","text","attr","class","style","controlData","elementData","accessibilityState","invisiblePlaceholderData","icon","unsafeHtml"];var h=["render","flush","destroy"];var g=window["sap-ui-config"]&&window["sap-ui-config"]["xx-debugRendering"]||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search);function m(){var e=this,i,v,b,C,w,I;this._setFocusHandler=function(e){l(e&&t.isA(e,"sap.ui.core.FocusHandler"),"oFocusHandler must be an sap.ui.core.FocusHandler");i=e};function E(){v=e.aBuffer=[];b=e.aRenderedControls=[];C=e.aStyleStack=[{}]}this.write=function(e){l(typeof e==="string"||typeof e==="number","sText must be a string or number");v.push.apply(v,arguments);return this};this.writeEscaped=function(e,t){if(e!=null){e=o(String(e));if(t){e=e.replace(/&#xa;/g,"<br>")}v.push(e)}return this};this.writeAttribute=function(e,t){l(typeof e==="string","sName must be a string");l(typeof t==="string"||typeof t==="number"||typeof t==="boolean","value must be a string, number or boolean");v.push(" ",e,'="',t,'"');return this};this.writeAttributeEscaped=function(e,t){l(typeof e==="string","sName must be a string");v.push(" ",e,'="',o(String(t)),'"');return this};this.addStyle=function(e,t){l(typeof e==="string","sName must be a string");if(t!=null){l(typeof t==="string"||typeof t==="number","value must be a string or number");var n=C[C.length-1];if(!n.aStyle){n.aStyle=[]}n.aStyle.push(e+":"+t)}return this};this.writeStyles=function(){var e=C[C.length-1];if(e.aStyle){this.write(' style="'+e.aStyle.join(";")+'" ')}e.aStyle=null;return this};this.addClass=function(e){if(e){l(typeof e==="string","sName must be a string");var t=C[C.length-1];if(!t.aClasses){t.aClasses=[]}t.aClasses.push(e)}return this};this.writeClasses=function(e){l(!e||typeof e==="boolean"||t.isA(e,"sap.ui.core.Element"),"oElement must be empty, a boolean, or an sap.ui.core.Element");var n=C[C.length-1];var r;if(e){r=e.aCustomStyleClasses}else if(e===false){r=[]}else{r=n.aCustomStyleClasses}if(n.aClasses||r){var i=[].concat(n.aClasses||[],r||[]);i.sort();i=i.filter(function(e,t){return t==0||e!==i[t-1]});this.write(' class="',i.join(" "),'" ')}if(!e){n.aCustomStyleClasses=null}n.aClasses=null;return this};var D=false;var P=false;this.openStart=function(e){l(!D,"New must not be opened when last opened tag not yet closed with 'openEnd'");D=true;this.write("<"+e+" ");return this};this.openEnd=function(){D=false;this.writeClasses();this.writeStyles();this.write(">");return this};this.close=function(e){this.write("</"+e+">");return this};this.voidStart=function(e){P=true;this.openStart(e);return this};this.voidEnd=function(){l(P,"Closing a self-closing tag via 'voidEnd' must be preceded by a 'voidStart'");P=false;this.write("/");this.openEnd();return this};this.unsafeHtml=function(e){l(!D,"HTML can only be written when there's no tag open");this.write(e);return this};this.text=function(e){l(!D,"text can only be written when there's no tag open");this.writeEscaped(e);return this};this.controlData=function(e){l(D,"controlData can only be written when an opening tag has been started");this.writeControlData(e);return this};this.elementData=function(e){l(D,"elementData can only be written when an opening tag has been started");this.writeElementData(e);return this};this.attr=function(e,t){l(e!=="class"&&e!=="style","attributes 'class' and 'style' must not be written, use methods 'class' and 'style' instead");this.writeAttributeEscaped(e,t);return this};this.class=function(e){l(typeof e==="string"&&!/\s/.test(e)&&arguments.length===1,"method class must be called with exactly one class name");for(var t=0;t<arguments.length;t++){this.addClass(arguments[t])}return this};this.style=function(e,t){l(typeof e==="string"&&e&&!/\s/.test(e),"method style must be called with a non-empty string name");this.addStyle(e,t);return this};this.accessibilityState=this.writeAccessibilityState;this.invisiblePlaceholderData=this.writeInvisiblePlaceholderData;this.icon=this.writeIcon;function A(e){I=true;try{var t=s.Event("BeforeRendering");t.srcControl=e;e._handleEvent(t)}finally{I=false}}this.cleanupControlWithoutRendering=function(e){l(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e||!e.getDomRef()){return}A(e);e.bOutput=false};this.renderControl=function(e){l(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e){return this}if(!w){w=[]}if(w&&w.length>0){u.pause(w[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){u.pause(e.getParent().getId()+"---rerender")}w.unshift(e.getId());u.start(e.getId()+"---renderControl","Rendering of "+e.getMetadata().getName(),["rendering","control"]);var n=v.length;var r={};if(e.aCustomStyleClasses&&e.aCustomStyleClasses.length>0){r.aCustomStyleClasses=e.aCustomStyleClasses}C.push(r);u.pause(e.getId()+"---renderControl");var i;var a=e.getMetadata();var o=e.getVisible();if(o){i=a.getRenderer()}else{var d=a.getProperty("visible");var c=d&&d._oParent&&d._oParent.getName()=="sap.ui.core.Control";i=c?R:a.getRenderer()}u.resume(e.getId()+"---renderControl");A(e);var p=e.aBindParameters;if(p&&p.length>0){var h=s(e.getDomRef());if(h&&h[0]){for(var g=0;g<p.length;g++){var m=p[g];h.unbind(m.sEventType,m.fnProxy)}}}if(i&&typeof i.render==="function"){var y=N;i.render(y,e)}else{f.error("The renderer for class "+a.getName()+" is not defined or does not define a render function! Rendering of "+e.getId()+" will be skipped!")}C.pop();b.push(e);if(e.getUIArea&&e.getUIArea()){e.getUIArea()._onControlRendered(e)}e.bOutput=v.length!=n;if(i===R){e.bOutput="invisible"}u.end(e.getId()+"---renderControl");w.shift();if(w&&w.length>0){u.resume(w[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){u.resume(e.getParent().getId()+"---rerender")}return this};this.getHTML=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");var n=v;var r=v=this.aBuffer=[];this.renderControl(e);v=this.aBuffer=n;return r.join("")};function T(e){var t,n=b.length;for(t=0;t<n;t++){b[t]._sapui_bInAfterRenderingPhase=true}I=true;try{for(t=0;t<n;t++){var r=b[t];if(r.bOutput&&r.bOutput!=="invisible"){var a=s.Event("AfterRendering");a.srcControl=r;u.start(r.getId()+"---AfterRendering","AfterRendering of "+r.getMetadata().getName(),["rendering","after"]);r._handleEvent(a);u.end(r.getId()+"---AfterRendering")}}}finally{for(t=0;t<n;t++){delete b[t]._sapui_bInAfterRenderingPhase}I=false}try{i.restoreFocus(e)}catch(e){f.warning("Problems while restoring the focus after rendering: "+e,null)}for(t=0;t<n;t++){var r=b[t],o=r.aBindParameters;if(o&&o.length>0){var l=s(r.getDomRef());if(l&&l[0]){for(var d=0;d<o.length;d++){var c=o[d];l.bind(c.sEventType,c.fnProxy)}}}}}function x(e){var t=i?i.getControlFocusInfo():null;var n=v.join("");e(n);T(t);E();a.refresh();r.notifyStepEnd()}this.flush=function(e,t,n){l(typeof e==="object"&&e.ownerDocument==document,"oTargetDomNode must be a DOM element");if(!t&&typeof n!=="number"&&!n){m.preserveContent(e)}x(function(t){for(var r=0;r<b.length;r++){var i=b[r].getDomRef();if(i&&!m.isPreservedContent(i)){if(m.isInlineTemplate(i)){s(i).empty()}else{s(i).remove()}}}if(typeof n==="number"){if(n<=0){s(e).prepend(t)}else{var a=s(e).children().eq(n-1);if(a.length===1){a.after(t)}else{s(e).append(t)}}}else if(!n){s(e).html(t)}else{s(e).append(t)}})};this.render=function(e,r){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be a control");l(typeof r==="object"&&r.ownerDocument==document,"oTargetDomNode must be a DOM element");if(I){f.error("Render must not be called within Before or After Rendering Phase. Call ignored.",null,this);return}E();this.renderControl(e);x(function(t){if(e&&r){var i=e.getDomRef();if(!i||m.isPreservedContent(i)){i=(y.Invisible+e.getId()?window.document.getElementById(y.Invisible+e.getId()):null)||(y.Dummy+e.getId()?window.document.getElementById(y.Dummy+e.getId()):null)}var a=i&&i.parentNode!=r;var o=function(){var e=s(r);if(r.innerHTML==""){e.html(t)}else{e.append(t)}};if(a){if(!m.isPreservedContent(i)){if(m.isInlineTemplate(i)){s(i).empty()}else{s(i).remove()}}if(t){o()}}else{if(t){if(i){if(m.isInlineTemplate(i)){s(i).html(t)}else if(S()){var l=s.parseHTML(t)[0];s.cleanData([i]);s.cleanData(i.getElementsByTagName("*"));n(i,l)}else{s(i).replaceWith(t)}}else{o()}}else{if(m.isInlineTemplate(i)){s(i).empty()}else{if(!e.getParent()||!e.getParent()._onChildRerenderedEmpty||!e.getParent()._onChildRerenderedEmpty(e,i)){s(i).remove()}}}}}})};this.destroy=function(){E()};var M={};var N={};var B={};d.forEach(function(t){M[t]=N[t]=B[t]=e[t]});p.forEach(function(t){N[t]=B[t]=e[t]});c.forEach(function(t){M[t]=B[t]=e[t];if(g){N[t]=function(){f.error("**** calling legacy render method "+t);return e[t].apply(this,arguments)}}else{N[t]=e[t]}});h.forEach(function(t){B[t]=e[t]});this.getRendererInterface=function(){return N};this.getInterface=function(){return B};E()}m.prototype.getConfiguration=function(){return sap.ui.getCore().getConfiguration()};m.prototype.translate=function(e){};m.prototype.writeAcceleratorKey=function(){return this};m.prototype.writeControlData=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");this.writeElementData(e);return this};m.prototype.writeInvisiblePlaceholderData=function(e){l(t.isA(e,"sap.ui.core.Element"),"oElement must be an instance of sap.ui.core.Element");var n=m.createInvisiblePlaceholderId(e),r=" "+'id="'+n+'" '+'class="sapUiHiddenPlaceholder" '+'data-sap-ui="'+n+'" '+'style="display: none;"'+'aria-hidden="true" ';this.write(r);return this};m.prototype.writeElementData=function(e){l(e&&t.isA(e,"sap.ui.core.Element"),"oElement must be an sap.ui.core.Element");var n=e.getId();if(n){this.attr("id",n);this.attr("data-sap-ui",n)}var r=e.getCustomData();var i=r.length;for(var a=0;a<i;a++){var s=r[a]._checkWriteToDom(e);if(s){this.attr(s.key,s.value)}}var o=e.getDragDropConfig().some(function(t){return t.isDraggable(e)});if(!o){var u=e.getParent();if(u&&u.getDragDropConfig){o=u.getDragDropConfig().some(function(t){return t.isDraggable(e)})}}if(o){this.attr("draggable","true");this.attr("data-sap-ui-draggable","true")}return this};m.prototype.writeAccessibilityState=function(n,r){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return this}if(arguments.length==1&&!t.isA(n,"sap.ui.core.Element")){r=n;n=null}var i={};if(n!=null){var a=n.getMetadata();var o=function(e,t,r){var s=a.getProperty(e);if(s&&n[s._sGetter]()===r){i[t]="true"}};var l=function(t,r){var s=a.getAssociation(t);if(s&&s.multiple){var o=n[s._sGetter]();if(t=="ariaLabelledBy"){var l=e.getReferencingLabels(n);var u=l.length;if(u){var f=[];for(var d=0;d<u;d++){if(o.indexOf(l[d])<0){f.push(l[d])}}o=f.concat(o)}}if(o.length>0){i[r]=o.join(" ")}}};o("editable","readonly",false);o("enabled","disabled",false);o("visible","hidden",false);if(e.isRequired(n)){i["required"]="true"}o("selected","selected",true);o("checked","checked",true);l("ariaDescribedBy","describedby");l("ariaLabelledBy","labelledby")}if(r){var u=function(e){var t=typeof e;return e===null||e===""||t==="number"||t==="string"||t==="boolean"};var f={};var d,c,p;for(d in r){c=r[d];if(u(c)){f[d]=c}else if(typeof c==="object"&&u(c.value)){p="";if(c.append&&(d==="describedby"||d==="labelledby")){p=i[d]?i[d]+" ":""}f[d]=p+c.value}}s.extend(i,f)}if(t.isA(n,"sap.ui.core.Element")&&n.getParent()&&n.getParent().enhanceAccessibilityState){n.getParent().enhanceAccessibilityState(n,i)}for(var h in i){if(i[h]!=null&&i[h]!==""){this.attr(h==="role"?h:"aria-"+h,i[h])}}return this};m.prototype.writeIcon=function(e,t,n){var r=sap.ui.requireSync("sap/ui/core/IconPool"),a=r.isIconURI(e),l=a?"span":"img",u=false,d,c,p,h,g;var m=this;if(typeof t==="string"){t=[t]}if(a){c=r.getIconInfo(e);if(!c){f.error("An unregistered icon: "+e+" is used in sap.ui.core.RenderManager's writeIcon method.");return this}if(!t){t=[]}t.push("sapUiIcon");if(!c.suppressMirroring){t.push("sapUiIconMirrorInRTL")}}this.openStart(l);if(Array.isArray(t)&&t.length){t.forEach(function(e){m.class(e)})}if(a){p={"data-sap-ui-icon-content":c.content,role:"presentation",title:c.text||null};this.style("font-family","'"+o(c.fontFamily)+"'")}else{p={role:"presentation",alt:"",src:e}}n=s.extend(p,n);if(!n.id){n.id=i()}if(a){h=n.alt||n.title||c.text||c.name;g=n.id+"-label";if(n["aria-labelledby"]){u=true;n["aria-labelledby"]+=" "+g}else if(!n.hasOwnProperty("aria-label")){n["aria-label"]=h}}if(typeof n==="object"){for(d in n){if(n.hasOwnProperty(d)&&n[d]!==null){this.attr(d,n[d])}}}if(a){this.openEnd(l);if(u){this.openStart("span");this.style("display","none");this.attr("id",g);this.openEnd("span");this.text(h);this.close("span")}this.close("span")}else{this.openEnd()}return this};m.prototype.getRenderer=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return m.getRenderer(e)};var y=m.RenderPrefixes={Invisible:"sap-ui-invisible-",Dummy:"sap-ui-dummy-",Temporary:"sap-ui-tmp-"};m.getRenderer=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return e.getMetadata().getRenderer()};m.forceRepaint=function(e){var t=e?window.document.getElementById(e):null;var n=typeof e=="string"?t:e;if(n){f.debug("forcing a repaint for "+(n.id||String(n)));var r=n.style.display;var i=document.activeElement;n.style.display="none";n.offsetHeight;n.style.display=r;if(document.activeElement!==i&&i){i.focus()}}};m.createInvisiblePlaceholderId=function(e){return y.Invisible+e.getId()};var v="sap-ui-preserve",b="sap-ui-static",C="data-sap-ui-preserve",w="data-sap-ui-area";function I(){var e=s(document.getElementById(v));if(e.length===0){e=s("<DIV/>",{"aria-hidden":"true",id:v}).addClass("sapUiHidden").addClass("sapUiForcedHidden").css("width","0").css("height","0").css("overflow","hidden").appendTo(document.body)}return e}function E(e){s("<DIV/>",{id:y.Dummy+e.id}).addClass("sapUiHidden").insertBefore(e)}var D=[];m.attachPreserveContent=function(e,t){m.detachPreserveContent(e);D.push({fn:e,context:t})};m.detachPreserveContent=function(e){D=D.filter(function(t){return t.fn!==e})};m.preserveContent=function(e,t,n){l(typeof e==="object"&&e.ownerDocument==document,"oRootNode must be a DOM element");D.forEach(function(t){t.fn.call(t.context||m,{domNode:e})});var r=I();function i(t){while(t&&t!=e&&t.parentNode){t=t.parentNode;if(t.hasAttribute(C)){return true}if(t.hasAttribute("data-sap-ui")){break}}}function a(t){if(t.id===v||t.id===b){return}if(t.hasAttribute(C)){if(t===e||i(t)){E(t)}r.append(t)}else if(n&&t.id){m.markPreservableContent(s(t),t.id);r.append(t);return}if(!t.hasAttribute(w)){var o=t.firstChild;while(o){t=o;o=o.nextSibling;if(t.nodeType===1){a(t)}}}}u.start(e.id+"---preserveContent","preserveContent for "+e.id,["rendering","preserve"]);if(t){a(e)}else{s(e).children().each(function(e,t){a(t)})}u.end(e.id+"---preserveContent")};m.findPreservedContent=function(e){l(typeof e==="string","sId must be a string");var t=I(),n=t.children("["+C+"='"+e.replace(/(:|\.)/g,"\\$1")+"']");return n};m.markPreservableContent=function(e,t){e.attr(C,t)};m.isPreservedContent=function(e){return e&&e.getAttribute(C)&&e.parentNode&&e.parentNode.id==v};m.getPreserveAreaRef=function(){return I()[0]};var P="data-sap-ui-template";m.markInlineTemplate=function(e){e.attr(P,"")};m.isInlineTemplate=function(e){return e&&e.hasAttribute(P)};var A;function S(){if(A===undefined){A=sap.ui.getCore().getConfiguration().getDomPatching();if(A){f.warning("DOM Patching is enabled: This feature should be used only for testing purposes!")}}return A}var R={render:function(e,t){e.openStart("span");e.invisiblePlaceholderData(t);e.openEnd();e.close("span")}};return m},true);