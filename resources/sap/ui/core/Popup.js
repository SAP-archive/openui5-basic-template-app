/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/base/Object","sap/ui/base/ObjectPool","./Control","./IntervalTrigger","./RenderManager","./Element","./ResizeHandler","./library","sap/base/assert","sap/base/Log","sap/base/util/Version","sap/base/util/uid","sap/base/util/extend","sap/base/util/deepExtend","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/events/F6Navigation","sap/ui/events/isMouseEventDelayed","sap/ui/base/EventProvider","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable","sap/ui/dom/jquery/rect"],function(t,e,i,o,s,n,r,a,l,u,f,p,h,d,c,_,g,y,m,b,v){"use strict";var C=u.CSSSize;var S=u.OpenState;var E;function I(){if(E){return E}var t,e;try{t=sap.ui.getCore().getStaticAreaRef();E=sap.ui.getCore().getUIArea(t)}catch(t){p.error(t);throw new Error("Popup cannot be opened because static UIArea cannot be determined.")}e=new s;E.addDependent(e);E=e.getUIArea();e.destroy();return E}var P=e.extend("sap.ui.core.Popup",{constructor:function(t,i,o,s){f(arguments.length==0||t&&typeof t==="object","oContent must be an object or there may be no arguments at all");f(i===undefined||i===true||i===false,"bModal must be true, false, or undefined");f(o===undefined||o===true||o===false,"bShadow must be true, false, or undefined");f(s===undefined||s===true||s===false,"bAutoClose must be true, false, or undefined");e.apply(this);this._popupUID=d();this.bOpen=false;this.eOpenState=S.CLOSED;this._mEvents={};this._mEvents["sap.ui.core.Popup.addFocusableContent-"+this._popupUID]=this._addFocusableArea;this._mEvents["sap.ui.core.Popup.removeFocusableContent-"+this._popupUID]=this._removeFocusableArea;this._mEvents["sap.ui.core.Popup.closePopup-"+this._popupUID]=this._closePopup;this._mEvents["sap.ui.core.Popup.onFocusEvent-"+this._popupUID]=this.onFocusEvent;this._mEvents["sap.ui.core.Popup.increaseZIndex-"+this._popupUID]=this._increaseMyZIndex;this._mEvents["sap.ui.core.Popup.contains-"+this._popupUID]=this._containsEventBusWrapper;if(t){this.setContent(t)}this._oDefaultPosition={my:P.Dock.CenterCenter,at:P.Dock.CenterCenter,of:document,offset:"0 0",collision:"flip"};this._oPosition=Object.assign({},this._oDefaultPosition);this._bModal=!!i;this._oPreviousFocus=null;this._sInitialFocusId=null;this._bShadow=typeof o==="boolean"?o:true;this._bAutoClose=!!s;this._animations={open:null,close:null};this._durations={open:"fast",close:"fast"};this._iZIndex=-1;this._oBlindLayer=null;this.setNavigationMode();if(this.touchEnabled){this._fAutoCloseHandler=function(t){if(t.isMarked("delayedMouseEvent")||t.isMarked("cancelAutoClose")){return}if(this.eOpenState===S.CLOSING||this.eOpenState===S.CLOSED){return}if(!this._contains(t.target)){this.close()}}}this._F6NavigationHandler=function(t){var e={},i=this._sF6NavMode,o;if(i=="DOCK"){if(this._bModal){i="NONE"}else if(this._oLastPosition&&this._oLastPosition.of){o=this._getOfDom(this._oLastPosition.of);if(!o||o===document){o=null;i="NONE"}}}switch(i){case"SCOPE":e.scope=this._$()[0];break;case"DOCK":e.target=o;var s=y(o).parents("[data-sap-ui-popup]");e.scope=s.length?s[0]:null;break;default:e.skip=true}m.handleF6GroupNavigation(t,e)}},metadata:{library:"sap.ui.core",publicMethods:["open","close","setContent","getContent","setPosition","setShadow","setModal","getModal","setAutoClose","setAutoCloseAreas","setExtraContent","isOpen","getAutoClose","getOpenState","setAnimations","setDurations","attachOpened","attachClosed","detachOpened","detachClosed"],associations:{childPopups:{type:"sap.ui.core.Popup",multiple:true,visibility:"hidden"}},events:{opened:{},closed:{}}}});P.prototype.getChildPopups=function(){return this.getAssociation("childPopups",[])};P.prototype.addChildPopup=function(t){return this.addAssociation("childPopups",t)};P.prototype.removeChildPopup=function(t){return this.removeAssociation("childPopups",t)};P._activateBlindLayer=true;P.blStack=[];P.Dock={BeginTop:"begin top",BeginCenter:"begin center",BeginBottom:"begin bottom",LeftTop:"left top",LeftCenter:"left center",LeftBottom:"left bottom",CenterTop:"center top",CenterCenter:"center center",CenterBottom:"center bottom",RightTop:"right top",RightCenter:"right center",RightBottom:"right bottom",EndTop:"end top",EndCenter:"end center",EndBottom:"end bottom"};P.prototype.touchEnabled=t.support.touch&&(t.browser.safari||!t.system.combi);P.prototype.preventBrowserFocus=t.support.touch&&!t.system.combi;i.extend("sap.ui.core.Popup.Layer",{constructor:function(){var t=this.getDomString();this._$Ref=y(t).appendTo(sap.ui.getCore().getStaticAreaRef())}});P.Layer.prototype.init=function(t,e){this._$Ref.css({visibility:"visible","z-index":e});this.update(t,e);this._$Ref.insertAfter(t).show()};P.Layer.prototype.update=function(t,e){if(t.length){var i=t.rect();this._$Ref.css({left:i.left,top:i.top});if(t.css("right")!="auto"&&t.css("right")!="inherit"){this._$Ref.css({right:t.css("right"),width:"auto"})}else{this._$Ref.css({width:i.width,right:"auto"})}if(t.css("bottom")!="auto"&&t.css("bottom")!="inherit"){this._$Ref.css({bottom:t.css("bottom"),height:"auto"})}else{this._$Ref.css({height:i.height,bottom:"auto"})}if(typeof e==="number"){this._$Ref.css("z-index",e)}}};P.Layer.prototype.reset=function(){if(this._$Ref.length){this._$Ref[0].style.display="none";this._$Ref[0].style.visibility="hidden";this._$Ref.appendTo(sap.ui.getCore().getStaticAreaRef())}};P.Layer.prototype.getDomString=function(){p.error("sap.ui.core.Popup.Layer: getDomString function must be overwritten!");return""};P.Layer.extend("sap.ui.core.Popup.BlindLayer",{constructor:function(){P.Layer.apply(this)}});P.BlindLayer.prototype.getDomString=function(){return'<div class="sapUiBliLy" id="sap-ui-blindlayer-'+d()+'"><iframe scrolling="no" tabIndex="-1"></iframe></div>'};P.prototype.oBlindLayerPool=new o(P.BlindLayer);P.Layer.extend("sap.ui.core.Popup.ShieldLayer",{constructor:function(){P.Layer.apply(this)}});P.ShieldLayer.prototype.getDomString=function(){return'<div class="sapUiPopupShield" id="sap-ui-shieldlayer-'+d()+'"></div>'};P.prototype.oShieldLayerPool=new o(P.ShieldLayer);(function(){var t=0;var e=Math.pow(2,32)-1;P.setInitialZIndex=function(i){if(i>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}t=Math.max(i,this.getLastZIndex())};P.getLastZIndex=function(){return t};P.prototype.getLastZIndex=function(){return P.getLastZIndex()};P.getNextZIndex=function(){t+=10;if(t>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}return t};P.prototype.getNextZIndex=function(){return P.getNextZIndex()}})();var O=function(t,e){if(!t&&e||t&&!e){return false}if(!t&&!e){return true}var i=3;var o=Math.abs(t.left-e.left);var s=Math.abs(t.top-e.top);var n=Math.abs(t.width-e.width);var r=Math.abs(t.height-e.height);if(o>i||s>i||n>i||r>i){return false}return true};P.prototype.open=function(t,e,i,o,n,r,l){f(this.oContent,"Popup content must have been set by now");if(this.eOpenState!=S.CLOSED){return}this.eOpenState=S.OPENING;var u=I(),h;this._bContentAddedToStatic=false;this._bUIAreaPatched=false;if(this.oContent instanceof s){if(!this.oContent.getParent()){u.addContent(this.oContent,true);this._bContentAddedToStatic=true}else if(!this.oContent.getUIArea()){this.oContent.getUIArea=function(){return u};this._bUIAreaPatched=true}h=this.oContent.getUIArea();if(P._bEnableUIAreaCheck&&h.getRootNode().id!==u.getRootNode().id){p.warning("The Popup content is NOT connected with the static-UIArea and may not work properly!")}}if(typeof t=="string"){l=r;r=n;n=o;o=i;i=e;e=t;t=-1}if(t===undefined){t=-1}f(t===-1||typeof t==="number"&&t%1==0,"iDuration must be an integer (or omitted)");f(e===undefined||typeof e==="string","my must be a string or empty");f(i===undefined||typeof i==="string","at must be a string or empty");f(!o||typeof o==="object"||typeof o==="function","of must be empty or an object");f(!n||typeof n==="string","offset must be empty or a string");f(!r||typeof r==="string","collision must be empty or a string");this._oPreviousFocus=P.getCurrentFocusInfo();if(this.isInPopup(o)||this.isInPopup(this._oPosition.of)){var d=this.getParentPopupId(o)||this.getParentPopupId(this._oPosition.of);var c="";var _=this.getContent();if(_ instanceof a){c=_.getId()}else if(typeof _==="object"){c=_.id}this.addChildToPopup(d,c);this.addChildToPopup(d,this._popupUID)}var g=this._$(true);var y="fast";if(t===0||t>0){y=t}else if(this._durations.open===0||this._durations.open>0){y=this._durations.open}var m;if(e||i||o||n||r){m=this._createPosition(e,i,o,n,r);this._oPosition=m}else{m=this._oPosition}if(!m.of){m.of=this._oPosition.of||document}this._iZIndex=this._iZIndex===this.getLastZIndex()?this._iZIndex:this.getNextZIndex();var b=sap.ui.getCore().getStaticAreaRef();g.css({position:"absolute",visibility:"hidden"});if(!(g[0].parentNode==b)){g.appendTo(b)}g.css("z-index",this._iZIndex);p.debug("position popup content "+g.attr("id")+" at "+JSON.stringify(m.at));this._applyPosition(m);if(l!==undefined){this.setFollowOf(l)}g.toggleClass("sapUiShd",this._bShadow);var v=g[0];if(v){v.style.display="none";v.style.visibility="visible"}var C=y==0;this._duringOpen(!C);if(C){this._opened()}else if(this._animations.open){this._animations.open.call(null,g,y,this._opened.bind(this))}else{g.fadeIn(y,this._opened.bind(this))}};P.prototype._getDomRefToFocus=function(){var t=this._$(false,true),e,i;if(this._shouldGetFocusAfterOpen()){if(this._sInitialFocusId){i=sap.ui.getCore().byId(this._sInitialFocusId);if(i){e=i.getFocusDomRef()}e=e||window.document.getElementById(this._sInitialFocusId)}e=e||t.firstFocusableDomRef()}return e};P.prototype._opened=function(){if(this.eOpenState!==S.OPENING){return}this.bOpen=true;var t=this._$(false,true);if(t[0]&&t[0].style){t[0].style.display="block"}if(this._shouldGetFocusAfterOpen()){var e=this._getDomRefToFocus();if(e){e.focus()}var i=this._getOfDom(this._oLastPosition.of);var o=y(i).rect();if(this._oLastOfRect&&o&&!O(this._oLastOfRect,o)){this._applyPosition(this._oLastPosition)}}this.eOpenState=S.OPEN;if(this.getFollowOf()){P.DockTrigger.addListener(P.checkDocking,this)}this._updateBlindLayer();this.fireOpened()};P.prototype._duringOpen=function(e){var i=this._$(false,true),o=sap.ui.getCore().getStaticAreaRef(),s=document.getElementById(o.id+"-firstfe");P._clearSelection();this._setupUserSelection();if(b()){if(this._oTopShieldLayer){clearTimeout(this._iTopShieldRemoveTimer);this._iTopShieldRemoveTimer=null}else{this._oTopShieldLayer=this.oShieldLayerPool.borrowObject(i,this._iZIndex+1)}this._iTopShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}.bind(this),500)}if(!!t.browser.msie&&!t.os.windows_phone&&P._activateBlindLayer){this._oBlindLayer=this.oBlindLayerPool.borrowObject(i,this._iZIndex-1)}if(this._bModal){this._showBlockLayer()}if(e&&s&&this._shouldGetFocusAfterOpen()&&!this.isInPopup(document.activeElement)&&this._getDomRefToFocus()!==document.activeElement){s.focus({preventScroll:true})}if(this.oContent instanceof a){this.oContent.addDelegate(this)}this.bOpen=true;this._activateFocusHandle();this._$(false,true).on("keydown",y.proxy(this._F6NavigationHandler,this));if(this._oBlindLayer){this._resizeListenerId=l.register(this._$().get(0),y.proxy(this.onresize,this))}};P.prototype._shouldGetFocusAfterOpen=function(){return this._bModal||this._bAutoClose||this._sInitialFocusId};P.prototype._contains=function(t){var e=this._$().get(0);if(!e){return false}var i=g(e,t);var o;if(!i){o=this.getChildPopups();i=o.some(function(e){var i=e?window.document.getElementById(e):null;var o=g(i,t);if(!o){var s="sap.ui.core.Popup.contains-"+e;var n={domRef:t};sap.ui.getCore().getEventBus().publish("sap.ui",s,n);o=n.contains}return o})}if(!i){x.forEach(function(e){i=i||y(t).closest(e).length>0})}return i};P.prototype._containsEventBusWrapper=function(t,e,i){i.contains=this._contains(i.domRef)};P.prototype.onFocusEvent=function(e){var i=y.event.fix(e);if(arguments.length>1&&arguments[1]==="sap.ui.core.Popup.onFocusEvent-"+this._popupUID){i=y.event.fix(arguments[2])}var o=i.type=="focus"||i.type=="activate"?"focus":"blur";var s=false;if(o=="focus"){var n=this._$().get(0);if(n){s=this._contains(i.target);p.debug("focus event on "+i.target.id+", contains: "+s);if(this._bModal&&!s){var r=P.blStack.length>0&&P.blStack[P.blStack.length-1].popup===this;if(r){if(t.system.desktop||y(i.target).is(":input")){if(this.oLastBlurredElement){setTimeout(function(){if(this.oLastBlurredElement){this.oLastBlurredElement.focus()}}.bind(this),0)}else{n.focus()}}}}else if(this._bAutoClose&&s&&this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null}}}else if(o=="blur"){p.debug("blur event on "+i.target.id);if(this._bModal){this.oLastBlurredElement=i.target}else if(this._bAutoClose){if(!this.touchEnabled&&!this._sTimeoutId){if(i.target===document.activeElement){return}var a=typeof this._durations.close==="string"?0:this._durations.close;this._sTimeoutId=setTimeout(function(){this.close(a,"autocloseBlur");var t=this._oLastPosition&&this._oLastPosition.of;if(t){var e=this.getParentPopupId(t);if(e){var o="sap.ui.core.Popup.onFocusEvent-"+e;sap.ui.getCore().getEventBus().publish("sap.ui",o,i)}}}.bind(this),a)}}}};P.prototype.setInitialFocusId=function(t){f(!t||typeof t==="string","sId must be a string or empty");this._sInitialFocusId=t};P.prototype.close=function(t){if(P._autoCloseDebug){return}if(this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null;if(arguments.length>1){var e=arguments[1];if(typeof e=="string"&&e=="autocloseBlur"&&this._isFocusInsidePopup()){return}}}f(t===undefined||typeof t==="number"&&t%1==0,"iDuration must be empty or an integer");if(this.eOpenState==S.CLOSED||this.eOpenState==S.CLOSING){return}var i="fast";if(t===0||t>0){i=t}else if(this._durations.close===0||this._durations.close>0){i=this._durations.close}this.eOpenState=S.CLOSING;if(this.getFollowOf()){P.DockTrigger.removeListener(P.checkDocking,this)}if(this.oContent){if(this._bContentAddedToStatic){sap.ui.getCore().getEventBus().publish("sap.ui","__beforePopupClose",{domNode:this._$().get(0)});var o=sap.ui.getCore().getStaticAreaRef();o=sap.ui.getCore().getUIArea(o);o.removeContent(o.indexOfContent(this.oContent),true)}else if(this._bUIAreaPatched){delete this.oContent.getUIArea}}this._bContentAddedToStatic=false;this._bUIAreaPatched=false;this._sTimeoutId=null;this._deactivateFocusHandle();this._$(false,true).off("keydown",this._F6NavigationHandler);if(this.oContent instanceof a){this.oContent.removeDelegate(this)}var s=this._$();if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._oBlindLayer){this.oBlindLayerPool.returnObject(this._oBlindLayer)}this._oBlindLayer=null;if(b()){if(this._oBottomShieldLayer){clearTimeout(this._iBottomShieldRemoveTimer);this._iBottomShieldRemoveTimer=null}else{this._oBottomShieldLayer=this.oShieldLayerPool.borrowObject(s,this._iZIndex-3)}this._iBottomShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}.bind(this),500)}if(this.isInPopup(this._oLastPosition.of)){var n=this.getParentPopupId(this._oLastPosition.of);var r="";var l=this.getContent();if(l instanceof a){r=l.getId()}else if(typeof l==="object"){r=l.id}this.removeChildFromPopup(n,r);this.removeChildFromPopup(n,this._popupUID)}if(this._bModal&&this.preventBrowserFocus){s.one("mousedown",function(t){t.preventDefault()})}this._duringClose();if(i==0){this._closed()}else if(this._animations.close){this._animations.close.call(null,s,i,this._closed.bind(this))}else{s.fadeOut(i,this._closed.bind(this))}};P.prototype._closed=function(){var t=this._$(false,true);if(this._bModal){this._hideBlockLayer()}P._clearSelection();this._restoreUserSelection();if(t.length){var e=t.get(0);if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}t=this._$(false,true);e=t.length?t[0]:null;if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}}if(this._bModal){P.applyFocusInfo(this._oPreviousFocus);this._oPreviousFocus=null;this.oLastBlurredElement=null}this.bOpen=false;this.eOpenState=S.CLOSED;var i=this.getChildPopups();for(var o=0,s=i.length;o<s;o++){this.closePopup(i[o])}this.fireClosed()};P.prototype._duringClose=function(){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}};P.getCurrentFocusInfo=function(){var t=null;var e=sap.ui.getCore().getCurrentFocusedControlId();if(e){var i=sap.ui.getCore().byId(e);t={sFocusId:e,oFocusInfo:i?i.getFocusInfo():{}}}else{try{var o=document.activeElement;if(o&&o.nodeName){t={sFocusId:o.id,oFocusedElement:o,oFocusInfo:{}}}}catch(e){t=null}}if(t){t.popup=this}return t};P.applyFocusInfo=function(t){var e={preventScroll:true};if(t){var i=sap.ui.getCore().byId(t.sFocusId);if(i){i.applyFocusInfo(Object.assign(e,t.oFocusInfo))}else{var o=(t.sFocusId?window.document.getElementById(t.sFocusId):null)||t.oFocusedElement;if(o){o.focus(e)}}}};P.prototype.setContent=function(t){f(typeof t==="object","oContent must be an object");this.oContent=t;return this};P.prototype.getContent=function(){return this.oContent};P.prototype.setPosition=function(t,e,i,o,s){f(typeof t==="string","my must be a string");f(typeof e==="string"||typeof e==="object"&&typeof e.left==="number"&&typeof e.top==="number","my must be a string or an object with 'left' and 'top' properties");f(!i||typeof i==="object"||typeof i==="function","of must be empty or an object");f(!o||typeof o==="string","offset must be empty or a string");f(!s||typeof s==="string","collision must be empty or a string");this._oPosition=this._createPosition(t,e,i,o,s);if(this.eOpenState!=S.CLOSED){this._applyPosition(this._oPosition);this._oBlindLayer&&this._oBlindLayer.update(this._$())}return this};P.prototype._createPosition=function(t,e,i,o,s){var n=false;if(t&&(t.indexOf("+")>=0||t.indexOf("-")>=0)){n=true;if(o&&o!="0 0"){p.warning("offset used in my and in offset, the offset value will be ignored","sap.ui.core.Popup","setPosition")}o=null}var r=c({},this._oDefaultPosition,{my:t||this._oDefaultPosition.my,at:e||this._oDefaultPosition.at,of:i,offset:o,collision:s});if(!y.ui.version){if(P._bNewOffset==null){P._bNewOffset=true;var a=y(document.createElement("div"));a.position({of:window,using:function(t,e){P._bNewOffset=e!==undefined}})}}var l=[];var u=[];if(P._bNewOffset||h(y.ui.version).compareTo("1.8.23")>0){if(o&&o!="0 0"){l=r.my.split(" ");u=o.split(" ");var f=[parseInt(u[0])<0?"":"+",parseInt(u[1])<0?"":"+"];r.my=l[0]+f[0]+u[0]+" "+l[1]+f[1]+u[1];r.offset=null}}else if(n){l=r.my.split(" ");u=["",""];var d=l[0].indexOf("+");if(d<0){d=l[0].indexOf("-")}if(d>=0){u[0]=l[0].slice(d);l[0]=l[0].slice(0,d)}d=l[1].indexOf("+");if(d<0){d=l[1].indexOf("-")}if(d>=0){u[1]=l[1].slice(d);l[1]=l[1].slice(0,d)}r.my=l[0]+" "+l[1];r.offset=u[0]+" "+u[1]}return r};P.prototype._getPositionOffset=function(){var t=[];if(this._oPosition.my&&(this._oPosition.my.indexOf("+")>=0||this._oPosition.my.indexOf("-")>=0)){var e=this._oPosition.my.split(" ");var i=e[0].indexOf("+");if(i<0){i=e[0].indexOf("-")}if(i>=0){t[0]=e[0].slice(i)}i=e[1].indexOf("+");if(i<0){i=e[1].indexOf("-")}if(i>=0){t[1]=e[1].slice(i)}}else if(this._oPosition.offset){t=this._oPosition.offset.split(" ")}return t};P.prototype._applyPosition=function(t){var e=sap.ui.getCore().getConfiguration().getRTL();var i=this._$();if(i.length){var o=t.at;var s=i.get(0);if(typeof o==="string"){s.style.display="block";s.style.left="";s.style.right="";i.position(this._resolveReference(this._convertPositionRTL(t,e)));this._fixPositioning(t,e)}else if(C.isValid(o.left)&&C.isValid(o.top)){i.css({left:o.left,top:o.top})}else if(C.isValid(o.right)&&C.isValid(o.top)){i.css({right:o.right,top:o.top})}else if(typeof o.left==="number"&&typeof o.top==="number"){var n=i[0];if(n&&n.style.right){var r=i[0].getBoundingClientRect().width;i.css({right:document.documentElement.clientWidth-(o.left+r)+"px",top:o.top+"px"})}else{i.css({left:o.left+"px",top:o.top+"px"})}}this._oLastPosition=t;this._oLastOfRect=this._calcOfRect(t.of)}};P.prototype._calcOfRect=function(t){var e=this._getOfDom(t);if(e){return y(e).rect()}return null};P.prototype._getOfDom=function(t){if(t instanceof y.Event){return null}var e;if(typeof t==="string"){e=y(document.getElementById(t))}else if(t instanceof y){e=t}else{e=y(t instanceof a?t.getDomRef():t)}return e[0]};P.prototype._convertPositionRTL=function(t,e){var i=Object.assign({},t);if(e){var o=false;if(i.my&&(i.my.indexOf("+")>=0||i.my.indexOf("-")>=0)){o=true}if((i.offset||o)&&(i.my.indexOf("begin")>-1||i.my.indexOf("end")>-1)&&(i.at.indexOf("begin")>-1||i.at.indexOf("end")>-1)){if(o){var s=i.my.split(" ");if(s.length==2){i.my="";if(s[0]){if(s[0].indexOf("begin")>-1||s[0].indexOf("end")>-1){if(s[0].indexOf("+")>-1){s[0]=s[0].replace("+","-")}else if(s[0].indexOf("-")>-1){s[0]=s[0].replace("-","+")}}i.my=s[0]}if(s[1]){if(s[1].indexOf("begin")>-1||s[1].indexOf("end")>-1){if(s[1].indexOf("+")>-1){s[1]=s[1].replace("+","-")}else if(s[1].indexOf("-")>-1){s[1]=s[1].replace("-","+")}}if(s[0]){i.my=i.my+" "}i.my=i.my+s[1]}}}else{i.offset=this._mirrorOffset(i.offset)}}i.my=i.my.replace("begin","right").replace("end","left");i.at=i.at.replace("begin","right").replace("end","left")}else{i.my=i.my.replace("end","right").replace("begin","left");i.at=i.at.replace("end","right").replace("begin","left")}return i};P.prototype._mirrorOffset=function(t){var e=String(t).trim().split(/\s/);var i=parseInt(e[0]);return-i+" "+e[e.length-1]};P.prototype._fixPositioning=function(t,e){var i=t.my;if(typeof i==="string"){if(P._isPositionFixingNeeded(i,e)){var o=this._$();var s=y(window).width()-o[0].getBoundingClientRect().width-o.offset().left;o.css({right:s+"px",left:""})}}};P._isPositionFixingNeeded=function(t,e){return e&&(t.indexOf("right")>-1||t.indexOf("begin")>-1||t.indexOf("center")>-1)||!e&&(t.indexOf("right")>-1||t.indexOf("end")>-1)};P.prototype._resolveReference=function(t){var e=t;if(t.of instanceof a){e=Object.assign({},t,{of:t.of.getDomRef()})}return e};P.prototype.setShadow=function(t){f(typeof t==="boolean","bShowShadow must be boolean");this._bShadow=t;if(this.eOpenState!=S.CLOSED){this._$().toggleClass("sapUiShd",t)}return this};P.prototype.setModal=function(t,e){f(typeof t==="boolean","bModal must be boolean");f(!e||typeof e==="string","sModalCSSClass must be empty or a string");var i=this._bModal;this._bModal=t;this._sModalCSSClass=e;if(this.isOpen()){if(i!==t){P._clearSelection();if(t){this._setupUserSelection();this._showBlockLayer()}else{this._hideBlockLayer();this._restoreUserSelection()}if(this.touchEnabled&&this._bAutoClose){if(!t){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}else{y(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}}return this};P.prototype.getModal=function(){return this._bModal};P.prototype.setNavigationMode=function(t){if(t!="NONE"&&t!="DOCK"&&t!="SCOPE"){this._sF6NavMode="NONE"}this._sF6NavMode=t};P.prototype.setAutoClose=function(t){f(typeof t==="boolean","bAutoClose must be boolean");if(this.touchEnabled&&this.isOpen()&&this._bAutoClose!==t){if(!this._bModal){if(t){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}else{y(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}this._bAutoClose=t;return this};P.prototype.setExtraContent=function(e){f(Array.isArray(e),"Extra popup content must be an array which contains either sap.ui.core.Element, DOM Element or an ID");if(!this._aExtraContent){this._aExtraContent=[]}var i=function(e){return{onBeforeRendering:function(){var i=e.getDomRef();if(i&&this.isOpen()){if(t.browser.msie){y(i).off("deactivate."+this._popupUID,this.fEventHandler)}else{i.removeEventListener("blur",this.fEventHandler,true)}}},onAfterRendering:function(){var i=e.getDomRef();if(i&&this.isOpen()){if(t.browser.msie){y(i).on("deactivate."+this._popupUID,this.fEventHandler)}else{i.addEventListener("blur",this.fEventHandler,true)}}}}};var o,s,n,r;for(var l=0,u=e.length;l<u;l++){s=e[l];if(s instanceof a){o=s.getId()}else if(typeof s==="object"){o=s.id}else if(typeof s==="string"){o=s}if(this.getChildPopups().indexOf(o)===-1){this.addChildPopup(o);r={id:o};if(s instanceof a){n=i(s);s.addEventDelegate(n,this);r.delegate=n}this._aExtraContent.push(r)}}return this};P.prototype.setAutoCloseAreas=P.prototype.setExtraContent;P.prototype.setAnimations=function(t,e){f(t===null||typeof t==="function","fnOpen must be a function");f(e===null||typeof e==="function","fnClose must be a function");if(t&&typeof t=="function"){this._animations.open=t}if(e&&typeof e=="function"){this._animations.close=e}return this};P.prototype.setDurations=function(t,e){f(t===null||typeof t==="number"&&t%1==0,"iOpenDuration must be null or an integer");f(!e||typeof e==="number"&&e%1==0,"iOpenDuration must be undefined or an integer");if(t>0||t===0){this._durations.open=t}if(e>0||e===0){this._durations.close=e}return this};P.CLOSE_ON_SCROLL="close_Popup_if_of_is_moved";P.prototype._fnCloseOnScroll=function(t){this.close()};P.prototype.setFollowOf=function(t){P.DockTrigger.removeListener(P.checkDocking,this);var e=false;this._bFollowOf=true;this._followOfHandler=null;if(typeof t==="function"){this._followOfHandler=t;e=true}else if(typeof t==="boolean"){e=t}else if(t===P.CLOSE_ON_SCROLL){this._followOfHandler=this._fnCloseOnScroll;e=true}else{this._bFollowOf=false;if(t!==null){p.error("Trying to set an invalid type to 'followOf: "+t)}}if(e&&this._oLastPosition){this._oLastOfRect=this._calcOfRect(this._oLastPosition.of)}if(this._bFollowOf&&this.getOpenState()===S.OPEN){P.DockTrigger.addListener(P.checkDocking,this)}};P.prototype.getAutoClose=function(){return this._bAutoClose};P.prototype.getFollowOf=function(){if(this._bFollowOf){return typeof this._followOfHandler==="function"?this._followOfHandler:true}return false};P.prototype.isOpen=function(){return this.bOpen};P.prototype.getOpenState=function(){return this.eOpenState};P.prototype.destroy=function(){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}this.close(0);this.oContent=null;if(this._bFollowOf){this.setFollowOf(null)}if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._iTopShieldRemoveTimer){clearTimeout(this._iTopShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}if(this._iBottomShieldRemoveTimer){clearTimeout(this._iBottomShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}if(this._aExtraContent){var t;this._aExtraContent.forEach(function(e){if(e.delegate){t=y(document.getElementById(e.id)).control(0);if(t){t.removeEventDelegate(e.delegate)}}})}e.prototype.destroy.apply(this,arguments)};P.prototype.exit=function(){delete this._mEvents};P.prototype._addFocusEventListeners=function(e,i,o){if(!this.fEventHandler){this.fEventHandler=y.proxy(this.onFocusEvent,this)}var s=this._$();var n=this.getChildPopups();var r={};var a=0,l=0;if(s.length){if(document.addEventListener&&!t.browser.msie){document.addEventListener("focus",this.fEventHandler,true);s.get(0).addEventListener("blur",this.fEventHandler,true);for(a=0,l=n.length;a<l;a++){r=n[a]?window.document.getElementById(n[a]):null;if(r){r.addEventListener("blur",this.fEventHandler,true)}}}else{y(document).on("activate."+this._popupUID,this.fEventHandler);s.on("deactivate."+this._popupUID,this.fEventHandler);for(a=0,l=n.length;a<l;a++){r=n[a]?window.document.getElementById(n[a]):null;if(r){y(r).on("deactivate."+this._popupUID,this.fEventHandler)}}}}};P.prototype._removeFocusEventListeners=function(e,i,o){var s=this._$(false,true);if(!s.length){return}var n=this.getChildPopups();var r={};var a=0,l=0;if(document.removeEventListener&&!t.browser.msie){document.removeEventListener("focus",this.fEventHandler,true);s.get(0).removeEventListener("blur",this.fEventHandler,true);for(a=0,l=n.length;a<l;a++){r=n[a]?window.document.getElementById(n[a]):null;if(r){r.removeEventListener("blur",this.fEventHandler,true)}this.closePopup(n[a])}}else{y(document).off("activate."+this._popupUID,this.fEventHandler);s.off("deactivate."+this._popupUID,this.fEventHandler);for(a=0,l=n.length;a<l;a++){r=n[a]?window.document.getElementById(n[a]):null;if(r){y(r).off("deactivate."+this._popupUID,this.fEventHandler)}}}this.fEventHandler=null};P.prototype._activateFocusHandle=function(){if(this._bModal||this._bAutoClose){this._addFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}};P.prototype._deactivateFocusHandle=function(){if(this.fEventHandler){this._removeFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){y(document).off("touchstart mousedown",this._fAutoCloseHandler)}};P.prototype._registerEventBusEvents=function(t,e,i){var o=this;y.each(o._mEvents,function(t,e){sap.ui.getCore().getEventBus().subscribe("sap.ui",t,e,o)});this._bEventBusEventsRegistered=true};P.prototype._unregisterEventBusEvents=function(t,e,i){var o=this;y.each(o._mEvents,function(t,e){sap.ui.getCore().getEventBus().unsubscribe("sap.ui",t,e,o)});delete this._bEventBusEventsRegistered};P.prototype._addFocusableArea=function(t,e,i){if(this.getChildPopups().indexOf(i.id)===-1){this.addChildPopup(i.id)}};P.prototype._removeFocusableArea=function(t,e,i){this.removeChildPopup(i.id)};P.prototype._closePopup=function(t,e,i){this.close(typeof this._durations.close==="string"?0:this._durations.close)};P.prototype._setIdentity=function(t){if(typeof t==="object"){t.attr("data-sap-ui-popup",this._popupUID)}else{p.warning("Incorrect DomRef-type for 'setIdentity': "+t,this);return}if(!this._bEventBusEventsRegistered){this._registerEventBusEvents()}};P.prototype._$=function(t,e){var i;if(this.oContent instanceof s){i=this.oContent.$();if(t||i.length===0&&!e){p.info("Rendering of popup content: "+this.oContent.getId());if(i.length>0){r.preserveContent(i[0],true,false)}sap.ui.getCore().getRenderManager().render(this.oContent,sap.ui.getCore().getStaticAreaRef());i=this.oContent.$()}}else if(this.oContent instanceof a){i=this.oContent.$()}else{i=y(this.oContent)}this._setIdentity(i);return i};function L(t){if(P._blockLayerStateProvider){P._blockLayerStateProvider.fireEvent("blockLayerStateChange",t)}}P.attachBlockLayerStateChange=function(t,e,i){if(!P._blockLayerStateProvider){P._blockLayerStateProvider=new v}P._blockLayerStateProvider.attachEvent("blockLayerStateChange",t,e,i)};P.detachBlockLayerStateChange=function(t,e){if(P._blockLayerStateProvider){P._blockLayerStateProvider.detachEvent("blockLayerStateChange",t,e)}};P.prototype._showBlockLayer=function(){var t=y("#sap-ui-blocklayer-popup"),e="sapUiBLy"+(this._sModalCSSClass?" "+this._sModalCSSClass:"");if(t.length===0){t=y('<div id="sap-ui-blocklayer-popup" tabindex="0" class="'+e+'"></div>');t.appendTo(sap.ui.getCore().getStaticAreaRef())}else{t.removeClass().addClass(e)}P.blStack.push({zIndex:this._iZIndex-2,popup:this});t.css({"z-index":this._iZIndex-2,visibility:"visible"}).show();y("html").addClass("sapUiBLyBack");if(P.blStack.length===1){L({visible:true,zIndex:P.blStack[0].zIndex})}};P.prototype._hideBlockLayer=function(){var t=y("#sap-ui-blocklayer-popup"),e=this,i;if(t.length){var o=t.get(0);if(P.blStack.length>1){P.blStack=P.blStack.filter(function(t){return t.popup!==e});o.style.zIndex=P.blStack[P.blStack.length-1].zIndex;o.style.visibility="visible";o.style.display="block"}else{i=P.blStack.pop();o.style.visibility="hidden";o.style.display="none";window.setTimeout(function(){y("html").removeClass("sapUiBLyBack")},0);L({visible:false,zIndex:i.zIndex})}}};P.prototype._isFocusInsidePopup=function(){var t=this._$(false).get(0);if(t&&g(t,document.activeElement)){return true}return false};P.DockTrigger=n;P.checkDocking=function(){if(this.getOpenState()===S.OPEN){var t=this._getOfDom(this._oLastPosition.of),e;if(t){if(t===window||t===window.document||g(document.documentElement,t)){e=y(t).rect()}else if(t.id){var i=window.document.getElementById(t.id);var o=y(i).rect();if(o&&!O(e,o)){e=o;this._oLastPosition.of=i}}}if(!e){this.close();return}else if(e.left===0&&e.top===0&&e.height===0&&e.height===0&&this._oLastPosition.of.id){this._oLastPosition.of=window.document.getElementById(this._oLastPosition.of.id);t=this._getOfDom(this._oLastPosition.of);e=y(t).rect();if(!e){this.close();return}}if(this._oLastOfRect){if(!O(this._oLastOfRect,e)){if(this._followOfHandler){var s=_({},this._oLastPosition),n=_({},this._oLastOfRect);this._followOfHandler({lastPosition:s,lastOfRect:n,currentOfRect:e})}else{this._applyPosition(this._oLastPosition)}}}}};P.prototype.ontouchstart=function(t){this.onmousedown(t,true);this._bMousedownCalled=true};P.prototype.onmousedown=function(t,e){if(this._bMousedownCalled&&!e){this._bMousedownCalled=false;return}if(this._iZIndex===this.getLastZIndex()||this.getModal()){return}this._increaseMyZIndex("","mousedown",t)};P.prototype._increaseMyZIndex=function(t,e,i){var o=this.getParentPopup(this._oLastPosition.of);if(i&&i.type==="mousedown"||i&&i.isFromParentPopup||o.length===0){this._iZIndex=this.getNextZIndex();var s=this._$(false,true);s.css("z-index",this._iZIndex);if(this._oBlindLayer){this._oBlindLayer.update(s,this._iZIndex-1)}if(i&&!i.type||i&&i.type!="mousedown"||e==="mousedown"){var n=this.getChildPopups();for(var r=0,a=n.length;r<a;r++){this.increaseZIndex(n[r],true)}}}else if(o.length>0){var l=y(o.get(0)).attr("data-sap-ui-popup");this.increaseZIndex(l,false)}};P.prototype.onAfterRendering=function(t){var e=this.getContent();var i=e instanceof a?e.$():y(e);i.toggleClass("sapUiShd",this._bShadow);P._clearSelection();this._setupUserSelection();i.css("position","absolute");this._setIdentity(i);var o=i[0];var s=o.style.left;var n=o.style.right;var r=o.style.top;var u=o.style.bottom;if(!(s&&s!="auto"||n&&n!="auto"||r&&r!="auto"||u&&u!="auto")){p.debug("reposition popup content "+i.attr("id")+" at "+JSON.stringify(this._oLastPosition.at));this._applyPosition(this._oLastPosition)}i.show().css({visibility:"visible","z-index":this._iZIndex});if(this._oBlindLayer){this._resizeListenerId=l.register(this._$().get(0),y.proxy(this.onresize,this))}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._addFocusEventListeners()}this._$(false,true).on("keydown",y.proxy(this._F6NavigationHandler,this))};P.prototype.onBeforeRendering=function(t){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._removeFocusEventListeners()}this._$(false,true).off("keydown",this._F6NavigationHandler)};P.prototype.onresize=function(t){if(this.eOpenState!=S.CLOSED&&this._oBlindLayer){var e=this;setTimeout(function(){e._updateBlindLayer()},0)}};P.prototype._updateBlindLayer=function(){if(this.eOpenState!=S.CLOSED&&this._oBlindLayer){this._oBlindLayer.update(this._$(false,true))}};P.prototype.isInPopup=function(t){var e=this.getParentPopup(t);return e&&e.length>0};P.prototype.getParentPopup=function(t){var e=t?t:this;var i=y(e instanceof a?e.getDomRef():e);return i.closest("[data-sap-ui-popup]")};P.prototype.getParentPopupId=function(t){var e=this.getParentPopup(t);return e.attr("data-sap-ui-popup")};P.prototype.addChildToPopup=function(t,e){var i="sap.ui.core.Popup.addFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};P.prototype.removeChildFromPopup=function(t,e){var i="sap.ui.core.Popup.removeFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};P.prototype.closePopup=function(t){var e="sap.ui.core.Popup.closePopup-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",e)};P.prototype.increaseZIndex=function(t,e){var i="sap.ui.core.Popup.increaseZIndex-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{isFromParentPopup:e?e:false})};P.prototype.focusTabChain=function(t){var e=t.event.target,i=t.that.getMetadata().getName(),o;if(!t.$FocusablesContent||!t.$FocusablesFooter||!t.$FocusablesContent.length&&!t.$FocusablesFooter.length){return}if(e.id===t.firstFocusable){p.debug("First dummy focus element was focused","",i);if(t.$FocusablesFooter.length>0){p.debug("Last footer element will be focused","",i);o=t.$FocusablesFooter[t.$FocusablesFooter.length-1]}else{p.debug("Last content element will be focused","",i);o=t.$FocusablesContent[t.$FocusablesContent.length-1]}}else if(e.id===t.lastFocusable){p.debug("Last dummy focus element was focues","",i);if(t.$FocusablesContent.length>0){p.debug("First content element will be focused","",i);o=t.$FocusablesContent[0]}else{p.debug("First footer element will be focused","",i);o=t.$FocusablesFooter[0]}}if(o){setTimeout(function(){var t=sap.ui.getCore().byId(o.id);if(t instanceof s){p.debug("Focus will be handled by "+t.getMetadata().getName(),"",i)}else{p.debug("oFocusDomRef will be focused","",i)}if(t){t.focus()}else if(o){o.focus()}return t?t.getId():o.id},0)}};P.prototype._setupUserSelection=function(){var t=this._$(false,true);P._markAsUserSelectable(t,this._bModal||P.blStack.length>0);if(this._bModal){if(P.blStack.length>0){var e=P.blStack[P.blStack.length-1];var i=function(t){return t.popup.getId()};if(P.blStack.map(i).indexOf(this.getId())===-1){P._markAsNotUserSelectable(e.popup._$(false,true),true)}else if(e.popup.getId()!==this.getId()){P._markAsNotUserSelectable(t,true)}}else{P._markAsNotUserSelectable(y("html"),true);P._markExternalContentAsUserSelectable(true)}}};P.prototype._restoreUserSelection=function(){var t=this._$(false,true);P._markAsNotUserSelectable(t,false);if(P.blStack.length>0){P._markAsUserSelectable(P.blStack[P.blStack.length-1].popup._$(false,true),true)}else{P._markAsUserSelectable(y("html"),false);P._markExternalContentAsNotUserSelectable(false)}};P._clearSelection=function(){var t=document.getSelection();if(!t.isCollapsed){t.removeAllRanges()}};P._markAsUserSelectable=function(e,i){if(!(t.browser.msie||t.browser.edge)){e.removeClass("sapUiNotUserSelectable");if(i){e.addClass("sapUiUserSelectable")}}};P._markAsNotUserSelectable=function(e,i){if(!(t.browser.msie||t.browser.edge)){e.removeClass("sapUiUserSelectable");if(i){e.addClass("sapUiNotUserSelectable")}}};var x=new Set,w="[data-sap-ui-integration-popup-content]";x.add(w);P.addExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(Set.prototype.add.bind(x));if(e){P.markExternalContentAsSelectable()}};P.removeExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}if(e){P.markExternalContentAsNotSelectable()}t.forEach(function(t){if(t!==w){x.delete(t)}})};P.markExternalContentAsSelectable=function(){P._clearSelection();if(P.blStack.length>0){P._markExternalContentAsUserSelectable(true)}};P.markExternalContentAsNotSelectable=function(){P._clearSelection();if(P.blStack.length>0){P._markExternalContentAsNotUserSelectable(false)}};P._getExternalContent=function(){var t=[];if(x.size>0){x.forEach(function(e){var i=y(e);if(i.length>0){t.push(i)}})}return t};P._markExternalContentAsUserSelectable=function(t){var e=P._getExternalContent();e.forEach(function(e){P._markAsUserSelectable(e,t)})};P._markExternalContentAsNotUserSelectable=function(t){var e=P._getExternalContent();e.forEach(function(e){P._markAsNotUserSelectable(e,t)})};return P});