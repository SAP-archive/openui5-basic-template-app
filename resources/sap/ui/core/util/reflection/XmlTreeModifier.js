/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseTreeModifier","sap/ui/base/DataType","sap/ui/core/XMLTemplateProcessor","sap/base/util/merge","sap/ui/thirdparty/jquery","sap/ui/util/XMLHelper","sap/ui/core/Fragment"],function(e,t,r,n,i,a){"use strict";var o={targets:"xmlTree",setVisible:function(e,t){if(t){e.removeAttribute("visible")}else{this.setProperty(e,"visible",t)}},getVisible:function(e){return this.getProperty(e,"visible")},setStashed:function(e,t){if(!t){e.removeAttribute("stashed")}else{this.setProperty(e,"stashed",t)}this.setVisible(e,!t)},getStashed:function(e){return this.getProperty(e,"stashed")},bindProperty:function(e,t,r){e.setAttribute(t,"{"+r+"}")},unbindProperty:function(e,t){e.removeAttribute(t)},setProperty:function(e,t,r){e.setAttribute(t,r)},getProperty:function(e,t){var r=this._getControlMetadata(e).getProperty(t);var n=e.getAttribute(t);if(r){var i=r.getType();if(n===null){n=r.getDefaultValue()||i.getDefaultValue()}else{n=i.parseValue(n)}}return n},isPropertyInitial:function(e,t){var r=e.getAttribute(t);return r==null},setPropertyBinding:function(e,t,r){e.setAttribute(t,r)},getPropertyBinding:function(e,t){return e.getAttribute(t)},createControl:function(e,t,r,n,i,a){var o,g,s;if(!this.bySelector(n,t,r)){var l=e.split(".");var u="";if(l.length>1){g=l.pop();u=l.join(".")}var f=r.ownerDocument.createElementNS(u,g);o=this.getControlIdBySelector(n,t);if(o){f.setAttribute("id",o)}if(i){this.applySettings(f,i)}return a?Promise.resolve(f):f}else{s=new Error("Can't create a control with duplicated ID "+o);if(a){return Promise.reject(s)}throw s}},applySettings:function(e,t){var r;Object.keys(t).forEach(function(n){r=t[n];e.setAttribute(n,r)})},_byId:function(e,t){if(t){if(t.ownerDocument&&t.ownerDocument.getElementById&&t.ownerDocument.getElementById(e)){return t.ownerDocument.getElementById(e)}else{return t.querySelector("[id='"+e+"']")}var r=i(document.getElementById(e));if(r.length===1){return r[0]}}},getId:function(e){return e.getAttribute("id")},getParent:function(e){var t=e.parentNode;if(!this.getId(t)){t=t.parentNode}return t},_getLocalName:function(e){return e.localName||e.baseName||e.nodeName},getControlType:function(e){return this._getControlTypeInXml(e)},getAllAggregations:function(e){var t=this._getControlMetadata(e);return t.getAllAggregations()},getAggregation:function(e,t){var r=this._findAggregationNode(e,t);var n=this._isSingleValueAggregation(e,t);if(!r){if(n&&this._isAltTypeAggregation(e,t)){return this.getProperty(e,t)}return n?undefined:[]}var i=this._getControlsInAggregation(e,r);if(n){return i[0]}return i},insertAggregation:function(e,t,r,n,i){var a=this._findAggregationNode(e,t);if(!a){var o=e.namespaceURI;a=this.createControl(o+"."+t,undefined,i);e.appendChild(a)}if(n>=a.childElementCount){a.appendChild(r)}else{var g=this._getControlsInAggregation(e,a)[n];a.insertBefore(r,g)}},removeAggregation:function(e,t,r){var n=this._findAggregationNode(e,t);n.removeChild(r)},removeAllAggregation:function(e,t){var r=this._findAggregationNode(e,t);if(e===r){var n=this._getControlsInAggregation(e,e);n.forEach(function(t){e.removeChild(t)})}else{e.removeChild(r)}},_findAggregationNode:function(e,t){var r;var n=this._children(e);for(var i=0;i<n.length;i++){var a=n[i];if(a.localName===t){r=a;break}}if(!r&&this._isDefaultAggregation(e,t)){r=e}return r},_isDefaultAggregation:function(e,t){var r=this._getControlMetadata(e);var n=r.getDefaultAggregation();return n&&t===n.name},_isNotNamedAggregationNode:function(e,t){var r=this.getAllAggregations(e);var n=r[t.localName];return e.namespaceURI!==t.namespaceURI||!n},_isSingleValueAggregation:function(e,t){var r=this.getAllAggregations(e);var n=r[t];return!n.multiple},_isAltTypeAggregation:function(e,t){var r=this._getControlMetadata(e);var n=r.getAllAggregations()[t];return!!n.altTypes},_getControlMetadata:function(e){return this._getControlMetadataInXml(e)},_getControlsInAggregation:function(e,t){var r=Array.prototype.slice.call(this._children(t));return r.filter(this._isNotNamedAggregationNode.bind(this,e))},_children:function(e){if(e.children){return e.children}else{var t=[];for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(n.nodeType===n.ELEMENT_NODE){t.push(n)}}return t}},getBindingTemplate:function(e,t){var r=this._findAggregationNode(e,t);if(r){var n=this._children(r);if(n.length===1){return n[0]}}},updateAggregation:function(e,t){},findIndexInParentAggregation:function(e){var t,r,n;t=this.getParent(e);if(!t){return-1}r=this.getParentAggregationName(e,t);n=this.getAggregation(t,r);if(Array.isArray(n)){return n.indexOf(e)}else{return 0}},getParentAggregationName:function(e,t){var r,n;if(!t.isSameNode(e.parentNode)){r=false}else{r=this._isNotNamedAggregationNode(t,e)}if(r){n=this._getControlMetadata(t).getDefaultAggregationName()}else{n=this._getLocalName(e.parentNode)}return n},findAggregation:function(e,t){var r=this._getControlMetadata(e);var n=r.getAllAggregations();if(n){return n[t]}},validateType:function(e,t,r,n,i){var a=t.type;if(t.multiple===false&&this.getAggregation(r,t.name)&&this.getAggregation(r,t.name).length>0){return false}var o=sap.ui.xmlfragment({fragmentContent:n});if(!Array.isArray(o)){o=[o]}var g=this._isInstanceOf(o[i],a)||this._hasInterface(o[i],a);o.forEach(function(e){e.destroy()});return g},instantiateFragment:function(e,t){var r=a.parse(e);r=this._checkAndPrefixIdsInFragment(r,t);if(r.localName==="FragmentDefinition"){return this._getElementNodeChildren(r)}else{return[r]}},destroy:function(e){var t=e.parentNode;t.removeChild(e)},getChangeHandlerModulePath:function(e){if(!e){return undefined}return e.getAttributeNS("sap.ui.fl","flexibility")}};return n({},e,o)},true);