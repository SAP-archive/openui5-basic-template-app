/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.sjax","sap/base/Log","sap/base/util/UriParameters","sap/ui/core/Core","sap/ui/thirdparty/URI"],function(e,t,r,n,a){"use strict";var s=/\/\$batch($|\?)/,i=/(?:^|\r\n)Content-Id\s*:\s*(\S+)/i,o=/^(.*)?:\s*(.*)$/,u="application/json;charset=UTF-8;IEEE754Compatible=true",c={},f="\r\nContent-Type: application/http\r\n"+"Content-Transfer-Encoding: binary\r\n",d=/^Content-Type:\s*multipart\/mixed;\s*boundary=/i,p=new r(window.location.href),l=p.get("autoRespondAfter"),h=p.get("realOData"),y=/^(\S+) (\S+)$/,g=/^(GET|DELETE|PATCH|POST) (\S+) HTTP\/1\.1$/,m={},T=/^(OData-Version|DataServiceVersion)$/i,v=h==="true"||h==="proxy",x=v||h==="direct",E=p.get("supportAssistant")==="true",b;if(x){document.title=document.title+" (real OData)"}function C(e,t,r){var n=QUnit.objectType(e),a=QUnit.objectType(t),s;if(n==="string"&&a==="regexp"){if(!t.test(e)){throw new Error(r+": actual value "+e+" does not match expected regular expression "+t)}return}if(n!==a){throw new Error(r+": actual type "+n+" does not match expected type "+a)}if(n==="array"){if(e.length<t.length){throw new Error(r+": array length: "+e.length+" < "+t.length)}}if(n==="array"||n==="object"){for(s in t){C(e[s],t[s],r==="/"?r+s:r+"/"+s)}}else if(e!==t){throw new Error(r+": actual value "+e+" does not match expected value "+t)}}function D(e,t,r,n){try{C(e,t,"/");QUnit.assert.pushResult({result:n,actual:e,expected:t,message:r})}catch(a){QUnit.assert.pushResult({result:!n,actual:e,expected:t,message:(r||"")+" failed because of "+a.message})}}b={awaitRendering:function(){if(sap.ui.getCore().getUIDirty()){return new Promise(function(e){function t(){if(sap.ui.getCore().getUIDirty()){setTimeout(t,1)}else{e()}}t()})}},deepContains:function(e,t,r){D(e,t,r,true)},notDeepContains:function(e,t,r){D(e,t,r,false)},useFakeServer:function(r,n,a){var p;function h(t,r){var n=q(t,r.requestBody),a=D(r);r.respond(200,e.extend({},a,{"Content-Type":"multipart/mixed;boundary="+n.boundary}),b(n,a))}function y(e){var t={code:e.code||200,headers:e.headers||{},ifMatch:e.ifMatch};if(e.source){t.message=H(n+e.source);t.headers["Content-Type"]=t.headers["Content-Type"]||v(e.source)}else{t.message=e.message}return t}function m(){var e,t,r={};for(t in a){e=a[t];if(!t.includes(" ")){t="GET "+t}if(Array.isArray(e)){r[t]=e.map(y)}else{r[t]=[y(e)]}}return r}function v(e){if(/\.xml$/.test(e)){return"application/xml"}if(/\.json$/.test(e)){return u}return"application/x-octet-stream"}function x(e,r,n){t.error(r.requestLine,n,"sap.ui.test.TestUtils");return{code:e,headers:{"Content-Type":"text/plain"},message:n}}function E(e){return e.slice(0,e.indexOf("\r\n"))}function b(e,t){var r=[""];e.parts.forEach(function(e){r.push(e.boundary?"\r\nContent-Type: multipart/mixed;boundary="+e.boundary+"\r\n\r\n"+b(e,t):C(e,t))});r.push("--\r\n");return r.join("--"+e.boundary)}function C(t,r){var n=e.extend({},r,t.headers);return f+(t.contentId?"Content-ID: "+t.contentId+"\r\n":"")+"\r\nHTTP/1.1 "+t.code+"\r\n"+Object.keys(n).map(function(e){return e+": "+n[e]}).join("\r\n")+"\r\n\r\n"+(t.message||"")+"\r\n"}function D(e){var t,r={};for(t in e.requestHeaders){if(T.test(t)){r[t]=e.requestHeaders[t]}}return r}function O(t,r){var n,a=p[t.method+" "+t.url];a=(a||[]).filter(function(e){if(typeof e.ifMatch==="function"){return e.ifMatch(t)}return!e.ifMatch||e.ifMatch.test(t.requestBody)});if(a.length){n=a[0]}else{switch(t.method){case"HEAD":n={code:200};break;case"DELETE":n={code:204,headers:{"Content-Type":"text/plain;charset=utf-8"}};break;case"PATCH":case"POST":n={code:200,headers:{"Content-Type":u},message:t.requestBody};break;default:n=x(404,t,"No mock data found")}}n={code:n.code,headers:e.extend({},D(t),n.headers),message:n.message};if(r&&n.code<300){n.contentId=r}return n}function q(e,t){var r=E(t);return{boundary:E(t).slice(2),parts:t.split(r).slice(1,-1).map(function(t){var r,n,a,s,o,u;t=t.slice(2);n=E(t);if(d.test(n)){s=q(e,t.slice(n.length+4));r=s.parts.filter(function(e){return e.code>=300});return r.length?r[0]:s}u=t.indexOf("\r\n\r\n")+4;o=w(e,t.slice(u));a=i.exec(t.slice(0,u));return O(o,a&&a[1])})}}function w(e,t){var r=t.indexOf("\r\n\r\n"),n,a,s={requestHeaders:{}};s.requestBody=t.slice(r+4,t.length-2);t=t.slice(0,r);n=t.split("\r\n");s.requestLine=n.shift();a=g.exec(s.requestLine);if(a){s.method=a[1];s.url=e+a[2];n.forEach(function(e){var t=o.exec(e);if(t){s.requestHeaders[t[1]]=t[2]}})}return s}function R(e){var t=e.url;if(s.test(t)){h(t.slice(0,t.indexOf("/$batch")+1),e)}else{S(e)}}function H(t){var r=c[t];if(!r){e.ajax({async:false,url:t,dataType:"text",success:function(e){r=e}});if(!r){throw new Error(t+": resource not found")}c[t]=r}return r}function S(e){var t=O(e);e.respond(t.code,t.headers,t.message)}function U(){var t,n;p=m();n=sinon.fakeServer.create();r.add(n);n.autoRespond=true;if(l){n.autoRespondAfter=parseInt(l)}n.respondWith("GET",/./,S);n.respondWith("DELETE",/./,S);n.respondWith("HEAD",/./,S);n.respondWith("PATCH",/./,S);n.respondWith("POST",/./,R);t=n.restore;n.restore=function(){sinon.FakeXMLHttpRequest.filters=[];t.apply(this,arguments)};sinon.xhr.supportsCORS=e.support.cors;sinon.FakeXMLHttpRequest.useFilters=true;sinon.FakeXMLHttpRequest.addFilter(function(e,t){return e!=="DELETE"&&e!=="HEAD"&&e!=="PATCH"&&e!=="POST"&&!(e+" "+t in p)})}n=sap.ui.require.toUrl(n).replace(/(^|\/)resources\/(~[-a-zA-Z0-9_.]*~\/)?/,"$1test-resources/")+"/";U()},withNormalizedMessages:function(e){var t=sinon.sandbox.create();try{var r=sap.ui.getCore(),n=r.getLibraryResourceBundle;t.stub(r,"getLibraryResourceBundle").returns({getText:function(e,t){var a=e,s=n.call(r).getText(e),i;for(i=0;i<10;i+=1){if(s.indexOf("{"+i+"}")>=0){a+=" "+(i>=t.length?"{"+i+"}":t[i])}}return a}});e.apply(this)}finally{t.verifyAndRestore()}},isRealOData:function(){return x},isSupportAssistant:function(){return E},getRealOData:function(){return h?"&realOData="+h:""},getBaseUri:function(){var e;if(document.baseURI){return document.baseURI}e=document.getElementsByTagName("base");return e[0]&&e[0].href||location.href},proxy:function(e){var t;if(!v){return e}t=sap.ui.require.toUrl("sap/ui").replace("resources/sap/ui","proxy");return new a(t+e,b.getBaseUri()).pathname().toString()},retrieveData:function(e){var t=m[e];delete m[e];return t},setData:function(e,t){m[e]=t},setupODataV4Server:function(e,t,r,n){var a={};if(x){return}if(!n){n="/"}else if(n.slice(-1)!=="/"){n+="/"}Object.keys(t).forEach(function(e){var r=y.exec(e),s,i;if(r){s=r[1]||"GET";i=r[2]}else{s="GET";i=e}if(!i.startsWith("/")){i=n+i}a[s+" "+i]=t[e]});b.useFakeServer(e,r||"sap/ui/core/qunit/odata/v4/data",a)}};return b},true);