/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/qunit/QUnitUtils","sap/ui/test/Opa5","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/test/_OpaLogger"],function(e,t,r,i,n,s){"use strict";return e.extend("sap.ui.test.actions.Action",{metadata:{properties:{idSuffix:{type:"string"}},publicMethods:["executeOn"]},executeOn:function(){return true},$:function(e){var t;var r="";if(this.getIdSuffix()){t=e.$(this.getIdSuffix());r=t.length?"":"DOM representation of control '"+e+"' has no element with user-provided ID suffix '"+this.getIdSuffix()+"'"}else{var i=this._getAdapter(e);if(i){t=e.$(i);r=t.length?"":"DOM representation of control '"+e+"' has no element with ID suffix '"+i+"' which is the default adapter for '"+this.getMetadata().getName()+"'"}if(!t||!t.length){t=n(e.getFocusDomRef());if(!t.length){t=e.$();if(!t.length){r+="DOM representation of control '"+e+"' has no focus DOM reference"}}}}if(t.length){this.oLogger.info("Found a DOM reference for the control '"+e+"'. Executing '"+this.getMetadata().getName()+"' on the DOM element with ID '"+t[0].id+"'");return t}else{this.oLogger.error(r);throw new Error(r)}},getUtils:function(){return r.getUtils()||t},init:function(){this.controlAdapters={};this.oLogger=s.getLogger(this.getMetadata().getName())},dropPosition:{BEFORE:"BEFORE",AFTER:"AFTER",CENTER:"CENTER"},_getAdapter:function(e){var t=function(r){var i=this.controlAdapters[r.getName()];if(i){if(n.isFunction(i)){return i(e)}if(typeof i==="string"){return i}}var s=r.getParent();if(s){return t(s)}return null}.bind(this);return t(e.getMetadata())},_tryOrSimulateFocusin:function(e,t){var r=e[0];var n=false;var s=this._isFocused(r);var o=i.browser.msie&&i.browser.version<12;var a=i.browser.firefox&&i.browser.version>=60;if(s||o||a){n=true}else{e.trigger("focus");var u=this._isFocused(r);n=!u}if(n){this.oLogger.debug("Control "+t+" could not be focused - maybe you are debugging?");this._createAndDispatchFocusEvent("focusin",r);this._createAndDispatchFocusEvent("focus",r);this._createAndDispatchFocusEvent("activate",r)}if(!this._isFocused(r)){this.oLogger.trace("Control "+t+" could not be focused-in correctly. This may lead to lost interactions with the control")}},_simulateFocusout:function(e){this._createAndDispatchFocusEvent("focusout",e);this._createAndDispatchFocusEvent("blur",e);this._createAndDispatchFocusEvent("deactivate",e)},_createAndDispatchMouseEvent:function(e,t){var r=0;var n;if(i.browser.msie&&i.browser.version<12){n=document.createEvent("MouseEvent");n.initMouseEvent(e,true,true,window,0,0,0,0,0,false,false,false,false,r,t)}else{n=new MouseEvent(e,{bubbles:true,cancelable:true,identifier:1,target:t,radiusX:1,radiusY:1,rotationAngle:0,button:r,type:e})}t.dispatchEvent(n)},_createAndDispatchFocusEvent:function(e,t){var r,n=["focusin","focusout","activate","deactivate"].indexOf(e)!==-1;if(i.browser.msie&&i.browser.version<12){r=document.createEvent("FocusEvent");r.initFocusEvent(e,n,false,window,0,t)}else{r=new FocusEvent(e,{type:e,target:t,curentTarget:t,bubbles:n})}t.dispatchEvent(r);this.oLogger.info("Dispatched focus event: '"+e+"'")},_createAndDispatchDragEvent:function(e,t,r){if(i.browser.msie&&i.browser.version<12){return}var n=this._getEventCoordinates(t,r);var s=new DataTransfer;var o;if(i.browser.edge){o=document.createEvent("DragEvent");o.initDragEvent(e,true,true,window,0,n.x,n.y,n.x,n.y,false,false,false,false,1,t,s)}else{o=new DragEvent(e,{type:e,eventPhase:3,bubbles:true,cancelable:true,defaultPrevented:false,composed:true,returnValue:true,cancelBubble:false,target:t,toElement:t,srcElement:t,radiusX:1,radiusY:1,rotationAngle:0,clientX:n.x,clientY:n.y,dataTransfer:s})}t.dispatchEvent(o)},_getEventCoordinates:function(e,t){var r=n(e);var i=r.offset();var s={x:i.left+r.outerWidth()/2,y:i.top+r.outerHeight()/2};if(!t){return s}switch(t.position){case this.dropPosition.BEFORE:return{x:i.left,y:i.top};case this.dropPosition.AFTER:return{x:i.left+r.outerWidth(),y:i.top+r.outerHeight()};case this.dropPosition.CENTER:default:return s}},_isFocused:function(e){var t=e===document.activeElement;var r=!document.hasFocus||document.hasFocus();var i=!!(e.type||e.href||~e.tabIndex);return t&&r&&i}})});