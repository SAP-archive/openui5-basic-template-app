/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/Device","sap/ui/test/_LogCollector","sap/base/Log","sap/ui/thirdparty/jquery","sap/base/util/ObjectPath"],function(e,t,r,n,i,a){"use strict";var s=null,o=null,u=null,c=null,l=null,h=false,f=false,d=null,p=null,g;function y(){s=o[0].contentWindow;m();v()}function w(e,t){if(e){o.css("width",e)}else{o.addClass("default-scale-x")}if(t){o.css("height",t)}else{o.addClass("default-scale-y")}if(!e&&!t){o.addClass("default-scale-both")}}function m(){var e=s.onerror;s.onerror=function(t,r,n,i,a){var s=false;if(e){s=e.apply(this,arguments)}setTimeout(function(){var e=i?"\ncolumn: "+i:"";var s=a&&"\niFrame error: "+(a.stack?a.message+"\n"+a.stack:a)||"";throw new Error("Error in launched application iFrame: "+t+"\nurl: "+r+"\nline: "+n+e+s)},0);return s}}function v(){if(f){return true}if(s&&s.sap&&s.sap.ui&&s.sap.ui.getCore){if(!h){s.sap.ui.getCore().attachInit(b)}h=true}return f}function H(e){s.sap.ui.require(["sap/ui/thirdparty/sinon"],function(t){if(!t){setTimeout(function(){H(e)},50)}else{e()}})}function b(){C();if(t.browser.firefox){H(I)}else{I()}}function L(){l.sap.log.addLogListener(r.getInstance()._oListener);f=true}function C(){l=s.jQuery;P("sap/ui/test");P("sap/ui/qunit");P("sap/ui/thirdparty")}function F(e,t,r){var i=new r,a=new t(i),o=e.setHash,u=e.getHash,c,l=false,h=s.history.go;e.replaceHash=function(e){l=true;var t=this.getHash();c=e;i.fireEvent("hashReplaced",{sHash:e});this.changed.dispatch(e,t)};e.setHash=function(e){l=true;var t=u.call(this);c=e;i.fireEvent("hashSet",{sHash:e});o.apply(this,arguments);if(t===this.getHash()){this.changed.dispatch(t,a.aHistory[a.iHistoryPosition])}};e.getHash=function(){if(c===undefined){return u.apply(this,arguments)}return c};e.changed.add(function(e){if(!l){i.fireEvent("hashSet",{sHash:e});c=e}l=false});i.init();function f(){l=true;var t=a.aHistory[a.iHistoryPosition],r=a.getPreviousHash();c=r;e.changed.dispatch(r,t)}function d(){l=true;var t=a.aHistory[a.iHistoryPosition+1],r=a.aHistory[a.iHistoryPosition];if(t===undefined){n.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return}c=t;e.changed.dispatch(t,r)}s.history.back=f;s.history.forward=d;s.history.go=function(e){if(e===-1){f();return}else if(e===1){d();return}n.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return h.apply(s.history,arguments)}}function I(){s.sap.ui.require(["sap/ui/test/OpaPlugin","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_OpaLogger","sap/ui/qunit/QUnitUtils","sap/ui/thirdparty/hasher","sap/ui/core/routing/History","sap/ui/core/routing/HashChanger"],function(e,t,r,n,i,a,s){r.setLevel(g);u=new e;d=t;c=n;F(i,a,s);p=s;L()})}function P(t){var r=sap.ui.require.toUrl(t);var n=new e(r).absoluteTo(document.baseURI).search("").toString();var i=a.get("sap.ui._ui5loader.config",s)||a.get("sap.ui.loader.config",s);if(i){var o={};o[t]=n;i({paths:o})}else if(l&&l.sap&&l.sap.registerResourcePath){l.sap.registerResourcePath(t,n)}else{throw new Error("iFrameLauncher.js: UI5 module system not found.")}}function E(){if(!s){throw new Error("sap.ui.test.launchers.iFrameLauncher: Teardown was called before launch. No iFrame was loaded.")}s.onerror=i.noop;for(var e=0;e<o.length;e++){o[0].src="about:blank";o[0].contentWindow.document.write("");o[0].contentWindow.close()}if(typeof CollectGarbage=="function"){CollectGarbage()}o.remove();l=null;u=null;c=null;s=null;f=false;h=false;d=null;p=null}return{launch:function(e){if(s){throw new Error("sap.ui.test.launchers.iFrameLauncher: Launch was called twice without teardown. Only one iFrame may be loaded at a time.")}o=i("#"+e.frameId);if(!o.length){if(!e.source){n.error("No source was given to launch the IFrame",this)}o=i('<IFrame id="'+e.frameId+'" class="opaFrame" src="'+e.source+'"></IFrame>');i("body").append(o);w(e.width,e.height)}if(o[0].contentDocument&&o[0].contentDocument.readyState==="complete"){y()}else{o.on("load",y)}g=e.opaLogLevel;return v()},hasLaunched:function(){v();return f},teardown:function(){E()},getHashChanger:function(){if(!p){return null}return p.getInstance()},getPlugin:function(){return u},getJQuery:function(){return l},getUtils:function(){return c},getWindow:function(){return s},_getAutoWaiter:function(){return d}}},true);