/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/autowaiter/_utils","sap/ui/thirdparty/jquery","./WaiterBase"],function(t,e,i){"use strict";var r={};var n={TRACKED:"TRACKED",STARTER:"STARTED",FINISHED:"FINISHED",CLEARED:"CLEARED"};var a;var o;var u=i.extend("sap.ui.test.autowaiter._timeoutWaiter",{hasPending:function(){var t=Object.keys(r).filter(function(t){return g(t)});var e=t.length>0;d(t);return e},_getDefaultConfig:function(){return e.extend({maxDepth:1,maxDelay:1e3,minDelay:10},i.prototype._getDefaultConfig.call(this))},_getValidationInfo:function(){return e.extend({maxDepth:"numeric",maxDelay:"numeric",minDelay:"numeric"},i.prototype._getValidationInfo.call(this))},_getInitiatorId:function(){return o},_isPolling:function(t){return!m(t)},_registerInitiatorResolverId:function(t){a=t}});var c=new u;function f(){if(o){return o}if(a){return a()}}function l(e){var i="set"+e;var a="clear"+e;var u=window[i];if(!u){return}var l=window[a];window[i]=function e(i,a,l){a=a||0;var s=Array.prototype.slice.call(arguments,2);var d={delay:a,initiator:f(),func:t.functionToString(i),stack:t.resolveStackTrace(),status:n.TRACKED};var g;if(l&&l==="TIMEOUT_WAITER_IGNORE"){g=u.apply(null,[i,a].concat(s.slice(1)));c._oLogger.trace("Timeout with ID "+g+" should not be tracked. "+" Delay: "+a+" Initiator: "+o);return g}var m=function t(){var e=r[g];if(!e){c._oLogger.trace("Timeout data for timeout with ID "+g+" disapered unexpectedly");e={}}o=g;c._oLogger.trace("Timeout with ID "+g+" started");e.status=n.STARTED;try{i()}finally{o=undefined}c._oLogger.trace("Timeout with ID "+g+" finished");e.status=n.FINISHED};g=u.apply(null,[m,a].concat(s));c._oLogger.trace("Timeout with ID "+g+" is tracked. "+" Delay: "+a+" Initiator: "+o);r[g]=d;return g};window[a]=function t(e){if(!e){c._oLogger.trace("Could not clean timeout with invalid ID: "+e);return}var i=r[e];if(!i){c._oLogger.trace("Timeout data for timeout with ID "+e+" disapered unexpectedly or timeout was not tracked intentionally");i={}}i.status=n.CLEARED;c._oLogger.trace("Timeout with ID "+e+" cleared");l(e)}}l("Timeout");l("Immediate");function s(t,e,i,r){return"\nTimeout: ID: "+t+" Type: "+(i?"BLOCKING":"NOT BLOCKING")+" Status: "+e.status+" Delay: "+e.delay+" Initiator: "+e.initiator+(r?"\nFunction: "+e.func:"")+(r?"\nStack: "+e.stack:"")}function d(t){var e=Object.keys(r);var i="Found "+t.length+" blocking out of "+e.length+" tracked timeouts";t.forEach(function(e){i+=s(e,r[e],t.some(function(t){return t==e}),true)});c._oHasPendingLogger.debug(i);var n="Tracked timeouts";e.forEach(function(e){n+=s(e,r[e],t.some(function(t){return t==e}),true)});c._oHasPendingLogger.trace(n)}function g(t){var e=r[t];if(e.status!==n.TRACKED){return false}if(e.delay>c._mConfig.maxDelay){return false}if(e.delay>c._mConfig.minDelay){return m(t)}return true}function m(t,e){e=e||1;var i=r[t];if(i.initiator&&r[i.initiator]){if(i.delay==r[i.initiator].delay){if(e>=c._mConfig.maxDepth){return false}return m(i.initiator,e+1)}}return true}return c},true);