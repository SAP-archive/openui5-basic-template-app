/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_utils","sap/ui/thirdparty/jquery"],function(t,e,a,i){"use strict";var r=t.getLogger("sap.ui.test.autowaiter._timeoutWaiter");var n=t.getLogger("sap.ui.test.autowaiter._timeoutWaiter#hasPending");var u=new e({errorPrefix:"sap.ui.test.autowaiter._timeoutWaiter#extendConfig"});var o={};var c=1;var s=1e3;var f=10;var l={maxDepth:c,maxDelay:s,minDelay:f};var d={TRACKED:"TRACKED",STARTER:"STARTED",FINISHED:"FINISHED",CLEARED:"CLEARED"};var m;function D(t){var e="set"+t;var i="clear"+t;var n=window[e];if(!n){return}var u=window[i];window[e]=function t(e,i,u){if(u&&u==="TIMEOUT_WAITER_IGNORE"){s=n.call(this,e,i);r.trace("Timeout with ID "+s+" should not be tracked. "+" Delay: "+i+" Initiator: "+m);return s}var c=function t(){var a=o[s];if(!a){r.trace("Timeout data for timeout with ID "+s+" disapered unexpectedly");a={}}m=s;r.trace("Timeout with ID "+s+" started");a.status=d.STARTED;try{e()}finally{m=undefined}r.trace("Timeout with ID "+s+" finished");a.status=d.FINISHED};i=i||0;var s;var f={delay:i,initiator:m,func:a.functionToString(e),stack:a.resolveStackTrace(),status:d.TRACKED};s=n.call(this,c,i);r.trace("Timeout with ID "+s+" is tracked. "+" Delay: "+i+" Initiator: "+m);o[s]=f;return s};window[i]=function t(e){if(!e){r.trace("Could not clead timeout with invalid ID: "+e);return}var a=o[e];if(!a){r.trace("Timeout data for timeout with ID "+e+" disapered unexpectedly or timeout was not tracked intentionally");a={}}a.status=d.CLEARED;r.trace("Timeout with ID "+e+" cleared");u.apply(this,arguments)}}D("Timeout");D("Immediate");function v(t,e,a,i){return"\nTimeout: ID: "+t+" Type: "+(a?"BLOCKING":"NOT BLOCKING")+" Status: "+e.status+" Delay: "+e.delay+" Initiator: "+e.initiator+(i?"\nFunction: "+e.func:"")+(i?"\nStack: "+e.stack:"")}function T(t){var e=Object.keys(o);var a="Found "+t.length+" blocking out of "+e.length+" tracked timeouts";t.forEach(function(e){a+=v(e,o[e],t.some(function(t){return t==e}),true)});n.debug(a);var i="Tracked timeouts";e.forEach(function(e){i+=v(e,o[e],t.some(function(t){return t==e}),true)});n.trace(i)}function y(t){var e=o[t];if(e.status!==d.TRACKED){return false}if(e.delay>l.maxDelay){return false}if(e.delay>l.minDelay){return h(t)}return true}function h(t,e){e=e||1;var a=o[t];if(a.initiator&&o[a.initiator]){if(a.delay==o[a.initiator].delay){if(e>=l.maxDepth){return false}return h(a.initiator,e+1)}}return true}return{hasPending:function(){var t=Object.keys(o).filter(function(t){return y(t)});var e=t.length>0;T(t);return e},extendConfig:function(t){t=t&&t.timeoutWaiter||{maxDepth:c,maxDelay:s};u.validate({inputToValidate:t,validationInfo:{maxDepth:"numeric",maxDelay:"numeric",minDelay:"numeric"}});i.extend(l,t)}}},true);