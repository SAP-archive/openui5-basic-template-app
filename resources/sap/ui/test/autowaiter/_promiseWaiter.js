/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/autowaiter/_utils","sap/ui/thirdparty/jquery","sap/ui/test/autowaiter/_timeoutWaiter","./WaiterBase"],function(e,t,n,r){"use strict";var i=[];var o=window.Promise;var a=["resolve","reject","all","race","allSettled"];var u;var s=r.extend("sap.ui.test.autowaiter._promiseWaiter",{hasPending:function(){var e=i.filter(function(e){return!!e.pending&&!m(e)});if(e.length>0){var t="There are "+e.length+" pending promises\n";e.forEach(function(e){t+=f(e)});c._oHasPendingLogger.debug(t)}return e.length>0},_getDefaultConfig:function(){return t.extend({maxDelay:1e3},r.prototype._getDefaultConfig.call(this))},_getValidationInfo:function(){return t.extend({maxDelay:"numeric"},r.prototype._getValidationInfo.call(this))}});var c=new s;n._registerInitiatorResolverId(function(){return u?u.completorTimeoutId:undefined});function f(e){return"\nPromise: Args: "+e.args+"\n Stack: "+e.stack}function g(){var e=n._getInitiatorId();if(!e&&u){e=u.completorTimeoutId}return e}function l(){var e=n._getInitiatorId();return e}function p(t){var n={args:t,stack:e.resolveStackTrace(),pending:true,tooLate:false,initiatorTimeoutId:g(),longRunnerTimeoutId:setTimeout(function(){n.tooLate=true;n.pending=false;c._oLogger.trace("Long-running promise is ignored:"+f(n))},c._mConfig.maxDelay,"TIMEOUT_WAITER_IGNORE")};c._oLogger.trace("New pending promise:"+f(n));i.push(n);return n}function d(e){if(!e){return}e.completorTimeoutId=l();e.endTime=Date.now();if(e.tooLate){return}else{e.pending=false;c._oLogger.trace("Promise complete:"+f(e));clearTimeout(e.longRunnerTimeoutId)}}function m(e){if(e.initiatorTimeoutId&&n._isPolling(e.initiatorTimeoutId)){c._oLogger.trace("Polling promise is ignored:"+f(e));return true}return false}var v=function(t){var n;var r=function(r,i){var o=e.functionToString(t);if(window.ES6Promise&&o==="'function noop() {}'"){c._oLogger.trace("Ignoring internal constructor of ES6 Promise polyfill");return t(r,i)}else if(o==="'function () { [native code] }'"){c._oLogger.trace("Ignoring internal Promise constructor");return t(r,i)}else{n=p(o);var a=function e(){d(n);r.apply(this,arguments)};var u=function e(){d(n);i.apply(this,arguments)};return t(a,u)}};var i=new o(r);function a(e){var t=e.then;e.then=function e(r,i){var o=r;if(r){var o=function e(){u=n;var t=r.apply(this,arguments);u=undefined;return t}}var a=t.apply(this,[o,i]);return a};return e}return a(i)};v.prototype=o.prototype;v.prototype.constructor=v;a.forEach(function(e){if(o[e]){v[e]=o[e]}});window.Promise=v;return c},true);