/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/test/_OpaLogger","sap/ui/test/_ParameterValidator","sap/ui/test/autowaiter/_autoWaiter","sap/ui/test/_LogCollector","sap/ui/thirdparty/jquery"],function(e,t,i,n,a){"use strict";var o=e.getLogger("sap.ui.test.autowaiter._autoWaiterAsync");var r=n.getInstance("^sap.ui.test.autowaiter.*#hasPending$");var s=new t({errorPrefix:"sap.ui.test.autowaiter._autoWaiterAsync#extendConfig"});var u;var l;var c={interval:400,timeout:15e3};function g(e){f(e);a.extend(c,e);i.extendConfig(c)}function d(e){if(u){a({error:"waitAsync is already running and cannot be called again at this moment"});return}var t=Date.now();u=true;o.debug("Start polling to check for pending asynchronous work");r.start();n();function n(){var e=Date.now()-t;if(e<=c.timeout){setTimeout(function(){if(i.hasToWait()){l=r.getAndClearLog();n()}else{a({log:"Polling finished successfully. There is no more pending asynchronous work for the moment"});u=false}},c.interval)}else{a({error:"Polling stopped because the timeout of "+c.timeout+" milliseconds has been reached but there is still pending asynchronous work.\n"+"This is the last log of pending work:\n"+l});u=false}}function a(t){if(e){e(t.error)}o.debug(t.error||t.log);r.destroy()}}function f(e){s.validate({allowUnknownProperties:true,inputToValidate:e,validationInfo:{interval:"positivenumeric",timeout:"positivenumeric"}})}return{extendConfig:g,waitAsync:d}},true);