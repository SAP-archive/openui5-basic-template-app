/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/UriParameters","./_utils"],function(t,n){"use strict";var e=Function.prototype.call.bind(Object.prototype.hasOwnProperty);function i(t){return Array.isArray(t)?t:[t]}function o(t){return new Promise(function(n,e){sap.ui.require(i(t),function(){n(Array.prototype.slice.call(arguments))},e)})}function r(t,n,i){if(n){for(var o in n){if(e(i,o)){t[o]=n[o]}}}return t}function u(){function t(t){if(document.body.querySelector("#"+t)==null){var n=document.createElement("div");n.id=t;document.body.insertBefore(n,document.body.firstChild)}}return n.whenDOMReady().then(function(){t("qunit");t("qunit-fixture")})}function a(t){var n=t.sourceFile+":"+t.lineNumber+":"+t.columnNumber,e="Security policy violation: directive '"+t.violatedDirective+"'";if(t.blockedURI){e+=" violated by '"+String(t.blockedURI).slice(0,20)+"'"}if(QUnit.config.current){QUnit.pushFailure(e,n)}else{throw new Error(e+" at "+n)}}var s={altertitle:1,collapse:1,filter:1,fixture:1,hidepassed:1,maxDepth:1,module:1,moduleId:1,notrycatch:1,noglobals:1,seed:1,reorder:1,requireExpects:1,testId:1,testTimeout:1,scrolltop:1};function l(t,n){var i=t.versions;var o=t.version||null;while(typeof o!=="object"){if(!e(i,o)){throw new TypeError("unsupported "+n+" version "+t.version)}o=i[o]}return o}function c(t){var e,i,c,f,d,p,h,v,y;document.title=t.title;if(t.loader){sap.ui.loader.config(t.loader)}if(t.runAfterLoader){e=o(t.runAfterLoader)}else{e=Promise.resolve()}v=l(t.qunit,"qunit");if(v!=null){window.QUnit=window.QUnit||{};QUnit.config=QUnit.config||{};if(t.qunit!=null&&typeof t.qunit==="object"){r(QUnit.config,t.qunit,s)}QUnit.config.autostart=false;i=e.then(function(){return o("sap/ui/test/qunitPause")}).then(function(){n.addStylesheet(v.css);return o(v.module)}).then(function(){y=[];QUnit.jUnitDone=function(t){y.push(t)};return o("sap/ui/qunit/qunit-junit")}).then(function(){delete QUnit.jUnitDone;return o("sap/ui/thirdparty/qunit-reporter-junit")}).then(function(){y.forEach(function(t){QUnit.jUnitDone(t)});y=undefined})}var g=l(t.sinon,"sinon");if(g!=null){c=e.then(function(){return o(g.module)});if(t.sinon.qunitBridge&&i){f=Promise.all([i,c]).then(function(){return o(g.bridge)})}if(t.sinon!=null&&typeof t.sinon==="object"){d=Promise.all([c,f]).then(function(){sinon.config=r(sinon.config||{},t.sinon,sinon.defaultConfig);return arguments})}}else if(v!=null){sap.ui.loader.config({shim:{"sap/ui/thirdparty/sinon-qunit":{deps:[v.module,"sap/ui/thirdparty/sinon"]},"sap/ui/qunit/sinon-qunit-bridge":{deps:[v.module,"sap/ui/thirdparty/sinon-4"]}}})}p=i.then(function(){if(QUnit.urlParams.coverage){return o("sap/ui/thirdparty/blanket").then(function(){if(t.coverage&&window.blanket){if(t.coverage.only!=null){window.blanket.options("sap-ui-cover-only",t.coverage.only)}if(t.coverage.never!=null){window.blanket.options("sap-ui-cover-never",t.coverage.never)}if(t.coverage.branchTracking){window.blanket.options("branchTracking",true)}}return o("sap/ui/qunit/qunit-coverage")}).then(function(){QUnit.config.autostart=false})}else{return o(["sap/ui/qunit/qunit-coverage"])}}).then(function(){if(QUnit.urlParams["sap-ui-xx-csp-policy"]){document.addEventListener("securitypolicyviolation",a);QUnit.done(function(){document.removeEventListener("securitypolicyviolation",a)})}QUnit.config.urlConfig.push({id:"sap-ui-xx-csp-policy",label:"CSP",value:{"sap-target-level-1:report-only":"Level 1","sap-target-level-2:report-only":"Level 2"},tooltip:"What Content-Security-Policy should the server send"});if(QUnit.urlParams["rtf"]||QUnit.urlParams["repeat-to-failure"]){QUnit.done(function(t){if(t.failed===0){setTimeout(function(){location.reload()},100)}})}QUnit.config.urlConfig.push({id:"repeat-to-failure",label:"Repeat",value:false,tooltip:"Whether this test should auto-repeat until it fails"})});h=Promise.all([e,i,c,f,d,p]);if(t.beforeBootstrap){h=h.then(function(){return o(t.beforeBootstrap)})}window["sap-ui-config"]=t.ui5||{};if(Array.isArray(window["sap-ui-config"].libs)){window["sap-ui-config"].libs=window["sap-ui-config"].libs.join(",")}if(t.bootCore){h=h.then(function(){return new Promise(function(t,n){sap.ui.require(["sap/ui/core/Core"],function(n){n.boot();n.attachInit(t)},n)})})}return h.then(function(){if(t.autostart){return o(t.module).then(function(t){return Promise.all(t)}).then(function(){return u()}).then(function(){if(t.ui5["xx-waitfortheme"]==="init"){return new Promise(function(t,n){sap.ui.require(["sap/ui/qunit/utils/waitForThemeApplied"],t,n)}).then(function(t){return t()})}}).then(function(){QUnit.start()})}else{return u().then(function(){return o(t.module).then(function(t){return Promise.all(t)})})}})}var f=t.fromQuery(window.location.search),d=n.getAttribute("data-sap-ui-testsuite")||f.get("testsuite"),p=n.getAttribute("data-sap-ui-test")||f.get("test");n.getSuiteConfig(d).then(function(t){var n=t.tests[p];if(!n){throw new TypeError("Invalid test name")}return c(n)}).catch(function(t){console.error(t.stack||t);if(typeof QUnit!=="undefined"){QUnit.test("Test Starter",function(){throw t});QUnit.start()}else{n.whenDOMReady().then(function(){document.body.style.color="red";document.body.innerHTML="<pre>"+n.encode(t.stack||t.message||String(t))+"</pre>"})}})});