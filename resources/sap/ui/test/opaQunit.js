/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/test/Opa","sap/ui/test/Opa5","sap/ui/thirdparty/jquery","sap/ui/test/qunitPause"],function(e,t,n,i,s){"use strict";s.setupAfterQUnit();QUnit.begin(function(n){if(sap&&sap.ui&&i("#qunit-userAgent").length>0){i("#qunit-userAgent")[0].innerText+="; UI5: "+sap.ui.version}t._usageReport.begin({uri:(new e).toString(),totalTests:n.totalTests})});QUnit.moduleStart(function(e){t._usageReport.moduleStart(e)});QUnit.testStart(function(){t._usageReport.testStart()});QUnit.testDone(function(e){t._usageReport.testDone(e);var n=e.assertions.some(function(e){return!e.result&&e.message==="Test timed out"});if(n){t._stopQueue({qunitTimeout:QUnit.config.testTimeout/1e3})}});QUnit.moduleDone(function(e){t._usageReport.moduleDone(e)});QUnit.done(function(e){t._usageReport.done(e)});window.opaSkip=u;window.opaTest=o;window.opaTodo=QUnit.todo?a:o;function o(){r("test",arguments,function(e,n){t._usageReport.opaEmpty();p();n()},function(e,n,o){t._usageReport.opaEmpty(o);e.ok(false,o.errorMessage);p();if(!s.shouldPauseOnAssert()){s.emitPause()}var a=i.Deferred();s.onResume(function(){if(!o.qunitTimeout){setTimeout(n,0)}a.resolve()});return a.promise()})}function a(){r("todo",arguments,function(e,t){p();t()},function(e,t,n){if(n.qunitTimeout){p()}else{e.ok(false,n.errorMessage);p();setTimeout(t,0)}})}function u(e,t,n,i){c();var s=function(){};if(l()){QUnit.skip(e,s)}else{QUnit.skip(e,t,s,i)}}function r(e,t,n,i){c();var s={testName:t[0],expected:t.length===2?null:t[1],callback:t.length===2?t[1]:t[2],async:t[3]};if(l()&&typeof s.async!=="undefined"){throw new Error("Qunit >=2.0 is used, which no longer supports the 'async' parameter for tests.")}var o=f(s,n,i);var a=[s.testName,o,s.async];if(!l()){a.splice(1,0,s.expected)}QUnit[e].apply(this,a)}function f(e,i,o){return function(a){var u=a.async();t.config.testName=e.testName;t.assert=a;n.assert=a;if(l()&&e.expected!==null){a.expect(e.expected)}e.callback.call(this,t.config.arrangements,t.config.actions,t.config.assertions);s.setupBeforeOpaTest();t.emptyQueue().done(function(){i(a,u)}).fail(function(e){o(a,u,e)})}}function c(){if(!QUnit.config.testTimeout||QUnit.config.testTimeout===3e4){QUnit.config.testTimeout=9e4}QUnit.config.reorder=false;QUnit.config.scrolltop=false}function p(){t.assert=undefined;n.assert=undefined}function l(){return QUnit.test.length===2}QUnit.config.urlConfig.push({id:"opaExecutionDelay",value:{400:"fast",700:"medium",1e3:"slow"},label:"Opa speed",tooltip:"Each waitFor will be delayed by a number of milliseconds. If it is not set Opa will execute the tests as fast as possible"});n._getEventProvider().attachEvent("onExtensionAfterInit",function(e){var n=e.getParameters();if(n.extension.getAssertions){var s=n.extension.getAssertions();i.each(s,function(e,i){QUnit.assert[e]=function(){var e=this;var s=i.apply(n.appWindow,arguments).always(function(t){e.push(t.result,t.actual,t.expected,t.message)});t.config.assertions._schedulePromiseOnFlow(s)}})}});return o});