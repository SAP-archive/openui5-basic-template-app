/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/Device","./NotificationListBase","sap/ui/core/InvisibleText","sap/ui/core/IconPool","sap/ui/core/Icon","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/m/Link","sap/m/Avatar","sap/ui/events/KeyCodes","./NotificationListItemRenderer"],function(t,e,i,r,s,o,a,n,u,p,h,l,g){"use strict";var f=e.getLibraryResourceBundle("sap.m"),I=f.getText("NOTIFICATION_LIST_ITEM_SHOW_MORE"),c=f.getText("NOTIFICATION_LIST_ITEM_SHOW_LESS"),_=f.getText("NOTIFICATION_LIST_ITEM_READ"),T=f.getText("NOTIFICATION_LIST_ITEM_UNREAD");var d=44;var v=t.AvatarSize;var y=t.AvatarColor;var A=u.Priority;var L=r.extend("sap.m.NotificationListItem",{metadata:{library:"sap.m",properties:{description:{type:"string",group:"Appearance",defaultValue:""},authorInitials:{type:"string",group:"Data",defaultValue:null},truncate:{type:"boolean",group:"Appearance",defaultValue:true},hideShowMoreButton:{type:"boolean",group:"Appearance",defaultValue:false},authorAvatarColor:{type:"sap.m.AvatarColor",group:"Appearance",defaultValue:y.Accent6}},aggregations:{processingMessage:{type:"sap.m.MessageStrip",multiple:false},_showMoreButton:{type:"sap.m.Link",multiple:false,visibility:"hidden"}}}});L.prototype.init=function(){this.setType("Active");this._footerIvisibleText=new s({id:this.getId()+"-invisibleFooterText"})};L.prototype._getAuthorAvatar=function(){if(this.getAuthorInitials()||this.getAuthorPicture()){if(!this._avatar){this._avatar=new h({displaySize:v.XS})}this._avatar.setInitials(this.getAuthorInitials());this._avatar.setSrc(this.getAuthorPicture());this._avatar.setBackgroundColor(this.getAuthorAvatarColor());return this._avatar}};L.prototype.onBeforeRendering=function(){r.prototype.onBeforeRendering.call(this);if(this._resizeListenerId){n.deregister(this._resizeListenerId);this._resizeListenerId=null}};L.prototype.onAfterRendering=function(){if(this.getHideShowMoreButton()){return}this._updateShowMoreButtonVisibility();if(this.getDomRef()){this._resizeListenerId=n.register(this.getDomRef(),this._onResize.bind(this))}};L.prototype.onfocusin=function(t){r.prototype.onfocusin.apply(this,arguments);if(!i.browser.msie){return}var e=t.target;if(e!==this.getDomRef()&&!e.classList.contains("sapMBtn")&&!e.classList.contains("sapMLnk")){t.preventDefault();t.stopImmediatePropagation();this.focus()}};L.prototype.onkeydown=function(t){if(t.target!==this.getDomRef()){return}var e=this.getParent(),i,r;if(!e||!e.isA("sap.m.NotificationListGroup")){return}i=e.getVisibleItems();r=i.indexOf(this);switch(t.which){case l.ARROW_UP:if(r===0){return}var s=r-1;i[s].focus();break;case l.ARROW_DOWN:var o=r+1;if(o===i.length){return}i[o].focus();break}};L.prototype.exit=function(){r.prototype.exit.apply(this,arguments);if(this._resizeListenerId){n.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this._footerIvisibleText){this._footerIvisibleText.destroy();this._footerIvisibleText=null}if(this._avatar){this._avatar.destroy();this._avatar=null}};L.prototype._onResize=function(){this._updateShowMoreButtonVisibility()};L.prototype._updateShowMoreButtonVisibility=function(){var t=this.$(),e=t.find(".sapMNLITitleText")[0],i=t.find(".sapMNLIDescription")[0],r;if(t.length>0){r=e.scrollHeight>d||i.scrollHeight>d}this._getShowMoreButton().setVisible(r)};L.prototype._getShowMoreButton=function(){var t=this.getAggregation("_showMoreButton");if(!t){t=new p(this.getId()+"-showMoreButton",{text:this.getTruncate()?I:c,press:function(){var t=!this.getTruncate();this._getShowMoreButton().setText(t?I:c);this.setTruncate(t)}.bind(this)});this.setAggregation("_showMoreButton",t,true)}return t};L.prototype._getFooterInvisibleText=function(){var t=this.getUnread()?T:_,e=this.getAuthorName(),i=this.getDatetime(),r=this.getPriority(),s=[t];if(e){e=f.getText("NOTIFICATION_LIST_ITEM_CREATED_BY");s.push(e);s.push(this.getAuthorName())}if(i){s.push(f.getText("NOTIFICATION_LIST_ITEM_DATETIME",[i]))}if(r!==A.None){s.push(f.getText("NOTIFICATION_LIST_ITEM_PRIORITY",[r]))}return this._footerIvisibleText.setText(s.join(" "))};return L});