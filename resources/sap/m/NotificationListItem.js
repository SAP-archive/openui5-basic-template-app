/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Core","./NotificationListBase","sap/ui/core/InvisibleText","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/m/Link","sap/m/Avatar","sap/ui/events/KeyCodes","./NotificationListItemRenderer"],function(t,e,i,r,s,o,a,n,u,h){"use strict";var p=e.getLibraryResourceBundle("sap.m"),l=p.getText("NOTIFICATION_LIST_ITEM_SHOW_MORE"),g=p.getText("NOTIFICATION_LIST_ITEM_SHOW_LESS"),I=p.getText("NOTIFICATION_LIST_ITEM_READ"),_=p.getText("NOTIFICATION_LIST_ITEM_UNREAD");var f=44;var T=t.AvatarSize;var c=t.AvatarColor;var d=o.Priority;var v=i.extend("sap.m.NotificationListItem",{metadata:{library:"sap.m",properties:{description:{type:"string",group:"Appearance",defaultValue:""},authorInitials:{type:"string",group:"Data",defaultValue:null},truncate:{type:"boolean",group:"Appearance",defaultValue:true},hideShowMoreButton:{type:"boolean",group:"Appearance",defaultValue:false},authorAvatarColor:{type:"sap.m.AvatarColor",group:"Appearance",defaultValue:c.Accent6}},aggregations:{processingMessage:{type:"sap.m.MessageStrip",multiple:false},_showMoreButton:{type:"sap.m.Link",multiple:false,visibility:"hidden"}}}});v.prototype.init=function(){this.setType("Active");this._footerIvisibleText=new r({id:this.getId()+"-invisibleFooterText"})};v.prototype._getAuthorAvatar=function(){if(this.getAuthorInitials()||this.getAuthorPicture()){if(!this._avatar){this._avatar=new n({displaySize:T.XS})}this._avatar.setInitials(this.getAuthorInitials());this._avatar.setSrc(this.getAuthorPicture());this._avatar.setBackgroundColor(this.getAuthorAvatarColor());return this._avatar}};v.prototype.onBeforeRendering=function(){i.prototype.onBeforeRendering.call(this);if(this._resizeListenerId){s.deregister(this._resizeListenerId);this._resizeListenerId=null}};v.prototype.onAfterRendering=function(){if(this.getHideShowMoreButton()){return}this._updateShowMoreButtonVisibility();if(this.getDomRef()){this._resizeListenerId=s.register(this.getDomRef(),this._onResize.bind(this))}};v.prototype.onkeydown=function(t){if(t.target!==this.getDomRef()){return}var e=this.getParent(),i,r;if(!e||!e.isA("sap.m.NotificationListGroup")){return}i=e.getVisibleItems();r=i.indexOf(this);switch(t.which){case u.ARROW_UP:if(r===0){return}var s=r-1;i[s].focus();break;case u.ARROW_DOWN:var o=r+1;if(o===i.length){return}i[o].focus();break}};v.prototype.exit=function(){i.prototype.exit.apply(this,arguments);if(this._resizeListenerId){s.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this._footerIvisibleText){this._footerIvisibleText.destroy();this._footerIvisibleText=null}if(this._avatar){this._avatar.destroy();this._avatar=null}};v.prototype._onResize=function(){this._updateShowMoreButtonVisibility()};v.prototype._updateShowMoreButtonVisibility=function(){var t=this.$(),e=t.find(".sapMNLITitleText")[0],i=t.find(".sapMNLIDescription")[0],r;if(t.length>0){r=e.scrollHeight>f||i.scrollHeight>f}this._getShowMoreButton().setVisible(r)};v.prototype._getShowMoreButton=function(){var t=this.getAggregation("_showMoreButton");if(!t){t=new a(this.getId()+"-showMoreButton",{text:this.getTruncate()?l:g,press:function(){var t=!this.getTruncate();this._getShowMoreButton().setText(t?l:g);this.setTruncate(t)}.bind(this)});this.setAggregation("_showMoreButton",t,true)}return t};v.prototype._getFooterInvisibleText=function(){var t=this.getUnread()?_:I,e=this.getAuthorName(),i=this.getDatetime(),r=this.getPriority(),s=[t];if(e){e=p.getText("NOTIFICATION_LIST_ITEM_CREATED_BY");s.push(e);s.push(this.getAuthorName())}if(i){s.push(p.getText("NOTIFICATION_LIST_ITEM_DATETIME",[i]))}if(r!==d.None){s.push(p.getText("NOTIFICATION_LIST_ITEM_PRIORITY",[r]))}return this._footerIvisibleText.setText(s.join(" "))};return v});