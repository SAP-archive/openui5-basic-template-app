/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/library","sap/ui/core/Control","./FormattedTextAnchorGenerator","./FormattedTextRenderer","sap/base/Log","sap/base/security/URLListValidator","sap/base/security/sanitizeHTML"],function(e,t,r,a,i,s,n,l){"use strict";var o=e.LinkConversion,u=t.TextDirection,p=t.TextAlign;var c=r.extend("sap.m.FormattedText",{metadata:{library:"sap.m",properties:{htmlText:{type:"string",group:"Misc",defaultValue:""},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},convertLinksToAnchorTags:{type:"sap.m.LinkConversion",group:"Behavior",defaultValue:o.None},convertedLinksDefaultTarget:{type:"string",group:"Behavior",defaultValue:"_blank"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:u.Inherit},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:p.Begin}},aggregations:{controls:{type:"sap.m.Link",multiple:true,singularName:"control"}}}});var g={ATTRIBS:{style:1,class:1,"a::href":1,"a::target":1,dir:1},ELEMENTS:{a:{cssClass:"sapMLnk"},abbr:1,bdi:1,blockquote:1,br:1,cite:1,code:1,em:1,h1:{cssClass:"sapMTitle sapMTitleStyleH1"},h2:{cssClass:"sapMTitle sapMTitleStyleH2"},h3:{cssClass:"sapMTitle sapMTitleStyleH3"},h4:{cssClass:"sapMTitle sapMTitleStyleH4"},h5:{cssClass:"sapMTitle sapMTitleStyleH5"},h6:{cssClass:"sapMTitle sapMTitleStyleH6"},p:1,pre:1,strong:1,span:1,u:1,dl:1,dt:1,dd:1,ol:1,ul:1,li:1}},f={ATTRIBS:{"a::href":1,"a::target":1},ELEMENTS:{a:{cssClass:"sapMLnk"},br:1,em:1,strong:1,u:1}};c.prototype._renderingRules=g;c.prototype.init=function(){};function h(e,t){var r;var a,i,l=e==="a";var o=this._renderingRules.ELEMENTS[e].cssClass||"";for(var u=0;u<t.length;u+=2){a=t[u];i=t[u+1];if(!this._renderingRules.ATTRIBS[a]&&!this._renderingRules.ATTRIBS[e+"::"+a]){r="FormattedText: <"+e+"> with attribute ["+a+'="'+i+'"] is not allowed';s.warning(r,this);t[u+1]=null;continue}if(a=="href"){if(!n.validate(i)){s.warning("FormattedText: incorrect href attribute:"+i,this);t[u+1]="#";l=false}}if(a=="target"){l=false}if(o&&a.toLowerCase()=="class"){t[u+1]=o+" "+i;o=""}}if(l){t.push("target");t.push("_blank")}if(o){t.push("class");t.push(o)}return t}function d(e,t){if(this._renderingRules.ELEMENTS[e]){return h.call(this,e,t)}else{var r="<"+e+"> is not allowed";s.warning(r,this)}}function T(e){return l(e,{tagPolicy:d.bind(this),uriRewriter:function(e){if(n.validate(e)){return e}}})}function y(e){var t=window.open();t.opener=null;t.location=e.currentTarget.href;e.preventDefault()}c.prototype.onAfterRendering=function(){this.$().find('a[target="_blank"]').on("click",y)};c.prototype.onBeforeRendering=function(){this.$().find('a[target="_blank"]').off("click",y)};c.prototype._getDisplayHtml=function(){var e=this.getHtmlText(),t=this.getConvertLinksToAnchorTags();if(t===o.None){return e}e=a.generateAnchors(e,t,this.getConvertedLinksDefaultTarget());return T.call(this,e)};c.prototype.setHtmlText=function(e){return this.setProperty("htmlText",T.call(this,e))};c.prototype._setUseLimitedRenderingRules=function(e){this._renderingRules=e?f:g};return c});