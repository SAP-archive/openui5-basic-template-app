/*!
* OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/library","sap/ui/Device","sap/ui/base/ManagedObject","sap/m/Link","sap/m/Text","sap/m/Button","sap/m/ResponsivePopover","sap/m/HyphenationSupport","./ExpandableTextRenderer"],function(e,t,r,a,i,n,o,p,s,l,d,g){"use strict";var u=t.getLibraryResourceBundle("sap.m");var c=u.getText("EXPANDABLE_TEXT_SHOW_MORE");var h=u.getText("EXPANDABLE_TEXT_SHOW_LESS");var x=u.getText("MSGBOX_CLOSE");var f=a.TextAlign;var y=a.TextDirection;var T=a.aria.HasPopup;var m=e.WrappingType;var v=e.PlacementType;var b=e.ExpandableTextOverflowMode;var _=e.EmptyIndicatorMode;function A(e){return e.replace(/ {2,}/g," ").replace(/\t{2,}/g," ")}var M=r.extend("sap.m.ExpandableText",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.m.IHyphenation"],library:"sap.m",properties:{text:{type:"string",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:y.Inherit},wrappingType:{type:"sap.m.WrappingType",group:"Appearance",defaultValue:m.Normal},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:f.Begin},renderWhitespace:{type:"boolean",group:"Appearance",defaultValue:false},overflowMode:{type:"sap.m.ExpandableTextOverflowMode",group:"Appearance",defaultValue:b.InPlace},maxCharacters:{type:"int",group:"Appearance",defaultValue:100},expanded:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},emptyIndicatorMode:{type:"sap.m.EmptyIndicatorMode",group:"Appearance",defaultValue:_.Off}},aggregations:{_showMoreLink:{type:"sap.m.Link",multiple:false,visibility:"hidden"}},designtime:"sap/m/designtime/ExpandableText.designtime"}});M.prototype.getText=function(e){var t=this.getProperty("text");if(e){return t.replace(/\r\n|\n\r|\r/g,"\n")}return t};M.prototype.getTextDomRef=function(){if(!this.getVisible()){return null}return this.getDomRef("string")};M.prototype._isExpandable=function(){var e=this.getText();if(!this.getRenderWhitespace()){e=A(e)}return e.length>this._getMaxCharacters()+c.length};M.prototype._getMaxCharacters=function(){return Math.max(0,this.getMaxCharacters())};M.prototype._getDisplayedText=function(){var e=this.getText(true);if(this.getProperty("expanded")||!this._isExpandable()){return e}if(!this.getRenderWhitespace()){e=A(e)}return e.substring(0,this._getMaxCharacters())};M.prototype._getShowMoreLink=function(){var e=this.getAggregation("_showMoreLink");if(!e){e=new o(this.getId()+"-showMoreLink",{text:this.getProperty("expanded")?h:c,press:function(t){var r,a,o;if(this.getOverflowMode()===b.InPlace){a=!this.getProperty("expanded");e.setText(a?h:c);this.setProperty("expanded",a)}else{r=new p({text:n.escapeSettingsValue(this.getText()),textDirection:this.getTextDirection(),wrappingType:this.getWrappingType(),textAlign:this.getTextAlign(),renderWhitespace:this.getRenderWhitespace()}).addStyleClass("sapUiSmallMargin").addStyleClass("sapMExTextPopover");o=this._oPopover;if(o&&o.isOpen()){o.close();return}if(!o){o=this._oPopover=new l({showHeader:false,placement:v.HorizontalPreferredRight,beforeClose:this._onPopoverBeforeClose.bind(this)});if(i.system.phone){o.setEndButton(new s({text:x,press:function(){o.close()}}))}this.addDependent(o)}e.setText(h);e.rerender();o.removeAllAriaLabelledBy();o.destroyContent();o.addAriaLabelledBy(r);o.addContent(r);o.openBy(t.getSource())}}.bind(this)});this.setAggregation("_showMoreLink",e,true)}e.setAriaHasPopup(this.getOverflowMode()===b.InPlace?T.None:T.Dialog);return e};M.prototype._onPopoverBeforeClose=function(){this._getShowMoreLink().setText(c)};M.prototype.exit=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null}};M.prototype.getAccessibilityInfo=function(){return{description:this.getText()}};M.prototype.getTextsToBeHyphenated=function(){return{main:this._getDisplayedText(true)}};M.prototype.getDomRefsForHyphenatedTexts=function(){return{main:this.getTextDomRef()}};d.mixInto(M.prototype);return M});