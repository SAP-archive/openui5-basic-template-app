/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/Element","sap/ui/Device","./ListItemBase","./Button","./ToolbarSeparator","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/ui/core/IconPool","sap/ui/core/Icon","sap/ui/core/library"],function(t,e,o,r,n,i,s,a,l,u,p,f,g){"use strict";var h=g.Priority;var c=t.ButtonType;var y=t.OverflowToolbarPriority;var v=e.getLibraryResourceBundle("sap.m"),d=v.getText("NOTIFICATION_LIST_ITEM_CLOSE"),w=v.getText("NOTIFICATION_LIST_GROUP_CLOSE");var B=i.extend("sap.m.NotificationListBase",{metadata:{library:"sap.m",abstract:true,properties:{priority:{type:"sap.ui.core.Priority",group:"Appearance",defaultValue:h.None},title:{type:"string",group:"Appearance",defaultValue:""},datetime:{type:"string",group:"Appearance",defaultValue:""},showButtons:{type:"boolean",group:"Behavior",defaultValue:true},showCloseButton:{type:"boolean",group:"Behavior",defaultValue:true},authorName:{type:"string",group:"Appearance",defaultValue:""},authorPicture:{type:"sap.ui.core.URI"}},aggregations:{buttons:{type:"sap.m.Button",multiple:true},_closeButton:{type:"sap.m.Button",multiple:false,visibility:"hidden"},_overflowToolbar:{type:"sap.m.OverflowToolbar",multiple:false,visibility:"hidden"},_priorityIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},events:{close:{}}},renderer:null});B.prototype._activeHandling=function(){};B.prototype.updateSelectedDOM=function(){};B.prototype.getAccessibilityText=function(){return""};B.prototype.getButtons=function(){var t=this._getCloseButton(),e=this._getToolbarSeparator();return this._getOverflowToolbar().getContent().filter(function(o){return o!==t&&o!==e},this)};B.prototype.addButton=function(t){var e=this._getOverflowToolbar(),o=e.getContent().length;if(n.system.phone){o-=2}e.insertContent(t,o);this.invalidate();return this};B.prototype.insertButton=function(t,e){this._getOverflowToolbar().insertContent(t,e);this.invalidate();return this};B.prototype.removeButton=function(t){var e=this._getOverflowToolbar().removeContent(t.getId());this.invalidate();return e};B.prototype.removeAllButtons=function(){var t=this._getOverflowToolbar(),e=this.getButtons();e.forEach(function(e){t.removeContent(e.getId())});this.invalidate();return this};B.prototype.destroyButtons=function(){var t=this.getButtons();t.forEach(function(t){t.destroy()});this.invalidate();return this};B.prototype.clone=function(){var t=i.prototype.clone.apply(this,arguments);t.destroyAggregation("_overflowToolbar");var e=this.getAggregation("_overflowToolbar");if(e){t.setAggregation("_overflowToolbar",e.clone(),true)}return t};B.prototype._getOverflowToolbar=function(){var t=this.getAggregation("_overflowToolbar"),e,o;if(!t){t=new l(this.getId()+"-overflowToolbar",{});this.setAggregation("_overflowToolbar",t,true);if(n.system.phone){o=this._getCloseButton();o.setLayoutData(new u({priority:y.AlwaysOverflow}));e=new a;e.setLayoutData(new u({priority:y.AlwaysOverflow}));t.addContent(e);t.addContent(o)}}return t};B.prototype._getCloseButton=function(){var t,e,o,r;if(n.system.phone){e=this._getOverflowToolbar();o=e.getContent();if(e&&o.length){r=o.length-1;t=o[r]}}else{t=this.getAggregation("_closeButton")}if(!t){if(n.system.phone){t=new s(this.getId()+"-closeButtonOverflow",{text:this.isA("sap.m.NotificationListItem")?d:w,type:c.Default,press:function(){this.close()}.bind(this)})}else{t=new s(this.getId()+"-closeButtonX",{icon:p.getIconURI("decline"),type:c.Transparent,tooltip:this.isA("sap.m.NotificationListItem")?d:w,press:function(){this.close()}.bind(this)});this.setAggregation("_closeButton",t)}}return t};B.prototype._getToolbarSeparator=function(){if(!n.system.phone){return null}var t,e=this._getOverflowToolbar(),o=e.getContent(),r;if(e&&o.length){r=o.length-2;t=o[r]}return t};B.prototype.exit=function(){};B.prototype._hasActionButtons=function(){return this.getShowButtons()&&this.getButtons().length};B.prototype._shouldRenderCloseButton=function(){return!n.system.phone&&this.getShowCloseButton()};B.prototype._shouldRenderOverflowToolbar=function(){var t=this._hasActionButtons();if(n.system.phone){return t||this.getShowCloseButton()}return t};B.prototype.onBeforeRendering=function(){var t=this.getButtons(),e,o;if(n.system.phone){this._updatePhoneButtons();return}e=t.length>1?y.AlwaysOverflow:y.NeverOverflow;for(var r=0;r<t.length;r++){o=t[r];o.setLayoutData(new u({priority:r===0?e:y.AlwaysOverflow}))}};B.prototype._updatePhoneButtons=function(){var t=this._getCloseButton(),e=this.isA("sap.m.NotificationListGroup"),o=e?w:d,r=e&&this.getCollapsed(),n=!r&&this._hasActionButtons(),i=this.getShowCloseButton(),s=this._getToolbarSeparator(),a;this.getButtons().forEach(function(t){if(n){a=y.AlwaysOverflow;t.removeStyleClass("sapMNLIBHiddenButton")}else{a=y.NeverOverflow;t.addStyleClass("sapMNLIBHiddenButton")}t.setLayoutData(new u({priority:a}))});if(!i){t.setVisible(false);s.setVisible(false);return}t.setVisible(true);if(n){t.setText(o);t.setTooltip("");t.setType(c.Default);t.setIcon("");t.setLayoutData(new u({priority:y.AlwaysOverflow}));s.setVisible(true)}else{t.setText("");t.setTooltip(o);t.setType(c.Transparent);t.setIcon(p.getIconURI("decline"));t.setLayoutData(new u({priority:y.NeverOverflow}));s.setVisible(false)}};B.prototype.close=function(){var t=this.getParent();this.fireClose();var e=!!this.getParent();if(!e&&t&&t instanceof r){var o={onAfterRendering:function(){t.focus();t.removeEventDelegate(o)}};t.addEventDelegate(o)}};B.prototype._getPriorityIcon=function(){var t=this.getAggregation("_priorityIcon");if(!t){t=new f({src:"sap-icon://message-error",useIconTooltip:false});this.setAggregation("_priorityIcon",t,true)}return t};return B});