/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ListItemBase","./library","sap/ui/core/IconPool","sap/ui/core/Icon","./TreeItemBaseRenderer","sap/ui/events/KeyCodes"],function(e,t,r,n,o,i){"use strict";var s=t.ListMode;var p=e.extend("sap.m.TreeItemBase",{metadata:{library:"sap.m"}});p.prototype.ExpandedIconURI=r.getIconURI("navigation-down-arrow");p.prototype.CollapsedIconURI=r.getIconURI("navigation-right-arrow");p.prototype.getTree=function(){var e=this.getParent();if(e&&e.isA("sap.m.Tree")){return e}};p.prototype.getList=p.prototype.getTree;p.prototype.informTree=p.prototype.informList;p.prototype.getItemNodeContext=function(){var e=this.getTree();var t=null;var r=e?e.getBinding("items"):null;if(e&&r){r=e.getBinding("items");t=r.getNodeByIndex(e.indexOfItem(this))}return t};p.prototype.getParentNode=function(){if(this.isTopLevel()){return}var e=this.getTree(),t=this.getLevel(),r=null,n=e.indexOfItem(this)-1,o=e.getItems(),i;while(n>=0){i=o[n].getLevel();if(i===t-1){r=o[n];break}n--}return r};p.prototype.getParentNodeContext=function(){return this.getItemNodeContext().parent};p.prototype.isLeaf=function(){var e=this.getTree(),t=this.getItemNodeContext();return t?!e.getBinding("items").nodeHasChildren(t):false};p.prototype.isTopLevel=function(){return this.getLevel()===0};p.prototype.getLevel=function(){return(this.getItemNodeContext()||{}).level};p.prototype.getExpanded=function(){var e=this.getTree();if(!e){return false}var t=e.indexOfItem(this);var r=e.getBinding("items");return r&&r.isExpanded(t)};p.prototype.setSelected=function(t){e.prototype.setSelected.apply(this,arguments);var r=this.getTree();var n=r?r.getBinding("items"):null;var o=-1;if(r&&n){o=r.indexOfItem(this);if(r.getMode()===s.SingleSelect){n.setSelectedIndex(o)}if(r.getMode()===s.MultiSelect){if(t){n.addSelectionInterval(o,o)}else{n.removeSelectionInterval(o,o)}}}return this};p.prototype._getExpanderControl=function(){var e=this.CollapsedIconURI,t=sap.ui.getCore().getLibraryResourceBundle("sap.m"),r=t.getText("TREE_ITEM_EXPAND_NODE");if(this.getExpanded()){e=this.ExpandedIconURI;r=t.getText("TREE_ITEM_COLLAPSE_NODE")}if(this._oExpanderControl){this._oExpanderControl.setSrc(e);this._oExpanderControl.setTooltip(r);return this._oExpanderControl}this._oExpanderControl=new n({id:this.getId()+"-expander",src:e,tooltip:r,noTabStop:true}).setParent(this,null,true).addStyleClass("sapMTreeItemBaseExpander").attachPress(function(e){this.informTree("ExpanderPressed")},this);return this._oExpanderControl};p.prototype.invalidate=function(){e.prototype.invalidate.apply(this,arguments);this._bInvalidated=true};p.prototype.onAfterRendering=function(){e.prototype.onAfterRendering.apply(this,arguments);this._bInvalidated=false};p.prototype.setBindingContext=function(){e.prototype.setBindingContext.apply(this,arguments);this.invalidate();return this};p.prototype._getPadding=function(){var e=this.getTree(),t=this.getLevel(),r=0,n;if(e){n=e.getDeepestLevel()}if(n<t){e._iDeepestLevel=t;n=e._iDeepestLevel}if(n<2){r=t*1.5}else if(n===2){r=t*1}else if(n<6){r=t*.5}else{r=t*.25}return r};p.prototype.onsapplus=function(e){this.informTree("ExpanderPressed",true)};p.prototype.onsapminus=function(e){this.informTree("ExpanderPressed",false)};p.prototype.onsapright=function(e){if(e.srcControl!==this||this.isLeaf()){return}if(!this.getExpanded()){this.informTree("ExpanderPressed",true)}else{e.keyCode=i.ARROW_DOWN}};p.prototype.onsapleft=function(e){if(e.srcControl!==this||this.isTopLevel()&&!this.getExpanded()){return}if(!this.isLeaf()){if(this.getExpanded()){this.informTree("ExpanderPressed",false)}else{this.getParentNode().focus()}}else{this.getParentNode().focus()}};p.prototype.onsapbackspace=function(e){if(e.srcControl!==this){return}if(!this.isTopLevel()){this.getParentNode().focus()}};p.prototype.getAccessibilityType=function(e){return e.getText("ACC_CTR_TYPE_TREEITEM")};p.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.destroyControls(["Expander"])};p.prototype.onlongdragover=function(e){this.informTree("LongDragOver")};return p});