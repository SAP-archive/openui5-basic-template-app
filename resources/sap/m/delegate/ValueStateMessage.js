/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/Object","sap/ui/core/Core","sap/ui/core/ValueStateSupport","sap/ui/core/Popup","sap/ui/core/library","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Aria"],function(t,e,o,a,r,s,i){"use strict";var n=s.ValueState;var u=e.extend("sap.m.delegate.ValueState",{constructor:function(t){e.apply(this,arguments);this._oControl=t;this._oPopup=null}});u.prototype.open=function(){var e=this._oControl,o=this.getPopup(),a=this.createDom(),s=r.Dock,n;if(!e||!e.getDomRef()||!o||!a){return}n=i(e.getDomRefForValueStateMessage());o.setContent(a);o.close(0);if(o.getContent()){o.getContent().style.maxWidth=e.getDomRef().offsetWidth+"px"}else{o.getContent().style.maxWidth=""}o.open(this.getOpenDuration(),s.BeginTop,s.BeginBottom,e.getDomRefForValueStateMessage(),null,null,t.system.phone?true:r.CLOSE_ON_SCROLL);var u=i(a);if(n.offset().top<u.offset().top){u.addClass("sapMValueStateMessageBottom")}else{u.addClass("sapMValueStateMessageTop")}};u.prototype.close=function(){if(this._oPopup){this._oPopup.close(0)}};u.prototype.getId=function(){var t=this._oControl;if(!t){return""}return typeof t.getValueStateMessageId==="function"?t.getValueStateMessageId():t.getId()+"-message"};u.prototype.getOpenDuration=function(){var t=this._oControl;if(!t){return 0}return t.iOpenMessagePopupDuration===undefined?0:t.iOpenMessagePopupDuration};u.prototype.createPopup=function(e){e=e||this.getId();if(this._oPopup){return this._oPopup}this._oPopup=new r(document.createElement("span"),false,false,false);this._oPopup.attachClosed(function(){i(document.getElementById(e)).remove()});this._oPopup.attachOpened(function(){var e=this._oPopup.getContent(),o=t.browser.msie&&this._oControl&&this._oControl.getFormattedValueStateText&&!!this._oControl.getFormattedValueStateText();if(e&&!o){e.style.zIndex=this._getCorrectZIndex()}}.bind(this));return this._oPopup};u.prototype.getPopup=function(){if(!this._oControl){return null}return this.createPopup()};u.prototype._getValueStateText=function(t,e){if(e===n.Success||e===n.None){return""}var o=t.getFormattedValueStateText&&t.getFormattedValueStateText();var r=o&&o.getHtmlText();var s=t.getValueStateText()||a.getAdditionalText(t);return r?o:s};u.prototype.createDom=function(){var e=this._oControl;if(!e){return null}var a=this.getId(),r,s=document.createElement("div"),i=e.getValueState(),u=this._getValueStateText(e,i);if(i===n.Success||i===n.None){s.className="sapUiInvisibleText"}else{s.className="sapMValueStateMessage sapMValueStateMessage"+i}if(typeof u==="string"){r=document.createElement("span");r.id=a+"-text";r.appendChild(document.createTextNode(u));s.appendChild(r)}else{o.getRenderManager().render(u,s);s.lastElementChild.setAttribute("id",a+"-text")}if(!r){s.lastElementChild.setAttribute("id",a+"-text")}else if(!e.isA("sap.m.Select")&&t.browser.msie){r.setAttribute("aria-hidden","true")}s.id=a;s.setAttribute("role","tooltip");s.setAttribute("aria-live","off");s.setAttribute("aria-hidden","true");return s};u.prototype.destroy=function(){if(this._oPopup){this._oPopup.destroy();this._oPopup=null}this._oControl=null};u.prototype._getCorrectZIndex=function(){var t=this._oControl.$().parents().filter(function(){var t=i(this).css("z-index");return t&&t!=="auto"&&t!=="0"});if(!t.length){return 1}var e=0;t.each(function(){var t=parseInt(i(this).css("z-index"));if(t>e){e=t}});return e+1};return u});