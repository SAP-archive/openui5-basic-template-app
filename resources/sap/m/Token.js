/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","./Tokenizer","sap/ui/core/library","sap/ui/core/Icon","./TokenRenderer","sap/ui/events/KeyCodes"],function(e,t,i,s,o,n,r){"use strict";var a=s.TextDirection;var l=t.extend("sap.m.Token",{metadata:{library:"sap.m",properties:{selected:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},text:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:a.Inherit}},aggregations:{deleteIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{delete:{},press:{},select:{},deselect:{}}}});l.prototype.init=function(){var e=this;this._deleteIcon=new o({id:e.getId()+"-icon",src:"sap-icon://sys-cancel",noTabStop:true,press:function(t){var s=e.getParent();e.fireDelete({token:e});if(s instanceof i){s._onTokenDelete(e)}t.preventDefault()}});this._deleteIcon.addStyleClass("sapMTokenIcon");this.setAggregation("deleteIcon",this._deleteIcon);this._deleteIcon.setUseIconTooltip(false)};l.prototype.ontouchstart=function(e){if(e.target.id===this.getId()+"-icon"){e.preventDefault()}};l.prototype.setSelected=function(e){if(this.getSelected()===e){return this}var t=this.$();if(t){t.toggleClass("sapMTokenSelected",e);t.attr("aria-selected",e)}this.setProperty("selected",e,true);return this};l.prototype.setEditable=function(e){var t=this.getParent();this.setProperty("editable",e,true);this.$().toggleClass("sapMTokenReadOnly",!e);if(t instanceof i){t.invalidate()}return this};l.prototype._onTokenPress=function(e){var t=this.getSelected(),s=e.ctrlKey||e.metaKey,o=e.shiftKey,n=true,r;if(s){n=!t}this.setSelected(n);this.firePress();if(t!=n){if(n){this.fireSelect()}else{this.fireDeselect()}}r=this.getParent();if(r instanceof i){r._onTokenSelect(this,s,o)}if(this.getSelected()){this.focus()}};l.prototype._changeSelection=function(e){if(this.getSelected()==e){return}this.setSelected(e);if(e){this.fireSelect()}else{this.fireDeselect()}};l.prototype.ontap=function(e){if(e.target.id==this._deleteIcon.getId()){e.setMark("tokenDeletePress",true);return}this._onTokenPress(e)};l.prototype.onsapfocusleave=function(e){if(this.getParent()instanceof i){return}this.setSelected(false)};l.prototype.onsapbackspace=function(e){this._deleteToken(e)};l.prototype.onsapdelete=function(e){this._deleteToken(e)};l.prototype._deleteToken=function(e){if(this.getParent()instanceof i){return}if(this.getEditable()){this.fireDelete({token:this})}e.preventDefault()};l.prototype.onsapspace=function(e){this._onTokenPress(e);if(e){e.preventDefault();e.stopPropagation()}};l.prototype.onkeydown=function(e){if((e.ctrlKey||e.metaKey)&&e.which===r.SPACE){this.onsapspace(e);e.preventDefault()}};return l});