/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./InputBase","./Popover","sap/ui/core/Item","./ColumnListItem","./GroupHeaderListItem","./StandardListItem","sap/ui/core/SeparatorItem","./List","./Table","./library","sap/ui/core/IconPool","sap/ui/Device","sap/ui/core/Control","./SuggestionsPopover","./Toolbar","./ToolbarSpacer","./Button","sap/ui/dom/containsOrEquals","sap/base/assert","sap/base/util/deepEqual","sap/m/inputUtils/wordStartsWithValue","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/highlightDOMElements","./InputRenderer","sap/ui/base/ManagedObject","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/selectText"],function(e,t,s,o,i,u,n,r,g,p,a,l,h,S,c,f,_,d,v,y,m,P,I,b,V,T){"use strict";var w=p.ListType;var R=p.InputTextFormatMode;var L=p.InputType;var M=p.ListMode;var A=p.ListSeparators;var F=e.extend("sap.m.Input",{metadata:{library:"sap.m",properties:{type:{type:"sap.m.InputType",group:"Data",defaultValue:L.Text},maxLength:{type:"int",group:"Behavior",defaultValue:0},dateFormat:{type:"string",group:"Misc",defaultValue:"YYYY-MM-dd",deprecated:true},showValueHelp:{type:"boolean",group:"Behavior",defaultValue:false},valueHelpIconSrc:{type:"sap.ui.core.URI",group:"Behavior",defaultValue:"sap-icon://value-help"},showSuggestion:{type:"boolean",group:"Behavior",defaultValue:false},valueHelpOnly:{type:"boolean",group:"Behavior",defaultValue:false},filterSuggests:{type:"boolean",group:"Behavior",defaultValue:true},maxSuggestionWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},startSuggestion:{type:"int",group:"Behavior",defaultValue:1},showTableSuggestionValueHelp:{type:"boolean",group:"Behavior",defaultValue:true},description:{type:"string",group:"Misc",defaultValue:null},fieldWidth:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"50%"},valueLiveUpdate:{type:"boolean",group:"Behavior",defaultValue:false},selectedKey:{type:"string",group:"Data",defaultValue:""},textFormatMode:{type:"sap.m.InputTextFormatMode",group:"Misc",defaultValue:R.Value},textFormatter:{type:"any",group:"Misc",defaultValue:""},suggestionRowValidator:{type:"any",group:"Misc",defaultValue:""},enableSuggestionsHighlighting:{type:"boolean",group:"Behavior",defaultValue:true},autocomplete:{type:"boolean",group:"Behavior",defaultValue:true}},defaultAggregation:"suggestionItems",aggregations:{suggestionItems:{type:"sap.ui.core.Item",multiple:true,singularName:"suggestionItem"},suggestionColumns:{type:"sap.m.Column",multiple:true,singularName:"suggestionColumn",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"columns"}},suggestionRows:{type:"sap.m.ColumnListItem",altTypes:["sap.m.GroupHeaderListItem"],multiple:true,singularName:"suggestionRow",bindable:"bindable",forwarding:{getter:"_getSuggestionsTable",aggregation:"items"}},_suggestionPopup:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_valueHelpIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false},selectedRow:{type:"sap.m.ColumnListItem",multiple:false}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},valueHelpRequest:{parameters:{fromSuggestions:{type:"boolean"}}},suggest:{parameters:{suggestValue:{type:"string"},suggestionColumns:{type:"sap.m.ListBase"}}},suggestionItemSelected:{parameters:{selectedItem:{type:"sap.ui.core.Item"},selectedRow:{type:"sap.m.ColumnListItem"}}},submit:{parameters:{value:{type:"string"}}}},designtime:"sap/m/designtime/Input.designtime"}});a.insertFontFaceStyle();F._DEFAULTFILTER_TABULAR=function(e,t){var s=t.getCells(),o=0;for(;o<s.length;o++){if(s[o].getText){if(m(s[o].getText(),e)){return true}}}return false};F._DEFAULTRESULT_TABULAR=function(e){var t=e.getCells(),s=0;for(;s<t.length;s++){if(t[s].getText){return t[s].getText()}}return""};F.prototype.init=function(){e.prototype.init.call(this);this._fnFilter=P;this._bFullScreen=l.system.phone;this._iSetCount=0;this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m")};F.prototype.exit=function(){e.prototype.exit.call(this);this._deregisterEvents();this.cancelPendingSuggest();if(this._iRefreshListTimeout){clearTimeout(this._iRefreshListTimeout);this._iRefreshListTimeout=null}if(this._oSuggestionTable){this._oSuggestionTable.destroy();this._oSuggestionTable=null}if(this._oSuggPopover){this._oSuggPopover.destroy();this._oSuggPopover=null}if(this._oShowMoreButton){this._oShowMoreButton.destroy();this._oShowMoreButton=null}if(this._oButtonToolbar){this._oButtonToolbar.destroy();this._oButtonToolbar=null}this.$().off("click")};F.prototype.onBeforeRendering=function(){var t=this.getSelectedKey(),s=this.getShowValueHelp()&&this.getEnabled()&&this.getEditable(),o=this.getAggregation("_endIcon")||[],i=o[0],u,n=this._isSuggestionsPopoverOpen(),r=n?this._oSuggPopover._getValueStateHeader().getText():null,g=n?this._oSuggPopover._getValueStateHeader().getValueState():"";e.prototype.onBeforeRendering.call(this);this._deregisterEvents();if(t){this.setSelectedKey(t)}if(this.getShowSuggestion()){this._oSuggPopover._bAutocompleteEnabled=this.getAutocomplete();if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton()}else{this._removeShowMoreButton()}u=this._oSuggPopover._oPopupInput;if(u){u.setType(this.getType())}}if(s){i=this._getValueHelpIcon();i.setProperty("visible",true,true)}else if(i){i.setProperty("visible",false,true)}if(!this.getWidth()){this.setProperty("width","100%",true)}if(this._oSuggPopover){this._oSuggPopover._resetTypeAhead()}if(n&&(this.getValueStateText()&&r!==this.getValueStateText()||this.getValueState()!==g||this.getFormattedValueStateText())){this._updateSuggestionsPopoverValueState()}};F.prototype._getDisplayText=function(e){var t=this.getTextFormatter();if(t){return t(e)}var s=e.getText(),o=e.getKey(),i=this.getTextFormatMode();switch(i){case R.Key:return o;case R.ValueKey:return s+" ("+o+")";case R.KeyValue:return"("+o+") "+s;default:return s}};F.prototype._onValueUpdated=function(e){if(this._bSelectingItem||e===this._sSelectedValue){return}var t=this.getSelectedKey(),s;if(t===""){return}if(this._hasTabularSuggestions()){s=this._oSuggestionTable&&!!this._oSuggestionTable.getSelectedItem()}else{s=this._oSuggPopover._oList&&!!this._oSuggPopover._oList.getSelectedItem()}if(s){return}this.setProperty("selectedKey","",true);this.setAssociation("selectedRow",null,true);this.setAssociation("selectedItem",null,true);this.fireSuggestionItemSelected({selectedItem:null,selectedRow:null})};F.prototype._updateSelectionFromList=function(){if(this._oSuggPopover._iPopupListSelectedIndex<0){return false}var e=this._oSuggPopover._oList.getSelectedItem();if(e){if(this._hasTabularSuggestions()){this.setSelectionRow(e,true)}else{this.setSelectionItem(e._oItem,true)}}return true};F.prototype.setSelectionItem=function(e,t){this._bSelectingItem=true;if(!e){this.setAssociation("selectedItem",null,true);this.setValue("");return}this._oSuggPopover._iPopupListSelectedIndex=-1;var s=this._iSetCount,o;this.setAssociation("selectedItem",e,true);this.setProperty("selectedKey",e.getKey(),true);if(t){this.fireSuggestionItemSelected({selectedItem:e})}if(s!==this._iSetCount){o=this.getValue()}else{o=this._getDisplayText(e)}this._sSelectedValue=o;this.updateInputField(o);if(this.bIsDestroyed){return}if(!(this.isMobileDevice()&&this instanceof sap.m.MultiInput)){this._closeSuggestionPopup()}this._bSelectingItem=false};F.prototype.addSuggestionRowGroup=function(e,t,s){t=t||new i({title:V.escapeSettingsValue(e.text)||V.escapeSettingsValue(e.key)});this.addAggregation("suggestionRows",t,s);return t};F.prototype.addSuggestionItemGroup=function(e,t,s){t=t||new n({text:V.escapeSettingsValue(e.text)||V.escapeSettingsValue(e.key)});this.addAggregation("suggestionItems",t,s);return t};F.prototype.setSelectedItem=function(e){if(typeof e==="string"){e=sap.ui.getCore().byId(e)}if(e!==null&&!(e instanceof s)){return this}this.setSelectionItem(e);return this};F.prototype.setSelectedKey=function(e){e=this.validateProperty("selectedKey",e);this.setProperty("selectedKey",e,true);if(this._hasTabularSuggestions()){return this}if(!e){this.setSelectionItem();return this}var t=this.getSuggestionItemByKey(e);this.setSelectionItem(t);return this};F.prototype.getSuggestionItemByKey=function(e){var t=this.getSuggestionItems()||[],s,o;for(o=0;o<t.length;o++){s=t[o];if(s.getKey()===e){return s}}};F.prototype._getFormattedValueStateText=function(){var t=this._isSuggestionsPopoverOpen(),s=t?this._oSuggPopover._getValueStateHeader().getFormattedText():null;if(t&&s){return s}else{return e.prototype.getFormattedValueStateText.call(this)}};F.prototype.setSelectionRow=function(e,t){if(!e){this.setAssociation("selectedRow",null,true);return}this._oSuggPopover._iPopupListSelectedIndex=-1;this._bSelectingItem=true;var o,i=this.getSuggestionRowValidator();if(i){o=i(e);if(!(o instanceof s)){o=null}}var u=this._iSetCount,n="",r;this.setAssociation("selectedRow",e,true);if(o){n=o.getKey()}this.setProperty("selectedKey",n,true);if(t){this.fireSuggestionItemSelected({selectedRow:e})}if(u!==this._iSetCount){r=this.getValue()}else{if(o){r=this._getDisplayText(o)}else{r=this._fnRowResultFilter?this._fnRowResultFilter(e):S._DEFAULTRESULT_TABULAR(e)}}this._sSelectedValue=r;this.updateInputField(r);if(this.bIsDestroyed){return}if(!(this.isMobileDevice()&&this instanceof sap.m.MultiInput&&this._isMultiLineMode)){this._closeSuggestionPopup()}this._bSelectingItem=false};F.prototype.setSelectedRow=function(e){if(typeof e==="string"){e=sap.ui.getCore().byId(e)}if(e!==null&&!(e instanceof o)){return this}this.setSelectionRow(e);return this};F.prototype._getValueHelpIcon=function(){var e=this,t=this.getAggregation("_endIcon")||[],s=this.getValueHelpIconSrc(),o=t[0];if(!o){o=this.addEndIcon({id:this.getId()+"-vhi",src:s,useIconTooltip:false,alt:this._oRb.getText("INPUT_VALUEHELP_BUTTON"),decorative:false,noTabStop:true,press:function(t){if(!e.getValueHelpOnly()){var s=this.getParent(),o;if(l.support.touch){o=s.$("inner");o.attr("readonly","readonly");s.focus();o.removeAttr("readonly")}else{s.focus()}e.bValueHelpRequested=true;e._fireValueHelpRequest(false)}}})}else if(o.getSrc()!==s){o.setSrc(s)}return o};F.prototype._fireValueHelpRequest=function(e){var t="";if(this.getShowSuggestion()&&this._oSuggPopover){t=this._oSuggPopover._sTypedInValue||""}else{t=this.getDOMValue()}this.fireValueHelpRequest({fromSuggestions:e,_userInputValue:t})};F.prototype._fireValueHelpRequestForValueHelpOnly=function(){if(this.getEnabled()&&this.getEditable()&&this.getShowValueHelp()&&this.getValueHelpOnly()){if(l.system.phone){this.focus()}this._fireValueHelpRequest(false)}};F.prototype.ontap=function(t){e.prototype.ontap.call(this,t);if(this.isValueHelpOnlyOpener(t.target)){this._fireValueHelpRequestForValueHelpOnly()}if(this.isMobileDevice()&&this.getEditable()&&this.getEnabled()&&this.getShowSuggestion()&&this._oSuggPopover&&t.target.id!=this.getId()+"-vhi"){this._openSuggestionsPopover()}};F.prototype.setFilterFunction=function(e){if(e===null||e===undefined){this._fnFilter=P;return this}v(typeof e==="function","Input.setFilterFunction: first argument fnFilter must be a function on "+this);this._fnFilter=e;return this};F.prototype.setRowResultFunction=function(e){var t;if(e===null||e===undefined){this._fnRowResultFilter=S._DEFAULTRESULT_TABULAR;return this}v(typeof e==="function","Input.setRowResultFunction: first argument fnFilter must be a function on "+this);this._fnRowResultFilter=e;t=this.getSelectedRow();if(t){this.setSelectedRow(t)}return this};F.prototype.closeSuggestions=function(){this._closeSuggestionPopup()};F.prototype._doSelect=function(e,t){if(l.support.touch){return}var s=this._$input[0];if(s){var o=this._$input;s.focus();o.selectText(e?e:0,t?t:o.val().length)}return this};F.prototype._isIncrementalType=function(){var e=this.getType();if(e==="Number"||e==="Date"||e==="Datetime"||e==="Month"||e==="Time"||e==="Week"){return true}return false};F.prototype.onsapescape=function(t){var s;if(this._isSuggestionsPopoverOpen()){t.originalEvent._sapui_handledByControl=true;this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup();if(this._sBeforeSuggest!==undefined){if(this._sBeforeSuggest!==this.getValue()){s=this.getLastValue();this.setValue(this._sBeforeSuggest);this.setLastValue(s)}this._sBeforeSuggest=undefined}return}if(this.getValueLiveUpdate()){this.setProperty("value",this.getLastValue(),true)}if(e.prototype.onsapescape){e.prototype.onsapescape.apply(this,arguments)}};F.prototype.onsapenter=function(t){this.cancelPendingSuggest();if(this._isSuggestionsPopoverOpen()){if(!this._updateSelectionFromList()&&!this.isComposingCharacter()){this._closeSuggestionPopup()}}if(e.prototype.onsapenter){e.prototype.onsapenter.apply(this,arguments)}if(this.getEnabled()&&this.getEditable()&&!(this.getValueHelpOnly()&&this.getShowValueHelp())){this.fireSubmit({value:this.getValue()})}};F.prototype.onsapfocusleave=function(s){var o=this._oSuggPopover,i=o&&o._oPopover,u=s.relatedControlId&&sap.ui.getCore().byId(s.relatedControlId),n=u&&u.getFocusDomRef(),r=o&&o._sProposedItemText&&this.getAutocomplete(),g=i&&n&&d(i.getDomRef(),n);if(i instanceof t){if(g&&!o.bMessageValueStateActive){this._bPopupHasFocus=true;if(l.system.desktop&&y(i.getFocusDomRef(),n)||u.isA("sap.m.GroupHeaderListItem")){this.focus()}}else{if(this.getDOMValue()===this._sSelectedSuggViaKeyboard){this._sSelectedSuggViaKeyboard=null}}}if(!g&&!r){e.prototype.onsapfocusleave.apply(this,arguments)}this.bValueHelpRequested=false};F.prototype.onmousedown=function(e){if(this._isSuggestionsPopoverOpen()){e.stopPropagation()}};F.prototype._deregisterEvents=function(){if(this._oSuggPopover){this._oSuggPopover._deregisterResize()}if(this.isMobileDevice()&&this._oSuggPopover&&this._oSuggPopover._oPopover){this.$().off("click")}};F.prototype.updateSuggestionItems=function(){this._bSuspendInvalidate=true;this.updateAggregation("suggestionItems");this._synchronizeSuggestions();this._bSuspendInvalidate=false;return this};F.prototype.invalidate=function(){if(!this._bSuspendInvalidate){h.prototype.invalidate.apply(this,arguments)}};F.prototype.cancelPendingSuggest=function(){if(this._iSuggestDelay){clearTimeout(this._iSuggestDelay);this._iSuggestDelay=null}};F.prototype._triggerSuggest=function(e){this.cancelPendingSuggest();this._bShouldRefreshListItems=true;if(!e){e=""}if(e.length>=this.getStartSuggestion()){this._iSuggestDelay=setTimeout(function(){if(this._sPrevSuggValue!==e){this._bBindingUpdated=false;this.fireSuggest({suggestValue:e});if(!this._bBindingUpdated){this._refreshItemsDelayed()}this._sPrevSuggValue=e}}.bind(this),300)}else if(this.isMobileDevice()){if(this._oSuggPopover._oList instanceof g){this._oSuggPopover._oList.addStyleClass("sapMInputSuggestionTableHidden")}else if(this._oSuggPopover._oList&&this._oSuggPopover._oList.destroyItems){this._oSuggPopover._oList.destroyItems()}}else if(this._isSuggestionsPopoverOpen()){setTimeout(function(){var e=this.getDOMValue()||"";if(e<this.getStartSuggestion()){this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup()}}.bind(this),0)}};(function(){F.prototype.setShowSuggestion=function(e){this.setProperty("showSuggestion",e,true);if(e){this._oSuggPopover=this._getSuggestionsPopover();this._oSuggPopover._iPopupListSelectedIndex=-1;if(!this._oSuggPopover._oPopover){this._createSuggestionsPopoverPopup();this._synchronizeSuggestions();this._createSuggestionPopupContent()}}else{if(this._oSuggPopover){this._oSuggPopover._destroySuggestionPopup();this._oSuggPopover._iPopupListSelectedIndex=-1;this._oButtonToolbar=null;this._oShowMoreButton=null}}return this};F.prototype._shouldTriggerSuggest=function(){return!this._bPopupHasFocus&&!this.getStartSuggestion()&&!this.getValue()&&this.getShowSuggestion()};F.prototype.setShowTableSuggestionValueHelp=function(e){this.setProperty("showTableSuggestionValueHelp",e,true);if(!(this._oSuggPopover&&this._oSuggPopover._oPopover)){return this}if(e){this._addShowMoreButton()}else{this._removeShowMoreButton()}return this};F.prototype.onchange=function(e){if(this.getShowValueHelp()||this.getShowSuggestion()){return}this.onChange(e)};F.prototype.oninput=function(t){e.prototype.oninput.call(this,t);if(t.isMarked("invalid")){return}var s=this.getDOMValue(),o,i,u;if(this.getValueLiveUpdate()){this.setProperty("value",s,true);this._onValueUpdated(s)}this.fireLiveChange({value:s,newValue:s});this.addStyleClass("sapMFocus");if(this.getShowSuggestion()&&!this.isMobileDevice()){o=this._getSuggestionsPopover();i=o._oList;this._triggerSuggest(s);if(i&&!o.bMessageValueStateActive){u=i.getSelectedItem();i.removeStyleClass("sapMListFocus");u&&u.removeStyleClass("sapMLIBFocused")}else if(o.bMessageValueStateActive&&document.activeElement.tagName!=="A"){o._getValueStateHeader().removeStyleClass("sapMPseudoFocus")}}};F.prototype.getValue=function(){return this.getDomRef("inner")&&this._$input?this.getDOMValue():this.getProperty("value")};F.prototype._refreshItemsDelayed=function(){clearTimeout(this._iRefreshListTimeout);this._iRefreshListTimeout=setTimeout(function(){if(this._oSuggPopover){this._refreshListItems()}}.bind(this),0)};F.prototype._filterListItems=function(e,t){var s,o,n,r=[],g=[],p=this.getFilterSuggests(),a=false;for(s=0;s<e.length;s++){n=e[s];if(e[s].isA("sap.ui.core.SeparatorItem")){o=new i({id:n.getId()+"-ghli",title:V.escapeSettingsValue(e[s].getText())});r.push({header:o,visible:false});this._configureListItem(n,o);g.push(o)}else if(!p||this._fnFilter(t,n)){o=new u({title:V.escapeSettingsValue(n.getText()),info:V.escapeSettingsValue(n.getAdditionalText&&n.getAdditionalText())});if(!a&&this._oSuggPopover._sProposedItemText===e[s].getText()){o.setSelected(true);a=true}if(r.length){r[r.length-1].visible=true}this._configureListItem(n,o);g.push(o)}}r.forEach(function(e){e.header.setVisible(e.visible)});return{hitItems:g,groups:r}};F.prototype._filterTabularItems=function(e,t){var s,o,i=this.getFilterSuggests(),u=[],n=[],r=false;for(s=0;s<e.length;s++){if(e[s].isA("sap.m.GroupHeaderListItem")){n.push({header:e[s],visible:false})}else{o=!i||this._fnFilter(t,e[s]);e[s].setVisible(o);o&&u.push(e[s]);if(!r&&o&&this._oSuggPopover._sProposedItemText===this._fnRowResultFilter(e[s])){e[s].setSelected(true);r=true}if(n.length&&o){n[n.length-1].visible=true}}}n.forEach(function(e){e.header.setVisible(e.visible)});this._getSuggestionsTable().invalidate();return{hitItems:u,groups:n}};F.prototype._clearSuggestionPopupItems=function(){if(!this._oSuggPopover._oList){return}if(this._oSuggPopover._oList instanceof g){this._oSuggPopover._oList.removeSelections(true)}else{this._oSuggPopover._oList.destroyItems()}};F.prototype._hideSuggestionPopup=function(){var e=this._oSuggPopover._oPopover;function t(){if(l.browser.internet_explorer){var e=this.getFocusInfo();this.setDOMValue(this._oSuggPopover._sTypedInValue);this.applyFocusInfo(e)}else{this.setDOMValue(this._oSuggPopover._sTypedInValue)}}if(!this.isMobileDevice()){if(this._isSuggestionsPopoverOpen()){this._sCloseTimer=setTimeout(function(){if(this._oSuggPopover){this._oSuggPopover._iPopupListSelectedIndex=-1}this.cancelPendingSuggest();if(this._oSuggPopover._sTypedInValue){t.call(this)}this._oSuggPopover._oProposedItem=null;e.close()}.bind(this),0)}}else if(this._hasTabularSuggestions()&&this._oSuggPopover._oList){this._oSuggPopover._oList.addStyleClass("sapMInputSuggestionTableHidden")}this.$("SuggDescr").text("");this.$("inner").removeAttr("aria-activedescendant")};F.prototype._openSuggestionPopup=function(e){if(!this.isMobileDevice()){if(this._sCloseTimer){clearTimeout(this._sCloseTimer);this._sCloseTimer=null}if(!this._isSuggestionsPopoverOpen()&&!this._sOpenTimer&&e!==false){this._sOpenTimer=setTimeout(function(){this._sOpenTimer=null;this._oSuggPopover&&this._openSuggestionsPopover()}.bind(this),0)}}};F.prototype._getFilteredSuggestionItems=function(e){var t,s=this.getSuggestionItems(),o=this.getSuggestionRows();if(this._hasTabularSuggestions()){if(this.isMobileDevice()&&this._oSuggPopover._oList){this._oSuggPopover._oList.removeStyleClass("sapMInputSuggestionTableHidden")}t=this._filterTabularItems(o,e)}else{t=this._filterListItems(s,e)}return t};F.prototype._fillSimpleSuggestionPopupItems=function(e){var t,s=e.hitItems,o=e.groups,i=s.length,u=i;if(!this._hasTabularSuggestions()){for(t=0;t<i;t++){this._oSuggPopover._oList.addItem(s[t])}u-=o.length}return u};F.prototype._applySuggestionAcc=function(e){var t="",s=this._oRb;if(e===1){t=s.getText("INPUT_SUGGESTIONS_ONE_HIT")}else if(e>1){t=s.getText("INPUT_SUGGESTIONS_MORE_HITS",e)}else{t=s.getText("INPUT_SUGGESTIONS_NO_HIT")}this.$("SuggDescr").text(t)};F.prototype._refreshListItems=function(){var e=this.getShowSuggestion(),t=this._oSuggPopover._bDoTypeAhead?this._oSuggPopover._sTypedInValue:this.getDOMValue()||"",s,o;this._oSuggPopover._iPopupListSelectedIndex=-1;if(!e||!this._bShouldRefreshListItems||!this.getDomRef()||!this.isMobileDevice()&&!this.$().hasClass("sapMInputFocused")){return null}this._clearSuggestionPopupItems();if(t.length<this.getStartSuggestion()){this._hideSuggestionPopup();return false}s=this._getFilteredSuggestionItems(t);o=this._fillSimpleSuggestionPopupItems(s);if(o>0){this._openSuggestionPopup(this.getValue().length>=this.getStartSuggestion())}else{this._hideSuggestionPopup()}this._applySuggestionAcc(o)};F.prototype._configureListItem=function(e,t){var s=w.Active;if(!e.getEnabled()||t.isA("sap.m.GroupHeaderListItem")){s=w.Inactive}t.setType(s);t._oItem=e;t.addEventDelegate({ontouchstart:function(e){(e.originalEvent||e)._sapui_cancelAutoClose=true}});return t};F.prototype.addSuggestionItem=function(e){this.addAggregation("suggestionItems",e,true);if(!this._oSuggPopover){this._getSuggestionsPopover()}this._synchronizeSuggestions();this._createSuggestionPopupContent();return this};F.prototype.insertSuggestionItem=function(e,t){this.insertAggregation("suggestionItems",t,e,true);if(!this._oSuggPopover){this._getSuggestionsPopover()}this._synchronizeSuggestions();this._createSuggestionPopupContent();return this};F.prototype.removeSuggestionItem=function(e){var t=this.removeAggregation("suggestionItems",e,true);this._synchronizeSuggestions();return t};F.prototype.removeAllSuggestionItems=function(){var e=this.removeAllAggregation("suggestionItems",true);this._synchronizeSuggestions();return e};F.prototype.destroySuggestionItems=function(){this.destroyAggregation("suggestionItems",true);this._synchronizeSuggestions();return this};F.prototype.addSuggestionRow=function(e){e.setType(w.Active);this.addAggregation("suggestionRows",e);this._synchronizeSuggestions();this._createSuggestionPopupContent(true);return this};F.prototype.insertSuggestionRow=function(e,t){e.setType(w.Active);this.insertAggregation("suggestionRows",e,t);this._synchronizeSuggestions();this._createSuggestionPopupContent(true);return this};F.prototype.removeSuggestionRow=function(e){var t=this.removeAggregation("suggestionRows",e);this._synchronizeSuggestions();return t};F.prototype.removeAllSuggestionRows=function(){var e=this.removeAllAggregation("suggestionRows");this._synchronizeSuggestions();return e};F.prototype.destroySuggestionRows=function(){this.destroyAggregation("suggestionRows");this._synchronizeSuggestions();return this};F.prototype.bindAggregation=function(){if(arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns"||arguments[0]==="suggestionItems"){this._createSuggestionPopupContent(arguments[0]==="suggestionRows"||arguments[0]==="suggestionColumns");this._bBindingUpdated=true}return e.prototype.bindAggregation.apply(this,arguments)};F.prototype._closeSuggestionPopup=function(){if(this._isSuggestionsPopoverOpen()){this.cancelPendingSuggest();this._oSuggPopover._oPopover.close();if(!this.isMobileDevice()&&this.$().hasClass("sapMInputFocused")){this.openValueStateMessage()}this.$("SuggDescr").text("");this.$("inner").removeAttr("aria-activedescendant");this._sPrevSuggValue=null}};F.prototype._synchronizeSuggestions=function(){if(document.activeElement===this.getFocusDomRef()){this._bShouldRefreshListItems=true;this._refreshItemsDelayed()}if(!this.getDomRef()||this._isSuggestionsPopoverOpen()){return}this._synchronizeSelection()};F.prototype._synchronizeSelection=function(){var e=this.getSelectedKey();if(!e){return}if(this.getValue()&&!this.getSelectedItem()&&!this.getSelectedRow()){return}this.setSelectedKey(e)}})();F.prototype.onfocusin=function(t){e.prototype.onfocusin.apply(this,arguments);this.addStyleClass("sapMInputFocused");if(!this.isMobileDevice()&&this._isSuggestionsPopoverOpen()){this.closeValueStateMessage()}if(this._shouldTriggerSuggest()){this._triggerSuggest(this.getValue())}this._bPopupHasFocus=undefined;this._sPrevSuggValue=null};F.prototype.oncompositionend=function(t){e.prototype.oncompositionend.apply(this,arguments);if(this._oSuggPopover&&!l.browser.edge&&!l.browser.firefox){this._oSuggPopover._handleTypeAhead()}};F.prototype.onsapshow=function(e){if(!this.getEnabled()||!this.getEditable()||!this.getShowValueHelp()){return}this.bValueHelpRequested=true;this._fireValueHelpRequest(false);e.preventDefault();e.stopPropagation()};F.prototype.onsaphide=F.prototype.onsapshow;F.prototype.onsapselect=function(e){this._fireValueHelpRequestForValueHelpOnly()};F.prototype.onfocusout=function(t){e.prototype.onfocusout.apply(this,arguments);this.removeStyleClass("sapMInputFocused");this.$("SuggDescr").text("")};F.prototype._hasTabularSuggestions=function(){return!!(this.getAggregation("suggestionColumns")&&this.getAggregation("suggestionColumns").length)};F.prototype._getSuggestionsTable=function(){if(this._bIsBeingDestroyed){return this._oSuggestionTable}if(!this._oSuggestionTable){this._oSuggestionTable=new g(this.getId()+"-popup-table",{mode:M.SingleSelectMaster,showNoData:false,showSeparators:A.None,width:"100%",enableBusyIndicator:false,rememberSelections:false,itemPress:function(e){if(l.system.desktop){this.focus()}this._oSuggPopover._bSuggestionItemTapped=true;var t=e.getParameter("listItem");this.setSelectionRow(t,true)}.bind(this),sticky:[p.Sticky.ColumnHeaders]});this._oSuggestionTable.addEventDelegate({onAfterRendering:function(){var e,t;if(!this.getEnableSuggestionsHighlighting()){return}e=this._oSuggestionTable.$().find("tbody .sapMLabel");t=(this._sTypedInValue||this.getValue()).toLowerCase();I(e,t)}.bind(this)});if(this.isMobileDevice()){this._oSuggestionTable.addStyleClass("sapMInputSuggestionTableHidden")}this._oSuggestionTable.updateItems=function(){g.prototype.updateItems.apply(this,arguments);this._refreshItemsDelayed();return this}}return this._oSuggestionTable};F.prototype.clone=function(){var e=h.prototype.clone.apply(this,arguments);e.setRowResultFunction(this._fnRowResultFilter);e.setValue(this.getValue());return e};F.prototype.setValue=function(t){this._iSetCount++;e.prototype.setValue.call(this,t);this._onValueUpdated(t);return this};F.prototype.setDOMValue=function(e){this._$input.val(e)};F.prototype.getDOMValue=function(){return this._$input.val()};F.prototype.updateInputField=function(e){if(this._isSuggestionsPopoverOpen()&&this.isMobileDevice()){this._oSuggPopover._oPopupInput.setValue(e);this._oSuggPopover._oPopupInput._doSelect()}else{e=this._getInputValue(e);this.setDOMValue(e);this.onChange(null,null,e)}};F.prototype.getAccessibilityInfo=function(){var t=e.prototype.getAccessibilityInfo.apply(this,arguments);t.description=((t.description||"")+" "+this.getDescription()).trim();return t};F.prototype.preventChangeOnFocusLeave=function(e){return this.bFocusoutDueRendering||this.bValueHelpRequested};F.prototype._getShowMoreButton=function(){return this._oShowMoreButton||(this._oShowMoreButton=new _({text:this._oRb.getText("INPUT_SUGGESTIONS_SHOW_ALL"),press:this._getShowMoreButtonPress.bind(this)}))};F.prototype._getShowMoreButtonPress=function(){var e;if(this.getShowTableSuggestionValueHelp()){if(this._oSuggPopover._sTypedInValue){e=this._oSuggPopover._sTypedInValue;this.updateDomValue(e);this._oSuggPopover._resetTypeAhead();this._oSuggPopover._sTypedInValue=e}this._fireValueHelpRequest(true);this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup()}};F.prototype._addShowMoreButton=function(e){var t=this._oSuggPopover&&this._oSuggPopover._oPopover;if(!t||!e&&!this._hasTabularSuggestions()){return}if(t.isA("sap.m.Dialog")){var s=this._getShowMoreButton();t.setEndButton(s)}else{var o=this._getButtonToolbar();t.setFooter(o)}};F.prototype._removeShowMoreButton=function(){var e=this._oSuggPopover&&this._oSuggPopover._oPopover;if(!e||!this._hasTabularSuggestions()){return}if(e.isA("sap.m.Dialog")){e.setEndButton(null)}else{e.setFooter(null)}};F.prototype._getButtonToolbar=function(){var e=this._getShowMoreButton();return this._oButtonToolbar||(this._oButtonToolbar=new c({content:[new f,e]}))};F.prototype._hasShowSelectedButton=function(){return false};F.prototype._createSuggestionPopupContent=function(e){if(this._bIsBeingDestroyed||this._getSuggestionsPopover()._oList){return}this._oSuggPopover._createSuggestionPopupContent(e);if(!this._hasTabularSuggestions()&&!e){this._oSuggPopover._oList.attachItemPress(function(e){if(l.system.desktop){this.focus()}var t=e.getParameter("listItem");if(!t.isA("sap.m.GroupHeaderListItem")){this._oSuggPopover._bSuggestionItemTapped=true;this.setSelectionItem(t._oItem,true)}},this)}else{if(this._fnFilter===P){this._fnFilter=F._DEFAULTFILTER_TABULAR}if(!this._fnRowResultFilter){this._fnRowResultFilter=F._DEFAULTRESULT_TABULAR}if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton(e)}}};F.prototype._createPopupInput=function(){var e=new F(this.getId()+"-popup-input",{width:"100%",valueLiveUpdate:true,showValueStateMessage:false,valueState:this.getValueState(),showValueHelp:this.getShowValueHelp(),valueHelpRequest:function(e){this.fireValueHelpRequest({fromSuggestions:true});this._oSuggPopover._iPopupListSelectedIndex=-1;this._closeSuggestionPopup()}.bind(this),liveChange:function(e){var t=e.getParameter("newValue");this.setDOMValue(this._getInputValue(this._oSuggPopover._oPopupInput.getValue()));this._triggerSuggest(t);this.fireLiveChange({value:t,newValue:t})}.bind(this)});return e};F.prototype._modifyPopupInput=function(e){e.addEventDelegate({onsapenter:function(){if(this.getAutocomplete()){this._oSuggPopover._finalizeAutocomplete()}this._closeSuggestionPopup()}},this);return e};F.prototype.forwardEventHandlersToSuggPopover=function(e){e.setOkPressHandler(this._closeSuggestionPopup.bind(this));e.setCancelPressHandler(this._closeSuggestionPopup.bind(this))};F.prototype._getSuggestionsPopover=function(){if(!this._oSuggPopover){var e=this._oSuggPopover=new S(this);if(this.isMobileDevice()){var t=this._createPopupInput();e._oPopupInput=this._modifyPopupInput(t)}this._oSuggPopover.setInputLabels(this.getLabels.bind(this));this._createSuggestionsPopoverPopup();this.forwardEventHandlersToSuggPopover(e);e._bAutocompleteEnabled=this.getAutocomplete();e.attachEvent(S.M_EVENTS.SELECTION_CHANGE,function(e){var t=e.getParameter("newValue");this.setDOMValue(t);this._sSelectedSuggViaKeyboard=t;this._doSelect()},this);if(this.getShowTableSuggestionValueHelp()){this._addShowMoreButton()}}return this._oSuggPopover};F.prototype._createSuggestionsPopoverPopup=function(){if(!this._oSuggPopover){return}var e=this._oSuggPopover;var t;e._createSuggestionPopup({showSelectedButton:this._hasShowSelectedButton()});t=e._oPopover;t.attachBeforeOpen(function(){this._updateSuggestionsPopoverValueState()},this);t.attachBeforeClose(function(){this._updateSuggestionsPopoverValueState()},this);if(this.isMobileDevice()){t.attachBeforeClose(function(){this.setDOMValue(this._getInputValue(e._oPopupInput.getValue()));this.onChange()},this).attachAfterClose(function(){var t=e._oList;if(!t){return}if(g&&!(t instanceof g)){t.destroyItems()}else{t.removeSelections(true)}}).attachAfterOpen(function(){this._triggerSuggest(this.getValue());this._refreshListItems()},this).attachBeforeOpen(function(){e._oPopupInput.setPlaceholder(this.getPlaceholder());e._oPopupInput.setMaxLength(this.getMaxLength());e._oPopupInput.setValue(this.getValue())},this)}else{t.attachAfterClose(function(){this._updateSelectionFromList();var t=e._oList,s=t.getSelectedItem();if(!t){return}if(t instanceof g){s&&s.removeStyleClass("sapMLIBFocused");t.removeSelections(true)}else{t.destroyItems()}e._deregisterResize()},this).attachBeforeOpen(function(){e._sPopoverContentWidth=this.getMaxSuggestionWidth();e._bEnableHighlighting=this.getEnableSuggestionsHighlighting();e._bAutocompleteEnabled=this.getAutocomplete();e._bIsInputIncrementalType=this._isIncrementalType();this._sBeforeSuggest=this.getValue();e._resizePopup();e._registerResize()},this)}this.setAggregation("_suggestionPopup",t);this._oSuggestionPopup=t};F.prototype.showItems=function(e){var t,s,o=this._fnFilter;if(!this.getEnabled()||!this.getEditable()){return}this.setFilterFunction(e||function(){return true});this._clearSuggestionPopupItems();t=this._getFilteredSuggestionItems(this.getDOMValue());s=this._fillSimpleSuggestionPopupItems(t);if(s>0){this._openSuggestionPopup()}else{this._hideSuggestionPopup()}this._applySuggestionAcc(s);this.setFilterFunction(o)};F.prototype.shouldValueStateMessageBeOpened=function(){var t=e.prototype.shouldValueStateMessageBeOpened.apply(this,arguments);if(!t||this._isSuggestionsPopoverOpen()){return false}return true};F.prototype._isSuggestionsPopoverOpen=function(){return this._oSuggPopover&&this._oSuggPopover.isOpen()};F.prototype.isMobileDevice=function(){return l.system.phone};F.prototype._openSuggestionsPopover=function(){this.closeValueStateMessage();this._updateSuggestionsPopoverValueState();this._oSuggPopover._oPopover.open()};F.prototype._updateSuggestionsPopoverValueState=function(){var e=this._oSuggPopover,t=this.getValueState(),s=this.getValueState()!==e._getValueStateHeader().getValueState(),o=this.getFormattedValueStateText(),i=this.getValueStateText();if(!e){return}if(this._isSuggestionsPopoverOpen()&&!o&&!s){this.setFormattedValueStateText(this._oSuggPopover._getValueStateHeader().getFormattedText())}e.updateValueState(t,o||i,this.getShowValueStateMessage());if(this.isMobileDevice()){e._oPopupInput.setValueState(t)}};F.prototype.setShowValueHelp=function(e){this.setProperty("showValueHelp",e);if(this._oSuggPopover&&this._oSuggPopover._oPopupInput){this._oSuggPopover._oPopupInput.setShowValueHelp(e)}return this};F.prototype.isValueHelpOnlyOpener=function(e){return true};return F});