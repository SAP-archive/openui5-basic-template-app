/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils"],function(e){"use strict";var t={};var n="sourceControl";t.applyChange=function(t,r,o){if(o.modifier.targets!=="jsControlTree"){throw new Error("Split change can't be applied on XML tree")}var i=t.getDefinition(),g=o.modifier,a=e.getViewForControl(r),s=t.getDependentControl(n,o),u=g.getAggregation(s,"menu"),d=g.getAggregation(u,"items"),p=s.sParentAggregationName,c=g.getParent(s),f=g.findIndexInParentAggregation(s),l=i.content.newElementIds.slice(),m={sParentAggregation:p,insertIndex:f,insertedButtons:[]};d.forEach(function(e,t){var n=g.getAggregation(e,"customData"),r=g.getAggregation(e,"dependents"),i=g.getId(e),s,u;if(n&&n.length>0){var d=i+"-originalButtonId";n.some(function(e){if(g.getId(e)===d){u=g.getProperty(e,"value");return true}})}if(u&&r.length>0){r.some(function(e){if(u===g.getId(e)){s=e;m.insertedButtons.push({id:g.getId(s),menuItemId:i});return true}});if(s){g.removeAggregation(e,"dependents",s)}}else{var I=l[t];s=g.createControl("sap.m.Button",o.appComponent,a,I);m.insertedButtons.push({id:g.getId(s)});g.setProperty(s,"text",g.getProperty(e,"text"));g.setProperty(s,"icon",g.getProperty(e,"icon"));g.setProperty(s,"enabled",g.getProperty(e,"enabled"));s.attachPress(function(t){return e.firePress(t)})}g.insertAggregation(c,p,s,f+t)});g.removeAggregation(c,p,s);g.insertAggregation(c,"dependents",s);t.setRevertData(m);return true};t.revertChange=function(e,t,r){var o=r.modifier,i=e.getRevertData(),g=e.getDependentControl(n,r),a=r.appComponent,s=o.getParent(g),u=i.sParentAggregation,d=i.insertIndex,p=i.insertedButtons,c=o.getAggregation(g,"menu"),f=o.getAggregation(c,"items"),l=p.map(function(e){return o.bySelector(e.id,a)});p.forEach(function(e,t){o.removeAggregation(s,u,l[t]);if(e.menuItemId){f.some(function(n){if(o.getId(n)===e.menuItemId){o.insertAggregation(n,"dependents",l[t]);return true}})}else{l[t].destroy()}});o.insertAggregation(s,u,g,d);e.resetRevertData();return true};t.completeChangeContent=function(e,t,r){var o=r.modifier,i=r.appComponent,g=e.getDefinition();if(!t.newElementIds){throw new Error("Split of MenuButton cannot be applied : oSpecificChangeInfo.newElementIds attribute required")}if(!t.sourceControlId){throw new Error("Split of MenuButton cannot be applied : oSpecificChangeInfo.sourceControlId attribute required")}g.content.newElementIds=t.newElementIds;e.addDependentControl(t.sourceControlId,n,r);g.content.sourceSelector=o.getSelector(t.sourceControlId,i)};return t},true);