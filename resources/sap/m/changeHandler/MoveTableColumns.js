/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/jquery"],function(e,n){"use strict";var t={};var r="source";var o="target";var i="movedElements";var a="columns";var u="cells";var g="items";function s(n,t,r,o,i){return Promise.resolve().then(n.getAggregation.bind(n,r,u)).then(function(a){if(!a){e.warning("Aggregation cells to move not found");return Promise.reject()}if(o<0||o>=a.length){e.warning("Move cells in table item called with invalid index: "+o);return Promise.reject()}var g=a[o];return Promise.resolve().then(n.removeAggregation.bind(n,r,u,g)).then(n.insertAggregation.bind(n,r,u,g,i,t))})}function c(e,n,t,r,o){return Promise.resolve().then(e.getAggregation.bind(e,t,g)).then(function(t){return t.reduce(function(t,i){return t.then(function(){if(e.getControlType(i)!=="sap.m.GroupHeaderListItem"){return s(e,n,i,r,o)}return undefined})},Promise.resolve())})}function d(t,i,u,d){var v=u.modifier;var l=u.view;var f=u.appComponent;var m=t.getContent();var p=t.getDependentControl(r,u);var h=t.getDependentControl(o,u);var b;var C;return Promise.resolve().then(function(){return v.getAggregation(h,a)}).then(function(t){b=t;if(p!==h){e.warning("Moving columns between different tables is not yet supported.");return Promise.reject(false)}return m.movedElements.reduce(function(t,r){var o;var i;var u;var m;var p;return t.then(function(){C=v.bySelector(r.selector,f,l);if(!C){p=r.selector&&r.selector.id;e.warning("The table column with id: '"+p+"' stored in the change is not found and the move operation cannot be applied");return Promise.reject()}u=b.indexOf(C);m=r.sourceIndex;i=typeof d==="function"&&d(m);i=n.isNumeric(i)?i:r.targetIndex;if(u!==i){o=u}else{o=m}return v.removeAggregation(h,a,C)}).then(function(){return v.insertAggregation(h,a,C,i,l)}).then(function(){return v.getBindingTemplate(h,g)}).then(function(e){if(e){return s(v,l,e,o,i).then(v.updateAggregation.bind(v,h,g))}else{return c(v,l,h,o,i)}})},Promise.resolve())})}t.applyChange=function(e,n,t){var r=[];return Promise.resolve().then(function(){return d(e,n,t,function(e){r.unshift({index:e})})}).then(function(){e.setRevertData(r)})};t.revertChange=function(e,n,t){var r=e.getRevertData();return Promise.resolve().then(function(){return d(e,n,t,function(){var e=r.shift();return e&&e.index})}).then(function(){e.resetRevertData()})};t.completeChangeContent=function(e,n,t){var a=t.modifier;var u=t.appComponent;var g=e.getDefinition();var s=a.bySelector(n.source.id,u);var c=a.bySelector(n.target.id,u);var d={aggregation:n.source.aggregation,type:a.getControlType(s)};var v={aggregation:n.target.aggregation,type:a.getControlType(c)};g.content={movedElements:[]};n.movedElements.forEach(function(e){var n=e.element||a.bySelector(e.id,u);g.content.movedElements.push({selector:a.getSelector(n,u),sourceIndex:e.sourceIndex,targetIndex:e.targetIndex})});e.addDependentControl(n.source.id,r,t,d);e.addDependentControl(n.target.id,o,t,v);e.addDependentControl(n.movedElements.map(function(e){return e.id}),i,t)};return t},true);