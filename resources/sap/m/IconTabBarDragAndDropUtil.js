/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/events/KeyCodes","sap/ui/core/library"],function(e,t,r,i){"use strict";var a=i.dnd.DropPosition;var n="Before",s="insertBefore",o="insertAfter",g,f="IconTabReorder",l="Forward",u="Backward";var c={_insertControl:function(e,t,r,i){var a=t.$(),n=r.$(),s=[],g=[];if(t._getNestedLevel()>1&&r._getNestedLevel()>1){s=t._getRootTab()._getSelectList().getItems().filter(function(e){return t._getRealTab()._isParentOf(e._getRealTab())});g=r._getRootTab()._getSelectList().getItems().filter(function(e){return r._getRealTab()._isParentOf(e._getRealTab())})}if(i){var f=t._getRootTab().getParent()._getOverflow()._getSelectList().getItems();s=f.filter(function(e){return t._getRealTab()._isParentOf(e._getRealTab())});g=f.filter(function(e){return r._getRealTab()._isParentOf(e._getRealTab())})}if(e===o){a.insertAfter(n)}else{a.insertBefore(n)}s.reverse().forEach(function(e){e.$().insertAfter(a)});g.reverse().forEach(function(e){e.$().insertAfter(n)})},handleDrop:function(e,t,r,i,f,l){var u=e.indexOfItem(r),d=e.indexOfItem(i),_=0,b=sap.ui.getCore().getConfiguration().getRTL(),p=t===n,h=i._getNestedLevel()-1;if(r._isParentOf(i)){return}if(h===l&&t===a.On){return}if(b&&!f){if(p){_=u<d?d:d+1;g=o}else{_=u<d?d-1:d;g=s}}else{if(p){_=u<d?d-1:d;g=s}else{_=u<d?d:d+1;g=o}}if(e.isA("sap.m.IconTabFilter")||!r.getParent().isA("sap.m.IconTabHeader")){if(p){_=d}else{_=d+1}}c._insertControl(g,r,i);if(t===a.On){if(i===r){return}_=e.getAggregation("items").length}c._handleConfigurationAfterDragAndDrop.call(e,r,_)},_updateAccessibilityInfo:function(){var e=this.getItems(),t=1,r;e.forEach(function(e){r=e.getDomRef();if(r&&r.getAttribute("aria-posinset")!==null){r.setAttribute("aria-posinset",t++)}})},_handleConfigurationAfterDragAndDrop:function(e,t){var r=[],i=this.isA("sap.m.IconTabHeader")?this:this._getIconTabHeader();if(this.isA("sap.m.IconTabBarSelectList")){r=this.getItems().filter(function(t){return e._getRealTab()._isParentOf(t._getRealTab())})}i._setPreserveSelection(true);this.removeAggregation("items",e,true);this.insertAggregation("items",e,t,true);r.forEach(function(e){this.removeAggregation("items",e,true)}.bind(this));var a=1+this.indexOfAggregation("items",e);r.reverse().forEach(function(e){this.insertAggregation("items",e,a,true)}.bind(this));i._setPreserveSelection(false);c._updateAccessibilityInfo.call(this)},_decreaseDropIndex:function(e,t){var r=e-1;while(r>=0&&(t[e]._getRealTab()._getNestedLevel()!==t[r]._getRealTab()._getNestedLevel()||!t[r].getVisible()||!t[e].$().hasClass("sapMITBFilterHidden")&&t[r].$().hasClass("sapMITBFilterHidden"))){r--}if(r<0){g=o;return e}g=s;return r},_increaseDropIndex:function(e,t,r){var i=e+1;while(i<t.length&&(t[e]._getRealTab()._getNestedLevel()!==t[i]._getRealTab()._getNestedLevel()||!t[i].getVisible())){i++}if(i>r){g=s;return e}g=o;return i},moveItem:function(e,t,i){var a=this.getItems(),n=this.indexOfItem(e),f=sap.ui.getCore().getConfiguration().getRTL(),d,_;if(this.isA("sap.m.IconTabFilter")){a=this._getRealTab().getItems()}switch(t){case r.HOME:d=0;g=s;break;case r.END:d=a.length-1;g=o;break;case r.ARROW_LEFT:if(f){_=c.preventDragBetweenSubItems(e,l,this);d=c._increaseDropIndex(n,a,i)}else{_=c.preventDragBetweenSubItems(e,u,this);d=c._decreaseDropIndex(n,a)}break;case r.ARROW_RIGHT:if(f){_=c.preventDragBetweenSubItems(e,u,this);d=c._decreaseDropIndex(n,a)}else{_=c.preventDragBetweenSubItems(e,l,this);d=c._increaseDropIndex(n,a,i)}break;case r.ARROW_DOWN:_=c.preventDragBetweenSubItems(e,l,this);d=c._increaseDropIndex(n,a,i);break;case r.ARROW_UP:_=c.preventDragBetweenSubItems(e,u,this);d=c._decreaseDropIndex(n,a);break;default:return false}if(_){return false}if(!this.isA("sap.m.IconTabFilter")){var b=a[d];c._insertControl(g,e,b,this._oTabFilter&&this._oTabFilter._bIsOverflow)}c._handleConfigurationAfterDragAndDrop.call(this,e,d);return true},setDragDropAggregations:function(r,i,a){var n=r._oIconTabHeader?r._oIconTabHeader:r;var s=n.getId();r.addDragDropConfig(new e({sourceAggregation:"items",groupName:f+s}));r.addDragDropConfig(new t({targetAggregation:"items",dropPosition:a,dropLayout:i,drop:r._handleDragAndDrop.bind(r),groupName:f+s}))},preventDragBetweenSubItems:function(e,t,r){var i=false;if(r.isA("sap.m.IconTabBarSelectList")){var a=e._getRealTab(),n=a.getParent(),s=n.getItems();if(s.indexOf(a)===0&&t===u||s.indexOf(a)+1===s.length&&t===l||s.length===1){i=true}}return i}};return c});