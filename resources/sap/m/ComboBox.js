/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./InputBase","./ComboBoxTextField","./ComboBoxBase","./SuggestionsPopover","./List","./library","sap/ui/Device","sap/ui/core/Item","./StandardListItem","./ComboBoxRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","./Toolbar","sap/base/assert","sap/base/security/encodeXML","sap/ui/core/Core"],function(e,t,s,i,o,n,r,a,l,h,c,u,p,d,f,g){"use strict";var m=n.ListType;var I=n.ListMode;var y=n.ListSeparators;var S=s.extend("sap.m.ComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/ComboBox.designtime",properties:{selectedKey:{type:"string",group:"Data",defaultValue:""},selectedItemId:{type:"string",group:"Misc",defaultValue:""},filterSecondaryValues:{type:"boolean",group:"Misc",defaultValue:false}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false}},events:{change:{parameters:{value:{type:"string"},itemPressed:{type:"boolean"}}},selectionChange:{parameters:{selectedItem:{type:"sap.ui.core.Item"}}}}}});function v(e,t){if(!t){return}var s=e.getFocusDomRef(),i=e._getSelectionRange().start,o=s.value.substring(0,s.selectionStart),n=e._shouldResetSelectionStart(t),r=e.getSelectedItem(),a=t.isA("sap.ui.core.SeparatorItem"),l;e.setSelection(t);if(t!==r&&!a){e.updateDomValue(t.getText());e.fireSelectionChange({selectedItem:t});t=e.getSelectedItem();if(n){i=0}e.selectText(i,s.value.length);e._bIsLastFocusedItemHeader=false}if(a){e.setSelectedItem(null);e.fireSelectionChange({selectedItem:null});e.updateDomValue(o);e._bIsLastFocusedItemHeader=true}l=this.getListItem(t);e.handleListItemsVisualFocus(l);if(e.isOpen()){e.$().removeClass("sapMFocus");e._getList().addStyleClass("sapMListFocus")}else{e.$().addClass("sapMFocus")}e.scrollToItem(t)}S.prototype.scrollToItem=function(e){var t=this.getPicker(),s=t.getDomRef("cont"),i=this.getListItem(e),o=e&&i&&i.getDomRef();if(!t||!s||!o){return}var n=s.scrollTop,r=o.offsetTop,a=s.clientHeight,l=o.offsetHeight;if(n>r){s.scrollTop=r}else if(r+l>n+a){s.scrollTop=Math.ceil(r+l-a)}};function _(e,t){if(document.activeElement===this.getFocusDomRef()){this.selectText(e,t)}}function b(e){var t=this.getSelectedItem(),s=this.getListItem(t),i=t&&s&&s.getDomRef(),o=i&&i.offsetTop,n=i&&i.offsetHeight,r=this.getPicker(),a=r.getDomRef("cont"),l=a.clientHeight;if(t&&o+n>l){if(!e){this._getList().$().css("visibility","hidden")}else{a.scrollTop=o-n/2;this._getList().$().css("visibility","visible")}}}S.prototype._handleAriaActiveDescendant=function(e){var t=this.getFocusDomRef(),s=this.getListItem(e),i="aria-activedescendant";if(t){if(e&&s&&s.getDomRef()&&this.isOpen()){t.setAttribute(i,s.getId())}else{t.removeAttribute(i)}}};S.prototype._getSelectedItemText=function(e){e=e||this.getSelectedItem();if(!e){e=this.getDefaultSelectedItem()}if(e){return e.getText()}return""};S.prototype._setItemVisibility=function(e,t){var s=e&&this.getListItem(e).$(),i="sapMSelectListItemBaseInvisible";if(t){e.bVisible=true;s.length&&s.removeClass(i)}else{e.bVisible=false;s.length&&s.addClass(i)}};S.prototype._highlightList=function(e){var t=[],s=[],i,o;this._oList.getItems().forEach(function(e){o=e.getDomRef();if(o){t.push({ref:o.getElementsByClassName("sapMSLITitleOnly")[0],text:e.getTitle()});i=o.querySelector(".sapMSLIInfo");if(i&&e.getInfo){s.push({ref:i,text:e.getInfo()})}}});this.highLightList(e,t);this.highLightList(e,s)};S.prototype.setSelectedIndex=function(e,t){var s;t=t||this.getItems();e=e>t.length-1?t.length-1:Math.max(0,e);s=t[e];if(s){this.setSelection(s)}};S.prototype.configureDropdown=function(e){e.setShowHeader(true);e.setInitialFocus(this)};S.prototype.configureDialog=function(e){var t=this,s=this.createPickerTextField(),i=s._handleEvent,o=this.getPickerInvisibleTextId();s._handleEvent=function(e){i.apply(this,arguments);if(/keydown|sapdown|sapup|saphome|sapend|sappagedown|sappageup|input/.test(e.type)){t._handleEvent(e)}};e._oPopupInput=s;e.setStretch(true).setCustomHeader(this.createPickerHeader()).setSubHeader(new p({content:s})).addButton(this.createPickerCloseButton()).attachBeforeOpen(function(){t.updatePickerHeaderTitle()}).attachAfterClose(function(){t.focus();n.closeKeyboard()});if(o){e.addAriaLabelledBy(o)}};S.prototype.createPickerTextField=function(){var e=new t({width:"100%",showValueStateMessage:false,showButton:false}).addEventDelegate({onsapenter:function(){this.updateDomValue(e.getValue());this.onChange()}},this);return e};S.prototype.revertSelection=function(){var e,t=this.getPickerTextField();this.setSelectedItem(this._oSelectedItemBeforeOpen);this.setValue(this._sValueBeforeOpen);if(this.getSelectedItem()===null){e=this._sValueBeforeOpen}else{e=this._oSelectedItemBeforeOpen.getText()}t&&t.setValue(e)};S.prototype.filterItems=function(e){var t=this.getItems(),i=[],o=[],n=e.properties.indexOf("additionalText")>-1,r=this.fnFilter||s.DEFAULT_TEXT_FILTER,a=[],l=false;this._oFirstItemTextMatched=null;t.forEach(function(t){if(t.isA("sap.ui.core.SeparatorItem")){if(!t.getText()){this.getListItem(t).setVisible(false);return}a.push({separator:t,show:false});l=true;this.getListItem(t).setVisible(false);return}var s=r.call(this,e.value,t,"getText");var h=r.call(this,e.value,t,"getAdditionalText");if((s||h)&&l){a[a.length-1].show=true;l=false}if(s){o.push(t);i.push(t)}else if(h&&n){i.push(t)}}.bind(this));t.forEach(function(e){if(e.isA("sap.ui.core.SeparatorItem")){return}var t=i.indexOf(e)>-1;var s=o.indexOf(e)>-1;if(!this._oFirstItemTextMatched&&s){this._oFirstItemTextMatched=e}this.getListItem(e).setVisible(t)},this);a.forEach(function(e){if(e.show){this.getListItem(e.separator).setVisible(true)}}.bind(this));return i};S.prototype._filterStartsWithItems=function(e,t){var s=e.toLowerCase();var i=this.getItems(),o=i.filter(function(e){return e[t]&&e[t]().toLowerCase().startsWith(s)});return o};S.prototype._getFilters=function(){return this.getFilterSecondaryValues()?["text","additionalText"]:["text"]};S.prototype.getNextFocusableItem=function(e){var t=this.getSelectableItems(),s=this.getNonSeparatorSelectableItems(t),i=this.$().hasClass("sapMFocus"),o=this.getSelectedItem()||this._getItemByListItem(this._oLastFocusedListItem),n;if(i&&this.isOpen()){n=t[0]}else if(i){n=s[s.indexOf(o)+(e?1:-1)]}else{n=t[t.indexOf(o)+(e?1:-1)]}return n};S.prototype.getNonSeparatorSelectableItems=function(e){return e.filter(function(e){return!e.isA("sap.ui.core.SeparatorItem")})};S.prototype._itemsTextStartsWithTypedValue=function(e,t){if(!e||typeof t!="string"||t==""){return false}return e.getText().toLowerCase().startsWith(t.toLowerCase())};S.prototype._shouldResetSelectionStart=function(e){var t=this.getFocusDomRef(),s=this._getSelectionRange(),i=s.start!==s.end,o=t.value.substring(0,s.start),n=this._itemsTextStartsWithTypedValue(e,o);return!(n&&(i||this._bIsLastFocusedItemHeader))};S.prototype._getSelectionRange=function(){var e=this.getFocusDomRef(),t=this.getValue(),s=e.selectionStart,i=e.selectionEnd,o={start:s,end:i};if(!(r.browser.msie||r.browser.edge)){return o}if(this._bIsLastFocusedItemHeader){o.start=t.length;o.end=t.length}return o};S.prototype.handleListItemsVisualFocus=function(e){if(this._oLastFocusedListItem){this._oLastFocusedListItem.removeStyleClass("sapMLIBFocused");this._oLastFocusedListItem=null}if(e){this._oLastFocusedListItem=e;e.addStyleClass("sapMLIBFocused")}};S.prototype.init=function(){this._oRb=g.getLibraryResourceBundle("sap.m");s.prototype.init.apply(this,arguments);this.bOpenValueStateMessage=true;this._sValueBeforeOpen="";this._sInputValueBeforeOpen="";this._oSelectedItemBeforeOpen=null;this._oFirstItemTextMatched=null;this.bIsFocused=false;if(r.system.phone){this.attachEvent("_change",this.onPropertyChange,this)}this._oLastFocusedListItem=null;this._bIsLastFocusedItemHeader=null};S.prototype.onBeforeRendering=function(){s.prototype.onBeforeRendering.apply(this,arguments);this._fillList();this.synchronizeSelection()};S.prototype._fillList=function(){var e=this._getList(),t,s,i,o,n;if(!e){return}if(this._oLastFocusedListItem){n=this._getItemByListItem(this._oLastFocusedListItem)}e.destroyItems();t=this.getItems();if(this._sInputValueBeforeOpen){t=this.filterItems({properties:this._getFilters(),value:this._sInputValueBeforeOpen})}for(o=0,i=t.length;o<i;o++){s=this._mapItemToListItem(t[o]);e.addAggregation("items",s,true)}if(n){this._oLastFocusedListItem=this.getListItem(n)}};S.prototype.exit=function(){s.prototype.exit.apply(this,arguments);this._oRb=null;this._oSelectedItemBeforeOpen=null;this._oFirstItemTextMatched=null;this._oLastFocusedListItem=null;if(this._oSuggestionPopover){this._oSuggestionPopover.destroy();this._oSuggestionPopover=null}};S.prototype.onBeforeRenderingPicker=function(){var e=this["onBeforeRendering"+this.getPickerType()];e&&e.call(this)};S.prototype.onBeforeRenderingDropdown=function(){var e=this.getPicker(),t=this.$().outerWidth()/parseFloat(n.BaseFontSize)+"rem";if(e){e.setContentMinWidth(t)}};S.prototype.onBeforeRenderingList=function(){if(this.bProcessingLoadItemsEvent){var e=this._getList(),t=this.getFocusDomRef();if(e){e.setBusy(true)}if(t){t.setAttribute("aria-busy","true")}}};S.prototype.onAfterRenderingPicker=function(){var e=this["onAfterRendering"+this.getPickerType()];e&&e.call(this);b.call(this,false)};S.prototype.onAfterRenderingList=function(){var e=this.getSelectedItem();if(this.bProcessingLoadItemsEvent&&this.getItems().length===0){return}var t=this._getList(),s=this.getFocusDomRef();this._highlightList(this._sInputValueBeforeOpen);if(e){t.setSelectedItem(this.getListItem(e))}if(t){t.setBusy(false)}if(s){s.removeAttribute("aria-busy")}};S.prototype.oninput=function(e){s.prototype.oninput.apply(this,arguments);if(e.isMarked("invalid")){return}this.loadItems(function(){this.handleInputValidation(e,this.isComposingCharacter())},{name:"input",busyIndicator:false});if(this.bProcessingLoadItemsEvent&&this.getPickerType()==="Dropdown"){this.open()}this.$().addClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus")};S.prototype.handleInputValidation=function(e,t){var s=this.getSelectedItem(),i=e.target.value,o=i==="",n=e.srcControl,r,a=this.getPickerType()==="Dropdown";if(o&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){r=this.getItems()}else{r=this.filterItems({properties:this._getFilters(),value:i})}var l=!!r.length;var h=r[0];if(!o&&h&&h.getEnabled()){this.handleTypeAhead(n,r,i,t)}if(o||!l||!n._bDoTypeAhead&&this._getSelectedItemText()!==i){this.setSelection(null);if(s!==this.getSelectedItem()){this.fireSelectionChange({selectedItem:this.getSelectedItem()})}}this._sInputValueBeforeOpen=i;if(this.isOpen()){setTimeout(function(){this._highlightList(i)}.bind(this))}if(l){if(o&&!this.bOpenedByKeyboardOrButton){this.close()}else if(a){this.open();this.scrollToItem(this.getSelectedItem())}}else if(this.isOpen()){if(a&&!this.bOpenedByKeyboardOrButton){this.close()}}else{this.clearFilter()}};S.prototype.handleTypeAhead=function(e,t,s,i){var o=this.intersectItems(this._filterStartsWithItems(s,"getText"),t);var n=this.getFilterSecondaryValues();var a=r.system.desktop;var l=this.getSelectedItem();if(e._bDoTypeAhead){var h=this.intersectItems(this._filterStartsWithItems(s,"getAdditionalText"),t);if(n&&!o[0]&&h[0]){!i&&e.updateDomValue(h[0].getAdditionalText());this.setSelection(h[0])}else if(o[0]){!i&&e.updateDomValue(o[0].getText());this.setSelection(o[0])}}else{this.setSelection(o[0])}if(l!==this.getSelectedItem()){this.fireSelectionChange({selectedItem:this.getSelectedItem()})}if(e._bDoTypeAhead){if(a){_.call(e,s.length,e.getValue().length)}else{setTimeout(_.bind(e,s.length,e.getValue().length),0)}}this.$().addClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus")};S.prototype.onSelectionChange=function(e){var t=this._getItemByListItem(e.getParameter("listItem")),s=this.getChangeEventParams(),i=t!==this.getSelectedItem();this.setSelection(t);this.fireSelectionChange({selectedItem:this.getSelectedItem()});if(i){s.itemPressed=true;this.onChange(null,s)}};S.prototype.onItemPress=function(e){var t=e.getParameter("listItem"),s=t.getTitle(),i=this.getChangeEventParams(),o=t!==this.getListItem(this.getSelectedItem());if(t.isA("sap.m.GroupHeaderListItem")){return}this.handleListItemsVisualFocus(t);this.updateDomValue(s);if(!o){i.itemPressed=true;this.onChange(null,i)}this.setProperty("value",s,true);if(this.getPickerType()==="Dropdown"){setTimeout(this.selectText.bind(this,this.getValue().length,this.getValue().length),0)}setTimeout(this.close.bind(this))};S.prototype.onBeforeOpen=function(){var t=this["onBeforeOpen"+this.getPickerType()],s=this.getFocusDomRef();if(this.hasLoadItemsEventListeners()&&!this.bProcessingLoadItemsEvent){this.loadItems()}this.addStyleClass(e.ICON_PRESSED_CSS_CLASS);if(s){this.getRoleComboNodeDomRef().setAttribute("aria-owns",this._getList().getId())}this.addContent();t&&t.call(this)};S.prototype.onBeforeOpenDialog=function(){var e=this.getPickerTextField();this._oSelectedItemBeforeOpen=this.getSelectedItem();this._sValueBeforeOpen=this.getValue();if(this.getSelectedItem()){this.filterItems({properties:this._getFilters(),value:""})}e.setValue(this._sValueBeforeOpen)};S.prototype.onAfterOpen=function(){var e=this.getFocusDomRef(),t=this.getSelectedItem(),s=this.getListItem(t);if(e){this.getRoleComboNodeDomRef().setAttribute("aria-expanded","true");s&&e.setAttribute("aria-activedescendant",s.getId())}b.call(this,true)};S.prototype.onBeforeClose=function(){s.prototype.onBeforeClose.apply(this,arguments);var t=this.getFocusDomRef();if(t){this.getRoleComboNodeDomRef().removeAttribute("aria-owns");t.removeAttribute("aria-activedescendant")}this.removeStyleClass(e.ICON_PRESSED_CSS_CLASS)};S.prototype.onAfterClose=function(){var e=this.getFocusDomRef();if(e){this.getRoleComboNodeDomRef().setAttribute("aria-expanded","false")}this.clearFilter();this._sInputValueBeforeOpen="";if(this.shouldValueStateMessageBeOpened()&&document.activeElement===e){this.openValueStateMessage()}};S.prototype.onItemChange=function(e){var t=this.getAssociation("selectedItem"),s=e.getParameter("newValue"),i=e.getParameter("name");if(t===e.getParameter("id")){switch(i){case"text":if(!this.isBound("value")){this.setValue(s)}break;case"key":if(!this.isBound("selectedKey")){this.setSelectedKey(s)}break}}};S.prototype._handleItemTap=function(e){var t=jQuery(e.target).control(0);if(!t.isA("sap.m.GroupHeaderListItem")){this.close()}};S.prototype.onkeydown=function(e){var t=e.srcControl;s.prototype.onkeydown.apply(t,arguments);if(!t.getEnabled()||!t.getEditable()){return}var i=u;t._bDoTypeAhead=e.which!==i.BACKSPACE&&e.which!==i.DELETE};S.prototype.oncut=function(e){var t=e.srcControl;s.prototype.oncut.apply(t,arguments);t._bDoTypeAhead=false};S.prototype.onsapenter=function(e){var t=e.srcControl,i=t.getSelectedItem();if(i&&this.getFilterSecondaryValues()){t.updateDomValue(i.getText())}s.prototype.onsapenter.apply(t,arguments);if(!t.getEnabled()||!t.getEditable()){return}if(t.isOpen()&&!this.isComposingCharacter()){t.close()}};S.prototype.onsapdown=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function e(){v.call(this,t,this.getNextFocusableItem(true))})};S.prototype.onsapup=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function e(){v.call(this,t,this.getNextFocusableItem(false))})};S.prototype.onsaphome=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function e(){var s=this.getSelectableItems()[0];v.call(this,t,s)})};S.prototype.onsapend=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function e(){var s=this.findLastEnabledItem(this.getSelectableItems());v.call(this,t,s)})};S.prototype.onsappagedown=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function(){var e=this.getNonSeparatorSelectableItems(this.getSelectableItems()),s=e.indexOf(this.getSelectedItem())+10,i;s=s>e.length-1?e.length-1:Math.max(0,s);i=e[s];v.call(this,t,i)})};S.prototype.onsappageup=function(e){var t=e.srcControl;if(!t.getEnabled()||!t.getEditable()){return}e.setMarked();e.preventDefault();this.loadItems(function(){var e=this.getNonSeparatorSelectableItems(this.getSelectableItems()),s=e.indexOf(this.getSelectedItem())-10,i;s=s>e.length-1?e.length-1:Math.max(0,s);i=e[s];v.call(this,t,i)})};S.prototype.onsapshow=function(e){var t,i;s.prototype.onsapshow.apply(this,arguments);if(!this.getValue()){t=this.getSelectableItems();i=this.getNonSeparatorSelectableItems(t)[0];if(i){this.setSelection(i);this.updateDomValue(i.getText());this.fireSelectionChange({selectedItem:i});setTimeout(function(){this.selectText(0,i.getText().length)}.bind(this),0)}}};S.prototype.onsaphide=S.prototype.onsapshow;S.prototype.onfocusin=function(e){var t=this.getPickerType()==="Dropdown";if(this._bIsBeingDestroyed){return}if(e.target===this.getOpenArea()){this.bOpenValueStateMessage=false;if(t&&!this.isPlatformTablet()){this.focus()}}else{if(t){setTimeout(function(){if(document.activeElement===this.getFocusDomRef()&&!this.bIsFocused&&!this.bFocusoutDueRendering&&!this.getSelectedText()){this.selectText(0,this.getValue().length)}this.bIsFocused=true}.bind(this),0)}if(!this.isOpen()&&this.bOpenValueStateMessage&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage()}this.bOpenValueStateMessage=true}if(this.getEnabled()&&(!this.isOpen()||!this.getSelectedItem()||!this._getList().hasStyleClass("sapMListFocus"))){this.$().addClass("sapMFocus")}};S.prototype.onsapfocusleave=function(e){this.bIsFocused=false;var t,i,o,n,r=this.getSelectedItem();if(r&&this.getFilterSecondaryValues()){this.updateDomValue(r.getText())}s.prototype.onsapfocusleave.apply(this,arguments);if(this.isPickerDialog()){return}i=this.getAggregation("picker");if(!e.relatedControlId||!i){return}t=this.isPlatformTablet();o=g.byId(e.relatedControlId);n=o&&o.getFocusDomRef();if(c(i.getFocusDomRef(),n)&&!t){this.focus()}};S.prototype.setSelection=function(e){var t=this._getList(),s,i;this.setAssociation("selectedItem",e,true);this.setProperty("selectedItemId",e instanceof a?e.getId():e,true);if(typeof e==="string"){e=g.byId(e)}if(t){s=this.getListItem(e);if(s){t.setSelectedItem(s,true)}else{t.removeSelections(true)}}i=e?e.getKey():"";this.setProperty("selectedKey",i,true);this._handleAriaActiveDescendant(e);if(this._oSuggestionPopover){this._oSuggestionPopover._iPopupListSelectedIndex=this.getItems().indexOf(e)}};S.prototype.isSelectionSynchronized=function(){var e=this.getSelectedItem();return this.getSelectedKey()===(e&&e.getKey())};S.prototype.synchronizeSelection=function(){if(this.isSelectionSynchronized()){return}var e=this.getSelectedKey(),t=this.getItemByKey(""+e);if(t&&e!==""){this.setAssociation("selectedItem",t,true);this.setProperty("selectedItemId",t.getId(),true);if(this._sValue===this.getValue()){this.setValue(t.getText());this._sValue=this.getValue()}}};S.prototype.isFiltered=function(){var e=this._getList();return e&&e.getVisibleItems().length!==this.getItems().length};S.prototype.isItemVisible=function(e){return e&&(e.bVisible===undefined||e.bVisible)};S.prototype.createPicker=function(e){var t=this.getAggregation("picker"),s=this.getRenderer(),i=s.CSS_CLASS_COMBOBOXBASE;if(t){return t}this._oSuggestionPopover=this._createSuggestionsPopover();t=this._oSuggestionPopover._oPopover;this.setAggregation("picker",t,true);this["configure"+e](t);t.setHorizontalScrolling(false).addStyleClass(i+"Picker").addStyleClass(i+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);return t};S.prototype._createSuggestionsPopover=function(){var e=this.isPickerDialog(),t;t=new i(this);if(e){t._oPopupInput=this.createPickerTextField()}t._createSuggestionPopup();t._createSuggestionPopupContent(false,false,false);this._oList=t._oList;this._configureList(this._oList);return t};S.prototype._configureList=function(e){var t=this.getRenderer();if(!e){return}e.setMode(I.SingleSelectMaster).setShowSeparators(y.None).setIncludeItemInSelection(true).setWidth("100%").setRememberSelections(false).setBusyIndicatorDelay(0).addStyleClass(t.CSS_CLASS_COMBOBOXBASE+"List").addStyleClass(t.CSS_CLASS_COMBOBOX+"List");e.attachSelectionChange(this.onSelectionChange,this).attachItemPress(this.onItemPress,this);e.addEventDelegate({ontap:this._handleItemTap,onBeforeRendering:this.onBeforeRenderingList,onAfterRendering:this.onAfterRenderingList},this)};S.prototype.destroyItems=function(){this.destroyAggregation("items");if(this._getList()){this._getList().destroyItems()}return this};S.prototype._mapItemToListItem=function(e){var t,s,i,o;var n=this.getRenderer();if(!e){return null}o=e.getAdditionalText&&this.getShowSecondaryValues()?e.getAdditionalText():"";s=n.CSS_CLASS_COMBOBOXBASE+"Item";i=this.isItemSelected(e)?s+"Selected":"";if(e.isA("sap.ui.core.SeparatorItem")){t=this._mapSeparatorItemToGroupHeader(e,n)}else{t=new l({type:m.Active,info:o,visible:e.getEnabled()}).addStyleClass(s+" "+i)}t.setTitle(e.getText());this.setSelectable(e,e.getEnabled());t.setTooltip(e.getTooltip());e.data(n.CSS_CLASS_COMBOBOXBASE+"ListItem",t);return t};S.prototype.setSelectable=function(e,t){if(this.indexOfItem(e)<0){return}e._bSelectable=t;var s=this.getListItem(e);if(s){s.setVisible(t)}};S.prototype.isItemSelected=function(e){return e&&e.getId()===this.getAssociation("selectedItem")};S.prototype.getDefaultSelectedItem=function(){return null};S.prototype.getChangeEventParams=function(){return{itemPressed:false}};S.prototype.clearSelection=function(){this.setSelection(null)};S.prototype.selectText=function(e,t){s.prototype.selectText.apply(this,arguments);this.textSelectionStart=e;this.textSelectionEnd=t;return this};S.prototype.setAssociation=function(e,t,i){var o=this._getList();if(o&&e==="selectedItem"){if(!(t instanceof a)){t=this.findItem("id",t)}o.setSelectedItem(this.getListItem(t),true)}return s.prototype.setAssociation.apply(this,arguments)};S.prototype.removeAllAssociation=function(e,t){var i=this._getList();if(i&&e==="selectedItem"){o.prototype.removeAllAssociation.apply(i,arguments)}return s.prototype.removeAllAssociation.apply(this,arguments)};S.prototype.clone=function(e){var t=s.prototype.clone.apply(this,arguments),i=this._getList();if(!this.isBound("items")&&i){t.setSelectedIndex(this.indexOfItem(this.getSelectedItem()))}return t};S.prototype.open=function(){var e=this._getList();s.prototype.open.call(this);if(this.getSelectedItem()){e.addStyleClass("sapMListFocus");this.$().removeClass("sapMFocus")}return this};S.prototype.close=function(){var e=this._getList();s.prototype.close.call(this);this.$().addClass("sapMFocus");e&&e.removeStyleClass("sapMListFocus");return this};S.prototype.findAggregatedObjects=function(){var e=this._getList();if(e){return o.prototype.findAggregatedObjects.apply(e,arguments)}return[]};S.prototype.setSelectedItem=function(e){if(typeof e==="string"){this.setAssociation("selectedItem",e,true);e=g.byId(e)}if(!(e instanceof a)&&e!==null){return this}if(!e){e=this.getDefaultSelectedItem()}this.setSelection(e);this.setValue(this._getSelectedItemText(e));return this};S.prototype.setSelectedItemId=function(e){e=this.validateProperty("selectedItemId",e);if(!e){e=this.getDefaultSelectedItem()}this.setSelection(e);e=this.getSelectedItem();this.setValue(this._getSelectedItemText(e));return this};S.prototype.setSelectedKey=function(e){e=this.validateProperty("selectedKey",e);var t=e==="",s=this.isBound("selectedKey")&&this.isBound("value")&&this.getBindingInfo("selectedKey").skipModelUpdate;if(t){this.setSelection(null);if(!s){this.setValue("")}return this}var i=this.getItemByKey(e);if(i){this.setSelection(i);if(!s){this.setValue(this._getSelectedItemText(i))}return this}this._sValue=this.getValue();return this.setProperty("selectedKey",e)};S.prototype.getSelectedItem=function(){var e=this.getAssociation("selectedItem");return e===null?null:g.byId(e)||null};S.prototype.updateItems=function(){var e,t=this.getSelectedItem(),e=s.prototype.updateItems.apply(this,arguments);clearTimeout(this._debounceItemsUpdate);this._debounceItemsUpdate=setTimeout(this["_syncItemsSelection"].bind(this,t),0);return e};S.prototype._syncItemsSelection=function(e){var t,s,i=this.getSelectedKey();if(!e||e===this.getSelectedItem()){return}s=this.getItems();t=s.some(function(e){return i===e.getKey()});this.setSelectedItem(t&&i?this.getItemByKey(i):null)};S.prototype.removeItem=function(e){e=s.prototype.removeItem.apply(this,arguments);var t;if(this._getList()){this._getList().removeItem(e&&this.getListItem(e))}if(this.isBound("items")&&!this.bItemsUpdated){return e}var i=this.getValue();if(this.getItems().length===0){this.clearSelection()}else if(this.isItemSelected(e)){t=this.getDefaultSelectedItem();this.setSelection(t);this.setValue(i)}return e};S.prototype.applyShowItemsFilters=function(){var e=this.getPicker(),t=function(){e.detachBeforeOpen(t,this);e=null;this.filterItems({value:this.getValue()||"_",properties:this._getFilters()})};e.attachBeforeOpen(t,this)};return S});