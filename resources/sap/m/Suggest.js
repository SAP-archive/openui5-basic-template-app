/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./Toolbar","./Button","./SuggestionsList","./SuggestionItem","sap/ui/Device","sap/m/library","sap/ui/core/Core"],function(e,t,n,s,i,r,o,a){"use strict";var u=o.PlacementType;function c(c){var l=c,p,f,d,g=r.system.phone,h=this;e.sap.require(g?"sap.m.Dialog":"sap.m.Popover");function m(e){var t=e.srcControl;var n;if(t instanceof i){n=t.getSuggestionText();h._suggestionItemTapped=true;p.close();window.setTimeout(function(){c._updateValue(n);c._fireChangeEvent();c.fireSearch({query:n,suggestionItem:t,refreshButtonPressed:false,clearButtonPressed:false})},0)}}function v(){var e,s,i,r,o,u;i=new(sap.ui.require("sap/m/SearchField"))({liveChange:function(e){var t=e.getParameter("newValue");c._updateValue(t);c.fireLiveChange({newValue:t});c.fireSuggest({suggestValue:t});h.update()},search:function(t){if(!t.getParameter("clearButtonPressed")){e.close()}}});u=new n({icon:"sap-icon://decline",press:function(){h._cancelButtonTapped=true;e._oCloseTrigger=true;e.close();c._updateValue(s)}});r=new t({content:[i,u]});o=new n({text:a.getLibraryResourceBundle("sap.m").getText("MSGBOX_OK"),press:function(){e.close()}});e=new(sap.ui.require("sap/m/Dialog"))({stretch:true,customHeader:r,content:_(),beginButton:o,beforeClose:function(){c._bSuggestionSuppressed=true},beforeOpen:function(){s=c.getValue();i._updateValue(s)},afterClose:function(e){if(!h._cancelButtonTapped&&!h._suggestionItemTapped){c._fireChangeEvent();c.fireSearch({query:c.getValue(),refreshButtonPressed:false,clearButtonPressed:false})}}});e.addEventDelegate({ontap:m},c);return e}function S(){var e=h._oPopover=new(sap.ui.require("sap/m/Popover"))({showArrow:false,showHeader:false,horizontalScrolling:false,placement:u.Vertical,offsetX:0,offsetY:0,initialFocus:l,bounce:false,afterOpen:function(){c.$("I").attr("aria-haspopup","true");c._applySuggestionAcc()},beforeClose:function(){c.$("I").attr("aria-haspopup","false").removeAttr("aria-activedescendant");c.$("SuggDescr").text("")},content:_()}).addStyleClass("sapMSltPicker").addStyleClass("sapMSltPicker-CTX");e.open=function(){return this.openBy(l)};e.addEventDelegate({onAfterRendering:h.setPopoverMinWidth.bind(h),ontap:m},c);return e}function _(){if(!f){f=new s({parentInput:l})}return f}function w(){if(p===undefined){p=g?v():S()}return p}this.setPopoverMinWidth=function(){var e=h._oPopover.getDomRef();if(e){var t=c.$().outerWidth()/parseFloat(o.BaseFontSize)+"rem";e.style.minWidth=t}};this.destroy=function(){if(p){p.close();p.destroy();p=null}if(f){f.destroy();f=null}};this.close=function(){if(!g&&this.isOpen()){p.close()}};this.open=function(){if(!this.isOpen()){this.setSelected(-1);this._suggestionItemTapped=false;this._cancelButtonTapped=false;w().open()}};this.update=function(){var e=_();window.clearTimeout(d);if(this.isOpen()){d=window.setTimeout(e.update.bind(e),50);c._applySuggestionAcc()}};this.isOpen=function(){return!!p&&p.isOpen()};this.getSelected=function(){return _().getSelectedItemIndex()};this.setSelected=function(e,t){return _().selectByIndex(e,t)}}return c},true);