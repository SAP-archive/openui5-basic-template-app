/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/Device","sap/ui/core/Element","./InputBase","./DateTimeField","./Button","./ResponsivePopover","./ValueStateHeader","sap/ui/core/date/UniversalDate","./library","sap/ui/core/Control","sap/ui/core/library","./DatePickerRenderer","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/IconPool","./InstanceManager","sap/ui/unified/Calendar","sap/ui/unified/DateRange","sap/ui/unified/DateTypeRange","sap/ui/unified/calendar/CustomMonthPicker","sap/ui/unified/calendar/CustomYearPicker","sap/ui/core/LabelEnablement","sap/ui/unified/library","sap/ui/dom/jquery/cursorPos"],function(e,t,a,i,s,o,n,r,p,l,u,h,d,g,f,_,c,y,D,m,C,v,P,T,b){"use strict";var V=h.CalendarType;var S=sap.ui.getCore().getLibraryResourceBundle("sap.m");var w=s.extend("sap.m.DatePicker",{metadata:{library:"sap.m",properties:{displayFormatType:{type:"string",group:"Appearance",defaultValue:""},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance",defaultValue:null},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showFooter:{type:"boolean",group:"Misc",defaultValue:false},showCurrentDateButton:{type:"boolean",group:"Behavior",defaultValue:false}},aggregations:{specialDates:{type:"sap.ui.core.Element",multiple:true,singularName:"specialDate"},_popup:{type:"sap.m.ResponsivePopover",multiple:false,visibility:"hidden"}},associations:{legend:{type:"sap.ui.core.Control",multiple:false}},events:{navigate:{parameters:{dateRange:{type:"sap.ui.unified.DateRange"},afterPopupOpened:{type:"boolean"}}}},designtime:"sap/m/designtime/DatePicker.designtime",dnd:{draggable:false,droppable:true}}});w.prototype.init=function(){s.prototype.init.apply(this,arguments);this._bIntervalSelection=false;this._bOnlyCalendar=true;this._bValid=true;this._oMinDate=new Date(1,0,1);this._oMinDate.setFullYear(1);this._oMaxDate=new Date(9999,11,31,23,59,59,999);var e=this.addEndIcon({id:this.getId()+"-icon",src:this.getIconSrc(),noTabStop:true,tooltip:S.getText("OPEN_PICKER_TEXT")});this._bShouldClosePicker=false;e.addEventDelegate({onmousedown:function(e){this._bShouldClosePicker=!!this.isOpen()}},this);e.attachPress(function(){this.toggleOpen(this._bShouldClosePicker)},this)};w.prototype.isValidValue=function(){return this._bValid};w.prototype.isOpen=function(){return this._oPopup&&this._oPopup.isOpen()};w.prototype.toggleOpen=function(e){if(this.getEditable()&&this.getEnabled()){if(e){E.call(this)}else{M.call(this)}}};w.prototype.getIconSrc=function(){return c.getIconURI("appointment-2")};w.prototype.exit=function(){i.prototype.exit.apply(this,arguments);if(this._oPopup){if(this._oPopup.isOpen()){this._oPopup.close()}delete this._oPopup}if(this._getCalendar()){if(this._oCalendarAfterRenderDelegate){this._getCalendar().removeDelegate(this._oCalendarAfterRenderDelegate)}this._getCalendar().destroy();delete this._getCalendar()}if(this._iInvalidateCalendar){clearTimeout(this._iInvalidateCalendar)}this._sUsedDisplayPattern=undefined;this._sUsedDisplayCalendarType=undefined;this._oDisplayFormat=undefined;this._sUsedValuePattern=undefined;this._sUsedValueCalendarType=undefined;this._oValueFormat=undefined};w.prototype.invalidate=function(e){if(!e||e!=this._getCalendar()){u.prototype.invalidate.apply(this,arguments);this._iInvalidateCalendar=setTimeout(O.bind(this),0)}};w.prototype.onBeforeRendering=function(){s.prototype.onBeforeRendering.apply(this,arguments);this._checkMinMaxDate();var e=this._getValueHelpIcon();if(e){e.setProperty("visible",this.getEditable(),true)}};w.prototype.setDisplayFormat=function(e){this.setProperty("displayFormat",e);if(this._oCalendar){this._oCalendar.removeDelegate(this._oCalendarAfterRenderDelegate);this._oCalendar.destroy();this._oCalendar=null;this._createPopupContent()}return this};w.prototype.setWidth=function(e){return i.prototype.setWidth.call(this,e||"100%")};w.prototype.getWidth=function(e){return this.getProperty("width")||"100%"};w.prototype.applyFocusInfo=function(e){this._bFocusNoPopup=true;if(!t.support.touch||t.system.desktop){i.prototype.applyFocusInfo.apply(this,arguments)}};w.prototype.onfocusin=function(t){if(!e(t.target).hasClass("sapUiIcon")){s.prototype.onfocusin.apply(this,arguments)}this._bFocusNoPopup=undefined};w.prototype.onsapshow=function(e){this.toggleOpen(this.isOpen());e.preventDefault()};w.prototype.onsaphide=w.prototype.onsapshow;w.prototype.onsappageup=function(e){var t=this._getCalendarConstructor().getMetadata().getName();e.preventDefault();if(t!="sap.ui.unified.Calendar"){return}this._increaseDate(1,"day")};w.prototype.onsappageupmodifiers=function(e){var t=this._getCalendarConstructor().getMetadata().getName();e.preventDefault();if(!e.ctrlKey&&e.shiftKey){if(t=="sap.ui.unified.internal.CustomYearPicker"){return}this._increaseDate(1,"month")}else{this._increaseDate(1,"year")}};w.prototype.onsappagedown=function(e){var t=this._getCalendarConstructor().getMetadata().getName();e.preventDefault();if(t!="sap.ui.unified.Calendar"){return}this._increaseDate(-1,"day")};w.prototype.onsappagedownmodifiers=function(e){var t=this._getCalendarConstructor().getMetadata().getName();e.preventDefault();if(!e.ctrlKey&&e.shiftKey){if(t=="sap.ui.unified.internal.CustomYearPicker"){return}this._increaseDate(-1,"month")}else{this._increaseDate(-1,"year")}};w.prototype.onkeypress=function(e){if(!e.charCode||e.metaKey||e.ctrlKey){return}var t=this._getFormatter(true);var a=String.fromCharCode(e.charCode);if(a&&t.sAllowedCharacters&&t.sAllowedCharacters.indexOf(a)<0){e.preventDefault()}};w.prototype._getValueHelpIcon=function(){var e=this.getAggregation("_endIcon");return e&&e[0]};w.prototype._dateValidation=function(e){this._bValid=true;if(e&&(e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime())){this._bValid=false;f(this._bValid,"Date must be in valid range")}this.setProperty("dateValue",e);return e};w.prototype.setMinDate=function(e){if(!this._isValidDate(e)){throw new Error("Date must be a JavaScript date object; "+this)}if(g(this.getMinDate(),e)){return this}if(e){var t=e.getFullYear();if(t<1||t>9999){throw new Error("Date must be between 0001-01-01 and 9999-12-31; "+this)}this._oMinDate=new Date(e.getTime());var a=this.getDateValue();if(a&&a.getTime()<e.getTime()){this._bValid=false;this._bOutOfAllowedRange=true;_.warning("DateValue not in valid date range",this)}}else{this._oMinDate=new Date(1,0,1);this._oMinDate.setFullYear(1)}this.setProperty("minDate",e);if(this._getCalendar()){this._getCalendar().setMinDate(e)}this._oMinDate.setHours(0,0,0,0);return this};w.prototype.setMaxDate=function(e){if(!this._isValidDate(e)){throw new Error("Date must be a JavaScript date object; "+this)}if(g(this.getMaxDate(),e)){return this}if(e){var t=e.getFullYear();if(t<1||t>9999){throw new Error("Date must be between 0001-01-01 and 9999-12-31; "+this)}this._oMaxDate=new Date(e.getTime());var a=this.getDateValue();if(a&&a.getTime()>e.getTime()){this._bValid=false;this._bOutOfAllowedRange=true;_.warning("DateValue not in valid date",this)}}else{this._oMaxDate=new Date(9999,11,31,23,59,59,999)}this.setProperty("maxDate",e);if(this._getCalendar()){this._getCalendar().setMaxDate(e)}this._oMaxDate.setHours(23,59,59,999);return this};w.prototype.setCurrentDateButton=function(e){var t=this._getCalendar();t&&t.setCurrentDateButton(e);return this.setProperty("showCurrentDateButton",e)};w.prototype._checkMinMaxDate=function(){if(this._oMinDate.getTime()>this._oMaxDate.getTime()){_.warning("minDate > MaxDate -> dates switched",this);var e=new Date(this._oMinDate.getTime());var t=new Date(this._oMaxDate.getTime());this._oMinDate=new Date(t.getTime());this._oMaxDate=new Date(e.getTime());this.setProperty("minDate",t,true);this.setProperty("maxDate",e,true);if(this._getCalendar()){this._getCalendar().setMinDate(t);this._getCalendar().setMaxDate(e)}}var a=this.getDateValue();if(a&&(a.getTime()<this._oMinDate.getTime()||a.getTime()>this._oMaxDate.getTime())){this._bValid=false;_.error("dateValue "+a.toString()+"(value="+this.getValue()+") does not match "+"min/max date range("+this._oMinDate.toString()+" - "+this._oMaxDate.toString()+"). App. "+"developers should take care to maintain dateValue/value accordingly.",this)}};w.prototype.getDisplayFormatType=function(){return this.getProperty("displayFormatType")};w.prototype._handleDateValidation=function(e){this._bValid=true;if(!e||e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime()){this._bValid=false;_.warning("Value can not be converted to a valid date",this)}var t=this._formatValue(e,true);if(t!==this.getValue()){this.setLastValue(t)}this.setProperty("value",t);this.setProperty("dateValue",e)};w.prototype.setDisplayFormatType=function(e){if(e){var t=false;for(var a in V){if(a==e){t=true;break}}if(!t){throw new Error(e+" is not a valid calendar type"+this)}}this.setProperty("displayFormatType",e,true);this.setDisplayFormat(this.getDisplayFormat());return this};w.prototype.setSecondaryCalendarType=function(e){this._bSecondaryCalendarTypeSet=true;this.setProperty("secondaryCalendarType",e,true);if(this._getCalendar()){this._getCalendar().setSecondaryCalendarType(e)}return this};w.prototype.setShowFooter=function(e){var t=this._oPopup,a=this._getCalendar();this.setProperty("showFooter",e);if(!t||!a){return this}t._getButtonFooter().setVisible(e);return this};w.prototype.addSpecialDate=function(e){I.call(this,e);this.addAggregation("specialDates",e,true);O.call(this);return this};w.prototype.insertSpecialDate=function(e,t){I.call(this,e);this.insertAggregation("specialDates",e,t,true);O.call(this);return this};w.prototype.removeSpecialDate=function(e){var t=this.removeAggregation("specialDates",e,true);O.call(this);return t};w.prototype.removeAllSpecialDates=function(){var e=this.removeAllAggregation("specialDates",true);O.call(this);return e};w.prototype.destroySpecialDates=function(){this.destroyAggregation("specialDates",true);O.call(this);return this};w.prototype.setLegend=function(e){this.setAssociation("legend",e,true);var t=this.getLegend();if(t){var a=sap.ui.require("sap/ui/unified/CalendarLegend");e=sap.ui.getCore().byId(t);if(e&&!(typeof a=="function"&&e instanceof a)){throw new Error(e+" is not an sap.ui.unified.CalendarLegend. "+this)}}if(this._getCalendar()){this._getCalendar().setLegend(t)}return this};w.prototype.onChange=function(e){if(!this.getEditable()||!this.getEnabled()){return}var t=this._$input.val(),a=this._formatValue(this.getDateValue()),i;if(t==a&&this._bValid){return}if(this.getShowFooter()&&this._oPopup&&!t){this._oPopup.getBeginButton().setEnabled(false)}this._bValid=true;if(t!=""){i=this._parseValue(t,true);if(!i||i.getTime()<this._oMinDate.getTime()||i.getTime()>this._oMaxDate.getTime()){this._bValid=false;i=undefined}else{t=this._formatValue(i)}}if(this.getDomRef()&&this._$input.val()!==t){this._$input.val(t);this._curpos=this._$input.cursorPos()}if(i){t=this._formatValue(i,true)}if(this.getLastValue()!==t||i&&this.getDateValue()&&i.getFullYear()!==this.getDateValue().getFullYear()){this.setLastValue(t);this.setProperty("value",t,true);var s=this.getValue();if(this._bValid&&t==s){this.setProperty("dateValue",i,true)}t=s;if(this.isOpen()){if(this._bValid){i=this.getDateValue()}this._getCalendar().focusDate(i);var o=this._oDateRange.getStartDate();if(!o&&i||o&&i&&o.getTime()!=i.getTime()){this._oDateRange.setStartDate(new Date(i.getTime()))}else if(o&&!i){this._oDateRange.setStartDate(undefined)}}this.fireChangeEvent(t,{valid:this._bValid})}};w.prototype._getInputValue=function(e){e=typeof e=="undefined"?this._$input.val():e.toString();var t=this._parseValue(e,true);e=this._formatValue(t,true);return e};w.prototype.updateDomValue=function(e){if(this.isActive()&&this._$input.val()!==e){this._bCheckDomValue=true;e=typeof e=="undefined"?this._$input.val():e.toString();this._curpos=this._$input.cursorPos();var t=this._parseValue(e,true);e=this._formatValue(t);this._$input.val(e);if(document.activeElement===this._$input[0]){this._$input.cursorPos(this._curpos)}}return this};function M(){this._createPopup();this._createPopupContent();var e;var t=this.getBinding("value");if(t&&t.oType&&t.oType.oOutputFormat){e=t.oType.oOutputFormat.oFormatOptions.calendarType}else if(t&&t.oType&&t.oType.oFormat){e=t.oType.oFormat.oFormatOptions.calendarType}if(!e){e=this.getDisplayFormatType()}if(e){this._getCalendar().setPrimaryCalendarType(e)}var a=this._bValid?this._formatValue(this.getDateValue()):this.getValue();if(a!=this._$input.val()){this.onChange()}this._fillDateRange();this._openPopup();this.fireNavigate({dateRange:this._getVisibleDatesRange(this._getCalendar()),afterPopupOpened:true})}w.prototype._createPopup=function(){var e="";if(!this._oPopup){this._oPopup=new n(this.getId()+"-RP",{showCloseButton:false,showArrow:false,showHeader:false,placement:l.PlacementType.VerticalPreferedBottom,contentWidth:this.$().closest(".sapUiSizeCompact").length>0?"18rem":"21rem",beginButton:new o({type:l.ButtonType.Emphasized,text:S.getText("DATEPICKER_SELECTION_CONFIRM"),press:this._handleOKButton.bind(this)}),afterOpen:R.bind(this),afterClose:F.bind(this)}).addStyleClass("sapMRPCalendar");if(this.getShowFooter()){this._oPopup.addStyleClass("sapMLandscapePadding")}this._oPopup._getPopup().setAutoClose(true);if(t.system.phone){e=T.getReferencingLabels(this).concat(this.getAriaLabelledBy()).reduce(function(e,t){var i=a.registry.get(t);return e+" "+(i.getText?i.getText():"")},"").trim();this._oPopup.setTitle(e);this._oPopup.setShowHeader(true);this._oPopup.setShowCloseButton(true)}else{this._oPopup._getPopup().setDurations(0,0);this._oPopup.setEndButton(new o({text:S.getText("DATEPICKER_SELECTION_CANCEL"),press:this._handleCancelButton.bind(this)}))}this.setAggregation("_popup",this._oPopup,true)}};w.prototype._openPopup=function(){if(!this._oPopup){return}this._oPopup._getPopup().setAutoCloseAreas([this.getDomRef()]);this._oPopup.openBy(this)};w.prototype._getVisibleDatesRange=function(e){var t=e._getVisibleDays();return new m({startDate:t[0].toLocalJSDate(),endDate:t[t.length-1].toLocalJSDate()})};w.prototype._createPopupContent=function(){var e=this._getCalendarConstructor();if(!this._getCalendar()){this._oCalendar=new e(this.getId()+"-cal",{intervalSelection:this._bIntervalSelection,minDate:this.getMinDate(),maxDate:this.getMaxDate(),legend:this.getLegend(),startDateChange:function(){this.fireNavigate({dateRange:this._getVisibleDatesRange(this._getCalendar())})}.bind(this)});this._oCalendar.setShowCurrentDateButton(this.getShowCurrentDateButton());this._oDateRange=new m;this._getCalendar().addSelectedDate(this._oDateRange);this._getCalendar()._setSpecialDatesControlOrigin(this);this._getCalendar().attachCancel(E,this);this._getCalendar().setPopupMode(true);if(this.$().closest(".sapUiSizeCompact").length>0){this._getCalendar().addStyleClass("sapUiSizeCompact")}if(this._bSecondaryCalendarTypeSet){this._getCalendar().setSecondaryCalendarType(this.getSecondaryCalendarType())}if(this._bOnlyCalendar){this._getCalendar().attachSelect(this._handleCalendarSelect,this);this._getCalendar().attachEvent("_renderMonth",x,this);this._oPopup._getButtonFooter().setVisible(this.getShowFooter());this._getCalendar()._bSkipCancelButtonRendering=true;if(!this._oPopup.getContent().length){var t=this._getValueStateHeader();this._oPopup.addContent(this._getValueStateHeader());t.setPopup(this._oPopup._oControl)}this._oPopup.addContent(this._getCalendar());if(!this.getDateValue()){this._oPopup.getBeginButton().setEnabled(false)}}this._oCalendarAfterRenderDelegate={onAfterRendering:function(){var e=this._oPopup&&this._oPopup._getPopup();e&&e._oLastPosition&&e._applyPosition(e._oLastPosition);if(this._oPopup.isOpen()){this._oCalendar.focus()}}.bind(this)};this._oCalendar.addDelegate(this._oCalendarAfterRenderDelegate)}};w.prototype._getCalendarConstructor=function(){var e=this._getFormatter(true).aFormatArray.map(function(e){return e.type.toLowerCase()}),t=e.indexOf("day")>=0,a=e.indexOf("month")>=0||e.indexOf("monthstandalone")>=0,i=e.indexOf("year")>=0;if(t&&a&&i){return D}else if(a&&i){return v}else if(i){return P}else{_.warning("Not valid date pattern! Default Calendar constructor function is returned",this);return D}};w.prototype._fillDateRange=function(){var e=this.getDateValue();if(e&&e.getTime()>=this._oMinDate.getTime()&&e.getTime()<=this._oMaxDate.getTime()){this._getCalendar().focusDate(new Date(e.getTime()));if(!this._oDateRange.getStartDate()||this._oDateRange.getStartDate().getTime()!=e.getTime()){this._oDateRange.setStartDate(new Date(e.getTime()))}}else{var t=this.getInitialFocusedDateValue();var a=t?t:new Date;var i=this._oMaxDate.getTime();if(a.getTime()<this._oMinDate.getTime()||a.getTime()>i){a=this._oMinDate}this._getCalendar().focusDate(a);if(this._oDateRange.getStartDate()){this._oDateRange.setStartDate(undefined)}}};w.prototype.getAccessibilityInfo=function(){var e=this.getRenderer();var t=i.prototype.getAccessibilityInfo.apply(this,arguments);var a=this.getValue()||"";if(this._bValid){var s=this.getDateValue();if(s){a=this._formatValue(s)}}t.type=S.getText("ACC_CTR_TYPE_DATEINPUT");t.description=[a,e.getLabelledByAnnouncement(this),e.getDescribedByAnnouncement(this)].join(" ").trim();return t};w.prototype._selectDate=function(){var e=this.getDateValue(),a=this._getSelectedDate(),i="";if(!g(a,e)){this.setDateValue(new Date(a.getTime()));i=this.getValue();this.fireChangeEvent(i,{valid:true});this._focusInput()}else if(!this._bValid){i=this._formatValue(a);if(i!=this._$input.val()){this._bValid=true;if(this.getDomRef()){this._$input.val(i);this.setLastValue(i)}i=this._formatValue(a,true);this.setProperty("value",i,true);this.fireChangeEvent(i,{valid:true});this._focusInput()}}else if(t.system.desktop||!t.support.touch){this.focus()}this._oPopup.close()};w.prototype._handleCalendarSelect=function(){if(this.getShowFooter()){this._oPopup.getBeginButton().setEnabled(true);return}this._selectDate()};w.prototype._focusInput=function(){if(this.getDomRef()&&(t.system.desktop||!t.support.touch)){this._curpos=this._$input.val().length;this._$input.cursorPos(this._curpos)}return this};w.prototype._getCalendar=function(){return this._oCalendar};w.prototype._getSelectedDate=function(){var e=this._getCalendar().getSelectedDates(),t;if(e.length>0){t=e[0].getStartDate()}return t};w.prototype._handleOKButton=function(){this._selectDate()};w.prototype._handleCancelButton=function(){if(!this.getDateValue()){this._oPopup.getBeginButton().setEnabled(false)}this._oPopup.close()};function E(e){if(this.isOpen()){this._oPopup.close();if(t.system.desktop||!t.support.touch){this.focus()}}}w.prototype._increaseDate=function(e,t){var a=this.getDateValue();var i=this._$input.cursorPos();if(a&&this.getEditable()&&this.getEnabled()){var s;var o=this.getBinding("value");if(o&&o.oType&&o.oType.oOutputFormat){s=o.oType.oOutputFormat.oFormatOptions.calendarType}else if(o&&o.oType&&o.oType.oFormat){s=o.oType.oFormat.oFormatOptions.calendarType}if(!s){s=this.getDisplayFormatType()}var n=p.getInstance(new Date(a.getTime()),s);a=p.getInstance(new Date(a.getTime()),s);switch(t){case"day":n.setDate(n.getDate()+e);break;case"month":n.setMonth(n.getMonth()+e);var r=(a.getMonth()+e)%12;if(r<0){r=12+r}while(n.getMonth()!=r){n.setDate(n.getDate()-1)}break;case"year":n.setFullYear(n.getFullYear()+e);while(n.getMonth()!=a.getMonth()){n.setDate(n.getDate()-1)}break;default:break}if(n.getTime()<this._oMinDate.getTime()){n=new p(this._oMinDate.getTime())}else if(n.getTime()>this._oMaxDate.getTime()){n=new p(this._oMaxDate.getTime())}if(!g(this.getDateValue(),n.getJSDate())){this.setDateValue(new Date(n.getTime()));this._curpos=i;this._$input.cursorPos(this._curpos);var l=this.getValue();this.fireChangeEvent(l,{valid:true})}}};w.prototype._getSpecialDates=function(){var e=this.getSpecialDates();for(var t=0;t<e.length;t++){var a=e[t].getSecondaryType()===b.CalendarDayType.NonWorking&&e[t].getType()!==b.CalendarDayType.NonWorking;if(a){var i=new C;i.setType(e[t].getSecondaryType());i.setStartDate(e[t].getStartDate());if(e[t].getEndDate()){i.setEndDate(e[t].getEndDate())}e.push(i)}}return e};function R(){this.addStyleClass(i.ICON_PRESSED_CSS_CLASS);this._renderedDays=this._getCalendar().$("-Month0-days").find(".sapUiCalItem").length;this.$("inner").attr("aria-owns",this.getId()+"-cal");this.$("inner").attr("aria-expanded",true);y.addPopoverInstance(this._oPopup);this._oCalendar.focus()}function F(){if(!this.getDateValue()){this._oPopup.getBeginButton().setEnabled(false)}this.removeStyleClass(i.ICON_PRESSED_CSS_CLASS);this.$("inner").attr("aria-expanded",false);this._getCalendar()._closePickers();y.removePopoverInstance(this._oPopup)}function x(e){var t=e.getParameter("days"),a=this._oPopup._getPopup();if(t>this._renderedDays){this._renderedDays=t;a._applyPosition(a._oLastPosition)}}function I(e){var t=sap.ui.require("sap/ui/unified/DateTypeRange");if(e&&!(t&&e instanceof t)){throw new Error(e+'is not valid for aggregation "specialDates" of '+this)}}function O(){if(this.isOpen()){this._getCalendar()._bDateRangeChanged=false;this._getCalendar().invalidate()}}return w});