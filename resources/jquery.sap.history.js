/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/base/util/uid","sap/base/strings/escapeRegExp"],function(e,t,r,i){"use strict";(function(n){var a="_skip",o=/\|id-[0-9]+-[0-9]+/,s=new RegExp(a+"[0-9]*$"),f=[],u=[],h={},l=0,c,p="|",y=[],d=false,g,v=false;e.sap.history=function(t){if(!e.isPlainObject(t)){return}if(!v){var r=e(n),i=n.location.href.split("#")[1]||"";r.on("hashchange",b);if(Array.isArray(t.routes)){var a,o;for(a=0;a<t.routes.length;a++){o=t.routes[a];if(o.path&&o.handler){e.sap.history.addRoute(o.path,o.handler)}}}if(typeof t.defaultHandler==="function"){g=t.defaultHandler}u.push(i);if(i.length>1){r.trigger("hashchange",[true])}else{c=i}v=true}};e.sap.history.addHistory=function(e,t,r,i){var a,o;if(r===undefined){r=true}if(!i){o=T(e,t);a=m(o);if(a){o+=p+a}o+=p+(r?"1":"0")}else{o=O(c)}y.push(o);h[o]=true;n.location.hash=o;return o};e.sap.history.addVirtualHistory=function(){e.sap.history.addHistory("",undefined,false,true)};e.sap.history.addRoute=function(t,r,i){if(i){r=e.proxy(r,i)}var n={};n.sIdentifier=t;n["action"]=r;f.push(n);return this};e.sap.history.setDefaultHandler=function(e){g=e};e.sap.history.getDefaultHandler=function(){return g};e.sap.history.backToHash=function(e){e=e||"";var r;if(u.length===1){if(typeof g==="function"){g()}}else{r=k(c,e);if(r<0){n.history.go(r)}else{t.error("jQuery.sap.history.backToHash: "+e+"is not in the history stack or it's after the current hash")}}};e.sap.history.backThroughPath=function(e){e=e||"";e=n.encodeURIComponent(e);var r;if(u.length===1){if(typeof g==="function"){g()}}else{r=k(c,e,true);if(r<0){n.history.go(r)}else{t.error("jQuery.sap.history.backThroughPath: there's no history state which has the "+e+" identifier in the history stack before the current hash")}}};e.sap.history.back=function(t){if(u.length===1){if(typeof g==="function"){g(e.sap.history.NavType.Back)}}else{if(!t){t=1}n.history.go(-1*t)}};e.sap.history.NavType={Back:"_back",Forward:"_forward",Bookmark:"_bookmark",Unknown:"_unknown"};function k(e,t,r){var i=u.indexOf(e),n,a,o;if(i>0){if(r){for(a=i-1;a>=0;a--){o=u[a];if(o.indexOf(t)===0&&!B(o)){return a-i}}}else{n=u.indexOf(t);if(n===-1&&t.length===0){return-1*i}if(n>-1&&n<i){return n-i}}}return 0}function b(e,t){var r=n.location.href.split("#")[1]||"";r=x(r);if(t||!h[r]){y.push(r)}if(!d){d=true;if(y.length>0){var i=y.shift();if(h[i]){I(i);delete h[i]}else{N(i)}c=i}d=false}}function x(e,t){var r=e,i=e?e.indexOf("#"):-1;if(i===0){r=r.slice(i+1)}if(t){r=r.replace(o,"")}return r}function O(e){var t=e?e:"";if(B(t)){var r=t.lastIndexOf(a);t=t.slice(0,r)}return t+a+l++}function T(e,t){var r=encodeURIComponent(e);var i=encodeURIComponent(JSON.stringify(t));return r+p+i}function m(e){var t=u.indexOf(c),i,n;if(t>-1){for(i=0;i<t+1;i++){n=u[i];if(n.slice(0,n.length-2)===e){return r()}}}return""}function I(e){var t=u.indexOf(c);if(!(t===-1||t===u.length-1)){u.splice(t+1,u.length-1-t)}u.push(e)}function B(e){return s.test(e)}function H(e,t){var r=u.indexOf(e),i;if(r!==-1){if(t){for(i=r;i<u.length;i++){if(!B(u[i])){return i-r}}}else{for(i=r;i>=0;i--){if(!B(u[i])){return i-r}}return-1*(r+1)}}}function N(r){var o,s,f,h,l;if(c===undefined){f=w(r);if(!f||!f.bBookmarkable){if(typeof g==="function"){g(e.sap.history.NavType.Bookmark)}return}}if(r.length===0){if(typeof g==="function"){g(e.sap.history.NavType.Back)}}else{h=u.indexOf(r);if(h===0){f=w(r);if(!f||!f.bBookmarkable){if(typeof g==="function"){g(e.sap.history.NavType.Back)}return}}if(B(r)){if(B(c)){s=H(r,false);n.history.go(s)}else{var p=new RegExp(i(c+a)+"[0-9]*$");if(p.test(r)){s=H(r,true);if(s){n.history.go(s)}else{n.history.back()}}else{s=H(r,false);n.history.go(s)}}}else{if(h===-1){l=e.sap.history.NavType.Unknown;u.push(r)}else{if(u.indexOf(c,h+1)===-1){l=e.sap.history.NavType.Forward}else{l=e.sap.history.NavType.Back}}f=w(r);if(f){o=R(f.sIdentifier);if(o){o.action.apply(null,[f.oStateData,l])}}else{t.error("hash format error! The current Hash: "+r)}}}}function R(e){var t;for(t=0;t<f.length;t++){if(f[t].sIdentifier===e){return f[t]}}}function w(e){if(B(e)){var t=e.lastIndexOf(a);e=e.slice(0,t)}var r=e.split(p),i={};if(r.length===4||r.length===3){i.sIdentifier=n.decodeURIComponent(r[0]);i.oStateData=JSON.parse(n.decodeURIComponent(r[1]));if(r.length===4){i.uid=r[2]}i.bBookmarkable=r[r.length-1]==="0"?false:true;return i}else{return null}}})(this);return e});